/*!
 * PixiJS - v8.8.0
 * Compiled Tue, 11 Feb 2025 15:45:29 UTC
 *
 * PixiJS is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
var PIXI=function(t){"use strict";var e,r=Object.defineProperty,i=Object.defineProperties,s=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,l=(t,e,i)=>e in t?r(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,h=(t,e)=>{for(var r in e||(e={}))o.call(e,r)&&l(t,r,e[r]);if(n)for(var r of n(e))a.call(e,r)&&l(t,r,e[r]);return t},u=((e=u||{}).Application="application",e.WebGLPipes="webgl-pipes",e.WebGLPipesAdaptor="webgl-pipes-adaptor",e.WebGLSystem="webgl-system",e.WebGPUPipes="webgpu-pipes",e.WebGPUPipesAdaptor="webgpu-pipes-adaptor",e.WebGPUSystem="webgpu-system",e.CanvasSystem="canvas-system",e.CanvasPipesAdaptor="canvas-pipes-adaptor",e.CanvasPipes="canvas-pipes",e.Asset="asset",e.LoadParser="load-parser",e.ResolveParser="resolve-parser",e.CacheParser="cache-parser",e.DetectionParser="detection-parser",e.MaskEffect="mask-effect",e.BlendMode="blend-mode",e.TextureSource="texture-source",e.Environment="environment",e.ShapeBuilder="shape-builder",e.Batcher="batcher",e);const c=t=>{if("function"==typeof t||"object"==typeof t&&t.extension){const e="object"!=typeof t.extension?{type:t.extension}:t.extension;t=((t,e)=>i(t,s(e)))(h({},e),{ref:t})}if("object"!=typeof t)throw new Error("Invalid extension type");return"string"==typeof(t=h({},t)).type&&(t.type=[t.type]),t},d=(t,e)=>{var r;return null!=(r=c(t).priority)?r:e},p={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(c).forEach((t=>{t.type.forEach((e=>{var r,i;return null==(i=(r=this._removeHandlers)[e])?void 0:i.call(r,t)}))})),this},add(...t){return t.map(c).forEach((t=>{t.type.forEach((e=>{var r,i;const s=this._addHandlers,n=this._queue;s[e]?null==(i=s[e])||i.call(s,t):(n[e]=n[e]||[],null==(r=n[e])||r.push(t))}))})),this},handle(t,e,r){var i;const s=this._addHandlers,n=this._removeHandlers;s[t]=e,n[t]=r;const o=this._queue;return o[t]&&(null==(i=o[t])||i.forEach((t=>e(t))),delete o[t]),this},handleByMap(t,e){return this.handle(t,(t=>{t.name&&(e[t.name]=t.ref)}),(t=>{t.name&&delete e[t.name]}))},handleByNamedList(t,e,r=-1){return this.handle(t,(t=>{e.findIndex((e=>e.name===t.name))>=0||(e.push({name:t.name,value:t.ref}),e.sort(((t,e)=>d(e.value,r)-d(t.value,r))))}),(t=>{const r=e.findIndex((e=>e.name===t.name));-1!==r&&e.splice(r,1)}))},handleByList(t,e,r=-1){return this.handle(t,(t=>{e.includes(t.ref)||(e.push(t.ref),e.sort(((t,e)=>d(e,r)-d(t,r))))}),(t=>{const r=e.indexOf(t.ref);-1!==r&&e.splice(r,1)}))},mixin(t,...e){for(const r of e)Object.defineProperties(t.prototype,Object.getOwnPropertyDescriptors(r))}};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function f(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var g={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,r="~";function i(){}function s(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function n(t,e,i,n,o){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new s(i,n||t,o),l=r?r+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],a]:t._events[l].push(a):(t._events[l]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function a(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),a.prototype.eventNames=function(){var t,i,s=[];if(0===this._eventsCount)return s;for(i in t=this._events)e.call(t,i)&&s.push(r?i.slice(1):i);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(t)):s},a.prototype.listeners=function(t){var e=r?r+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var s=0,n=i.length,o=new Array(n);s<n;s++)o[s]=i[s].fn;return o},a.prototype.listenerCount=function(t){var e=r?r+t:t,i=this._events[e];return i?i.fn?1:i.length:0},a.prototype.emit=function(t,e,i,s,n,o){var a=r?r+t:t;if(!this._events[a])return!1;var l,h,u=this._events[a],c=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,i),!0;case 4:return u.fn.call(u.context,e,i,s),!0;case 5:return u.fn.call(u.context,e,i,s,n),!0;case 6:return u.fn.call(u.context,e,i,s,n,o),!0}for(h=1,l=new Array(c-1);h<c;h++)l[h-1]=arguments[h];u.fn.apply(u.context,l)}else{var d,p=u.length;for(h=0;h<p;h++)switch(u[h].once&&this.removeListener(t,u[h].fn,void 0,!0),c){case 1:u[h].fn.call(u[h].context);break;case 2:u[h].fn.call(u[h].context,e);break;case 3:u[h].fn.call(u[h].context,e,i);break;case 4:u[h].fn.call(u[h].context,e,i,s);break;default:if(!l)for(d=1,l=new Array(c-1);d<c;d++)l[d-1]=arguments[d];u[h].fn.apply(u[h].context,l)}}return!0},a.prototype.on=function(t,e,r){return n(this,t,e,r,!1)},a.prototype.once=function(t,e,r){return n(this,t,e,r,!0)},a.prototype.removeListener=function(t,e,i,s){var n=r?r+t:t;if(!this._events[n])return this;if(!e)return o(this,n),this;var a=this._events[n];if(a.fn)a.fn===e&&(!s||a.once)&&(!i||a.context===i)&&o(this,n);else{for(var l=0,h=[],u=a.length;l<u;l++)(a[l].fn!==e||s&&!a[l].once||i&&a[l].context!==i)&&h.push(a[l]);h.length?this._events[n]=1===h.length?h[0]:h:o(this,n)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&o(this,e)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,t.exports=a}(g);var m=f(g.exports),_={grad:.9,turn:360,rad:360/(2*Math.PI)},x=function(t){return"string"==typeof t?t.length>0:"number"==typeof t},y=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=Math.pow(10,e)),Math.round(r*t)/r+0},b=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=1),t>r?r:t>e?t:e},v=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},T=function(t){return{r:b(t.r,0,255),g:b(t.g,0,255),b:b(t.b,0,255),a:b(t.a)}},S=function(t){return{r:y(t.r),g:y(t.g),b:y(t.b),a:y(t.a,3)}},w=/^#([0-9a-f]{3,8})$/i,E=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},A=function(t){var e=t.r,r=t.g,i=t.b,s=t.a,n=Math.max(e,r,i),o=n-Math.min(e,r,i),a=o?n===e?(r-i)/o:n===r?2+(i-e)/o:4+(e-r)/o:0;return{h:60*(a<0?a+6:a),s:n?o/n*100:0,v:n/255*100,a:s}},P=function(t){var e=t.h,r=t.s,i=t.v,s=t.a;e=e/360*6,r/=100,i/=100;var n=Math.floor(e),o=i*(1-r),a=i*(1-(e-n)*r),l=i*(1-(1-e+n)*r),h=n%6;return{r:255*[i,a,o,o,l,i][h],g:255*[l,i,i,a,o,o][h],b:255*[o,o,l,i,i,a][h],a:s}},M=function(t){return{h:v(t.h),s:b(t.s,0,100),l:b(t.l,0,100),a:b(t.a)}},R=function(t){return{h:y(t.h),s:y(t.s),l:y(t.l),a:y(t.a,3)}},C=function(t){return P((r=(e=t).s,{h:e.h,s:(r*=((i=e.l)<50?i:100-i)/100)>0?2*r/(i+r)*100:0,v:i+r,a:e.a}));var e,r,i},O=function(t){return{h:(e=A(t)).h,s:(s=(200-(r=e.s))*(i=e.v)/100)>0&&s<200?r*i/100/(s<=100?s:200-s)*100:0,l:s/2,a:e.a};var e,r,i,s},I=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,B=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,k=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,G=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,D={string:[[function(t){var e=w.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:4===t.length?y(parseInt(t[3]+t[3],16)/255,2):1}:6===t.length||8===t.length?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:8===t.length?y(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=k.exec(t)||G.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:T({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:void 0===e[7]?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=I.exec(t)||B.exec(t);if(!e)return null;var r,i,s=M({h:(r=e[1],i=e[2],void 0===i&&(i="deg"),Number(r)*(_[i]||1)),s:Number(e[3]),l:Number(e[4]),a:void 0===e[5]?1:Number(e[5])/(e[6]?100:1)});return C(s)},"hsl"]],object:[[function(t){var e=t.r,r=t.g,i=t.b,s=t.a,n=void 0===s?1:s;return x(e)&&x(r)&&x(i)?T({r:Number(e),g:Number(r),b:Number(i),a:Number(n)}):null},"rgb"],[function(t){var e=t.h,r=t.s,i=t.l,s=t.a,n=void 0===s?1:s;if(!x(e)||!x(r)||!x(i))return null;var o=M({h:Number(e),s:Number(r),l:Number(i),a:Number(n)});return C(o)},"hsl"],[function(t){var e=t.h,r=t.s,i=t.v,s=t.a,n=void 0===s?1:s;if(!x(e)||!x(r)||!x(i))return null;var o,a=(o={h:Number(e),s:Number(r),v:Number(i),a:Number(n)},{h:v(o.h),s:b(o.s,0,100),v:b(o.v,0,100),a:b(o.a)});return P(a)},"hsv"]]},F=function(t,e){for(var r=0;r<e.length;r++){var i=e[r][0](t);if(i)return[i,e[r][1]]}return[null,void 0]},N=function(t){return"string"==typeof t?F(t.trim(),D.string):"object"==typeof t&&null!==t?F(t,D.object):[null,void 0]},U=function(t,e){var r=O(t);return{h:r.h,s:b(r.s+100*e,0,100),l:r.l,a:r.a}},L=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},z=function(t,e){var r=O(t);return{h:r.h,s:r.s,l:b(r.l+100*e,0,100),a:r.a}},X=function(){function t(t){this.parsed=N(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return null!==this.parsed},t.prototype.brightness=function(){return y(L(this.rgba),2)},t.prototype.isDark=function(){return L(this.rgba)<.5},t.prototype.isLight=function(){return L(this.rgba)>=.5},t.prototype.toHex=function(){return e=(t=S(this.rgba)).r,r=t.g,i=t.b,n=(s=t.a)<1?E(y(255*s)):"","#"+E(e)+E(r)+E(i)+n;var t,e,r,i,s,n},t.prototype.toRgb=function(){return S(this.rgba)},t.prototype.toRgbString=function(){return e=(t=S(this.rgba)).r,r=t.g,i=t.b,(s=t.a)<1?"rgba("+e+", "+r+", "+i+", "+s+")":"rgb("+e+", "+r+", "+i+")";var t,e,r,i,s},t.prototype.toHsl=function(){return R(O(this.rgba))},t.prototype.toHslString=function(){return e=(t=R(O(this.rgba))).h,r=t.s,i=t.l,(s=t.a)<1?"hsla("+e+", "+r+"%, "+i+"%, "+s+")":"hsl("+e+", "+r+"%, "+i+"%)";var t,e,r,i,s},t.prototype.toHsv=function(){return t=A(this.rgba),{h:y(t.h),s:y(t.s),v:y(t.v),a:y(t.a,3)};var t},t.prototype.invert=function(){return H({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},t.prototype.saturate=function(t){return void 0===t&&(t=.1),H(U(this.rgba,t))},t.prototype.desaturate=function(t){return void 0===t&&(t=.1),H(U(this.rgba,-t))},t.prototype.grayscale=function(){return H(U(this.rgba,-1))},t.prototype.lighten=function(t){return void 0===t&&(t=.1),H(z(this.rgba,t))},t.prototype.darken=function(t){return void 0===t&&(t=.1),H(z(this.rgba,-t))},t.prototype.rotate=function(t){return void 0===t&&(t=15),this.hue(this.hue()+t)},t.prototype.alpha=function(t){return"number"==typeof t?H({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):y(this.rgba.a,3);var e},t.prototype.hue=function(t){var e=O(this.rgba);return"number"==typeof t?H({h:t,s:e.s,l:e.l,a:e.a}):y(e.h)},t.prototype.isEqual=function(t){return this.toHex()===H(t).toHex()},t}(),H=function(t){return t instanceof X?t:new X(t)},j=[];var V=Object.defineProperty,W=Object.getOwnPropertySymbols,$=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable,q=(t,e,r)=>e in t?V(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;!function(t){t.forEach((function(t){j.indexOf(t)<0&&(t(X,D),j.push(t))}))}([function(t,e){var r={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var s in r)i[r[s]]=s;var n={};t.prototype.toName=function(e){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var s,o,a=i[this.toHex()];if(a)return a;if(null!=e&&e.closest){var l=this.toRgb(),h=1/0,u="black";if(!n.length)for(var c in r)n[c]=new t(r[c]).toRgb();for(var d in r){var p=(s=l,o=n[d],Math.pow(s.r-o.r,2)+Math.pow(s.g-o.g,2)+Math.pow(s.b-o.b,2));p<h&&(h=p,u=d)}return u}},e.string.push([function(e){var i=e.toLowerCase(),s="transparent"===i?"#0000":r[i];return s?new t(s).toRgb():null},"name"])}]);const K=class t{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(e){if(e instanceof t)this._value=this._cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(null===e)throw new Error("Cannot set Color#value to null");(null===this._value||!this._isSourceEqual(this._value,e))&&(this._value=this._cloneSource(e),this._normalize(this._value))}}get value(){return this._value}_cloneSource(t){return"string"==typeof t||"number"==typeof t||t instanceof Number||null===t?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):"object"==typeof t&&null!==t?((t,e)=>{for(var r in e||(e={}))$.call(e,r)&&q(t,r,e[r]);if(W)for(var r of W(e))Y.call(e,r)&&q(t,r,e[r]);return t})({},t):t}_isSourceEqual(t,e){const r=typeof t;if(r!==typeof e)return!1;if("number"===r||"string"===r||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length===e.length&&t.every(((t,r)=>t===e[r]));if(null!==t&&null!==e){const r=Object.keys(t),i=Object.keys(e);return r.length===i.length&&r.every((r=>t[r]===e[r]))}return t===e}toRgba(){const[t,e,r,i]=this._components;return{r:t,g:e,b:r,a:i}}toRgb(){const[t,e,r]=this._components;return{r:t,g:e,b:r}}toRgbaString(){const[t,e,r]=this.toUint8RgbArray();return`rgba(${t},${e},${r},${this.alpha})`}toUint8RgbArray(t){const[e,r,i]=this._components;return this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb),t[0]=Math.round(255*e),t[1]=Math.round(255*r),t[2]=Math.round(255*i),t}toArray(t){this._arrayRgba||(this._arrayRgba=[]),t||(t=this._arrayRgba);const[e,r,i,s]=this._components;return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t}toRgbArray(t){this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb);const[e,r,i]=this._components;return t[0]=e,t[1]=r,t[2]=i,t}toNumber(){return this._int}toBgrNumber(){const[t,e,r]=this.toUint8RgbArray();return(r<<16)+(e<<8)+t}toLittleEndianNumber(){const t=this._int;return(t>>16)+(65280&t)+((255&t)<<16)}multiply(e){const[r,i,s,n]=t._temp.setValue(e)._components;return this._components[0]*=r,this._components[1]*=i,this._components[2]*=s,this._components[3]*=n,this._refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this._refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(1===t)return(255<<24)+this._int;if(0===t)return e?0:this._int;let r=this._int>>16&255,i=this._int>>8&255,s=255&this._int;return e&&(r=r*t+.5|0,i=i*t+.5|0,s=s*t+.5|0),(255*t<<24)+(r<<16)+(i<<8)+s}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}_normalize(e){let r,i,s,n;if(("number"==typeof e||e instanceof Number)&&e>=0&&e<=16777215){r=(e>>16&255)/255,i=(e>>8&255)/255,s=(255&e)/255,n=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[r,i,s,n=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[r,i,s,n=255]=e,r/=255,i/=255,s/=255,n/=255;else if("string"==typeof e||"object"==typeof e){if("string"==typeof e){const r=t.HEX_PATTERN.exec(e);r&&(e=`#${r[2]}`)}const o=H(e);o.isValid()&&(({r:r,g:i,b:s,a:n}=o.rgba),r/=255,i/=255,s/=255)}if(void 0===r)throw new Error(`Unable to convert color ${e}`);this._components[0]=r,this._components[1]=i,this._components[2]=s,this._components[3]=n,this._refreshInt()}_refreshInt(){this._clamp(this._components);const[t,e,r]=this._components;this._int=(255*t<<16)+(255*e<<8)+(255*r|0)}_clamp(t,e=0,r=1){return"number"==typeof t?Math.min(Math.max(t,e),r):(t.forEach(((i,s)=>{t[s]=Math.min(Math.max(i,e),r)})),t)}static isColorLike(e){return"number"==typeof e||"string"==typeof e||e instanceof Number||e instanceof t||Array.isArray(e)||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Float32Array||void 0!==e.r&&void 0!==e.g&&void 0!==e.b||void 0!==e.r&&void 0!==e.g&&void 0!==e.b&&void 0!==e.a||void 0!==e.h&&void 0!==e.s&&void 0!==e.l||void 0!==e.h&&void 0!==e.s&&void 0!==e.l&&void 0!==e.a||void 0!==e.h&&void 0!==e.s&&void 0!==e.v||void 0!==e.h&&void 0!==e.s&&void 0!==e.v&&void 0!==e.a}};K.shared=new K,K._temp=new K,K.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Q=K;const Z={cullArea:null,cullable:!1,cullableChildren:!0},J=2*Math.PI,tt=180/Math.PI,et=Math.PI/180;class rt{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new rt(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}static get shared(){return it.x=0,it.y=0,it}}const it=new rt;class st{constructor(t=1,e=0,r=0,i=1,s=0,n=0){this.array=null,this.a=t,this.b=e,this.c=r,this.d=i,this.tx=s,this.ty=n}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,r,i,s,n){return this.a=t,this.b=e,this.c=r,this.d=i,this.tx=s,this.ty=n,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,e){e=e||new rt;const r=t.x,i=t.y;return e.x=this.a*r+this.c*i+this.tx,e.y=this.b*r+this.d*i+this.ty,e}applyInverse(t,e){e=e||new rt;const r=this.a,i=this.b,s=this.c,n=this.d,o=this.tx,a=this.ty,l=1/(r*n+s*-i),h=t.x,u=t.y;return e.x=n*l*h+-s*l*u+(a*s-o*n)*l,e.y=r*l*u+-i*l*h+(-a*r+o*i)*l,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),r=Math.sin(t),i=this.a,s=this.c,n=this.tx;return this.a=i*e-this.b*r,this.b=i*r+this.b*e,this.c=s*e-this.d*r,this.d=s*r+this.d*e,this.tx=n*e-this.ty*r,this.ty=n*r+this.ty*e,this}append(t){const e=this.a,r=this.b,i=this.c,s=this.d;return this.a=t.a*e+t.b*i,this.b=t.a*r+t.b*s,this.c=t.c*e+t.d*i,this.d=t.c*r+t.d*s,this.tx=t.tx*e+t.ty*i+this.tx,this.ty=t.tx*r+t.ty*s+this.ty,this}appendFrom(t,e){const r=t.a,i=t.b,s=t.c,n=t.d,o=t.tx,a=t.ty,l=e.a,h=e.b,u=e.c,c=e.d;return this.a=r*l+i*u,this.b=r*h+i*c,this.c=s*l+n*u,this.d=s*h+n*c,this.tx=o*l+a*u+e.tx,this.ty=o*h+a*c+e.ty,this}setTransform(t,e,r,i,s,n,o,a,l){return this.a=Math.cos(o+l)*s,this.b=Math.sin(o+l)*s,this.c=-Math.sin(o-a)*n,this.d=Math.cos(o-a)*n,this.tx=t-(r*this.a+i*this.c),this.ty=e-(r*this.b+i*this.d),this}prepend(t){const e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){const e=this.a,r=this.c;this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,r=this.b,i=this.c,s=this.d,n=t.pivot,o=-Math.atan2(-i,s),a=Math.atan2(r,e),l=Math.abs(o+a);return l<1e-5||Math.abs(J-l)<1e-5?(t.rotation=a,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=a),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(i*i+s*s),t.position.x=this.tx+(n.x*e+n.y*i),t.position.y=this.ty+(n.x*r+n.y*s),t}invert(){const t=this.a,e=this.b,r=this.c,i=this.d,s=this.tx,n=t*i-e*r;return this.a=i/n,this.b=-e/n,this.c=-r/n,this.d=t/n,this.tx=(r*this.ty-i*s)/n,this.ty=-(t*this.ty-e*s)/n,this}isIdentity(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.tx&&0===this.ty}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new st;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}equals(t){return t.a===this.a&&t.b===this.b&&t.c===this.c&&t.d===this.d&&t.tx===this.tx&&t.ty===this.ty}static get IDENTITY(){return ot.identity()}static get shared(){return nt.identity()}}const nt=new st,ot=new st;class at{constructor(t,e,r){this._x=e||0,this._y=r||0,this._observer=t}clone(t){return new at(null!=t?t:this._observer,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this._observer._onUpdate(this)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this._observer._onUpdate(this)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this._observer._onUpdate(this))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this._observer._onUpdate(this))}}const lt={default:-1};function ht(t="default"){return void 0===lt[t]&&(lt[t]=-1),++lt[t]}class ut{constructor(t,e){this._pool=[],this._count=0,this._index=0,this._classType=t,e&&this.prepopulate(e)}prepopulate(t){for(let e=0;e<t;e++)this._pool[this._index++]=new this._classType;this._count+=t}get(t){var e;let r;return r=this._index>0?this._pool[--this._index]:new this._classType,null==(e=r.init)||e.call(r,t),r}return(t){var e;null==(e=t.reset)||e.call(t),this._pool[this._index++]=t}get totalSize(){return this._count}get totalFree(){return this._index}get totalUsed(){return this._count-this._index}clear(){this._pool.length=0,this._index=0}}class ct{constructor(){this._poolsByClass=new Map}prepopulate(t,e){this.getPool(t).prepopulate(e)}get(t,e){return this.getPool(t).get(e)}return(t){this.getPool(t.constructor).return(t)}getPool(t){return this._poolsByClass.has(t)||this._poolsByClass.set(t,new ut(t)),this._poolsByClass.get(t)}stats(){const t={};return this._poolsByClass.forEach((e=>{const r=t[e._classType.name]?e._classType.name+e._classType.ID:e._classType.name;t[r]={free:e.totalFree,used:e.totalUsed,size:e.totalSize}})),t}}const dt=new ct,pt={get isCachedAsTexture(){var t;return!(null==(t=this.renderGroup)||!t.isCachedAsTexture)},cacheAsTexture(t){"boolean"==typeof t&&!1===t?this.disableRenderGroup():(this.enableRenderGroup(),this.renderGroup.enableCacheAsTexture(!0===t?{}:t))},updateCacheTexture(){var t;null==(t=this.renderGroup)||t.updateCacheTexture()},get cacheAsBitmap(){return this.isCachedAsTexture},set cacheAsBitmap(t){this.cacheAsTexture(t)}};function ft(t,e,r){const i=t.length;let s;if(e>=i||0===r)return;const n=i-(r=e+r>i?i-e:r);for(s=e;s<n;++s)t[s]=t[s+r];t.length=n}const gt={allowChildren:!0,removeChildren(t=0,e){const r=null!=e?e:this.children.length,i=r-t,s=[];if(i>0&&i<=r){for(let e=r-1;e>=t;e--){const t=this.children[e];t&&(s.push(t),t.parent=null)}ft(this.children,t,r);const e=this.renderGroup||this.parentRenderGroup;e&&e.removeChildren(s);for(let t=0;t<s.length;++t)this.emit("childRemoved",s[t],this,t),s[t].emit("removed",this);return s.length>0&&this._didViewChangeTick++,s}if(0===i&&0===this.children.length)return s;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(t){const e=this.getChildAt(t);return this.removeChild(e)},getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]},setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);this.getChildIndex(t),this.addChildAt(t,e)},getChildIndex(t){const e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied Container must be a child of the caller");return e},addChildAt(t,e){const{children:r}=this;if(e<0||e>r.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${r.length}`);if(t.parent){const r=t.parent.children.indexOf(t);if(t.parent===this&&r===e)return t;-1!==r&&t.parent.children.splice(r,1)}e===r.length?r.push(t):r.splice(e,0,t),t.parent=this,t.didChange=!0,t._updateFlags=15;const i=this.renderGroup||this.parentRenderGroup;return i&&i.addChild(t),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",t,this,e),t.emit("added",this),t},swapChildren(t,e){if(t===e)return;const r=this.getChildIndex(t),i=this.getChildIndex(e);this.children[r]=e,this.children[i]=t;const s=this.renderGroup||this.parentRenderGroup;s&&(s.structureDidChange=!0),this._didContainerChangeTick++},removeFromParent(){var t;null==(t=this.parent)||t.removeChild(this)},reparentChild(...t){return 1===t.length?this.reparentChildAt(t[0],this.children.length):(t.forEach((t=>this.reparentChildAt(t,this.children.length))),t[0])},reparentChildAt(t,e){if(t.parent===this)return this.setChildIndex(t,e),t;const r=t.worldTransform.clone();t.removeFromParent(),this.addChildAt(t,e);const i=this.worldTransform.clone();return i.invert(),r.prepend(i),t.setFromMatrix(r),t}},mt={collectRenderables(t,e,r){this.parentRenderLayer&&this.parentRenderLayer!==r||this.globalDisplayStatus<7||!this.includeInBuild||(this.sortableChildren&&this.sortChildren(),this.isSimple?this.collectRenderablesSimple(t,e,r):this.renderGroup?e.renderPipes.renderGroup.addRenderGroup(this.renderGroup,t):this.collectRenderablesWithEffects(t,e,r))},collectRenderablesSimple(t,e,r){const i=this.children,s=i.length;for(let n=0;n<s;n++)i[n].collectRenderables(t,e,r)},collectRenderablesWithEffects(t,e,r){const{renderPipes:i}=e;for(let e=0;e<this.effects.length;e++){const r=this.effects[e];i[r.pipe].push(r,this,t)}this.collectRenderablesSimple(t,e,r);for(let e=this.effects.length-1;e>=0;e--){const r=this.effects[e];i[r.pipe].pop(r,this,t)}}};class _t{constructor(){this.pipe="filter",this.priority=1}destroy(){for(let t=0;t<this.filters.length;t++)this.filters[t].destroy();this.filters=null,this.filterArea=null}}class xt{constructor(){this._effectClasses=[],this._tests=[],this._initialized=!1}init(){this._initialized||(this._initialized=!0,this._effectClasses.forEach((t=>{this.add({test:t.test,maskClass:t})})))}add(t){this._tests.push(t)}getMaskEffect(t){this._initialized||this.init();for(let e=0;e<this._tests.length;e++){const r=this._tests[e];if(r.test(t))return dt.get(r.maskClass,t)}return t}returnMaskEffect(t){dt.return(t)}}const yt=new xt;p.handleByList(u.MaskEffect,yt._effectClasses);var bt=Object.defineProperty,vt=Object.getOwnPropertySymbols,Tt=Object.prototype.hasOwnProperty,St=Object.prototype.propertyIsEnumerable,wt=(t,e,r)=>e in t?bt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Et=(t,e)=>{for(var r in e||(e={}))Tt.call(e,r)&&wt(t,r,e[r]);if(vt)for(var r of vt(e))St.call(e,r)&&wt(t,r,e[r]);return t};const At={_maskEffect:null,_maskOptions:{inverse:!1},_filterEffect:null,effects:[],_markStructureAsChanged(){const t=this.renderGroup||this.parentRenderGroup;t&&(t.structureDidChange=!0)},addEffect(t){-1===this.effects.indexOf(t)&&(this.effects.push(t),this.effects.sort(((t,e)=>t.priority-e.priority)),this._markStructureAsChanged(),this._updateIsSimple())},removeEffect(t){const e=this.effects.indexOf(t);-1!==e&&(this.effects.splice(e,1),this._markStructureAsChanged(),this._updateIsSimple())},set mask(t){const e=this._maskEffect;(null==e?void 0:e.mask)!==t&&(e&&(this.removeEffect(e),yt.returnMaskEffect(e),this._maskEffect=null),null!=t&&(this._maskEffect=yt.getMaskEffect(t),this.addEffect(this._maskEffect)))},setMask(t){this._maskOptions=Et(Et({},this._maskOptions),t),t.mask&&(this.mask=t.mask),this._markStructureAsChanged()},get mask(){var t;return null==(t=this._maskEffect)?void 0:t.mask},set filters(t){var e;!Array.isArray(t)&&t&&(t=[t]);const r=this._filterEffect||(this._filterEffect=new _t),i=(null==t?void 0:t.length)>0,s=i!==(null==(e=r.filters)?void 0:e.length)>0;t=Array.isArray(t)?t.slice(0):t,r.filters=Object.freeze(t),s&&(i?this.addEffect(r):(this.removeEffect(r),r.filters=null!=t?t:null))},get filters(){var t;return null==(t=this._filterEffect)?void 0:t.filters},set filterArea(t){this._filterEffect||(this._filterEffect=new _t),this._filterEffect.filterArea=t},get filterArea(){var t;return null==(t=this._filterEffect)?void 0:t.filterArea}},Pt={label:null,get name(){return this.label},set name(t){this.label=t},getChildByName(t,e=!1){return this.getChildByLabel(t,e)},getChildByLabel(t,e=!1){const r=this.children;for(let e=0;e<r.length;e++){const i=r[e];if(i.label===t||t instanceof RegExp&&t.test(i.label))return i}if(e)for(let e=0;e<r.length;e++){const i=r[e].getChildByLabel(t,!0);if(i)return i}return null},getChildrenByLabel(t,e=!1,r=[]){const i=this.children;for(let e=0;e<i.length;e++){const s=i[e];(s.label===t||t instanceof RegExp&&t.test(s.label))&&r.push(s)}if(e)for(let e=0;e<i.length;e++)i[e].getChildrenByLabel(t,!0,r);return r}},Mt=[new rt,new rt,new rt,new rt];class Rt{constructor(t=0,e=0,r=0,i=0){this.type="rectangle",this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(i)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}isEmpty(){return this.left===this.right||this.top===this.bottom}static get EMPTY(){return new Rt(0,0,0,0)}clone(){return new Rt(this.x,this.y,this.width,this.height)}copyFromBounds(t){return this.x=t.minX,this.y=t.minY,this.width=t.maxX-t.minX,this.height=t.maxY-t.minY,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)}strokeContains(t,e,r,i=.5){const{width:s,height:n}=this;if(s<=0||n<=0)return!1;const o=this.x,a=this.y,l=r*(1-i),h=r-l;return t>=o-l&&t<=o+s+l&&e>=a-l&&e<=a+n+l&&!(t>o+h&&t<o+s-h&&e>a+h&&e<a+n-h)}intersects(t,e){if(!e){const e=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=e)return!1;const r=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>r}const r=this.left,i=this.right,s=this.top,n=this.bottom;if(i<=r||n<=s)return!1;const o=Mt[0].set(t.left,t.top),a=Mt[1].set(t.left,t.bottom),l=Mt[2].set(t.right,t.top),h=Mt[3].set(t.right,t.bottom);if(l.x<=o.x||a.y<=o.y)return!1;const u=Math.sign(e.a*e.d-e.b*e.c);if(0===u||(e.apply(o,o),e.apply(a,a),e.apply(l,l),e.apply(h,h),Math.max(o.x,a.x,l.x,h.x)<=r||Math.min(o.x,a.x,l.x,h.x)>=i||Math.max(o.y,a.y,l.y,h.y)<=s||Math.min(o.y,a.y,l.y,h.y)>=n))return!1;const c=u*(a.y-o.y),d=u*(o.x-a.x),p=c*r+d*s,f=c*i+d*s,g=c*r+d*n,m=c*i+d*n;if(Math.max(p,f,g,m)<=c*o.x+d*o.y||Math.min(p,f,g,m)>=c*h.x+d*h.y)return!1;const _=u*(o.y-l.y),x=u*(l.x-o.x),y=_*r+x*s,b=_*i+x*s,v=_*r+x*n,T=_*i+x*n;return!(Math.max(y,b,v,T)<=_*o.x+x*o.y||Math.min(y,b,v,T)>=_*h.x+x*h.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this}fit(t){const e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),i=Math.max(this.y,t.y),s=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=i,this.height=Math.max(s-i,0),this}ceil(t=1,e=.001){const r=Math.ceil((this.x+this.width-e)*t)/t,i=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=i-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),i=Math.min(this.y,t.y),s=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=i,this.height=s-i,this}getBounds(t){return t||(t=new Rt),t.copyFrom(this),t}containsRect(t){if(this.width<=0||this.height<=0)return!1;const e=t.x,r=t.y,i=t.x+t.width,s=t.y+t.height;return e>=this.x&&e<this.x+this.width&&r>=this.y&&r<this.y+this.height&&i>=this.x&&i<this.x+this.width&&s>=this.y&&s<this.y+this.height}}const Ct=new st;class Ot{constructor(t=1/0,e=1/0,r=-1/0,i=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Ct,this.minX=t,this.minY=e,this.maxX=r,this.maxY=i}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this._rectangle||(this._rectangle=new Rt);const t=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(t.x=0,t.y=0,t.width=0,t.height=0):t.copyFromBounds(this),t}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Ct,this}set(t,e,r,i){this.minX=t,this.minY=e,this.maxX=r,this.maxY=i}addFrame(t,e,r,i,s){s||(s=this.matrix);const n=s.a,o=s.b,a=s.c,l=s.d,h=s.tx,u=s.ty;let c=this.minX,d=this.minY,p=this.maxX,f=this.maxY,g=n*t+a*e+h,m=o*t+l*e+u;g<c&&(c=g),m<d&&(d=m),g>p&&(p=g),m>f&&(f=m),g=n*r+a*e+h,m=o*r+l*e+u,g<c&&(c=g),m<d&&(d=m),g>p&&(p=g),m>f&&(f=m),g=n*t+a*i+h,m=o*t+l*i+u,g<c&&(c=g),m<d&&(d=m),g>p&&(p=g),m>f&&(f=m),g=n*r+a*i+h,m=o*r+l*i+u,g<c&&(c=g),m<d&&(d=m),g>p&&(p=g),m>f&&(f=m),this.minX=c,this.minY=d,this.maxX=p,this.maxY=f}addRect(t,e){this.addFrame(t.x,t.y,t.x+t.width,t.y+t.height,e)}addBounds(t,e){this.addFrame(t.minX,t.minY,t.maxX,t.maxY,e)}addBoundsMask(t){this.minX=this.minX>t.minX?this.minX:t.minX,this.minY=this.minY>t.minY?this.minY:t.minY,this.maxX=this.maxX<t.maxX?this.maxX:t.maxX,this.maxY=this.maxY<t.maxY?this.maxY:t.maxY}applyMatrix(t){const e=this.minX,r=this.minY,i=this.maxX,s=this.maxY,{a:n,b:o,c:a,d:l,tx:h,ty:u}=t;let c=n*e+a*r+h,d=o*e+l*r+u;this.minX=c,this.minY=d,this.maxX=c,this.maxY=d,c=n*i+a*r+h,d=o*i+l*r+u,this.minX=c<this.minX?c:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=c>this.maxX?c:this.maxX,this.maxY=d>this.maxY?d:this.maxY,c=n*e+a*s+h,d=o*e+l*s+u,this.minX=c<this.minX?c:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=c>this.maxX?c:this.maxX,this.maxY=d>this.maxY?d:this.maxY,c=n*i+a*s+h,d=o*i+l*s+u,this.minX=c<this.minX?c:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=c>this.maxX?c:this.maxX,this.maxY=d>this.maxY?d:this.maxY}fit(t){return this.minX<t.left&&(this.minX=t.left),this.maxX>t.right&&(this.maxX=t.right),this.minY<t.top&&(this.minY=t.top),this.maxY>t.bottom&&(this.maxY=t.bottom),this}fitBounds(t,e,r,i){return this.minX<t&&(this.minX=t),this.maxX>e&&(this.maxX=e),this.minY<r&&(this.minY=r),this.maxY>i&&(this.maxY=i),this}pad(t,e=t){return this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new Ot(this.minX,this.minY,this.maxX,this.maxY)}scale(t,e=t){return this.minX*=t,this.minY*=e,this.maxX*=t,this.maxY*=e,this}get x(){return this.minX}set x(t){const e=this.maxX-this.minX;this.minX=t,this.maxX=t+e}get y(){return this.minY}set y(t){const e=this.maxY-this.minY;this.minY=t,this.maxY=t+e}get width(){return this.maxX-this.minX}set width(t){this.maxX=this.minX+t}get height(){return this.maxY-this.minY}set height(t){this.maxY=this.minY+t}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(t,e,r,i){let s=this.minX,n=this.minY,o=this.maxX,a=this.maxY;i||(i=this.matrix);const l=i.a,h=i.b,u=i.c,c=i.d,d=i.tx,p=i.ty;for(let i=e;i<r;i+=2){const e=t[i],r=t[i+1],f=l*e+u*r+d,g=h*e+c*r+p;s=f<s?f:s,n=g<n?g:n,o=f>o?f:o,a=g>a?g:a}this.minX=s,this.minY=n,this.maxX=o,this.maxY=a}containsPoint(t,e){return this.minX<=t&&this.minY<=e&&this.maxX>=t&&this.maxY>=e}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}copyFrom(t){return this.minX=t.minX,this.minY=t.minY,this.maxX=t.maxX,this.maxY=t.maxY,this}}const It=new ut(st),Bt=new ut(Ot),kt=new st,Gt={getFastGlobalBounds(t,e){e||(e=new Ot),e.clear(),this._getGlobalBoundsRecursive(!!t,e,this.parentRenderLayer),e.isValid||e.set(0,0,0,0);const r=this.renderGroup||this.parentRenderGroup;return e.applyMatrix(r.worldTransform),e},_getGlobalBoundsRecursive(t,e,r){let i=e;if(t&&this.parentRenderLayer&&this.parentRenderLayer!==r||7!==this.localDisplayStatus||!this.measurable)return;const s=!!this.effects.length;if((this.renderGroup||s)&&(i=Bt.get().clear()),this.boundsArea)e.addRect(this.boundsArea,this.worldTransform);else{if(this.renderPipeId){const t=this.bounds;i.addFrame(t.minX,t.minY,t.maxX,t.maxY,this.groupTransform)}const e=this.children;for(let s=0;s<e.length;s++)e[s]._getGlobalBoundsRecursive(t,i,r)}if(s){let t=!1;const r=this.renderGroup||this.parentRenderGroup;for(let e=0;e<this.effects.length;e++)this.effects[e].addBounds&&(t||(t=!0,i.applyMatrix(r.worldTransform)),this.effects[e].addBounds(i,!0));t&&(i.applyMatrix(r.worldTransform.copyTo(kt).invert()),e.addBounds(i,this.relativeGroupTransform)),e.addBounds(i),Bt.return(i)}else this.renderGroup&&(e.addBounds(i,this.relativeGroupTransform),Bt.return(i))}};function Dt(t,e,r){let i,s;return r.clear(),t.parent?e?i=t.parent.worldTransform:(s=It.get().identity(),i=Nt(t,s)):i=st.IDENTITY,Ft(t,r,i,e),s&&It.return(s),r.isValid||r.set(0,0,0,0),r}function Ft(t,e,r,i){var s,n;if(!t.visible||!t.measurable)return;let o;i?o=t.worldTransform:(t.updateLocalTransform(),o=It.get(),o.appendFrom(t.localTransform,r));const a=e,l=!!t.effects.length;if(l&&(e=Bt.get().clear()),t.boundsArea)e.addRect(t.boundsArea,o);else{t.bounds&&(e.matrix=o,e.addBounds(t.bounds));for(let r=0;r<t.children.length;r++)Ft(t.children[r],e,o,i)}if(l){for(let r=0;r<t.effects.length;r++)null==(n=(s=t.effects[r]).addBounds)||n.call(s,e);a.addBounds(e,st.IDENTITY),Bt.return(e)}i||It.return(o)}function Nt(t,e){const r=t.parent;return r&&(Nt(r,e),r.updateLocalTransform(),e.append(r.localTransform)),e}function Ut(t,e){if(16777215===t||!e)return e;if(16777215===e||!t)return t;return(((t>>16&255)*(e>>16&255)/255|0)<<16)+(((t>>8&255)*(e>>8&255)/255|0)<<8)+((255&t)*(255&e)/255|0)}const Lt=16777215;function zt(t,e){return t===Lt?e:e===Lt?t:Ut(t,e)}function Xt(t){return((255&t)<<16)+(65280&t)+(t>>16&255)}const Ht={getGlobalAlpha(t){if(t)return this.renderGroup?this.renderGroup.worldAlpha:this.parentRenderGroup?this.parentRenderGroup.worldAlpha*this.alpha:this.alpha;let e=this.alpha,r=this.parent;for(;r;)e*=r.alpha,r=r.parent;return e},getGlobalTransform(t,e){if(e)return t.copyFrom(this.worldTransform);this.updateLocalTransform();const r=Nt(this,It.get().identity());return t.appendFrom(this.localTransform,r),It.return(r),t},getGlobalTint(t){if(t)return this.renderGroup?Xt(this.renderGroup.worldColor):this.parentRenderGroup?Xt(zt(this.localColor,this.parentRenderGroup.worldColor)):this.tint;let e=this.localColor,r=this.parent;for(;r;)e=zt(e,r.localColor),r=r.parent;return Xt(e)}};function jt(t,e,r){return e.clear(),r||(r=st.IDENTITY),Vt(t,e,r,t,!0),e.isValid||e.set(0,0,0,0),e}function Vt(t,e,r,i,s){var n,o;let a;if(s)a=It.get(),a=r.copyTo(a);else{if(!t.visible||!t.measurable)return;t.updateLocalTransform();const e=t.localTransform;a=It.get(),a.appendFrom(e,r)}const l=e,h=!!t.effects.length;if(h&&(e=Bt.get().clear()),t.boundsArea)e.addRect(t.boundsArea,a);else{t.renderPipeId&&(e.matrix=a,e.addBounds(t.bounds));const r=t.children;for(let t=0;t<r.length;t++)Vt(r[t],e,a,i,!1)}if(h){for(let r=0;r<t.effects.length;r++)null==(o=(n=t.effects[r]).addLocalBounds)||o.call(n,e,i);l.addBounds(e,st.IDENTITY),Bt.return(e)}It.return(a)}function Wt(t,e){const r=t.children;for(let t=0;t<r.length;t++){const i=r[t],s=i.uid,n=(65535&i._didViewChangeTick)<<16|65535&i._didContainerChangeTick,o=e.index;(e.data[o]!==s||e.data[o+1]!==n)&&(e.data[e.index]=s,e.data[e.index+1]=n,e.didChange=!0),e.index=o+2,i.children.length&&Wt(i,e)}return e.didChange}const $t=new st,Yt={_localBoundsCacheId:-1,_localBoundsCacheData:null,_setWidth(t,e){const r=Math.sign(this.scale.x)||1;this.scale.x=0!==e?t/e*r:r},_setHeight(t,e){const r=Math.sign(this.scale.y)||1;this.scale.y=0!==e?t/e*r:r},getLocalBounds(){this._localBoundsCacheData||(this._localBoundsCacheData={data:[],index:1,didChange:!1,localBounds:new Ot});const t=this._localBoundsCacheData;return t.index=1,t.didChange=!1,t.data[0]!==this._didViewChangeTick&&(t.didChange=!0,t.data[0]=this._didViewChangeTick),Wt(this,t),t.didChange&&jt(this,t.localBounds,$t),t.localBounds},getBounds(t,e){return Dt(this,t,e||new Ot)}},qt={_onRender:null,set onRender(t){const e=this.renderGroup||this.parentRenderGroup;if(!t)return this._onRender&&(null==e||e.removeOnRender(this)),void(this._onRender=null);this._onRender||null==e||e.addOnRender(this),this._onRender=t},get onRender(){return this._onRender}},Kt={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(t){this._zIndex!==t&&(this._zIndex=t,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(Qt))}};function Qt(t,e){return t._zIndex-e._zIndex}const Zt={getGlobalPosition(t=new rt,e=!1){return this.parent?this.parent.toGlobal(this._position,t,e):(t.x=this._position.x,t.y=this._position.y),t},toGlobal(t,e,r=!1){const i=this.getGlobalTransform(It.get(),r);return e=i.apply(t,e),It.return(i),e},toLocal(t,e,r,i){e&&(t=e.toGlobal(t,r,i));const s=this.getGlobalTransform(It.get(),i);return r=s.applyInverse(t,r),It.return(s),r}};class Jt{constructor(){this.uid=ht("instructionSet"),this.instructions=[],this.instructionSize=0,this.renderables=[],this.gcTick=0}reset(){this.instructionSize=0}add(t){this.instructions[this.instructionSize++]=t}log(){this.instructions.length=this.instructionSize,console.table(this.instructions,["type","action"])}}function te(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function ee(t){return!(t&t-1||!t)}function re(t){const e={};for(const r in t)void 0!==t[r]&&(e[r]=t[r]);return e}var ie=Object.defineProperty,se=Object.getOwnPropertySymbols,ne=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable,ae=(t,e,r)=>e in t?ie(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,le=(t,e)=>{for(var r in e||(e={}))ne.call(e,r)&&ae(t,r,e[r]);if(se)for(var r of se(e))oe.call(e,r)&&ae(t,r,e[r]);return t};const he=Object.create(null);const ue=class t extends m{constructor(e={}){var r,i,s,n,o,a,l;super(),this._resourceType="textureSampler",this._touched=0,this._maxAnisotropy=1,this.destroyed=!1,e=le(le({},t.defaultOptions),e),this.addressMode=e.addressMode,this.addressModeU=null!=(r=e.addressModeU)?r:this.addressModeU,this.addressModeV=null!=(i=e.addressModeV)?i:this.addressModeV,this.addressModeW=null!=(s=e.addressModeW)?s:this.addressModeW,this.scaleMode=e.scaleMode,this.magFilter=null!=(n=e.magFilter)?n:this.magFilter,this.minFilter=null!=(o=e.minFilter)?o:this.minFilter,this.mipmapFilter=null!=(a=e.mipmapFilter)?a:this.mipmapFilter,this.lodMinClamp=e.lodMinClamp,this.lodMaxClamp=e.lodMaxClamp,this.compare=e.compare,this.maxAnisotropy=null!=(l=e.maxAnisotropy)?l:1}set addressMode(t){this.addressModeU=t,this.addressModeV=t,this.addressModeW=t}get addressMode(){return this.addressModeU}set wrapMode(t){this.addressMode=t}get wrapMode(){return this.addressMode}set scaleMode(t){this.magFilter=t,this.minFilter=t,this.mipmapFilter=t}get scaleMode(){return this.magFilter}set maxAnisotropy(t){this._maxAnisotropy=Math.min(t,16),this._maxAnisotropy>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this._maxAnisotropy}get _resourceId(){return this._sharedResourceId||this._generateResourceId()}update(){this.emit("change",this),this._sharedResourceId=null}_generateResourceId(){const t=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this._maxAnisotropy}`;return this._sharedResourceId=function(t){const e=he[t];return void 0===e&&(he[t]=ht("resource")),e}(t),this._resourceId}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this.removeAllListeners()}};ue.defaultOptions={addressMode:"clamp-to-edge",scaleMode:"linear"};let ce=ue;var de=Object.defineProperty,pe=Object.getOwnPropertySymbols,fe=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable,me=(t,e,r)=>e in t?de(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_e=(t,e)=>{for(var r in e||(e={}))fe.call(e,r)&&me(t,r,e[r]);if(pe)for(var r of pe(e))ge.call(e,r)&&me(t,r,e[r]);return t};const xe=class t extends m{constructor(e={}){var r,i,s;super(),this.options=e,this.uid=ht("textureSource"),this._resourceType="textureSource",this._resourceId=ht("resource"),this.uploadMethodId="unknown",this._resolution=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm",this.dimension="2d",this.antialias=!1,this._touched=0,this._batchTick=-1,this._textureBindLocation=-1,e=_e(_e({},t.defaultOptions),e),this.label=null!=(r=e.label)?r:"",this.resource=e.resource,this.autoGarbageCollect=e.autoGarbageCollect,this._resolution=e.resolution,e.width?this.pixelWidth=e.width*this._resolution:this.pixelWidth=this.resource&&null!=(i=this.resourceWidth)?i:1,e.height?this.pixelHeight=e.height*this._resolution:this.pixelHeight=this.resource&&null!=(s=this.resourceHeight)?s:1,this.width=this.pixelWidth/this._resolution,this.height=this.pixelHeight/this._resolution,this.format=e.format,this.dimension=e.dimensions,this.mipLevelCount=e.mipLevelCount,this.autoGenerateMipmaps=e.autoGenerateMipmaps,this.sampleCount=e.sampleCount,this.antialias=e.antialias,this.alphaMode=e.alphaMode,this.style=new ce(re(e)),this.destroyed=!1,this._refreshPOT()}get source(){return this}get style(){return this._style}set style(t){var e,r;this.style!==t&&(null==(e=this._style)||e.off("change",this._onStyleChange,this),this._style=t,null==(r=this._style)||r.on("change",this._onStyleChange,this),this._onStyleChange())}get addressMode(){return this._style.addressMode}set addressMode(t){this._style.addressMode=t}get repeatMode(){return this._style.addressMode}set repeatMode(t){this._style.addressMode=t}get magFilter(){return this._style.magFilter}set magFilter(t){this._style.magFilter=t}get minFilter(){return this._style.minFilter}set minFilter(t){this._style.minFilter=t}get mipmapFilter(){return this._style.mipmapFilter}set mipmapFilter(t){this._style.mipmapFilter=t}get lodMinClamp(){return this._style.lodMinClamp}set lodMinClamp(t){this._style.lodMinClamp=t}get lodMaxClamp(){return this._style.lodMaxClamp}set lodMaxClamp(t){this._style.lodMaxClamp=t}_onStyleChange(){this.emit("styleChange",this)}update(){if(this.resource){const t=this._resolution;if(this.resize(this.resourceWidth/t,this.resourceHeight/t))return}this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._style&&(this._style.destroy(),this._style=null),this.uploadMethodId=null,this.resource=null,this.removeAllListeners()}unload(){this._resourceId=ht("resource"),this.emit("change",this),this.emit("unload",this)}get resourceWidth(){const{resource:t}=this;return t.naturalWidth||t.videoWidth||t.displayWidth||t.width}get resourceHeight(){const{resource:t}=this;return t.naturalHeight||t.videoHeight||t.displayHeight||t.height}get resolution(){return this._resolution}set resolution(t){this._resolution!==t&&(this._resolution=t,this.width=this.pixelWidth/t,this.height=this.pixelHeight/t)}resize(t,e,r){r||(r=this._resolution),t||(t=this.width),e||(e=this.height);const i=Math.round(t*r),s=Math.round(e*r);return this.width=i/r,this.height=s/r,this._resolution=r,(this.pixelWidth!==i||this.pixelHeight!==s)&&(this._refreshPOT(),this.pixelWidth=i,this.pixelHeight=s,this.emit("resize",this),this._resourceId=ht("resource"),this.emit("change",this),!0)}updateMipmaps(){this.autoGenerateMipmaps&&this.mipLevelCount>1&&this.emit("updateMipmaps",this)}set wrapMode(t){this._style.wrapMode=t}get wrapMode(){return this._style.wrapMode}set scaleMode(t){this._style.scaleMode=t}get scaleMode(){return this._style.scaleMode}_refreshPOT(){this.isPowerOfTwo=ee(this.pixelWidth)&&ee(this.pixelHeight)}static test(t){throw new Error("Unimplemented")}};xe.defaultOptions={resolution:1,format:"bgra8unorm",alphaMode:"premultiply-alpha-on-upload",dimensions:"2d",mipLevelCount:1,autoGenerateMipmaps:!1,sampleCount:1,antialias:!1,autoGarbageCollect:!1};let ye=xe;const be=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],ve=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Te=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Se=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],we=[],Ee=[],Ae=Math.sign;!function(){for(let t=0;t<16;t++){const e=[];we.push(e);for(let r=0;r<16;r++){const i=Ae(be[t]*be[r]+Te[t]*ve[r]),s=Ae(ve[t]*be[r]+Se[t]*ve[r]),n=Ae(be[t]*Te[r]+Te[t]*Se[r]),o=Ae(ve[t]*Te[r]+Se[t]*Se[r]);for(let t=0;t<16;t++)if(be[t]===i&&ve[t]===s&&Te[t]===n&&Se[t]===o){e.push(t);break}}}for(let t=0;t<16;t++){const e=new st;e.set(be[t],ve[t],Te[t],Se[t],0,0),Ee.push(e)}}();const Pe={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>be[t],uY:t=>ve[t],vX:t=>Te[t],vY:t=>Se[t],inv:t=>8&t?15&t:7&-t,add:(t,e)=>we[t][e],sub:(t,e)=>we[t][Pe.inv(e)],rotate180:t=>4^t,isVertical:t=>2==(3&t),byDirection:(t,e)=>2*Math.abs(t)<=Math.abs(e)?e>=0?Pe.S:Pe.N:2*Math.abs(e)<=Math.abs(t)?t>0?Pe.E:Pe.W:e>0?t>0?Pe.SE:Pe.SW:t>0?Pe.NE:Pe.NW,matrixAppendRotationInv:(t,e,r=0,i=0)=>{const s=Ee[Pe.inv(e)];s.tx=r,s.ty=i,t.append(s)}},Me=()=>{};var Re=Object.defineProperty,Ce=Object.defineProperties,Oe=Object.getOwnPropertyDescriptors,Ie=Object.getOwnPropertySymbols,Be=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable,Ge=(t,e,r)=>e in t?Re(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;class De extends ye{constructor(t){const e=t.resource||new Float32Array(t.width*t.height*4);let r=t.format;r||(e instanceof Float32Array?r="rgba32float":e instanceof Int32Array||e instanceof Uint32Array?r="rgba32uint":e instanceof Int16Array||e instanceof Uint16Array?r="rgba16uint":(Int8Array,r="bgra8unorm")),super(((t,e)=>Ce(t,Oe(e)))(((t,e)=>{for(var r in e||(e={}))Be.call(e,r)&&Ge(t,r,e[r]);if(Ie)for(var r of Ie(e))ke.call(e,r)&&Ge(t,r,e[r]);return t})({},t),{resource:e,format:r})),this.uploadMethodId="buffer"}static test(t){return t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}De.extension=u.TextureSource;const Fe=new st;class Ne{constructor(t,e){this.mapCoord=new st,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===e?t.width<10?0:.5:e,this.isSimple=!1,this.texture=t}get texture(){return this._texture}set texture(t){var e;this.texture!==t&&(null==(e=this._texture)||e.removeListener("update",this.update,this),this._texture=t,this._texture.addListener("update",this.update,this),this.update())}multiplyUvs(t,e){void 0===e&&(e=t);const r=this.mapCoord;for(let i=0;i<t.length;i+=2){const s=t[i],n=t[i+1];e[i]=s*r.a+n*r.c+r.tx,e[i+1]=s*r.b+n*r.d+r.ty}return e}update(){const t=this._texture;this._updateID++;const e=t.uvs;this.mapCoord.set(e.x1-e.x0,e.y1-e.y0,e.x3-e.x0,e.y3-e.y0,e.x0,e.y0);const r=t.orig,i=t.trim;i&&(Fe.set(r.width/i.width,0,0,r.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(Fe));const s=t.source,n=this.uClampFrame,o=this.clampMargin/s._resolution,a=this.clampOffset/s._resolution;return n[0]=(t.frame.x+o+a)/s.width,n[1]=(t.frame.y+o+a)/s.height,n[2]=(t.frame.x+t.frame.width-o+a)/s.width,n[3]=(t.frame.y+t.frame.height-o+a)/s.height,this.uClampOffset[0]=this.clampOffset/s.pixelWidth,this.uClampOffset[1]=this.clampOffset/s.pixelHeight,this.isSimple=t.frame.width===s.width&&t.frame.height===s.height&&0===t.rotate,!0}}class Ue extends m{constructor({source:t,label:e,frame:r,orig:i,trim:s,defaultAnchor:n,defaultBorders:o,rotate:a,dynamic:l}={}){var h;if(super(),this.uid=ht("texture"),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=new Rt,this.noFrame=!1,this.dynamic=!1,this.isTexture=!0,this.label=e,this.source=null!=(h=null==t?void 0:t.source)?h:new ye,this.noFrame=!r,r)this.frame.copyFrom(r);else{const{width:t,height:e}=this._source;this.frame.width=t,this.frame.height=e}this.orig=i||this.frame,this.trim=s,this.rotate=null!=a?a:0,this.defaultAnchor=n,this.defaultBorders=o,this.destroyed=!1,this.dynamic=l||!1,this.updateUvs()}set source(t){this._source&&this._source.off("resize",this.update,this),this._source=t,t.on("resize",this.update,this),this.emit("update",this)}get source(){return this._source}get textureMatrix(){return this._textureMatrix||(this._textureMatrix=new Ne(this)),this._textureMatrix}get width(){return this.orig.width}get height(){return this.orig.height}updateUvs(){const{uvs:t,frame:e}=this,{width:r,height:i}=this._source,s=e.x/r,n=e.y/i,o=e.width/r,a=e.height/i;let l=this.rotate;if(l){const e=o/2,r=a/2,i=s+e,h=n+r;l=Pe.add(l,Pe.NW),t.x0=i+e*Pe.uX(l),t.y0=h+r*Pe.uY(l),l=Pe.add(l,2),t.x1=i+e*Pe.uX(l),t.y1=h+r*Pe.uY(l),l=Pe.add(l,2),t.x2=i+e*Pe.uX(l),t.y2=h+r*Pe.uY(l),l=Pe.add(l,2),t.x3=i+e*Pe.uX(l),t.y3=h+r*Pe.uY(l)}else t.x0=s,t.y0=n,t.x1=s+o,t.y1=n,t.x2=s+o,t.y2=n+a,t.x3=s,t.y3=n+a}destroy(t=!1){this._source&&t&&(this._source.destroy(),this._source=null),this._textureMatrix=null,this.destroyed=!0,this.emit("destroy",this),this.removeAllListeners()}update(){this.noFrame&&(this.frame.width=this._source.width,this.frame.height=this._source.height),this.updateUvs(),this.emit("update",this)}get baseTexture(){return this._source}}Ue.EMPTY=new Ue({label:"EMPTY",source:new ye({label:"EMPTY"})}),Ue.EMPTY.destroy=Me,Ue.WHITE=new Ue({source:new De({resource:new Uint8Array([255,255,255,255]),width:1,height:1,alphaMode:"premultiply-alpha-on-upload",label:"WHITE"}),label:"WHITE"}),Ue.WHITE.destroy=Me;var Le=Object.defineProperty,ze=Object.defineProperties,Xe=Object.getOwnPropertyDescriptors,He=Object.getOwnPropertySymbols,je=Object.prototype.hasOwnProperty,Ve=Object.prototype.propertyIsEnumerable,We=(t,e,r)=>e in t?Le(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;let $e=0;class Ye{constructor(t){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1}createTexture(t,e,r){const i=new ye(((t,e)=>ze(t,Xe(e)))(((t,e)=>{for(var r in e||(e={}))je.call(e,r)&&We(t,r,e[r]);if(He)for(var r of He(e))Ve.call(e,r)&&We(t,r,e[r]);return t})({},this.textureOptions),{width:t,height:e,resolution:1,antialias:r,autoGarbageCollect:!1}));return new Ue({source:i,label:"texturePool_"+$e++})}getOptimalTexture(t,e,r=1,i){let s=Math.ceil(t*r-1e-6),n=Math.ceil(e*r-1e-6);s=te(s),n=te(n);const o=(s<<17)+(n<<1)+(i?1:0);this._texturePool[o]||(this._texturePool[o]=[]);let a=this._texturePool[o].pop();return a||(a=this.createTexture(s,n,i)),a.source._resolution=r,a.source.width=s/r,a.source.height=n/r,a.source.pixelWidth=s,a.source.pixelHeight=n,a.frame.x=0,a.frame.y=0,a.frame.width=t,a.frame.height=e,a.updateUvs(),this._poolKeyHash[a.uid]=o,a}getSameSizeTexture(t,e=!1){const r=t.source;return this.getOptimalTexture(t.width,t.height,r._resolution,e)}returnTexture(t){const e=this._poolKeyHash[t.uid];this._texturePool[e].push(t)}clear(t){if(t=!1!==t)for(const t in this._texturePool){const e=this._texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0)}this._texturePool={}}}const qe=new Ye;class Ke{constructor(){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this.worldTransform=new st,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.gcTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new Jt,this._onRenderContainers=[],this.textureNeedsUpdate=!0,this.isCachedAsTexture=!1,this._matrixDirty=7}init(t){this.root=t,t._onRender&&this.addOnRender(t),t.didChange=!0;const e=t.children;for(let t=0;t<e.length;t++){const r=e[t];r._updateFlags=15,this.addChild(r)}}enableCacheAsTexture(t={}){this.textureOptions=t,this.isCachedAsTexture=!0,this.textureNeedsUpdate=!0}disableCacheAsTexture(){this.isCachedAsTexture=!1,this.texture&&(qe.returnTexture(this.texture),this.texture=null)}updateCacheTexture(){this.textureNeedsUpdate=!0}reset(){this.renderGroupChildren.length=0;for(const t in this.childrenToUpdate){const e=this.childrenToUpdate[t];e.list.fill(null),e.index=0}this.childrenRenderablesToUpdate.index=0,this.childrenRenderablesToUpdate.list.fill(null),this.root=null,this.updateTick=0,this.structureDidChange=!0,this._onRenderContainers.length=0,this.renderGroupParent=null,this.disableCacheAsTexture()}get localTransform(){return this.root.localTransform}addRenderGroupChild(t){t.renderGroupParent&&t.renderGroupParent._removeRenderGroupChild(t),t.renderGroupParent=this,this.renderGroupChildren.push(t)}_removeRenderGroupChild(t){const e=this.renderGroupChildren.indexOf(t);e>-1&&this.renderGroupChildren.splice(e,1),t.renderGroupParent=null}addChild(t){if(this.structureDidChange=!0,t.parentRenderGroup=this,t.updateTick=-1,t.parent===this.root?t.relativeRenderGroupDepth=1:t.relativeRenderGroupDepth=t.parent.relativeRenderGroupDepth+1,t.didChange=!0,this.onChildUpdate(t),t.renderGroup)return void this.addRenderGroupChild(t.renderGroup);t._onRender&&this.addOnRender(t);const e=t.children;for(let t=0;t<e.length;t++)this.addChild(e[t])}removeChild(t){if(this.structureDidChange=!0,t._onRender&&(t.renderGroup||this.removeOnRender(t)),t.parentRenderGroup=null,t.renderGroup)return void this._removeRenderGroupChild(t.renderGroup);const e=t.children;for(let t=0;t<e.length;t++)this.removeChild(e[t])}removeChildren(t){for(let e=0;e<t.length;e++)this.removeChild(t[e])}onChildUpdate(t){let e=this.childrenToUpdate[t.relativeRenderGroupDepth];e||(e=this.childrenToUpdate[t.relativeRenderGroupDepth]={index:0,list:[]}),e.list[e.index++]=t}updateRenderable(t){t.globalDisplayStatus<7||(this.instructionSet.renderPipes[t.renderPipeId].updateRenderable(t),t.didViewUpdate=!1)}onChildViewUpdate(t){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=t}get isRenderable(){return 7===this.root.localDisplayStatus&&this.worldAlpha>0}addOnRender(t){this._onRenderContainers.push(t)}removeOnRender(t){this._onRenderContainers.splice(this._onRenderContainers.indexOf(t),1)}runOnRender(t){for(let e=0;e<this._onRenderContainers.length;e++)this._onRenderContainers[e]._onRender(t)}destroy(){this.disableCacheAsTexture(),this.renderGroupParent=null,this.root=null,this.childrenRenderablesToUpdate=null,this.childrenToUpdate=null,this.renderGroupChildren=null,this._onRenderContainers=null,this.instructionSet=null}getChildren(t=[]){const e=this.root.children;for(let r=0;r<e.length;r++)this._getChildren(e[r],t);return t}_getChildren(t,e=[]){if(e.push(t),t.renderGroup)return e;const r=t.children;for(let t=0;t<r.length;t++)this._getChildren(r[t],e);return e}invalidateMatrices(){this._matrixDirty=7}get inverseWorldTransform(){return 1&this._matrixDirty?(this._matrixDirty&=-2,this._inverseWorldTransform||(this._inverseWorldTransform=new st),this._inverseWorldTransform.copyFrom(this.worldTransform).invert()):this._inverseWorldTransform}get textureOffsetInverseTransform(){return 2&this._matrixDirty?(this._matrixDirty&=-3,this._textureOffsetInverseTransform||(this._textureOffsetInverseTransform=new st),this._textureOffsetInverseTransform.copyFrom(this.inverseWorldTransform).translate(-this._textureBounds.x,-this._textureBounds.y)):this._textureOffsetInverseTransform}get inverseParentTextureTransform(){if(!(4&this._matrixDirty))return this._inverseParentTextureTransform;this._matrixDirty&=-5;const t=this._parentCacheAsTextureRenderGroup;return t?(this._inverseParentTextureTransform||(this._inverseParentTextureTransform=new st),this._inverseParentTextureTransform.copyFrom(this.worldTransform).prepend(t.inverseWorldTransform).translate(-t._textureBounds.x,-t._textureBounds.y)):this.worldTransform}get cacheToLocalTransform(){return this._parentCacheAsTextureRenderGroup?this._parentCacheAsTextureRenderGroup.textureOffsetInverseTransform:null}}function Qe(t,e,r={}){for(const i in e)!r[i]&&void 0!==e[i]&&(t[i]=e[i])}const Ze=new at(null),Je=new at(null),tr=new at(null,1,1);class er extends m{constructor(t={}){var e,r;super(),this.uid=ht("renderable"),this._updateFlags=15,this.renderGroup=null,this.parentRenderGroup=null,this.parentRenderGroupIndex=0,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.updateTick=-1,this.localTransform=new st,this.relativeGroupTransform=new st,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this._position=new at(this,0,0),this._scale=tr,this._pivot=Je,this._skew=Ze,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this._didContainerChangeTick=0,this._didViewChangeTick=0,this._didLocalTransformChangeId=-1,this.effects=[],Qe(this,t,{children:!0,parent:!0,effects:!0}),null==(e=t.children)||e.forEach((t=>this.addChild(t))),null==(r=t.parent)||r.addChild(this)}static mixin(t){p.mixin(er,t)}set _didChangeId(t){this._didViewChangeTick=t>>12&4095,this._didContainerChangeTick=4095&t}get _didChangeId(){return 4095&this._didContainerChangeTick|(4095&this._didViewChangeTick)<<12}addChild(...t){if(t.length>1){for(let e=0;e<t.length;e++)this.addChild(t[e]);return t[0]}const e=t[0],r=this.renderGroup||this.parentRenderGroup;return e.parent===this?(this.children.splice(this.children.indexOf(e),1),this.children.push(e),r&&(r.structureDidChange=!0),e):(e.parent&&e.parent.removeChild(e),this.children.push(e),this.sortableChildren&&(this.sortDirty=!0),e.parent=this,e.didChange=!0,e._updateFlags=15,r&&r.addChild(e),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this),this._didViewChangeTick++,0!==e._zIndex&&e.depthOfChildModified(),e)}removeChild(...t){if(t.length>1){for(let e=0;e<t.length;e++)this.removeChild(t[e]);return t[0]}const e=t[0],r=this.children.indexOf(e);return r>-1&&(this._didViewChangeTick++,this.children.splice(r,1),this.renderGroup?this.renderGroup.removeChild(e):this.parentRenderGroup&&this.parentRenderGroup.removeChild(e),e.parentRenderLayer&&e.parentRenderLayer.detach(e),e.parent=null,this.emit("childRemoved",e,this,r),e.emit("removed",this)),e}_onUpdate(t){t&&t===this._skew&&this._updateSkew(),this._didContainerChangeTick++,!this.didChange&&(this.didChange=!0,this.parentRenderGroup&&this.parentRenderGroup.onChildUpdate(this))}set isRenderGroup(t){!!this.renderGroup!==t&&(t?this.enableRenderGroup():this.disableRenderGroup())}get isRenderGroup(){return!!this.renderGroup}enableRenderGroup(){if(this.renderGroup)return;const t=this.parentRenderGroup;null==t||t.removeChild(this),this.renderGroup=dt.get(Ke,this),this.groupTransform=st.IDENTITY,null==t||t.addChild(this),this._updateIsSimple()}disableRenderGroup(){if(!this.renderGroup)return;const t=this.parentRenderGroup;null==t||t.removeChild(this),dt.return(this.renderGroup),this.renderGroup=null,this.groupTransform=this.relativeGroupTransform,null==t||t.addChild(this),this._updateIsSimple()}_updateIsSimple(){this.isSimple=!this.renderGroup&&0===this.effects.length}get worldTransform(){return this._worldTransform||(this._worldTransform=new st),this.renderGroup?this._worldTransform.copyFrom(this.renderGroup.worldTransform):this.parentRenderGroup&&this._worldTransform.appendFrom(this.relativeGroupTransform,this.parentRenderGroup.worldTransform),this._worldTransform}get x(){return this._position.x}set x(t){this._position.x=t}get y(){return this._position.y}set y(t){this._position.y=t}get position(){return this._position}set position(t){this._position.copyFrom(t)}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this._onUpdate(this._skew))}get angle(){return this.rotation*tt}set angle(t){this.rotation=t*et}get pivot(){return this._pivot===Je&&(this._pivot=new at(this,0,0)),this._pivot}set pivot(t){this._pivot===Je&&(this._pivot=new at(this,0,0)),"number"==typeof t?this._pivot.set(t):this._pivot.copyFrom(t)}get skew(){return this._skew===Ze&&(this._skew=new at(this,0,0)),this._skew}set skew(t){this._skew===Ze&&(this._skew=new at(this,0,0)),this._skew.copyFrom(t)}get scale(){return this._scale===tr&&(this._scale=new at(this,1,1)),this._scale}set scale(t){this._scale===tr&&(this._scale=new at(this,0,0)),"number"==typeof t?this._scale.set(t):this._scale.copyFrom(t)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(t){const e=this.getLocalBounds().width;this._setWidth(t,e)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(t){const e=this.getLocalBounds().height;this._setHeight(t,e)}getSize(t){t||(t={});const e=this.getLocalBounds();return t.width=Math.abs(this.scale.x*e.width),t.height=Math.abs(this.scale.y*e.height),t}setSize(t,e){var r;const i=this.getLocalBounds();"object"==typeof t?(e=null!=(r=t.height)?r:t.width,t=t.width):null!=e||(e=t),void 0!==t&&this._setWidth(t,i.width),void 0!==e&&this._setHeight(e,i.height)}_updateSkew(){const t=this._rotation,e=this._skew;this._cx=Math.cos(t+e._y),this._sx=Math.sin(t+e._y),this._cy=-Math.sin(t-e._x),this._sy=Math.cos(t-e._x)}updateTransform(t){return this.position.set("number"==typeof t.x?t.x:this.position.x,"number"==typeof t.y?t.y:this.position.y),this.scale.set("number"==typeof t.scaleX?t.scaleX||1:this.scale.x,"number"==typeof t.scaleY?t.scaleY||1:this.scale.y),this.rotation="number"==typeof t.rotation?t.rotation:this.rotation,this.skew.set("number"==typeof t.skewX?t.skewX:this.skew.x,"number"==typeof t.skewY?t.skewY:this.skew.y),this.pivot.set("number"==typeof t.pivotX?t.pivotX:this.pivot.x,"number"==typeof t.pivotY?t.pivotY:this.pivot.y),this}setFromMatrix(t){t.decompose(this)}updateLocalTransform(){const t=this._didContainerChangeTick;if(this._didLocalTransformChangeId===t)return;this._didLocalTransformChangeId=t;const e=this.localTransform,r=this._scale,i=this._pivot,s=this._position,n=r._x,o=r._y,a=i._x,l=i._y;e.a=this._cx*n,e.b=this._sx*n,e.c=this._cy*o,e.d=this._sy*o,e.tx=s._x-(a*e.a+l*e.c),e.ty=s._y-(a*e.b+l*e.d)}set alpha(t){t!==this.localAlpha&&(this.localAlpha=t,this._updateFlags|=1,this._onUpdate())}get alpha(){return this.localAlpha}set tint(t){const e=Q.shared.setValue(null!=t?t:16777215).toBgrNumber();e!==this.localColor&&(this.localColor=e,this._updateFlags|=1,this._onUpdate())}get tint(){return Xt(this.localColor)}set blendMode(t){this.localBlendMode!==t&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=2,this.localBlendMode=t,this._onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(2&this.localDisplayStatus)}set visible(t){const e=t?2:0;(2&this.localDisplayStatus)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=4,this.localDisplayStatus^=2,this._onUpdate())}get culled(){return!(4&this.localDisplayStatus)}set culled(t){const e=t?0:4;(4&this.localDisplayStatus)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=4,this.localDisplayStatus^=4,this._onUpdate())}get renderable(){return!!(1&this.localDisplayStatus)}set renderable(t){const e=t?1:0;(1&this.localDisplayStatus)!==e&&(this._updateFlags|=4,this.localDisplayStatus^=1,this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._onUpdate())}get isRenderable(){return 7===this.localDisplayStatus&&this.groupAlpha>0}destroy(t=!1){var e;if(this.destroyed)return;let r;if(this.destroyed=!0,this.children.length&&(r=this.removeChildren(0,this.children.length)),this.removeFromParent(),this.parent=null,this._maskEffect=null,this._filterEffect=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._skew=null,this.emit("destroyed",this),this.removeAllListeners(),("boolean"==typeof t?t:null==t?void 0:t.children)&&r)for(let e=0;e<r.length;++e)r[e].destroy(t);null==(e=this.renderGroup)||e.destroy(),this.renderGroup=null}}p.mixin(er,gt,Gt,Zt,qt,Yt,At,Pt,Kt,Z,pt,Ht,mt);class rr{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=rr.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new rt,this.page=new rt,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,r,i,s){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}var ir,sr=/iPhone/i,nr=/iPod/i,or=/iPad/i,ar=/\biOS-universal(?:.+)Mac\b/i,lr=/\bAndroid(?:.+)Mobile\b/i,hr=/Android/i,ur=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,cr=/Silk/i,dr=/Windows Phone/i,pr=/\bWindows(?:.+)ARM\b/i,fr=/BlackBerry/i,gr=/BB10/i,mr=/Opera Mini/i,_r=/\b(CriOS|Chrome)(?:.+)Mobile/i,xr=/Mobile(?:.+)Firefox\b/i,yr=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};function br(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var r=e.userAgent,i=r.split("[FBAN");void 0!==i[1]&&(r=i[0]),void 0!==(i=r.split("Twitter"))[1]&&(r=i[0]);var s=function(t){return function(e){return e.test(t)}}(r),n={apple:{phone:s(sr)&&!s(dr),ipod:s(nr),tablet:!s(sr)&&(s(or)||yr(e))&&!s(dr),universal:s(ar),device:(s(sr)||s(nr)||s(or)||s(ar)||yr(e))&&!s(dr)},amazon:{phone:s(ur),tablet:!s(ur)&&s(cr),device:s(ur)||s(cr)},android:{phone:!s(dr)&&s(ur)||!s(dr)&&s(lr),tablet:!s(dr)&&!s(ur)&&!s(lr)&&(s(cr)||s(hr)),device:!s(dr)&&(s(ur)||s(cr)||s(lr)||s(hr))||s(/\bokhttp\b/i)},windows:{phone:s(dr),tablet:s(pr),device:s(dr)||s(pr)},other:{blackberry:s(fr),blackberry10:s(gr),opera:s(mr),firefox:s(xr),chrome:s(_r),device:s(fr)||s(gr)||s(mr)||s(xr)||s(_r)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const vr=(null!=(ir=br.default)?ir:br)(globalThis.navigator);var Tr=Object.defineProperty,Sr=Object.getOwnPropertySymbols,wr=Object.prototype.hasOwnProperty,Er=Object.prototype.propertyIsEnumerable,Ar=(t,e,r)=>e in t?Tr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pr=(t,e)=>{for(var r in e||(e={}))wr.call(e,r)&&Ar(t,r,e[r]);if(Sr)for(var r of Sr(e))Er.call(e,r)&&Ar(t,r,e[r]);return t};const Mr=class t{constructor(t,e=vr){this._mobileInfo=e,this.debug=!1,this._activateOnTab=!0,this._deactivateOnMouseMove=!0,this._isActive=!1,this._isMobileAccessibility=!1,this._div=null,this._pool=[],this._renderId=0,this._children=[],this._androidUpdateCount=0,this._androidUpdateFrequency=500,this._hookDiv=null,(e.tablet||e.phone)&&this._createTouchHook(),this._renderer=t}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}get hookDiv(){return this._hookDiv}_createTouchHook(){const t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2..toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",(()=>{this._isMobileAccessibility=!0,this._activate(),this._destroyTouchHook()})),document.body.appendChild(t),this._hookDiv=t}_destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}_activate(){if(this._isActive)return;this._isActive=!0,this._div||(this._div=document.createElement("div"),this._div.style.width="100px",this._div.style.height="100px",this._div.style.position="absolute",this._div.style.top="0px",this._div.style.left="0px",this._div.style.zIndex=2..toString(),this._div.style.pointerEvents="none"),this._activateOnTab&&(this._onKeyDown=this._onKeyDown.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)),this._deactivateOnMouseMove&&(this._onMouseMove=this._onMouseMove.bind(this),globalThis.document.addEventListener("mousemove",this._onMouseMove,!0));const t=this._renderer.view.canvas;if(t.parentNode)t.parentNode.appendChild(this._div),this._initAccessibilitySetup();else{const e=new MutationObserver((()=>{t.parentNode&&(t.parentNode.appendChild(this._div),e.disconnect(),this._initAccessibilitySetup())}));e.observe(document.body,{childList:!0,subtree:!0})}}_initAccessibilitySetup(){this._renderer.runners.postrender.add(this),this._renderer.lastObjectRendered&&this._updateAccessibleObjects(this._renderer.lastObjectRendered)}_deactivate(){if(this._isActive&&!this._isMobileAccessibility){this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),this._activateOnTab&&globalThis.addEventListener("keydown",this._onKeyDown,!1),this._renderer.runners.postrender.remove(this);for(const t of this._children)t._accessibleDiv&&t._accessibleDiv.parentNode&&(t._accessibleDiv.parentNode.removeChild(t._accessibleDiv),t._accessibleDiv=null),t._accessibleActive=!1;this._pool.forEach((t=>{t.parentNode&&t.parentNode.removeChild(t)})),this._div&&this._div.parentNode&&this._div.parentNode.removeChild(this._div),this._pool=[],this._children=[]}}_updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&(t._accessibleActive||this._addChild(t),t._renderId=this._renderId);const e=t.children;if(e)for(let t=0;t<e.length;t++)this._updateAccessibleObjects(e[t])}init(e){const r=t.defaultOptions,i={accessibilityOptions:Pr(Pr({},r),(null==e?void 0:e.accessibilityOptions)||{})};this.debug=i.accessibilityOptions.debug,this._activateOnTab=i.accessibilityOptions.activateOnTab,this._deactivateOnMouseMove=i.accessibilityOptions.deactivateOnMouseMove,i.accessibilityOptions.enabledByDefault?this._activate():this._activateOnTab&&(this._onKeyDown=this._onKeyDown.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)),this._renderer.runners.postrender.remove(this)}postrender(){const t=performance.now();if(this._mobileInfo.android.device&&t<this._androidUpdateCount||(this._androidUpdateCount=t+this._androidUpdateFrequency,!this._renderer.renderingToScreen||!this._renderer.view.canvas))return;const e=new Set;if(this._renderer.lastObjectRendered){this._updateAccessibleObjects(this._renderer.lastObjectRendered);for(const t of this._children)t._renderId===this._renderId&&e.add(this._children.indexOf(t))}for(let t=this._children.length-1;t>=0;t--){const r=this._children[t];e.has(t)||(r._accessibleDiv&&r._accessibleDiv.parentNode&&(r._accessibleDiv.parentNode.removeChild(r._accessibleDiv),this._pool.push(r._accessibleDiv),r._accessibleDiv=null),r._accessibleActive=!1,ft(this._children,t,1))}if(this._renderer.renderingToScreen){const{x:t,y:e,width:r,height:i}=this._renderer.screen,s=this._div;s.style.left=`${t}px`,s.style.top=`${e}px`,s.style.width=`${r}px`,s.style.height=`${i}px`}for(let t=0;t<this._children.length;t++){const e=this._children[t];if(!e._accessibleActive||!e._accessibleDiv)continue;const r=e._accessibleDiv,i=e.hitArea||e.getBounds().rectangle;if(e.hitArea){const t=e.worldTransform,s=this._renderer.resolution,n=this._renderer.resolution;r.style.left=(t.tx+i.x*t.a)*s+"px",r.style.top=(t.ty+i.y*t.d)*n+"px",r.style.width=i.width*t.a*s+"px",r.style.height=i.height*t.d*n+"px"}else{this._capHitArea(i);const t=this._renderer.resolution,e=this._renderer.resolution;r.style.left=i.x*t+"px",r.style.top=i.y*e+"px",r.style.width=i.width*t+"px",r.style.height=i.height*e+"px"}}this._renderId++}_updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}_capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:r}=this._renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>r&&(t.height=r-t.y)}_addChild(t){let e=this._pool.pop();e||("button"===t.accessibleType?e=document.createElement("button"):(e=document.createElement(t.accessibleType),e.style.cssText="\n                        color: transparent;\n                        pointer-events: none;\n                        padding: 0;\n                        margin: 0;\n                        border: 0;\n                        outline: 0;\n                        background: transparent;\n                        box-sizing: border-box;\n                        user-select: none;\n                        -webkit-user-select: none;\n                        -moz-user-select: none;\n                        -ms-user-select: none;\n                    ",t.accessibleText&&(e.innerText=t.accessibleText)),e.style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:(!t.accessibleHint||null===t.accessibleHint)&&(e.title=`container ${t.tabIndex}`),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this._updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.container=t,this._children.push(t),this._div.appendChild(t._accessibleDiv),t.interactive&&(t._accessibleDiv.tabIndex=t.tabIndex)}_dispatchEvent(t,e){const{container:r}=t.target,i=this._renderer.events.rootBoundary,s=Object.assign(new rr(i),{target:r});i.rootTarget=this._renderer.lastObjectRendered,e.forEach((t=>i.dispatchEvent(s,t)))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){9!==t.keyCode||!this._activateOnTab||this._activate()}_onMouseMove(t){0===t.movementX&&0===t.movementY||this._deactivate()}destroy(){this._deactivate(),this._destroyTouchHook(),this._div=null,this._pool=null,this._children=null,this._renderer=null,this._activateOnTab&&globalThis.removeEventListener("keydown",this._onKeyDown)}setAccessibilityEnabled(t){t?this._activate():this._deactivate()}};Mr.extension={type:[u.WebGLSystem,u.WebGPUSystem],name:"accessibility"},Mr.defaultOptions={enabledByDefault:!1,debug:!1,activateOnTab:!0,deactivateOnMouseMove:!0};let Rr=Mr;const Cr={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessibleText:null,accessiblePointerEvents:"auto",accessibleChildren:!0,_renderId:-1};p.add(Rr),p.mixin(er,Cr);class Or{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this._cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this._cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let t,e;if(this._cancelResize(),this._resizeTo===globalThis.window)t=globalThis.innerWidth,e=globalThis.innerHeight;else{const{clientWidth:r,clientHeight:i}=this._resizeTo;t=r,e=i}this.renderer.resize(t,e),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this._cancelResize(),this._cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Or.extension=u.Application;var Ir=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(Ir||{});class Br{constructor(t,e=null,r=0,i=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=t,this._context=e,this.priority=r,this._once=i}match(t,e=null){return this._fn===t&&this._context===e}emit(t){this._fn&&(this._context?this._fn.call(this._context,t):this._fn(t));const e=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const kr=class t{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Br(null,null,1/0),this.deltaMS=1/t.targetFPMS,this.elapsedMS=1/t.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,r=Ir.NORMAL){return this._addListener(new Br(t,e,r))}addOnce(t,e,r=Ir.NORMAL){return this._addListener(new Br(t,e,r,!0))}_addListener(t){let e=this._head.next,r=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}else t.connect(r);return this._startIfPossible(),this}remove(t,e){let r=this._head.next;for(;r;)r=r.match(t,e)?r.destroy():r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let r;if(e>this.lastTime){if(r=this.elapsedMS=e-this.lastTime,r>this._maxElapsedMS&&(r=this._maxElapsedMS),r*=this.speed,this._minElapsedMS){const t=e-this._lastFrame|0;if(t<this._minElapsedMS)return;this._lastFrame=e-t%this._minElapsedMS}this.deltaMS=r,this.deltaTime=this.deltaMS*t.targetFPMS;const i=this._head;let s=i.next;for(;s;)s=s.emit(this);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const r=Math.min(this.maxFPS,e),i=Math.min(Math.max(0,r)/1e3,t.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(0===t)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!t._shared){const e=t._shared=new t;e.autoStart=!0,e._protected=!0}return t._shared}static get system(){if(!t._system){const e=t._system=new t;e.autoStart=!0,e._protected=!0}return t._system}};kr.targetFPMS=.06;let Gr=kr;class Dr{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,Ir.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Gr.shared:new Gr,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}Dr.extension=u.Application,p.add(Or),p.add(Dr);const Fr=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this._tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this._tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this._tickerAdded||!this.domElement||(Gr.system.add(this._tickerUpdate,this,Ir.INTERACTION),this._tickerAdded=!0)}removeTickerListener(){this._tickerAdded&&(Gr.system.remove(this._tickerUpdate,this),this._tickerAdded=!1)}pointerMoved(){this._didMove=!0}_update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const t=this.events._rootPointerEvent;this.events.supportsTouchEvents&&"touch"===t.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY,pointerType:t.pointerType,pointerId:t.pointerId}))}_tickerUpdate(t){this._deltaTime+=t.deltaTime,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this._update())}};class Nr extends rr{constructor(){super(...arguments),this.client=new rt,this.movement=new rt,this.offset=new rt,this.global=new rt,this.screen=new rt}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,r){return t.worldTransform.applyInverse(r||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,r,i,s,n,o,a,l,h,u,c,d,p,f){throw new Error("Method not implemented.")}}class Ur extends Nr{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Lr extends Nr{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}Lr.DOM_DELTA_PIXEL=0,Lr.DOM_DELTA_LINE=1,Lr.DOM_DELTA_PAGE=2;const zr=new rt,Xr=new rt;class Hr{constructor(t){this.dispatch=new m,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(((t,e)=>t.priority-e.priority))}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let r=0,i=e.length;r<i;r++)e[r].fn(t)}hitTest(t,e){Fr.pauseUpdate=!0;const r=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,zr.set(t,e),this.hitTestFn,this.hitPruneFn);return r&&r[0]}propagate(t,e){if(!t.target)return;const r=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let i=0,s=r.length-1;i<s;i++)if(t.currentTarget=r[i],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let i=r.length-2;i>=0;i--)if(t.currentTarget=r[i],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,r=this._allInteractiveElements){if(0===r.length)return;t.eventPhase=t.BUBBLING_PHASE;const i=Array.isArray(e)?e:[e];for(let e=r.length-1;e>=0;e--)i.forEach((i=>{t.currentTarget=r[e],this.notifyTarget(t,i)}))}propagationPath(t){const e=[t];for(let r=0;r<2048&&t!==this.rootTarget&&t.parent;r++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,r,i,s,n=!1){let o=!1;if(this._interactivePrune(t))return null;if(("dynamic"===t.eventMode||"dynamic"===e)&&(Fr.pauseUpdate=!1),t.interactiveChildren&&t.children){const a=t.children;for(let l=a.length-1;l>=0;l--){const h=a[l],u=this.hitTestMoveRecursive(h,this._isInteractive(e)?e:h.eventMode,r,i,s,n||s(t,r));if(u){if(u.length>0&&!u[u.length-1].parent)continue;const e=t.isInteractive();(u.length>0||e)&&(e&&this._allInteractiveElements.push(t),u.push(t)),0===this._hitElements.length&&(this._hitElements=u),o=!0}}}const a=this._isInteractive(e),l=t.isInteractive();return l&&l&&this._allInteractiveElements.push(t),n||this._hitElements.length>0?null:o?this._hitElements:a&&!s(t,r)&&i(t,r)?l?[t]:[]:null}hitTestRecursive(t,e,r,i,s){if(this._interactivePrune(t)||s(t,r))return null;if(("dynamic"===t.eventMode||"dynamic"===e)&&(Fr.pauseUpdate=!1),t.interactiveChildren&&t.children){const n=t.children,o=r;for(let r=n.length-1;r>=0;r--){const a=n[r],l=this.hitTestRecursive(a,this._isInteractive(e)?e:a.eventMode,o,i,s);if(l){if(l.length>0&&!l[l.length-1].parent)continue;const e=t.isInteractive();return(l.length>0||e)&&l.push(t),l}}}const n=this._isInteractive(e),o=t.isInteractive();return n&&i(t,r)?o?[t]:[]:null}_isInteractive(t){return"static"===t||"dynamic"===t}_interactivePrune(t){return!t||!t.visible||!t.renderable||!t.measurable||"none"===t.eventMode||"passive"===t.eventMode&&!t.interactiveChildren}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,Xr),!t.hitArea.contains(Xr.x,Xr.y)))return!0;if(t.effects&&t.effects.length)for(let r=0;r<t.effects.length;r++){const i=t.effects[r];if(i.containsPoint&&!i.containsPoint(e,this.hitTestFn))return!0}return!1}hitTestFn(t,e){return!!t.hitArea||!(null==t||!t.containsPoint)&&(t.worldTransform.applyInverse(e,Xr),t.containsPoint(Xr))}notifyTarget(t,e){var r,i;if(!t.currentTarget.isInteractive())return;null!=e||(e=t.type);const s=`on${e}`;null==(i=(r=t.currentTarget)[s])||i.call(r,t);const n=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this._notifyListeners(t,n),t.eventPhase===t.AT_TARGET&&this._notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof Ur))return;const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType)this.dispatchEvent(e,"touchstart");else if("mouse"===e.pointerType||"pen"===e.pointerType){const t=2===e.button;this.dispatchEvent(e,t?"rightdown":"mousedown")}this.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var e,r,i;if(!(t instanceof Ur))return;this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const s=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const n="mouse"===s.pointerType||"pen"===s.pointerType,o=this.trackingData(t.pointerId),a=this.findMountedTarget(o.overTargets);if((null==(e=o.overTargets)?void 0:e.length)>0&&a!==s.target){const e="mousemove"===t.type?"mouseout":"pointerout",r=this.createPointerEvent(t,e,a);if(this.dispatchEvent(r,"pointerout"),n&&this.dispatchEvent(r,"mouseout"),!s.composedPath().includes(a)){const e=this.createPointerEvent(t,"pointerleave",a);for(e.eventPhase=e.AT_TARGET;e.target&&!s.composedPath().includes(e.target);)e.currentTarget=e.target,this.notifyTarget(e),n&&this.notifyTarget(e,"mouseleave"),e.target=e.target.parent;this.freeEvent(e)}this.freeEvent(r)}if(a!==s.target){const e="mousemove"===t.type?"mouseover":"pointerover",r=this.clonePointerEvent(s,e);this.dispatchEvent(r,"pointerover"),n&&this.dispatchEvent(r,"mouseover");let i=null==a?void 0:a.parent;for(;i&&i!==this.rootTarget.parent&&i!==s.target;)i=i.parent;if(!i||i===this.rootTarget.parent){const t=this.clonePointerEvent(s,"pointerenter");for(t.eventPhase=t.AT_TARGET;t.target&&t.target!==a&&t.target!==this.rootTarget.parent;)t.currentTarget=t.target,this.notifyTarget(t),n&&this.notifyTarget(t,"mouseenter"),t.target=t.target.parent;this.freeEvent(t)}this.freeEvent(r)}const l=[],h=null==(r=this.enableGlobalMoveEvents)||r;this.moveOnAll?l.push("pointermove"):this.dispatchEvent(s,"pointermove"),h&&l.push("globalpointermove"),"touch"===s.pointerType&&(this.moveOnAll?l.splice(1,0,"touchmove"):this.dispatchEvent(s,"touchmove"),h&&l.push("globaltouchmove")),n&&(this.moveOnAll?l.splice(1,0,"mousemove"):this.dispatchEvent(s,"mousemove"),h&&l.push("globalmousemove"),this.cursor=null==(i=s.target)?void 0:i.cursor),l.length>0&&this.all(s,l),this._allInteractiveElements.length=0,this._hitElements.length=0,o.overTargets=s.composedPath(),this.freeEvent(s)}mapPointerOver(t){var e;if(!(t instanceof Ur))return;const r=this.trackingData(t.pointerId),i=this.createPointerEvent(t),s="mouse"===i.pointerType||"pen"===i.pointerType;this.dispatchEvent(i,"pointerover"),s&&this.dispatchEvent(i,"mouseover"),"mouse"===i.pointerType&&(this.cursor=null==(e=i.target)?void 0:e.cursor);const n=this.clonePointerEvent(i,"pointerenter");for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),s&&this.notifyTarget(n,"mouseenter"),n.target=n.target.parent;r.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(n)}mapPointerOut(t){if(!(t instanceof Ur))return;const e=this.trackingData(t.pointerId);if(e.overTargets){const r="mouse"===t.pointerType||"pen"===t.pointerType,i=this.findMountedTarget(e.overTargets),s=this.createPointerEvent(t,"pointerout",i);this.dispatchEvent(s),r&&this.dispatchEvent(s,"mouseout");const n=this.createPointerEvent(t,"pointerleave",i);for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),r&&this.notifyTarget(n,"mouseleave"),n.target=n.target.parent;e.overTargets=null,this.freeEvent(s),this.freeEvent(n)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Ur))return;const e=performance.now(),r=this.createPointerEvent(t);if(this.dispatchEvent(r,"pointerup"),"touch"===r.pointerType)this.dispatchEvent(r,"touchend");else if("mouse"===r.pointerType||"pen"===r.pointerType){const t=2===r.button;this.dispatchEvent(r,t?"rightup":"mouseup")}const i=this.trackingData(t.pointerId),s=this.findMountedTarget(i.pressTargetsByButton[t.button]);let n=s;if(s&&!r.composedPath().includes(s)){let e=s;for(;e&&!r.composedPath().includes(e);){if(r.currentTarget=e,this.notifyTarget(r,"pointerupoutside"),"touch"===r.pointerType)this.notifyTarget(r,"touchendoutside");else if("mouse"===r.pointerType||"pen"===r.pointerType){const t=2===r.button;this.notifyTarget(r,t?"rightupoutside":"mouseupoutside")}e=e.parent}delete i.pressTargetsByButton[t.button],n=e}if(n){const s=this.clonePointerEvent(r,"click");s.target=n,s.path=null,i.clicksByButton[t.button]||(i.clicksByButton[t.button]={clickCount:0,target:s.target,timeStamp:e});const o=i.clicksByButton[t.button];if(o.target===s.target&&e-o.timeStamp<200?++o.clickCount:o.clickCount=1,o.target=s.target,o.timeStamp=e,s.detail=o.clickCount,"mouse"===s.pointerType){const t=2===s.button;this.dispatchEvent(s,t?"rightclick":"click")}else"touch"===s.pointerType&&this.dispatchEvent(s,"tap");this.dispatchEvent(s,"pointertap"),this.freeEvent(s)}this.freeEvent(r)}mapPointerUpOutside(t){if(!(t instanceof Ur))return;const e=this.trackingData(t.pointerId),r=this.findMountedTarget(e.pressTargetsByButton[t.button]),i=this.createPointerEvent(t);if(r){let s=r;for(;s;)i.currentTarget=s,this.notifyTarget(i,"pointerupoutside"),"touch"===i.pointerType?this.notifyTarget(i,"touchendoutside"):("mouse"===i.pointerType||"pen"===i.pointerType)&&this.notifyTarget(i,2===i.button?"rightupoutside":"mouseupoutside"),s=s.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(i)}mapWheel(t){if(!(t instanceof Lr))return;const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let r=1;r<t.length&&t[r].parent===e;r++)e=t[r];return e}createPointerEvent(t,e,r){var i;const s=this.allocateEvent(Ur);return this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.nativeEvent=t.nativeEvent,s.originalEvent=t,s.target=null!=(i=null!=r?r:this.hitTest(s.global.x,s.global.y))?i:this._hitElements[0],"string"==typeof e&&(s.type=e),s}createWheelEvent(t){const e=this.allocateEvent(Lr);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const r=this.allocateEvent(Ur);return r.nativeEvent=t.nativeEvent,r.originalEvent=t.originalEvent,this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.target=t.target,r.path=t.composedPath().slice(),r.type=null!=e?e:r.type,r}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Ur&&e instanceof Ur&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof Nr&&e instanceof Nr&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.defaultPrevented=!1,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}_notifyListeners(t,e){const r=t.currentTarget._events[e];if(r)if("fn"in r)r.once&&t.currentTarget.removeListener(e,r.fn,void 0,!0),r.fn.call(r.context,t);else for(let i=0,s=r.length;i<s&&!t.propagationImmediatelyStopped;i++)r[i].once&&t.currentTarget.removeListener(e,r[i].fn,void 0,!0),r[i].fn.call(r[i].context,t)}}var jr=Object.defineProperty,Vr=Object.getOwnPropertySymbols,Wr=Object.prototype.hasOwnProperty,$r=Object.prototype.propertyIsEnumerable,Yr=(t,e,r)=>e in t?jr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;const qr={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Kr=class t{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new Hr(null),Fr.init(this),this.autoPreventDefault=!0,this._eventsAdded=!1,this._rootPointerEvent=new Ur(null),this._rootWheelEvent=new Lr(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy(((t,e)=>{for(var r in e||(e={}))Wr.call(e,r)&&Yr(t,r,e[r]);if(Vr)for(var r of Vr(e))$r.call(e,r)&&Yr(t,r,e[r]);return t})({},t.defaultEventFeatures),{set:(t,e,r)=>("globalMove"===e&&(this.rootBoundary.enableGlobalMoveEvents=r),t[e]=r,!0)}),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._onPointerUp=this._onPointerUp.bind(this),this._onPointerOverOut=this._onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){var r,i;const{canvas:s,resolution:n}=this.renderer;this.setTargetElement(s),this.resolution=n,t._defaultEventMode=null!=(r=e.eventMode)?r:"passive",Object.assign(this.features,null!=(i=e.eventFeatures)?i:{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null,this._currentCursor=null}setCursor(t){t||(t="default");let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this._currentCursor===t)return;this._currentCursor=t;const r=this.cursorStyles[t];if(r)switch(typeof r){case"string":e&&(this.domElement.style.cursor=r);break;case"function":r(t);break;case"object":e&&Object.assign(this.domElement.style,r)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this._rootPointerEvent}_onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this._normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let t=0,r=e.length;t<r;t++){const r=e[t],i=this._bootstrapEvent(this._rootPointerEvent,r);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}_onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Fr.pointerMoved();const e=this._normalizeToPointerData(t);for(let t=0,r=e.length;t<r;t++){const r=this._bootstrapEvent(this._rootPointerEvent,e[t]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}_onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const r=e!==this.domElement?"outside":"",i=this._normalizeToPointerData(t);for(let t=0,e=i.length;t<e;t++){const e=this._bootstrapEvent(this._rootPointerEvent,i[t]);e.type+=r,this.rootBoundary.mapEvent(e)}this.setCursor(this.rootBoundary.cursor)}_onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this._normalizeToPointerData(t);for(let t=0,r=e.length;t<r;t++){const r=this._bootstrapEvent(this._rootPointerEvent,e[t]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this._removeEvents(),this.domElement=t,Fr.domElement=t,this._addEvents()}_addEvents(){if(this._eventsAdded||!this.domElement)return;Fr.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this._onPointerMove,!0),this.domElement.addEventListener("pointerdown",this._onPointerDown,!0),this.domElement.addEventListener("pointerleave",this._onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this._onPointerOverOut,!0),globalThis.addEventListener("pointerup",this._onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this._onPointerMove,!0),this.domElement.addEventListener("mousedown",this._onPointerDown,!0),this.domElement.addEventListener("mouseout",this._onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this._onPointerOverOut,!0),globalThis.addEventListener("mouseup",this._onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this._onPointerDown,!0),this.domElement.addEventListener("touchend",this._onPointerUp,!0),this.domElement.addEventListener("touchmove",this._onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this._eventsAdded=!0}_removeEvents(){if(!this._eventsAdded||!this.domElement)return;Fr.removeTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction="")),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this._onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this._onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this._onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this._onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this._onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this._onPointerMove,!0),this.domElement.removeEventListener("mousedown",this._onPointerDown,!0),this.domElement.removeEventListener("mouseout",this._onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this._onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this._onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this._onPointerDown,!0),this.domElement.removeEventListener("touchend",this._onPointerUp,!0),this.domElement.removeEventListener("touchmove",this._onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this._eventsAdded=!1}mapPositionToPoint(t,e,r){const i=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},s=1/this.resolution;t.x=(e-i.left)*(this.domElement.width/i.width)*s,t.y=(r-i.top)*(this.domElement.height/i.height)*s}_normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let r=0,i=t.changedTouches.length;r<i;r++){const i=t.changedTouches[r];void 0===i.button&&(i.button=0),void 0===i.buttons&&(i.buttons=1),void 0===i.isPrimary&&(i.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===i.width&&(i.width=i.radiusX||1),void 0===i.height&&(i.height=i.radiusY||1),void 0===i.tiltX&&(i.tiltX=0),void 0===i.tiltY&&(i.tiltY=0),void 0===i.pointerType&&(i.pointerType="touch"),void 0===i.pointerId&&(i.pointerId=i.identifier||0),void 0===i.pressure&&(i.pressure=i.force||.5),void 0===i.twist&&(i.twist=0),void 0===i.tangentialPressure&&(i.tangentialPressure=0),void 0===i.layerX&&(i.layerX=i.offsetX=i.clientX),void 0===i.layerY&&(i.layerY=i.offsetY=i.clientY),i.isNormalized=!0,i.type=t.type,e.push(i)}else if(globalThis.MouseEvent&&(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof globalThis.PointerEvent))e.push(t);else{const r=t;void 0===r.isPrimary&&(r.isPrimary=!0),void 0===r.width&&(r.width=1),void 0===r.height&&(r.height=1),void 0===r.tiltX&&(r.tiltX=0),void 0===r.tiltY&&(r.tiltY=0),void 0===r.pointerType&&(r.pointerType="mouse"),void 0===r.pointerId&&(r.pointerId=1),void 0===r.pressure&&(r.pressure=.5),void 0===r.twist&&(r.twist=0),void 0===r.tangentialPressure&&(r.tangentialPressure=0),r.isNormalized=!0,e.push(r)}return e}normalizeWheelEvent(t){const e=this._rootWheelEvent;return this._transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}_bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this._transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=qr[t.type]||t.type),t}_transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};Kr.extension={name:"events",type:[u.WebGLSystem,u.CanvasSystem,u.WebGPUSystem],priority:-1},Kr.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let Qr=Kr;const Zr={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,get interactive(){return"dynamic"===this.eventMode||"static"===this.eventMode},set interactive(t){this.eventMode=t?"static":"passive"},_internalEventMode:void 0,get eventMode(){var t;return null!=(t=this._internalEventMode)?t:Qr.defaultEventMode},set eventMode(t){this._internalEventMode=t},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(t,e,r){const i="boolean"==typeof r&&r||"object"==typeof r&&r.capture,s="object"==typeof r?r.signal:void 0,n="object"==typeof r&&!0===r.once,o="function"==typeof e?void 0:e;t=i?`${t}capture`:t;const a="function"==typeof e?e:e.handleEvent,l=this;s&&s.addEventListener("abort",(()=>{l.off(t,a,o)})),n?l.once(t,a,o):l.on(t,a,o)},removeEventListener(t,e,r){const i="function"==typeof e?void 0:e;t="boolean"==typeof r&&r||"object"==typeof r&&r.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.off(t,e,i)},dispatchEvent(t){if(!(t instanceof rr))throw new Error("Container cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};p.add(Qr),p.mixin(er,Zr);var Jr=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(Jr||{});const ti={createCanvas:(t,e)=>{const r=document.createElement("canvas");return r.width=t,r.height=e,r},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>{var t;return null!=(t=document.baseURI)?t:window.location.href},getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>(new DOMParser).parseFromString(t,"text/xml")};let ei=ti;const ri={get:()=>ei,set(t){ei=t}};function ii(t){if("string"!=typeof t)throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function si(t){return t.split("?")[0].split("#")[0]}const ni={toPosix:t=>function(t,e,r){return t.replace(new RegExp(function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(e),"g"),r)}(t,"\\","/"),isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl:t=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t),isBlobUrl:t=>t.startsWith("blob:"),hasProtocol(t){return/^[^/:]+:/.test(this.toPosix(t))},getProtocol(t){ii(t),t=this.toPosix(t);const e=/^file:\/\/\//.exec(t);if(e)return e[0];const r=/^[^/:]+:\/{0,2}/.exec(t);return r?r[0]:""},toAbsolute(t,e,r){if(ii(t),this.isDataUrl(t)||this.isBlobUrl(t))return t;const i=si(this.toPosix(null!=e?e:ri.get().getBaseUrl())),s=si(this.toPosix(null!=r?r:this.rootname(i)));return(t=this.toPosix(t)).startsWith("/")?ni.join(s,t.slice(1)):this.isAbsolute(t)?t:this.join(i,t)},normalize(t){if(ii(t),0===t.length)return".";if(this.isDataUrl(t)||this.isBlobUrl(t))return t;let e="";const r=(t=this.toPosix(t)).startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));const i=t.endsWith("/");return t=function(t,e){let r="",i=0,s=-1,n=0,o=-1;for(let a=0;a<=t.length;++a){if(a<t.length)o=t.charCodeAt(a);else{if(47===o)break;o=47}if(47===o){if(s!==a-1&&1!==n)if(s!==a-1&&2===n){if(r.length<2||2!==i||46!==r.charCodeAt(r.length-1)||46!==r.charCodeAt(r.length-2))if(r.length>2){const t=r.lastIndexOf("/");if(t!==r.length-1){-1===t?(r="",i=0):(r=r.slice(0,t),i=r.length-1-r.lastIndexOf("/")),s=a,n=0;continue}}else if(2===r.length||1===r.length){r="",i=0,s=a,n=0;continue}e&&(r.length>0?r+="/..":r="..",i=2)}else r.length>0?r+=`/${t.slice(s+1,a)}`:r=t.slice(s+1,a),i=a-s-1;s=a,n=0}else 46===o&&-1!==n?++n:n=-1}return r}(t,!1),t.length>0&&i&&(t+="/"),r?`/${t}`:e+t},isAbsolute(t){return ii(t),t=this.toPosix(t),!!this.hasProtocol(t)||t.startsWith("/")},join(...t){var e;if(0===t.length)return".";let r;for(let i=0;i<t.length;++i){const s=t[i];if(ii(s),s.length>0)if(void 0===r)r=s;else{const n=null!=(e=t[i-1])?e:"";this.joinExtensions.includes(this.extname(n).toLowerCase())?r+=`/../${s}`:r+=`/${s}`}}return void 0===r?".":this.normalize(r)},dirname(t){if(ii(t),0===t.length)return".";let e=(t=this.toPosix(t)).charCodeAt(0);const r=47===e;let i=-1,s=!0;const n=this.getProtocol(t),o=t;for(let r=(t=t.slice(n.length)).length-1;r>=1;--r)if(e=t.charCodeAt(r),47===e){if(!s){i=r;break}}else s=!1;return-1===i?r?"/":this.isUrl(o)?n+t:n:r&&1===i?"//":n+t.slice(0,i)},rootname(t){ii(t);let e="";if(e=(t=this.toPosix(t)).startsWith("/")?"/":this.getProtocol(t),this.isUrl(t)){const r=t.indexOf("/",e.length);e=-1!==r?t.slice(0,r):t,e.endsWith("/")||(e+="/")}return e},basename(t,e){ii(t),e&&ii(e),t=si(this.toPosix(t));let r,i=0,s=-1,n=!0;if(void 0!==e&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let o=e.length-1,a=-1;for(r=t.length-1;r>=0;--r){const l=t.charCodeAt(r);if(47===l){if(!n){i=r+1;break}}else-1===a&&(n=!1,a=r+1),o>=0&&(l===e.charCodeAt(o)?-1==--o&&(s=r):(o=-1,s=a))}return i===s?s=a:-1===s&&(s=t.length),t.slice(i,s)}for(r=t.length-1;r>=0;--r)if(47===t.charCodeAt(r)){if(!n){i=r+1;break}}else-1===s&&(n=!1,s=r+1);return-1===s?"":t.slice(i,s)},extname(t){ii(t);let e=-1,r=0,i=-1,s=!0,n=0;for(let o=(t=si(this.toPosix(t))).length-1;o>=0;--o){const a=t.charCodeAt(o);if(47!==a)-1===i&&(s=!1,i=o+1),46===a?-1===e?e=o:1!==n&&(n=1):-1!==e&&(n=-1);else if(!s){r=o+1;break}}return-1===e||-1===i||0===n||1===n&&e===i-1&&e===r+1?"":t.slice(e,i)},parse(t){ii(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return e;let r=(t=si(this.toPosix(t))).charCodeAt(0);const i=this.isAbsolute(t);let s;e.root=this.rootname(t),s=i||this.hasProtocol(t)?1:0;let n=-1,o=0,a=-1,l=!0,h=t.length-1,u=0;for(;h>=s;--h)if(r=t.charCodeAt(h),47!==r)-1===a&&(l=!1,a=h+1),46===r?-1===n?n=h:1!==u&&(u=1):-1!==n&&(u=-1);else if(!l){o=h+1;break}return-1===n||-1===a||0===u||1===u&&n===a-1&&n===o+1?-1!==a&&(e.base=e.name=0===o&&i?t.slice(1,a):t.slice(o,a)):(0===o&&i?(e.name=t.slice(1,n),e.base=t.slice(1,a)):(e.name=t.slice(o,n),e.base=t.slice(o,a)),e.ext=t.slice(n,a)),e.dir=this.dirname(t),e},sep:"/",delimiter:":",joinExtensions:[".html"]},oi=(t,e,r=!1)=>(Array.isArray(t)||(t=[t]),e?t.map((t=>"string"==typeof t||r?e(t):t)):t);function ai(t,e,r,i,s){const n=e[r];for(let o=0;o<n.length;o++){const a=n[o];r<e.length-1?ai(t.replace(i[r],a),e,r+1,i,s):s.push(t.replace(i[r],a))}}function li(t){const e=t.match(/\{(.*?)\}/g),r=[];if(e){const i=[];e.forEach((t=>{const e=t.substring(1,t.length-1).split(",");i.push(e)})),ai(t,i,0,e,r)}else r.push(t);return r}const hi=t=>!Array.isArray(t);var ui=Object.defineProperty,ci=Object.defineProperties,di=Object.getOwnPropertyDescriptors,pi=Object.getOwnPropertySymbols,fi=Object.prototype.hasOwnProperty,gi=Object.prototype.propertyIsEnumerable,mi=(t,e,r)=>e in t?ui(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_i=(t,e)=>{for(var r in e||(e={}))fi.call(e,r)&&mi(t,r,e[r]);if(pi)for(var r of pi(e))gi.call(e,r)&&mi(t,r,e[r]);return t};class xi{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){var e,r,i;if(this._bundleIdConnector=null!=(e=t.connector)?e:this._bundleIdConnector,this._createBundleAssetId=null!=(r=t.createBundleAssetId)?r:this._createBundleAssetId,this._extractAssetIdFromBundle=null!=(i=t.extractAssetIdFromBundle)?i:this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach((t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))})),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if("string"==typeof t)this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&")}}getAlias(t){const{alias:e,src:r}=t;return oi(e||r,(t=>"string"==typeof t?t:Array.isArray(t)?t.map((t=>{var e;return null!=(e=null==t?void 0:t.src)?e:t})):null!=t&&t.src?t.src:t),!0)}addManifest(t){this._manifest,this._manifest=t,t.bundles.forEach((t=>{this.addBundle(t.name,t.assets)}))}addBundle(t,e){const r=[];let i=e;Array.isArray(e)||(i=Object.entries(e).map((([t,e])=>"string"==typeof e||Array.isArray(e)?{alias:t,src:e}:_i({alias:t},e)))),i.forEach((e=>{const i=e.src,s=e.alias;let n;if("string"==typeof s){const e=this._createBundleAssetId(t,s);r.push(e),n=[s,e]}else{const e=s.map((e=>this._createBundleAssetId(t,e)));r.push(...e),n=[...s,...e]}this.add(((t,e)=>ci(t,di(e)))(_i({},e),{alias:n,src:i}))})),this._bundles[t]=r}add(t){const e=[];Array.isArray(t)?e.push(...t):e.push(t),oi(e).forEach((t=>{const{src:e}=t;let{data:r,format:i,loadParser:s}=t;const n=oi(e).map((t=>"string"==typeof t?li(t):Array.isArray(t)?t:[t])),o=this.getAlias(t),a=[];n.forEach((t=>{t.forEach((t=>{var e,n,l;let h={};if("object"!=typeof t){h.src=t;for(let e=0;e<this._parsers.length;e++){const r=this._parsers[e];if(r.test(t)){h=r.parse(t);break}}}else r=null!=(e=t.data)?e:r,i=null!=(n=t.format)?n:i,s=null!=(l=t.loadParser)?l:s,h=_i(_i({},h),t);if(!o)throw new Error(`[Resolver] alias is undefined for this asset: ${h.src}`);h=this._buildResolvedAsset(h,{aliases:o,data:r,format:i,loadParser:s}),a.push(h)}))})),o.forEach((t=>{this._assetMap[t]=a}))}))}resolveBundle(t){const e=hi(t);t=oi(t);const r={};return t.forEach((t=>{const e=this._bundles[t];if(e){const i=this.resolve(e),s={};for(const e in i){const r=i[e];s[this._extractAssetIdFromBundle(t,e)]=r}r[t]=s}})),e?r[t[0]]:r}resolveUrl(t){const e=this.resolve(t);if("string"!=typeof t){const t={};for(const r in e)t[r]=e[r].src;return t}return e.src}resolve(t){const e=hi(t);t=oi(t);const r={};return t.forEach((t=>{if(!this._resolverHash[t])if(this._assetMap[t]){let e=this._assetMap[t];const r=this._getPreferredOrder(e);null==r||r.priority.forEach((t=>{r.params[t].forEach((r=>{const i=e.filter((e=>!!e[t]&&e[t]===r));i.length&&(e=i)}))})),this._resolverHash[t]=e[0]}else this._resolverHash[t]=this._buildResolvedAsset({alias:[t],src:t},{});r[t]=this._resolverHash[t]})),e?r[t[0]]:r}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const r=t[e],i=this._preferredOrder.find((t=>t.params.format.includes(r.format)));if(i)return i}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;return`${t}${/\?/.test(t)?"&":"?"}${this._defaultSearchParams}`}_buildResolvedAsset(t,e){var r,i;const{aliases:s,data:n,loadParser:o,format:a}=e;return(this._basePath||this._rootPath)&&(t.src=ni.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=null!=(r=null!=s?s:t.alias)?r:[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data=_i(_i({},n||{}),t.data),t.loadParser=null!=o?o:t.loadParser,t.format=null!=(i=null!=a?a:t.format)?i:yi(t.src),t}}function yi(t){return t.split(".").pop().split("?").shift().split("#").shift()}xi.RETINA_PREFIX=/@([0-9\.]+)x/;const bi=(t,e)=>{const r=e.split("?")[1];return r&&(t+=`?${r}`),t},vi=class t{constructor(t,e){this.linkedSheets=[],this._texture=t instanceof Ue?t:null,this.textureSource=t.source,this.textures={},this.animations={},this.data=e;const r=parseFloat(e.meta.scale);r?(this.resolution=r,t.source.resolution=this.resolution):this.resolution=t.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise((e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=t.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()}))}_processFrames(e){let r=e;const i=t.BATCH_SIZE;for(;r-e<i&&r<this._frameKeys.length;){const t=this._frameKeys[r],e=this._frames[t],i=e.frame;if(i){let r=null,s=null;const n=!1!==e.trimmed&&e.sourceSize?e.sourceSize:e.frame,o=new Rt(0,0,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution);r=e.rotated?new Rt(Math.floor(i.x)/this.resolution,Math.floor(i.y)/this.resolution,Math.floor(i.h)/this.resolution,Math.floor(i.w)/this.resolution):new Rt(Math.floor(i.x)/this.resolution,Math.floor(i.y)/this.resolution,Math.floor(i.w)/this.resolution,Math.floor(i.h)/this.resolution),!1!==e.trimmed&&e.spriteSourceSize&&(s=new Rt(Math.floor(e.spriteSourceSize.x)/this.resolution,Math.floor(e.spriteSourceSize.y)/this.resolution,Math.floor(i.w)/this.resolution,Math.floor(i.h)/this.resolution)),this.textures[t]=new Ue({source:this.textureSource,frame:r,orig:o,trim:s,rotate:e.rotated?2:0,defaultAnchor:e.anchor,defaultBorders:e.borders,label:t.toString()})}r++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let r=0;r<t[e].length;r++){const i=t[e][r];this.animations[e].push(this.textures[i])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*t.BATCH_SIZE),this._batchIndex++,setTimeout((()=>{this._batchIndex*t.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())}),0)}destroy(t=!1){var e;for(const t in this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(null==(e=this._texture)||e.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};vi.BATCH_SIZE=1e3;let Ti=vi;const Si=["jpg","png","jpeg","avif","webp","basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"];function wi(t,e,r){const i={};if(t.forEach((t=>{i[t]=e})),Object.keys(e.textures).forEach((t=>{i[t]=e.textures[t]})),!r){const r=ni.dirname(t[0]);e.linkedSheets.forEach(((t,s)=>{const n=wi([`${r}/${e.data.meta.related_multi_packs[s]}`],t,!0);Object.assign(i,n)}))}return i}const Ei={extension:u.Asset,cache:{test:t=>t instanceof Ti,getCacheableAssets:(t,e)=>wi(t,e,!1)},resolver:{extension:{type:u.ResolveParser,name:"resolveSpritesheet"},test:t=>{const e=t.split("?")[0].split("."),r=e.pop(),i=e.pop();return"json"===r&&Si.includes(i)},parse:t=>{var e,r;const i=t.split(".");return{resolution:parseFloat(null!=(r=null==(e=xi.RETINA_PREFIX.exec(t))?void 0:e[1])?r:"1"),format:i[i.length-2],src:t}}},loader:{name:"spritesheetLoader",extension:{type:u.LoadParser,priority:Jr.Normal,name:"spritesheetLoader"},testParse:async(t,e)=>".json"===ni.extname(e.src).toLowerCase()&&!!t.frames,async parse(t,e,r){var i,s,n;const{texture:o,imageFilename:a,textureOptions:l}=null!=(i=null==e?void 0:e.data)?i:{};let h,u=ni.dirname(e.src);if(u&&u.lastIndexOf("/")!==u.length-1&&(u+="/"),o instanceof Ue)h=o;else{const i=bi(u+(null!=a?a:t.meta.image),e.src);h=(await r.load([{src:i,data:l}]))[i]}const c=new Ti(h.source,t);await c.parse();const d=null==(s=null==t?void 0:t.meta)?void 0:s.related_multi_packs;if(Array.isArray(d)){const t=[];for(const i of d){if("string"!=typeof i)continue;let s=u+i;null!=(n=e.data)&&n.ignoreMultiPack||(s=bi(s,e.src),t.push(r.load({src:s,data:{textureOptions:l,ignoreMultiPack:!0}})))}const i=await Promise.all(t);c.linkedSheets=i,i.forEach((t=>{t.linkedSheets=[c].concat(c.linkedSheets.filter((e=>e!==t)))}))}return c},async unload(t,e,r){await r.unload(t.textureSource._sourceOrigin),t.destroy(!1)}}};function Ai(t,e,r){const{width:i,height:s}=r.orig,n=r.trim;if(n){const r=n.width,o=n.height;t.minX=n.x-e._x*i,t.maxX=t.minX+r,t.minY=n.y-e._y*s,t.maxY=t.minY+o}else t.minX=-e._x*i,t.maxX=t.minX+i,t.minY=-e._y*s,t.maxY=t.minY+s}p.add(Ei);class Pi extends er{constructor(t){super(t),this.canBundle=!0,this.allowChildren=!1,this._roundPixels=0,this._lastUsed=-1,this._bounds=new Ot(0,1,0,0),this._boundsDirty=!0}get bounds(){return this._boundsDirty?(this.updateBounds(),this._boundsDirty=!1,this._bounds):this._bounds}get roundPixels(){return!!this._roundPixels}set roundPixels(t){this._roundPixels=t?1:0}containsPoint(t){const e=this.bounds,{x:r,y:i}=t;return r>=e.minX&&r<=e.maxX&&i>=e.minY&&i<=e.maxY}onViewUpdate(){if(this._didViewChangeTick++,this._boundsDirty=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const t=this.renderGroup||this.parentRenderGroup;t&&t.onChildViewUpdate(this)}destroy(t){super.destroy(t),this._bounds=null}collectRenderablesSimple(t,e,r){const{renderPipes:i,renderableGC:s}=e;i.blendMode.setBlendMode(this,this.groupBlendMode,t),i[this.renderPipeId].addRenderable(this,t),s.addRenderable(this),this.didViewUpdate=!1;const n=this.children,o=n.length;for(let i=0;i<o;i++)n[i].collectRenderables(t,e,r)}}var Mi=Object.defineProperty,Ri=Object.getOwnPropertySymbols,Ci=Object.prototype.hasOwnProperty,Oi=Object.prototype.propertyIsEnumerable,Ii=(t,e,r)=>e in t?Mi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;class Bi extends Pi{constructor(t=Ue.EMPTY){t instanceof Ue&&(t={texture:t});const e=t,{texture:r=Ue.EMPTY,anchor:i,roundPixels:s,width:n,height:o}=e,a=((t,e)=>{var r={};for(var i in t)Ci.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&Ri)for(var i of Ri(t))e.indexOf(i)<0&&Oi.call(t,i)&&(r[i]=t[i]);return r})(e,["texture","anchor","roundPixels","width","height"]);super(((t,e)=>{for(var r in e||(e={}))Ci.call(e,r)&&Ii(t,r,e[r]);if(Ri)for(var r of Ri(e))Oi.call(e,r)&&Ii(t,r,e[r]);return t})({label:"Sprite"},a)),this.renderPipeId="sprite",this.batched=!0,this._visualBounds={minX:0,maxX:1,minY:0,maxY:0},this._anchor=new at({_onUpdate:()=>{this.onViewUpdate()}}),i?this.anchor=i:r.defaultAnchor&&(this.anchor=r.defaultAnchor),this.texture=r,this.allowChildren=!1,this.roundPixels=null!=s&&s,void 0!==n&&(this.width=n),void 0!==o&&(this.height=o)}static from(t,e=!1){return new Bi(t instanceof Ue?t:Ue.from(t,e))}set texture(t){t||(t=Ue.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this._width&&this._setWidth(this._width,this._texture.orig.width),this._height&&this._setHeight(this._height,this._texture.orig.height),this.onViewUpdate())}get texture(){return this._texture}get visualBounds(){return Ai(this._visualBounds,this._anchor,this._texture),this._visualBounds}get sourceBounds(){return this.visualBounds}updateBounds(){const t=this._anchor,e=this._texture,r=this._bounds,{width:i,height:s}=e.orig;r.minX=-t._x*i,r.maxX=r.minX+i,r.minY=-t._y*s,r.maxY=r.minY+s}destroy(t=!1){if(super.destroy(t),"boolean"==typeof t?t:null==t?void 0:t.texture){const e="boolean"==typeof t?t:null==t?void 0:t.textureSource;this._texture.destroy(e)}this._texture=null,this._visualBounds=null,this._bounds=null,this._anchor=null}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this._setWidth(t,this._texture.orig.width),this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this._setHeight(t,this._texture.orig.height),this._height=t}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this._texture.orig.width,t.height=Math.abs(this.scale.y)*this._texture.orig.height,t}setSize(t,e){var r;"object"==typeof t?(e=null!=(r=t.height)?r:t.width,t=t.width):null!=e||(e=t),void 0!==t&&this._setWidth(t,this._texture.orig.width),void 0!==e&&this._setHeight(e,this._texture.orig.height)}}const ki=new Ot;function Gi(t,e,r){const i=ki;t.measurable=!0,Dt(t,r,i),e.addBoundsMask(i),t.measurable=!1}function Di(t,e,r){const i=Bt.get();t.measurable=!0;const s=It.get().identity();jt(t,i,Fi(t,r,s)),t.measurable=!1,e.addBoundsMask(i),It.return(s),Bt.return(i)}function Fi(t,e,r){return t&&t!==e&&(Fi(t.parent,e,r),t.updateLocalTransform(),r.append(t.localTransform)),r}class Ni{constructor(t){this.priority=0,this.inverse=!1,this.pipe="alphaMask",null!=t&&t.mask&&this.init(t.mask)}init(t){this.mask=t,this.renderMaskToTexture=!(t instanceof Bi),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask=null}addBounds(t,e){this.inverse||Gi(this.mask,t,e)}addLocalBounds(t,e){Di(this.mask,t,e)}containsPoint(t,e){return e(this.mask,t)}destroy(){this.reset()}static test(t){return t instanceof Bi}}Ni.extension=u.MaskEffect;class Ui{constructor(t){this.priority=0,this.pipe="colorMask",null!=t&&t.mask&&this.init(t.mask)}init(t){this.mask=t}destroy(){}static test(t){return"number"==typeof t}}Ui.extension=u.MaskEffect;class Li{constructor(t){this.priority=0,this.pipe="stencilMask",null!=t&&t.mask&&this.init(t.mask)}init(t){this.mask=t,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null}addBounds(t,e){Gi(this.mask,t,e)}addLocalBounds(t,e){Di(this.mask,t,e)}containsPoint(t,e){return e(this.mask,t)}destroy(){this.reset()}static test(t){return t instanceof er}}Li.extension=u.MaskEffect;class zi extends ye{constructor(t){t.resource||(t.resource=ri.get().createCanvas()),t.width||(t.width=t.resource.width,t.autoDensity||(t.width/=t.resolution)),t.height||(t.height=t.resource.height,t.autoDensity||(t.height/=t.resolution)),super(t),this.uploadMethodId="image",this.autoDensity=t.autoDensity,this.resizeCanvas(),this.transparent=!!t.transparent}resizeCanvas(){this.autoDensity&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),(this.resource.width!==this.pixelWidth||this.resource.height!==this.pixelHeight)&&(this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight)}resize(t=this.width,e=this.height,r=this._resolution){const i=super.resize(t,e,r);return i&&this.resizeCanvas(),i}static test(t){return globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement||globalThis.OffscreenCanvas&&t instanceof OffscreenCanvas}get context2D(){return this._context2D||(this._context2D=this.resource.getContext("2d"))}}zi.extension=u.TextureSource;class Xi extends ye{constructor(t){if(t.resource&&globalThis.HTMLImageElement&&t.resource instanceof HTMLImageElement){const e=ri.get().createCanvas(t.resource.width,t.resource.height);e.getContext("2d").drawImage(t.resource,0,0,t.resource.width,t.resource.height),t.resource=e}super(t),this.uploadMethodId="image",this.autoGarbageCollect=!0}static test(t){return globalThis.HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||globalThis.VideoFrame&&t instanceof VideoFrame}}let Hi;async function ji(){return null!=Hi||(Hi=(async()=>{var t;const e=document.createElement("canvas").getContext("webgl");if(!e)return"premultiply-alpha-on-upload";const r=await new Promise((t=>{const e=document.createElement("video");e.onloadeddata=()=>t(e),e.onerror=()=>t(null),e.autoplay=!1,e.crossOrigin="anonymous",e.preload="auto",e.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",e.load()}));if(!r)return"premultiply-alpha-on-upload";const i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i);const s=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r);const n=new Uint8Array(4);return e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,n),e.deleteFramebuffer(s),e.deleteTexture(i),null==(t=e.getExtension("WEBGL_lose_context"))||t.loseContext(),n[0]<=n[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),Hi}Xi.extension=u.TextureSource;var Vi=Object.defineProperty,Wi=Object.defineProperties,$i=Object.getOwnPropertyDescriptors,Yi=Object.getOwnPropertySymbols,qi=Object.prototype.hasOwnProperty,Ki=Object.prototype.propertyIsEnumerable,Qi=(t,e,r)=>e in t?Vi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Zi=(t,e)=>{for(var r in e||(e={}))qi.call(e,r)&&Qi(t,r,e[r]);if(Yi)for(var r of Yi(e))Ki.call(e,r)&&Qi(t,r,e[r]);return t};const Ji=class t extends ye{constructor(e){var r;super(e),this.isReady=!1,this.uploadMethodId="video",e=Zi(Zi({},t.defaultOptions),e),this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==e.autoPlay,this.alphaMode=null!=(r=e.alphaMode)?r:"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),!1!==e.autoLoad&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){const t=Gr.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;const t=this.resource,e=this.options;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._mediaReady():(e.preload||t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlayThrough),t.addEventListener("error",this._onError,!0)),this.alphaMode=await ji(),this._load=new Promise(((r,i)=>{this.isValid?r(this):(this._resolve=r,this._reject=i,void 0!==e.preloadTimeoutMs&&(this._preloadTimeout=setTimeout((()=>{this._onError(new ErrorEvent(`Preload exceeded timeout of ${e.preloadTimeoutMs}ms`))}))),t.load())})),this._load}_onError(t){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.resource;return!t.paused&&!t.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._mediaReady(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){this.resource.removeEventListener("canplay",this._onCanPlay),this._mediaReady()}_onCanPlayThrough(){this.resource.removeEventListener("canplaythrough",this._onCanPlay),this._preloadTimeout&&(clearTimeout(this._preloadTimeout),this._preloadTimeout=void 0),this._mediaReady()}_mediaReady(){const t=this.resource;this.isValid&&(this.isReady=!0,this.resize(t.videoWidth,t.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();const t=this.resource;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlayThrough),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.resource.requestVideoFrameCallback?(this._isConnectedToTicker&&(Gr.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),null===this._videoFrameRequestCallbackHandle&&(this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback))):(null!==this._videoFrameRequestCallbackHandle&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Gr.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(null!==this._videoFrameRequestCallbackHandle&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Gr.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement}};Ji.extension=u.TextureSource,Ji.defaultOptions=((t,e)=>Wi(t,$i(e)))(Zi({},ye.defaultOptions),{autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1}),Ji.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let ts=Ji;const es=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){return this._cache.get(t)}set(t,e){const r=oi(t);let i;for(let t=0;t<this.parsers.length;t++){const s=this.parsers[t];if(s.test(e)){i=s.getCacheableAssets(r,e);break}}const s=new Map(Object.entries(i||{}));i||r.forEach((t=>{s.set(t,e)}));const n=[...s.keys()],o={cacheKeys:n,keys:r};r.forEach((t=>{this._cacheMap.set(t,o)})),n.forEach((t=>{i&&i[t];this._cache.has(t)&&this._cache.get(t),this._cache.set(t,s.get(t))}))}remove(t){if(!this._cacheMap.has(t))return;const e=this._cacheMap.get(t);e.cacheKeys.forEach((t=>{this._cache.delete(t)})),e.keys.forEach((t=>{this._cacheMap.delete(t)}))}get parsers(){return this._parsers}},rs=[];function is(t={}){const e=t&&t.resource,r=e?t.resource:t,i=e?t:{resource:t};for(let t=0;t<rs.length;t++){const e=rs[t];if(e.test(r))return new e(i)}throw new Error(`Could not find a source type for resource: ${i.resource}`)}function ss(t={},e=!1){const r=t&&t.resource,i=r?t.resource:t,s=r?t:{resource:t};if(!e&&es.has(i))return es.get(i);const n=new Ue({source:is(s)});return n.on("destroy",(()=>{es.has(i)&&es.remove(i)})),e||es.set(i,n),n}function ns(t,e=!1){return"string"==typeof t?es.get(t):t instanceof ye?new Ue({source:t}):ss(t,e)}p.handleByList(u.TextureSource,rs),Ue.from=ns,ye.from=is,p.add(Ni,Ui,Li,ts,Xi,zi,De);class os{constructor(t){this.resources=Object.create(null),this._dirty=!0;let e=0;for(const r in t){const i=t[r];this.setResource(i,e++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;const t=[];let e=0;for(const r in this.resources)t[e++]=this.resources[r]._resourceId;this._key=t.join("|")}setResource(t,e){var r,i;const s=this.resources[e];t!==s&&(s&&(null==(r=t.off)||r.call(t,"change",this.onResourceChange,this)),null==(i=t.on)||i.call(t,"change",this.onResourceChange,this),this.resources[e]=t,this._dirty=!0)}getResource(t){return this.resources[t]}_touch(t){const e=this.resources;for(const r in e)e[r]._touched=t}destroy(){var t;const e=this.resources;for(const r in e){const i=e[r];null==(t=i.off)||t.call(i,"change",this.onResourceChange,this)}this.resources=null}onResourceChange(t){if(this._dirty=!0,t.destroyed){const e=this.resources;for(const r in e)e[r]===t&&(e[r]=null)}else this._updateKey()}}let as;function ls(){return(!as||null!=as&&as.isContextLost())&&(as=ri.get().createCanvas().getContext("webgl",{})),as}const hs=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function us(t){let e="";for(let r=0;r<t;++r)r>0&&(e+="\nelse "),r<t-1&&(e+=`if(test == ${r}.0){}`);return e}function cs(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const r=e.createShader(e.FRAGMENT_SHADER);try{for(;;){const i=hs.replace(/%forloop%/gi,us(t));if(e.shaderSource(r,i),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS))break;t=t/2|0}}finally{e.deleteShader(r)}return t}let ds=null;function ps(){var t;if(ds)return ds;const e=ls();return ds=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),ds=cs(ds,e),null==(t=e.getExtension("WEBGL_lose_context"))||t.loseContext(),ds}const fs={};function gs(t,e){let r=2166136261;for(let i=0;i<e;i++)r^=t[i].uid,r=Math.imul(r,16777619),r>>>=0;return fs[r]||function(t,e,r){const i={};let s=0;ms||(ms=ps());for(let r=0;r<ms;r++){const n=r<e?t[r]:Ue.EMPTY.source;i[s++]=n.source,i[s++]=n.style}const n=new os(i);return fs[r]=n,n}(t,e,r)}let ms=0;class _s{constructor(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this.uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}function xs(t,e){const r=t.byteLength/8|0,i=new Float64Array(t,0,r);new Float64Array(e,0,r).set(i);const s=t.byteLength-8*r;if(s>0){const i=new Uint8Array(t,8*r,s);new Uint8Array(e,8*r,s).set(i)}}const ys={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var bs=(t=>(t[t.DISABLED=0]="DISABLED",t[t.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",t[t.MASK_ACTIVE=2]="MASK_ACTIVE",t[t.INVERSE_MASK_ACTIVE=3]="INVERSE_MASK_ACTIVE",t[t.RENDERING_MASK_REMOVE=4]="RENDERING_MASK_REMOVE",t[t.NONE=5]="NONE",t))(bs||{});function vs(t,e){return"no-premultiply-alpha"===e.alphaMode&&ys[t]||t}class Ts{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let t=0;t<this.count;t++){const e=this.textures[t];this.textures[t]=null,this.ids[e.uid]=null}this.count=0}}var Ss=Object.defineProperty,ws=Object.getOwnPropertySymbols,Es=Object.prototype.hasOwnProperty,As=Object.prototype.propertyIsEnumerable,Ps=(t,e,r)=>e in t?Ss(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ms=(t,e)=>{for(var r in e||(e={}))Es.call(e,r)&&Ps(t,r,e[r]);if(ws)for(var r of ws(e))As.call(e,r)&&Ps(t,r,e[r]);return t};class Rs{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new Ts,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}const Cs=[];let Os=0;function Is(){return Os>0?Cs[--Os]:new Rs}function Bs(t){Cs[Os++]=t}let ks=0;const Gs=class t{constructor(e={}){var r;this.uid=ht("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._elements=[],t.defaultOptions.maxTextures=null!=(r=t.defaultOptions.maxTextures)?r:ps(),e=Ms(Ms({},t.defaultOptions),e);const{maxTextures:i,attributesInitialSize:s,indicesInitialSize:n}=e;this.attributeBuffer=new _s(4*s),this.indexBuffer=new Uint16Array(n),this.maxTextures=i}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let t=0;t<this.batchIndex;t++)Bs(this.batches[t]);this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(t){this._elements[this.elementSize++]=t,t._indexStart=this.indexSize,t._attributeStart=this.attributeSize,t._batcher=this,this.indexSize+=t.indexSize,this.attributeSize+=t.attributeSize*this.vertexSize}checkAndUpdateTexture(t,e){const r=t._batch.textures.ids[e._source.uid];return!(!r&&0!==r)&&(t._textureId=r,t.texture=e,!0)}updateElement(t){this.dirty=!0;const e=this.attributeBuffer;t.packAsQuad?this.packQuadAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId):this.packAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId)}break(t){const e=this._elements;if(!e[this.elementStart])return;let r=Is(),i=r.textures;i.clear();const s=e[this.elementStart];let n=vs(s.blendMode,s.texture._source),o=s.topology;4*this.attributeSize>this.attributeBuffer.size&&this._resizeAttributeBuffer(4*this.attributeSize),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const a=this.attributeBuffer.float32View,l=this.attributeBuffer.uint32View,h=this.indexBuffer;let u=this._batchIndexSize,c=this._batchIndexStart,d="startBatch";const p=this.maxTextures;for(let s=this.elementStart;s<this.elementSize;++s){const f=e[s];e[s]=null;const g=f.texture._source,m=vs(f.blendMode,g),_=n!==m||o!==f.topology;g._batchTick!==ks||_?(g._batchTick=ks,(i.count>=p||_)&&(this._finishBatch(r,c,u-c,i,n,o,t,d),d="renderBatch",c=u,n=m,o=f.topology,r=Is(),i=r.textures,i.clear(),++ks),f._textureId=g._textureBindLocation=i.count,i.ids[g.uid]=i.count,i.textures[i.count++]=g,f._batch=r,u+=f.indexSize,f.packAsQuad?(this.packQuadAttributes(f,a,l,f._attributeStart,f._textureId),this.packQuadIndex(h,f._indexStart,f._attributeStart/this.vertexSize)):(this.packAttributes(f,a,l,f._attributeStart,f._textureId),this.packIndex(f,h,f._indexStart,f._attributeStart/this.vertexSize))):(f._textureId=g._textureBindLocation,u+=f.indexSize,f.packAsQuad?(this.packQuadAttributes(f,a,l,f._attributeStart,f._textureId),this.packQuadIndex(h,f._indexStart,f._attributeStart/this.vertexSize)):(this.packAttributes(f,a,l,f._attributeStart,f._textureId),this.packIndex(f,h,f._indexStart,f._attributeStart/this.vertexSize)),f._batch=r)}i.count>0&&(this._finishBatch(r,c,u-c,i,n,o,t,d),c=u,++ks),this.elementStart=this.elementSize,this._batchIndexStart=c,this._batchIndexSize=u}_finishBatch(t,e,r,i,s,n,o,a){t.gpuBindGroup=null,t.bindGroup=null,t.action=a,t.batcher=this,t.textures=i,t.blendMode=s,t.topology=n,t.start=e,t.size=r,++ks,this.batches[this.batchIndex++]=t,o.add(t)}finish(t){this.break(t)}ensureAttributeBuffer(t){4*t<=this.attributeBuffer.size||this._resizeAttributeBuffer(4*t)}ensureIndexBuffer(t){t<=this.indexBuffer.length||this._resizeIndexBuffer(t)}_resizeAttributeBuffer(t){const e=Math.max(t,2*this.attributeBuffer.size),r=new _s(e);xs(this.attributeBuffer.rawBinaryData,r.rawBinaryData),this.attributeBuffer=r}_resizeIndexBuffer(t){const e=this.indexBuffer;let r=Math.max(t,1.5*e.length);r+=r%2;const i=r>65535?new Uint32Array(r):new Uint16Array(r);if(i.BYTES_PER_ELEMENT!==e.BYTES_PER_ELEMENT)for(let t=0;t<e.length;t++)i[t]=e[t];else xs(e.buffer,i.buffer);this.indexBuffer=i}packQuadIndex(t,e,r){t[e]=r+0,t[e+1]=r+1,t[e+2]=r+2,t[e+3]=r+0,t[e+4]=r+2,t[e+5]=r+3}packIndex(t,e,r,i){const s=t.indices,n=t.indexSize,o=t.indexOffset,a=t.attributeOffset;for(let t=0;t<n;t++)e[r++]=i+s[t+o]-a}destroy(){for(let t=0;t<this.batches.length;t++)Bs(this.batches[t]);this.batches=null;for(let t=0;t<this._elements.length;t++)this._elements[t]._batch=null;this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}};Gs.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};let Ds=Gs;var Fs=(t=>(t[t.MAP_READ=1]="MAP_READ",t[t.MAP_WRITE=2]="MAP_WRITE",t[t.COPY_SRC=4]="COPY_SRC",t[t.COPY_DST=8]="COPY_DST",t[t.INDEX=16]="INDEX",t[t.VERTEX=32]="VERTEX",t[t.UNIFORM=64]="UNIFORM",t[t.STORAGE=128]="STORAGE",t[t.INDIRECT=256]="INDIRECT",t[t.QUERY_RESOLVE=512]="QUERY_RESOLVE",t[t.STATIC=1024]="STATIC",t))(Fs||{});class Ns extends m{constructor(t){let{data:e,size:r}=t;const{usage:i,label:s,shrinkToFit:n}=t;super(),this.uid=ht("buffer"),this._resourceType="buffer",this._resourceId=ht("resource"),this._touched=0,this._updateID=1,this._dataInt32=null,this.shrinkToFit=!0,this.destroyed=!1,e instanceof Array&&(e=new Float32Array(e)),this._data=e,null!=r||(r=null==e?void 0:e.byteLength);const o=!!e;this.descriptor={size:r,usage:i,mappedAtCreation:o,label:s},this.shrinkToFit=null==n||n}get data(){return this._data}set data(t){this.setDataWithSize(t,t.length,!0)}get dataInt32(){return this._dataInt32||(this._dataInt32=new Int32Array(this.data.buffer)),this._dataInt32}get static(){return!!(this.descriptor.usage&Fs.STATIC)}set static(t){t?this.descriptor.usage|=Fs.STATIC:this.descriptor.usage&=~Fs.STATIC}setDataWithSize(t,e,r){if(this._updateID++,this._updateSize=e*t.BYTES_PER_ELEMENT,this._data===t)return void(r&&this.emit("update",this));const i=this._data;this._data=t,this._dataInt32=null,i&&i.length===t.length||!this.shrinkToFit&&i&&t.byteLength<i.byteLength?r&&this.emit("update",this):(this.descriptor.size=t.byteLength,this._resourceId=ht("resource"),this.emit("change",this))}update(t){this._updateSize=null!=t?t:this._updateSize,this._updateID++,this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}}function Us(t,e){if(!(t instanceof Ns)){let r=e?Fs.INDEX:Fs.VERTEX;t instanceof Array&&(e?(t=new Uint32Array(t),r=Fs.INDEX|Fs.COPY_DST):(t=new Float32Array(t),r=Fs.VERTEX|Fs.COPY_DST)),t=new Ns({data:t,label:e?"index-mesh-buffer":"vertex-mesh-buffer",usage:r})}return t}function Ls(t,e,r){const i=t.getAttribute(e);if(!i)return r.minX=0,r.minY=0,r.maxX=0,r.maxY=0,r;const s=i.buffer.data;let n=1/0,o=1/0,a=-1/0,l=-1/0;const h=s.BYTES_PER_ELEMENT,u=(i.offset||0)/h,c=(i.stride||8)/h;for(let t=u;t<s.length;t+=c){const e=s[t],r=s[t+1];e>a&&(a=e),r>l&&(l=r),e<n&&(n=e),r<o&&(o=r)}return r.minX=n,r.minY=o,r.maxX=a,r.maxY=l,r}class zs extends m{constructor(t={}){var e;super(),this.uid=ht("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new Ot,this._boundsDirty=!0;const{attributes:r,indexBuffer:i,topology:s}=t;if(this.buffers=[],this.attributes={},r)for(const t in r)this.addAttribute(t,r[t]);this.instanceCount=null!=(e=t.instanceCount)?e:1,i&&this.addIndex(i),this.topology=s||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(t){return this.attributes[t]}getIndex(){return this.indexBuffer}getBuffer(t){return this.getAttribute(t).buffer}getSize(){for(const t in this.attributes){const e=this.attributes[t];return e.buffer.data.length/(e.stride/4||e.size)}return 0}addAttribute(t,e){const r=function(t){return(t instanceof Ns||Array.isArray(t)||t.BYTES_PER_ELEMENT)&&(t={buffer:t}),t.buffer=Us(t.buffer,!1),t}(e);-1===this.buffers.indexOf(r.buffer)&&(this.buffers.push(r.buffer),r.buffer.on("update",this.onBufferUpdate,this),r.buffer.on("change",this.onBufferUpdate,this)),this.attributes[t]=r}addIndex(t){this.indexBuffer=Us(t,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,Ls(this,"aPosition",this._bounds)):this._bounds}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners(),t&&this.buffers.forEach((t=>t.destroy())),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}const Xs=new Float32Array(1),Hs=new Uint32Array(1);class js extends zs{constructor(){const t=new Ns({data:Xs,label:"attribute-batch-buffer",usage:Fs.VERTEX|Fs.COPY_DST,shrinkToFit:!1});super({attributes:{aPosition:{buffer:t,format:"float32x2",stride:24,offset:0},aUV:{buffer:t,format:"float32x2",stride:24,offset:8},aColor:{buffer:t,format:"unorm8x4",stride:24,offset:16},aTextureIdAndRound:{buffer:t,format:"uint16x2",stride:24,offset:20}},indexBuffer:new Ns({data:Hs,label:"index-batch-buffer",usage:Fs.INDEX|Fs.COPY_DST,shrinkToFit:!1})})}}const Vs=Object.create(null),Ws=Object.create(null);function $s(t,e){let r=Ws[t];return void 0===r&&(void 0===Vs[e]&&(Vs[e]=1),Ws[t]=r=Vs[e]++),r}let Ys;function qs(){if(!Ys){Ys="mediump";const t=ls();t&&t.getShaderPrecisionFormat&&(Ys=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision?"highp":"mediump")}return Ys}function Ks(t,e,r){return e?t:r?`\n        \n        #ifdef GL_ES // This checks if it is WebGL1\n        #define in varying\n        #define finalColor gl_FragColor\n        #define texture texture2D\n        #endif\n        ${t=t.replace("out vec4 finalColor;","")}\n        `:`\n        \n        #ifdef GL_ES // This checks if it is WebGL1\n        #define in attribute\n        #define out varying\n        #endif\n        ${t}\n        `}function Qs(t,e,r){const i=r?e.maxSupportedFragmentPrecision:e.maxSupportedVertexPrecision;if("precision"!==t.substring(0,9)){let s=r?e.requestedFragmentPrecision:e.requestedVertexPrecision;return"highp"===s&&"highp"!==i&&(s="mediump"),`precision ${s} float;\n${t}`}return"highp"!==i&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}function Zs(t,e){return e?`#version 300 es\n${t}`:t}const Js={},tn={};function en(t,{name:e="pixi-program"},r=!0){e=e.replace(/\s+/g,"-");const i=r?Js:tn;return i[e+=r?"-fragment":"-vertex"]?(i[e]++,e+=`-${i[e]}`):i[e]=1,-1!==t.indexOf("#define SHADER_NAME")?t:`#define SHADER_NAME ${e}\n${t}`}function rn(t,e){return e?t.replace("#version 300 es",""):t}var sn=Object.defineProperty,nn=Object.getOwnPropertySymbols,on=Object.prototype.hasOwnProperty,an=Object.prototype.propertyIsEnumerable,ln=(t,e,r)=>e in t?sn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,hn=(t,e)=>{for(var r in e||(e={}))on.call(e,r)&&ln(t,r,e[r]);if(nn)for(var r of nn(e))an.call(e,r)&&ln(t,r,e[r]);return t};const un={stripVersion:rn,ensurePrecision:Qs,addProgramDefines:Ks,setProgramName:en,insertVersion:Zs},cn=Object.create(null),dn=class t{constructor(e){const r=-1!==(e=hn(hn({},t.defaultOptions),e)).fragment.indexOf("#version 300 es"),i={stripVersion:r,ensurePrecision:{requestedFragmentPrecision:e.preferredFragmentPrecision,requestedVertexPrecision:e.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:qs()},setProgramName:{name:e.name},addProgramDefines:r,insertVersion:r};let s=e.fragment,n=e.vertex;Object.keys(un).forEach((t=>{const e=i[t];s=un[t](s,e,!0),n=un[t](n,e,!1)})),this.fragment=s,this.vertex=n,this.transformFeedbackVaryings=e.transformFeedbackVaryings,this._key=$s(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null}static from(e){const r=`${e.vertex}:${e.fragment}`;return cn[r]||(cn[r]=new t(e)),cn[r]}};dn.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let pn=dn;const fn={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function gn(t){var e;return null!=(e=fn[t])?e:fn.float32}const mn={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"};function _n({source:t,entryPoint:e}){var r;const i={},s=t.indexOf(`fn ${e}`);if(-1!==s){const e=t.indexOf("->",s);if(-1!==e){const n=t.substring(s,e),o=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g;let a;for(;null!==(a=o.exec(n));){const t=null!=(r=mn[a[3]])?r:"float32";i[a[2]]={location:parseInt(a[1],10),format:t,stride:gn(t).stride,offset:0,instance:!1,start:0}}}}return i}function xn(t){var e,r,i;const s=/@group\((\d+)\)/,n=/@binding\((\d+)\)/,o=/var(<[^>]+>)? (\w+)/,a=/:\s*(\w+)/,l=/(\w+)\s*:\s*([\w\<\>]+)/g,h=/struct\s+(\w+)/,u=null==(e=t.match(/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g))?void 0:e.map((t=>({group:parseInt(t.match(s)[1],10),binding:parseInt(t.match(n)[1],10),name:t.match(o)[2],isUniform:"<uniform>"===t.match(o)[1],type:t.match(a)[1]})));if(!u)return{groups:[],structs:[]};const c=null!=(i=null==(r=t.match(/struct\s+(\w+)\s*{([^}]+)}/g))?void 0:r.map((t=>{const e=t.match(h)[1],r=t.match(l).reduce(((t,e)=>{const[r,i]=e.split(":");return t[r.trim()]=i.trim(),t}),{});return r?{name:e,members:r}:null})).filter((({name:t})=>u.some((e=>e.type===t)))))?i:[];return{groups:u,structs:c}}var yn=(t=>(t[t.VERTEX=1]="VERTEX",t[t.FRAGMENT=2]="FRAGMENT",t[t.COMPUTE=4]="COMPUTE",t))(yn||{});function bn({groups:t}){const e=[];for(let r=0;r<t.length;r++){const i=t[r];e[i.group]||(e[i.group]=[]),i.isUniform?e[i.group].push({binding:i.binding,visibility:yn.VERTEX|yn.FRAGMENT,buffer:{type:"uniform"}}):"sampler"===i.type?e[i.group].push({binding:i.binding,visibility:yn.FRAGMENT,sampler:{type:"filtering"}}):"texture_2d"===i.type&&e[i.group].push({binding:i.binding,visibility:yn.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return e}function vn({groups:t}){const e=[];for(let r=0;r<t.length;r++){const i=t[r];e[i.group]||(e[i.group]={}),e[i.group][i.name]=i.binding}return e}function Tn(t,e){const r=new Set,i=new Set;return{structs:[...t.structs,...e.structs].filter((t=>!r.has(t.name)&&(r.add(t.name),!0))),groups:[...t.groups,...e.groups].filter((t=>{const e=`${t.name}-${t.binding}`;return!i.has(e)&&(i.add(e),!0)}))}}const Sn=Object.create(null);class wn{constructor(t){var e,r;this._layoutKey=0,this._attributeLocationsKey=0;const{fragment:i,vertex:s,layout:n,gpuLayout:o,name:a}=t;if(this.name=a,this.fragment=i,this.vertex=s,i.source===s.source){const t=xn(i.source);this.structsAndGroups=t}else{const t=xn(s.source),e=xn(i.source);this.structsAndGroups=Tn(t,e)}this.layout=null!=n?n:vn(this.structsAndGroups),this.gpuLayout=null!=o?o:bn(this.structsAndGroups),this.autoAssignGlobalUniforms=void 0!==(null==(e=this.layout[0])?void 0:e.globalUniforms),this.autoAssignLocalUniforms=void 0!==(null==(r=this.layout[1])?void 0:r.localUniforms),this._generateProgramKey()}_generateProgramKey(){const{vertex:t,fragment:e}=this,r=t.source+e.source+t.entryPoint+e.entryPoint;this._layoutKey=$s(r,"program")}get attributeData(){return null!=this._attributeData||(this._attributeData=_n(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null}static from(t){const e=`${t.vertex.source}:${t.fragment.source}:${t.fragment.entryPoint}:${t.vertex.entryPoint}`;return Sn[e]||(Sn[e]=new wn(t)),Sn[e]}}function En(t,e,r){if(t)for(const i in t){const s=e[i.toLocaleLowerCase()];if(s){let e=t[i];"header"===i&&(e=e.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),r&&s.push(`//----${r}----//`),s.push(e)}}}const An=/\{\{(.*?)\}\}/g;function Pn(t){var e,r;const i={};return(null!=(r=null==(e=t.match(An))?void 0:e.map((t=>t.replace(/[{()}]/g,""))))?r:[]).forEach((t=>{i[t]=[]})),i}function Mn(t,e){let r;const i=/@in\s+([^;]+);/g;for(;null!==(r=i.exec(t));)e.push(r[1])}function Rn(t,e,r=!1){const i=[];Mn(e,i),t.forEach((t=>{t.header&&Mn(t.header,i)}));const s=i;r&&s.sort();const n=s.map(((t,e)=>`       @location(${e}) ${t},`)).join("\n");let o=e.replace(/@in\s+[^;]+;\s*/g,"");return o=o.replace("{{in}}",`\n${n}\n`),o}function Cn(t,e){let r;const i=/@out\s+([^;]+);/g;for(;null!==(r=i.exec(t));)e.push(r[1])}function On(t,e){const r=[];Cn(e,r),t.forEach((t=>{t.header&&Cn(t.header,r)}));let i=0;const s=r.sort().map((t=>t.indexOf("builtin")>-1?t:`@location(${i++}) ${t}`)).join(",\n"),n=r.sort().map((t=>`       var ${function(t){return t.replace(/@.*?\s+/g,"")}(t)};`)).join("\n"),o=`return VSOutput(\n            ${r.sort().map((t=>` ${function(t){const e=/\b(\w+)\s*:/g.exec(t);return e?e[1]:""}(t)}`)).join(",\n")});`;let a=e.replace(/@out\s+[^;]+;\s*/g,"");return a=a.replace("{{struct}}",`\n${s}\n`),a=a.replace("{{start}}",`\n${n}\n`),a=a.replace("{{return}}",`\n${o}\n`),a}function In(t,e){let r=t;for(const t in e){const i=e[t];r=i.join("\n").length?r.replace(`{{${t}}}`,`//-----${t} START-----//\n${i.join("\n")}\n//----${t} FINISH----//`):r.replace(`{{${t}}}`,"")}return r}const Bn=Object.create(null),kn=new Map;let Gn=0;function Dn({template:t,bits:e}){const r=Nn(t,e);if(Bn[r])return Bn[r];const{vertex:i,fragment:s}=function(t,e){const r=e.map((t=>t.vertex)).filter((t=>!!t)),i=e.map((t=>t.fragment)).filter((t=>!!t));let s=Rn(r,t.vertex,!0);s=On(r,s);const n=Rn(i,t.fragment,!0);return{vertex:s,fragment:n}}(t,e);return Bn[r]=Un(i,s,e),Bn[r]}function Fn({template:t,bits:e}){const r=Nn(t,e);return Bn[r]||(Bn[r]=Un(t.vertex,t.fragment,e)),Bn[r]}function Nn(t,e){return e.map((t=>(kn.has(t)||kn.set(t,Gn++),kn.get(t)))).sort(((t,e)=>t-e)).join("-")+t.vertex+t.fragment}function Un(t,e,r){const i=Pn(t),s=Pn(e);return r.forEach((t=>{En(t.vertex,i,t.name),En(t.fragment,s,t.name)})),{vertex:In(t,i),fragment:In(e,s)}}const Ln="\n    @in aPosition: vec2<f32>;\n    @in aUV: vec2<f32>;\n\n    @out @builtin(position) vPosition: vec4<f32>;\n    @out vUV : vec2<f32>;\n    @out vColor : vec4<f32>;\n\n    {{header}}\n\n    struct VSOutput {\n        {{struct}}\n    };\n\n    @vertex\n    fn main( {{in}} ) -> VSOutput {\n\n        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;\n        var modelMatrix = mat3x3<f32>(\n            1.0, 0.0, 0.0,\n            0.0, 1.0, 0.0,\n            0.0, 0.0, 1.0\n          );\n        var position = aPosition;\n        var uv = aUV;\n\n        {{start}}\n        \n        vColor = vec4<f32>(1., 1., 1., 1.);\n\n        {{main}}\n\n        vUV = uv;\n\n        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;\n\n        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);\n       \n        vColor *= globalUniforms.uWorldColorAlpha;\n\n        {{end}}\n\n        {{return}}\n    };\n",zn="\n    @in vUV : vec2<f32>;\n    @in vColor : vec4<f32>;\n   \n    {{header}}\n\n    @fragment\n    fn main(\n        {{in}}\n      ) -> @location(0) vec4<f32> {\n        \n        {{start}}\n\n        var outColor:vec4<f32>;\n      \n        {{main}}\n        \n        var finalColor:vec4<f32> = outColor * vColor;\n\n        {{end}}\n\n        return finalColor;\n      };\n",Xn="\n    in vec2 aPosition;\n    in vec2 aUV;\n\n    out vec4 vColor;\n    out vec2 vUV;\n\n    {{header}}\n\n    void main(void){\n\n        mat3 worldTransformMatrix = uWorldTransformMatrix;\n        mat3 modelMatrix = mat3(\n            1.0, 0.0, 0.0,\n            0.0, 1.0, 0.0,\n            0.0, 0.0, 1.0\n          );\n        vec2 position = aPosition;\n        vec2 uv = aUV;\n        \n        {{start}}\n        \n        vColor = vec4(1.);\n        \n        {{main}}\n        \n        vUV = uv;\n        \n        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;\n\n        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n\n        vColor *= uWorldColorAlpha;\n\n        {{end}}\n    }\n",Hn="\n   \n    in vec4 vColor;\n    in vec2 vUV;\n\n    out vec4 finalColor;\n\n    {{header}}\n\n    void main(void) {\n        \n        {{start}}\n\n        vec4 outColor;\n      \n        {{main}}\n        \n        finalColor = outColor * vColor;\n        \n        {{end}}\n    }\n",jn={name:"global-uniforms-bit",vertex:{header:"\n        struct GlobalUniforms {\n            uProjectionMatrix:mat3x3<f32>,\n            uWorldTransformMatrix:mat3x3<f32>,\n            uWorldColorAlpha: vec4<f32>,\n            uResolution: vec2<f32>,\n        }\n\n        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;\n        "}},Vn={name:"global-uniforms-ubo-bit",vertex:{header:"\n          uniform globalUniforms {\n            mat3 uProjectionMatrix;\n            mat3 uWorldTransformMatrix;\n            vec4 uWorldColorAlpha;\n            vec2 uResolution;\n          };\n        "}},Wn={name:"global-uniforms-bit",vertex:{header:"\n          uniform mat3 uProjectionMatrix;\n          uniform mat3 uWorldTransformMatrix;\n          uniform vec4 uWorldColorAlpha;\n          uniform vec2 uResolution;\n        "}};var $n=Object.defineProperty,Yn=Object.getOwnPropertySymbols,qn=Object.prototype.hasOwnProperty,Kn=Object.prototype.propertyIsEnumerable,Qn=(t,e,r)=>e in t?$n(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;function Zn({bits:t,name:e}){const r=Dn({template:{fragment:zn,vertex:Ln},bits:[jn,...t]});return wn.from({name:e,vertex:{source:r.vertex,entryPoint:"main"},fragment:{source:r.fragment,entryPoint:"main"}})}function Jn({bits:t,name:e}){return new pn(((t,e)=>{for(var r in e||(e={}))qn.call(e,r)&&Qn(t,r,e[r]);if(Yn)for(var r of Yn(e))Kn.call(e,r)&&Qn(t,r,e[r]);return t})({name:e},Fn({template:{vertex:Xn,fragment:Hn},bits:[Wn,...t]})))}const to={name:"color-bit",vertex:{header:"\n            @in aColor: vec4<f32>;\n        ",main:"\n            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);\n        "}},eo={name:"color-bit",vertex:{header:"\n            in vec4 aColor;\n        ",main:"\n            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);\n        "}},ro={};function io(t){const e=[];if(1===t)e.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),e.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let r=0;for(let i=0;i<t;i++)e.push(`@group(1) @binding(${r++}) var textureSource${i+1}: texture_2d<f32>;`),e.push(`@group(1) @binding(${r++}) var textureSampler${i+1}: sampler;`)}return e.join("\n")}function so(t){const e=[];if(1===t)e.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{e.push("switch vTextureId {");for(let r=0;r<t;r++)r===t-1?e.push("  default:{"):e.push(`  case ${r}:{`),e.push(`      outColor = textureSampleGrad(textureSource${r+1}, textureSampler${r+1}, vUV, uvDx, uvDy);`),e.push("      break;}");e.push("}")}return e.join("\n")}function no(t){return ro[t]||(ro[t]={name:"texture-batch-bit",vertex:{header:"\n                @in aTextureIdAndRound: vec2<u32>;\n                @out @interpolate(flat) vTextureId : u32;\n            ",main:"\n                vTextureId = aTextureIdAndRound.y;\n            ",end:"\n                if(aTextureIdAndRound.x == 1)\n                {\n                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n                }\n            "},fragment:{header:`\n                @in @interpolate(flat) vTextureId: u32;\n\n                ${io(t)}\n            `,main:`\n                var uvDx = dpdx(vUV);\n                var uvDy = dpdy(vUV);\n\n                ${so(t)}\n            `}}),ro[t]}const oo={};function ao(t){const e=[];for(let r=0;r<t;r++)r>0&&e.push("else"),r<t-1&&e.push(`if(vTextureId < ${r}.5)`),e.push("{"),e.push(`\toutColor = texture(uTextures[${r}], vUV);`),e.push("}");return e.join("\n")}function lo(t){return oo[t]||(oo[t]={name:"texture-batch-bit",vertex:{header:"\n                in vec2 aTextureIdAndRound;\n                out float vTextureId;\n\n            ",main:"\n                vTextureId = aTextureIdAndRound.y;\n            ",end:"\n                if(aTextureIdAndRound.x == 1.)\n                {\n                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n                }\n            "},fragment:{header:`\n                in float vTextureId;\n\n                uniform sampler2D uTextures[${t}];\n\n            `,main:`\n\n                ${ao(t)}\n            `}}),oo[t]}const ho={name:"round-pixels-bit",vertex:{header:"\n            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32> \n            {\n                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n            }\n        "}},uo={name:"round-pixels-bit",vertex:{header:"   \n            vec2 roundPixels(vec2 position, vec2 targetSize)\n            {       \n                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n            }\n        "}},co=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],po=co.reduce(((t,e)=>(t[e]=!0,t)),{});function fo(t,e){switch(t){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*e);case"vec3<f32>":return new Float32Array(3*e);case"vec4<f32>":return new Float32Array(4*e);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var go=Object.defineProperty,mo=Object.getOwnPropertySymbols,_o=Object.prototype.hasOwnProperty,xo=Object.prototype.propertyIsEnumerable,yo=(t,e,r)=>e in t?go(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,bo=(t,e)=>{for(var r in e||(e={}))_o.call(e,r)&&yo(t,r,e[r]);if(mo)for(var r of mo(e))xo.call(e,r)&&yo(t,r,e[r]);return t};const vo=class t{constructor(e,r){var i;this._touched=0,this.uid=ht("uniform"),this._resourceType="uniformGroup",this._resourceId=ht("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,r=bo(bo({},t.defaultOptions),r),this.uniformStructures=e;const s={};for(const t in e){const r=e[t];if(r.name=t,r.size=null!=(i=r.size)?i:1,!po[r.type])throw new Error(`Uniform type ${r.type} is not supported. Supported uniform types are: ${co.join(", ")}`);null!=r.value||(r.value=fo(r.type,r.size)),s[t]=r.value}this.uniforms=s,this._dirtyId=1,this.ubo=r.ubo,this.isStatic=r.isStatic,this._signature=$s(Object.keys(s).map((t=>`${t}-${e[t].type}`)).join("-"),"uniform-group")}update(){this._dirtyId++}};vo.defaultOptions={ubo:!1,isStatic:!1};let To=vo;const So={};function wo(t){let e=So[t];if(e)return e;const r=new Int32Array(t);for(let e=0;e<t;e++)r[e]=e;return e=So[t]=new To({uTextures:{value:r,type:"i32",size:t}},{isStatic:!0}),e}var Eo=(t=>(t[t.WEBGL=1]="WEBGL",t[t.WEBGPU=2]="WEBGPU",t[t.BOTH=3]="BOTH",t))(Eo||{}),Ao=Object.defineProperty,Po=Object.getOwnPropertySymbols,Mo=Object.prototype.hasOwnProperty,Ro=Object.prototype.propertyIsEnumerable,Co=(t,e,r)=>e in t?Ao(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;class Oo extends m{constructor(t){super(),this.uid=ht("shader"),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[];let{gpuProgram:e,glProgram:r,groups:i,resources:s,compatibleRenderers:n,groupMap:o}=t;this.gpuProgram=e,this.glProgram=r,void 0===n&&(n=0,e&&(n|=Eo.WEBGPU),r&&(n|=Eo.WEBGL)),this.compatibleRenderers=n;const a={};if(!s&&!i&&(s={}),s&&i)throw new Error("[Shader] Cannot have both resources and groups");if(!e&&i&&!o)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!e&&i&&o)for(const t in o)for(const e in o[t]){const r=o[t][e];a[r]={group:t,binding:e,name:r}}else if(e&&i&&!o){const t=e.structsAndGroups.groups;o={},t.forEach((t=>{o[t.group]=o[t.group]||{},o[t.group][t.binding]=t.name,a[t.name]=t}))}else if(s){i={},o={},e&&e.structsAndGroups.groups.forEach((t=>{o[t.group]=o[t.group]||{},o[t.group][t.binding]=t.name,a[t.name]=t}));let t=0;for(const e in s)a[e]||(i[99]||(i[99]=new os,this._ownedBindGroups.push(i[99])),a[e]={group:99,binding:t,name:e},o[99]=o[99]||{},o[99][t]=e,t++);for(const t in s){const e=t;let r=s[t];!r.source&&!r._resourceType&&(r=new To(r));const n=a[e];n&&(i[n.group]||(i[n.group]=new os,this._ownedBindGroups.push(i[n.group])),i[n.group].setResource(r,n.binding))}}this.groups=i,this._uniformBindMap=o,this.resources=this._buildResourceAccessor(i,a)}addResource(t,e,r){var i,s;(i=this._uniformBindMap)[e]||(i[e]={}),(s=this._uniformBindMap[e])[r]||(s[r]=t),this.groups[e]||(this.groups[e]=new os,this._ownedBindGroups.push(this.groups[e]))}_buildResourceAccessor(t,e){const r={};for(const i in e){const s=e[i];Object.defineProperty(r,s.name,{get:()=>t[s.group].getResource(s.binding),set(e){t[s.group].setResource(e,s.binding)}})}return r}destroy(t=!1){var e,r;this.emit("destroy",this),t&&(null==(e=this.gpuProgram)||e.destroy(),null==(r=this.glProgram)||r.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach((t=>{t.destroy()})),this._ownedBindGroups=null,this.resources=null,this.groups=null}static from(t){const e=t,{gpu:r,gl:i}=e,s=((t,e)=>{var r={};for(var i in t)Mo.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&Po)for(var i of Po(t))e.indexOf(i)<0&&Ro.call(t,i)&&(r[i]=t[i]);return r})(e,["gpu","gl"]);let n,o;return r&&(n=wn.from(r)),i&&(o=pn.from(i)),new Oo(((t,e)=>{for(var r in e||(e={}))Mo.call(e,r)&&Co(t,r,e[r]);if(Po)for(var r of Po(e))Ro.call(e,r)&&Co(t,r,e[r]);return t})({gpuProgram:n,glProgram:o},s))}}class Io extends Oo{constructor(t){super({glProgram:Jn({name:"batch",bits:[eo,lo(t),uo]}),gpuProgram:Zn({name:"batch",bits:[to,no(t),ho]}),resources:{batchSamplers:wo(t)}})}}let Bo=null;const ko=class t extends Ds{constructor(){super(...arguments),this.geometry=new js,this.shader=Bo||(Bo=new Io(this.maxTextures)),this.name=t.extension.name,this.vertexSize=6}packAttributes(t,e,r,i,s){const n=s<<16|65535&t.roundPixels,o=t.transform,a=o.a,l=o.b,h=o.c,u=o.d,c=o.tx,d=o.ty,{positions:p,uvs:f}=t,g=t.color,m=t.attributeOffset,_=m+t.attributeSize;for(let t=m;t<_;t++){const s=2*t,o=p[s],m=p[s+1];e[i++]=a*o+h*m+c,e[i++]=u*m+l*o+d,e[i++]=f[s],e[i++]=f[s+1],r[i++]=g,r[i++]=n}}packQuadAttributes(t,e,r,i,s){const n=t.texture,o=t.transform,a=o.a,l=o.b,h=o.c,u=o.d,c=o.tx,d=o.ty,p=t.bounds,f=p.maxX,g=p.minX,m=p.maxY,_=p.minY,x=n.uvs,y=t.color,b=s<<16|65535&t.roundPixels;e[i+0]=a*g+h*_+c,e[i+1]=u*_+l*g+d,e[i+2]=x.x0,e[i+3]=x.y0,r[i+4]=y,r[i+5]=b,e[i+6]=a*f+h*_+c,e[i+7]=u*_+l*f+d,e[i+8]=x.x1,e[i+9]=x.y1,r[i+10]=y,r[i+11]=b,e[i+12]=a*f+h*m+c,e[i+13]=u*m+l*f+d,e[i+14]=x.x2,e[i+15]=x.y2,r[i+16]=y,r[i+17]=b,e[i+18]=a*g+h*m+c,e[i+19]=u*m+l*g+d,e[i+20]=x.x3,e[i+21]=x.y3,r[i+22]=y,r[i+23]=b}};ko.extension={type:[u.Batcher],name:"default"};let Go=ko;function Do(t,e,r,i,s,n,o,a=null){let l=0;r*=e,s*=n;const h=a.a,u=a.b,c=a.c,d=a.d,p=a.tx,f=a.ty;for(;l<o;){const o=t[r],a=t[r+1];i[s]=h*o+c*a+p,i[s+1]=u*o+d*a+f,s+=n,r+=e,l++}}function Fo(t,e,r,i){let s=0;for(e*=r;s<i;)t[e]=0,t[e+1]=0,e+=r,s++}function No(t,e,r,i,s){const n=e.a,o=e.b,a=e.c,l=e.d,h=e.tx,u=e.ty;r||(r=0),i||(i=2),s||(s=t.length/i-r);let c=r*i;for(let e=0;e<s;e++){const e=t[c],r=t[c+1];t[c]=n*e+a*r+h,t[c+1]=o*e+l*r+u,c+=i}}const Uo=new st;class Lo{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const t=this.baseColor,e=t>>16|65280&t|(255&t)<<16,r=this.renderable;return r?Ut(e,r.groupColor)+(this.alpha*r.groupAlpha*255<<24):e+(255*this.alpha<<24)}get transform(){var t;return(null==(t=this.renderable)?void 0:t.groupTransform)||Uo}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.attributeOffset=this.attributeOffset,t.attributeSize=this.attributeSize,t.baseColor=this.baseColor,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData,t.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}}var zo=Object.defineProperty,Xo=Object.defineProperties,Ho=Object.getOwnPropertyDescriptors,jo=Object.getOwnPropertySymbols,Vo=Object.prototype.hasOwnProperty,Wo=Object.prototype.propertyIsEnumerable,$o=(t,e,r)=>e in t?zo(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Yo=(t,e)=>{for(var r in e||(e={}))Vo.call(e,r)&&$o(t,r,e[r]);if(jo)for(var r of jo(e))Wo.call(e,r)&&$o(t,r,e[r]);return t},qo=(t,e)=>Xo(t,Ho(e));const Ko={extension:{type:u.ShapeBuilder,name:"circle"},build(t,e){let r,i,s,n,o,a;if("circle"===t.type){const e=t;r=e.x,i=e.y,o=a=e.radius,s=n=0}else if("ellipse"===t.type){const e=t;r=e.x,i=e.y,o=e.halfWidth,a=e.halfHeight,s=n=0}else{const e=t,l=e.width/2,h=e.height/2;r=e.x+l,i=e.y+h,o=a=Math.max(0,Math.min(e.radius,Math.min(l,h))),s=l-o,n=h-a}if(!(o>=0&&a>=0&&s>=0&&n>=0))return e;const l=Math.ceil(2.3*Math.sqrt(o+a)),h=8*l+(s?4:0)+(n?4:0);if(0===h)return e;if(0===l)return e[0]=e[6]=r+s,e[1]=e[3]=i+n,e[2]=e[4]=r-s,e[5]=e[7]=i-n,e;let u=0,c=4*l+(s?2:0)+2,d=c,p=h,f=s+o,g=n,m=r+f,_=r-f,x=i+g;if(e[u++]=m,e[u++]=x,e[--c]=x,e[--c]=_,n){const t=i-g;e[d++]=_,e[d++]=t,e[--p]=t,e[--p]=m}for(let t=1;t<l;t++){const h=Math.PI/2*(t/l),f=s+Math.cos(h)*o,g=n+Math.sin(h)*a,m=r+f,_=r-f,x=i+g,y=i-g;e[u++]=m,e[u++]=x,e[--c]=x,e[--c]=_,e[d++]=_,e[d++]=y,e[--p]=y,e[--p]=m}f=s,g=n+a,m=r+f,_=r-f,x=i+g;const y=i-g;return e[u++]=m,e[u++]=x,e[--p]=y,e[--p]=m,s&&(e[u++]=_,e[u++]=x,e[--p]=y,e[--p]=_),e},triangulate(t,e,r,i,s,n){if(0===t.length)return;let o=0,a=0;for(let e=0;e<t.length;e+=2)o+=t[e],a+=t[e+1];o/=t.length/2,a/=t.length/2;let l=i;e[l*r]=o,e[l*r+1]=a;const h=l++;for(let i=0;i<t.length;i+=2)e[l*r]=t[i],e[l*r+1]=t[i+1],i>0&&(s[n++]=l,s[n++]=h,s[n++]=l-1),l++;s[n++]=h+1,s[n++]=h,s[n++]=l-1}},Qo=qo(Yo({},Ko),{extension:qo(Yo({},Ko.extension),{name:"ellipse"})}),Zo=qo(Yo({},Ko),{extension:qo(Yo({},Ko.extension),{name:"roundedRectangle"})}),Jo=1e-4,ta=1e-4;function ea(t){const e=t.length;if(e<6)return 1;let r=0;for(let i=0,s=t[e-2],n=t[e-1];i<e;i+=2){const e=t[i],o=t[i+1];r+=(e-s)*(o+n),s=e,n=o}return r<0?-1:1}function ra(t,e,r,i,s,n,o,a){let l,h;o?(l=i,h=-r):(l=-i,h=r);const u=t-r*s+l,c=e-i*s+h,d=t+r*n+l,p=e+i*n+h;return a.push(u,c),a.push(d,p),2}function ia(t,e,r,i,s,n,o,a){const l=r-t,h=i-e;let u=Math.atan2(l,h),c=Math.atan2(s-t,n-e);a&&u<c?u+=2*Math.PI:!a&&u>c&&(c+=2*Math.PI);let d=u;const p=c-u,f=Math.abs(p),g=Math.sqrt(l*l+h*h),m=1+(15*f*Math.sqrt(g)/Math.PI>>0),_=p/m;if(d+=_,a){o.push(t,e),o.push(r,i);for(let r=1,i=d;r<m;r++,i+=_)o.push(t,e),o.push(t+Math.sin(i)*g,e+Math.cos(i)*g);o.push(t,e),o.push(s,n)}else{o.push(r,i),o.push(t,e);for(let r=1,i=d;r<m;r++,i+=_)o.push(t+Math.sin(i)*g,e+Math.cos(i)*g),o.push(t,e);o.push(s,n),o.push(t,e)}return 2*m}function sa(t,e,r,i,s,n){const o=Jo;if(0===t.length)return;const a=e;let l=a.alignment;if(.5!==e.alignment){let e=ea(t);r&&(e*=-1),l=(l-.5)*e+.5}const h=new rt(t[0],t[1]),u=new rt(t[t.length-2],t[t.length-1]),c=i,d=Math.abs(h.x-u.x)<o&&Math.abs(h.y-u.y)<o;if(c){t=t.slice(),d&&(t.pop(),t.pop(),u.set(t[t.length-2],t[t.length-1]));const e=.5*(h.x+u.x),r=.5*(u.y+h.y);t.unshift(e,r),t.push(e,r)}const p=s,f=t.length/2;let g=t.length;const m=p.length/2,_=a.width/2,x=_*_,y=a.miterLimit*a.miterLimit;let b=t[0],v=t[1],T=t[2],S=t[3],w=0,E=0,A=-(v-S),P=b-T,M=0,R=0,C=Math.sqrt(A*A+P*P);A/=C,P/=C,A*=_,P*=_;const O=2*(1-l),I=2*l;c||("round"===a.cap?g+=ia(b-A*(O-I)*.5,v-P*(O-I)*.5,b-A*O,v-P*O,b+A*I,v+P*I,p,!0)+2:"square"===a.cap&&(g+=ra(b,v,A,P,O,I,!0,p))),p.push(b-A*O,v-P*O),p.push(b+A*I,v+P*I);for(let e=1;e<f-1;++e){b=t[2*(e-1)],v=t[2*(e-1)+1],T=t[2*e],S=t[2*e+1],w=t[2*(e+1)],E=t[2*(e+1)+1],A=-(v-S),P=b-T,C=Math.sqrt(A*A+P*P),A/=C,P/=C,A*=_,P*=_,M=-(S-E),R=T-w,C=Math.sqrt(M*M+R*R),M/=C,R/=C,M*=_,R*=_;const r=T-b,i=v-S,s=T-w,n=E-S,o=r*s+i*n,l=i*s-n*r,h=l<0;if(Math.abs(l)<.001*Math.abs(o)){p.push(T-A*O,S-P*O),p.push(T+A*I,S+P*I),o>=0&&("round"===a.join?g+=ia(T,S,T-A*O,S-P*O,T-M*O,S-R*O,p,!1)+4:g+=2,p.push(T-M*I,S-R*I),p.push(T+M*O,S+R*O));continue}const u=(-A+b)*(-P+S)-(-A+T)*(-P+v),c=(-M+w)*(-R+S)-(-M+T)*(-R+E),d=(r*c-s*u)/l,f=(n*u-i*c)/l,m=(d-T)*(d-T)+(f-S)*(f-S),B=T+(d-T)*O,k=S+(f-S)*O,G=T-(d-T)*I,D=S-(f-S)*I,F=h?O:I;m<=Math.min(r*r+i*i,s*s+n*n)+F*F*x?"bevel"===a.join||m/x>y?(h?(p.push(B,k),p.push(T+A*I,S+P*I),p.push(B,k),p.push(T+M*I,S+R*I)):(p.push(T-A*O,S-P*O),p.push(G,D),p.push(T-M*O,S-R*O),p.push(G,D)),g+=2):"round"===a.join?h?(p.push(B,k),p.push(T+A*I,S+P*I),g+=ia(T,S,T+A*I,S+P*I,T+M*I,S+R*I,p,!0)+4,p.push(B,k),p.push(T+M*I,S+R*I)):(p.push(T-A*O,S-P*O),p.push(G,D),g+=ia(T,S,T-A*O,S-P*O,T-M*O,S-R*O,p,!1)+4,p.push(T-M*O,S-R*O),p.push(G,D)):(p.push(B,k),p.push(G,D)):(p.push(T-A*O,S-P*O),p.push(T+A*I,S+P*I),"round"===a.join?g+=h?ia(T,S,T+A*I,S+P*I,T+M*I,S+R*I,p,!0)+2:ia(T,S,T-A*O,S-P*O,T-M*O,S-R*O,p,!1)+2:"miter"===a.join&&m/x<=y&&(h?(p.push(G,D),p.push(G,D)):(p.push(B,k),p.push(B,k)),g+=2),p.push(T-M*O,S-R*O),p.push(T+M*I,S+R*I),g+=2)}b=t[2*(f-2)],v=t[2*(f-2)+1],T=t[2*(f-1)],S=t[2*(f-1)+1],A=-(v-S),P=b-T,C=Math.sqrt(A*A+P*P),A/=C,P/=C,A*=_,P*=_,p.push(T-A*O,S-P*O),p.push(T+A*I,S+P*I),c||("round"===a.cap?g+=ia(T-A*(O-I)*.5,S-P*(O-I)*.5,T-A*O,S-P*O,T+A*I,S+P*I,p,!1)+2:"square"===a.cap&&(g+=ra(T,S,A,P,O,I,!1,p)));for(let t=m;t<g+m-2;++t)b=p[2*t],v=p[2*t+1],T=p[2*(t+1)],S=p[2*(t+1)+1],w=p[2*(t+2)],E=p[2*(t+2)+1],!(Math.abs(b*(S-E)+T*(E-v)+w*(v-S))<1e-8)&&n.push(t,t+1,t+2)}function na(t,e,r,i){const s=Jo;if(0===t.length)return;const n=t[0],o=t[1],a=t[t.length-2],l=t[t.length-1],h=e||Math.abs(n-a)<s&&Math.abs(o-l)<s,u=r,c=t.length/2,d=u.length/2;for(let e=0;e<c;e++)u.push(t[2*e]),u.push(t[2*e+1]);for(let t=0;t<c-1;t++)i.push(d+t,d+t+1);h&&i.push(d+c-1,d)}var oa={exports:{}};oa.exports;oa.exports=aa;oa.exports.default=aa;function aa(t,e,r){r=r||2;var i,s,n,o,a,l,h,u=e&&e.length,c=u?e[0]*r:t.length,d=la(t,0,c,r,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(t,e,r,i){var s,n,o,a,l,h=[];for(s=0,n=e.length;s<n;s++)o=e[s]*i,a=s<n-1?e[s+1]*i:t.length,(l=la(t,o,a,i,!1))===l.next&&(l.steiner=!0),h.push(ya(l));for(h.sort(ga),s=0;s<h.length;s++)r=ma(h[s],r);return r}(t,e,d,r)),t.length>80*r){i=n=t[0],s=o=t[1];for(var f=r;f<c;f+=r)(a=t[f])<i&&(i=a),(l=t[f+1])<s&&(s=l),a>n&&(n=a),l>o&&(o=l);h=0!==(h=Math.max(n-i,o-s))?32767/h:0}return ua(d,p,r,i,s,h,0),p}function la(t,e,r,i,s){var n,o;if(s===Ia(t,e,r,i)>0)for(n=e;n<r;n+=i)o=Ra(n,t[n],t[n+1],o);else for(n=r-i;n>=e;n-=i)o=Ra(n,t[n],t[n+1],o);return o&&Sa(o,o.next)&&(Ca(o),o=o.next),o}function ha(t,e){if(!t)return t;e||(e=t);var r,i=t;do{if(r=!1,i.steiner||!Sa(i,i.next)&&0!==Ta(i.prev,i,i.next))i=i.next;else{if(Ca(i),(i=e=i.prev)===i.next)break;r=!0}}while(r||i!==e);return e}function ua(t,e,r,i,s,n,o){if(t){!o&&n&&function(t,e,r,i){var s=t;do{0===s.z&&(s.z=xa(s.x,s.y,e,r,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,function(t){var e,r,i,s,n,o,a,l,h=1;do{for(r=t,t=null,n=null,o=0;r;){for(o++,i=r,a=0,e=0;e<h&&(a++,i=i.nextZ);e++);for(l=h;a>0||l>0&&i;)0!==a&&(0===l||!i||r.z<=i.z)?(s=r,r=r.nextZ,a--):(s=i,i=i.nextZ,l--),n?n.nextZ=s:t=s,s.prevZ=n,n=s;r=i}n.nextZ=null,h*=2}while(o>1)}(s)}(t,i,s,n);for(var a,l,h=t;t.prev!==t.next;)if(a=t.prev,l=t.next,n?da(t,i,s,n):ca(t))e.push(a.i/r|0),e.push(t.i/r|0),e.push(l.i/r|0),Ca(t),t=l.next,h=l.next;else if((t=l)===h){o?1===o?ua(t=pa(ha(t),e,r),e,r,i,s,n,2):2===o&&fa(t,e,r,i,s,n):ua(ha(t),e,r,i,s,n,1);break}}}function ca(t){var e=t.prev,r=t,i=t.next;if(Ta(e,r,i)>=0)return!1;for(var s=e.x,n=r.x,o=i.x,a=e.y,l=r.y,h=i.y,u=s<n?s<o?s:o:n<o?n:o,c=a<l?a<h?a:h:l<h?l:h,d=s>n?s>o?s:o:n>o?n:o,p=a>l?a>h?a:h:l>h?l:h,f=i.next;f!==e;){if(f.x>=u&&f.x<=d&&f.y>=c&&f.y<=p&&ba(s,a,n,l,o,h,f.x,f.y)&&Ta(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function da(t,e,r,i){var s=t.prev,n=t,o=t.next;if(Ta(s,n,o)>=0)return!1;for(var a=s.x,l=n.x,h=o.x,u=s.y,c=n.y,d=o.y,p=a<l?a<h?a:h:l<h?l:h,f=u<c?u<d?u:d:c<d?c:d,g=a>l?a>h?a:h:l>h?l:h,m=u>c?u>d?u:d:c>d?c:d,_=xa(p,f,e,r,i),x=xa(g,m,e,r,i),y=t.prevZ,b=t.nextZ;y&&y.z>=_&&b&&b.z<=x;){if(y.x>=p&&y.x<=g&&y.y>=f&&y.y<=m&&y!==s&&y!==o&&ba(a,u,l,c,h,d,y.x,y.y)&&Ta(y.prev,y,y.next)>=0||(y=y.prevZ,b.x>=p&&b.x<=g&&b.y>=f&&b.y<=m&&b!==s&&b!==o&&ba(a,u,l,c,h,d,b.x,b.y)&&Ta(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;y&&y.z>=_;){if(y.x>=p&&y.x<=g&&y.y>=f&&y.y<=m&&y!==s&&y!==o&&ba(a,u,l,c,h,d,y.x,y.y)&&Ta(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;b&&b.z<=x;){if(b.x>=p&&b.x<=g&&b.y>=f&&b.y<=m&&b!==s&&b!==o&&ba(a,u,l,c,h,d,b.x,b.y)&&Ta(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function pa(t,e,r){var i=t;do{var s=i.prev,n=i.next.next;!Sa(s,n)&&wa(s,i,i.next,n)&&Pa(s,n)&&Pa(n,s)&&(e.push(s.i/r|0),e.push(i.i/r|0),e.push(n.i/r|0),Ca(i),Ca(i.next),i=t=n),i=i.next}while(i!==t);return ha(i)}function fa(t,e,r,i,s,n){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&va(o,a)){var l=Ma(o,a);return o=ha(o,o.next),l=ha(l,l.next),ua(o,e,r,i,s,n,0),void ua(l,e,r,i,s,n,0)}a=a.next}o=o.next}while(o!==t)}function ga(t,e){return t.x-e.x}function ma(t,e){var r=function(t,e){var r,i=e,s=t.x,n=t.y,o=-1/0;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){var a=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=s&&a>o&&(o=a,r=i.x<i.next.x?i:i.next,a===s))return r}i=i.next}while(i!==e);if(!r)return null;var l,h=r,u=r.x,c=r.y,d=1/0;i=r;do{s>=i.x&&i.x>=u&&s!==i.x&&ba(n<c?s:o,n,u,c,n<c?o:s,n,i.x,i.y)&&(l=Math.abs(n-i.y)/(s-i.x),Pa(i,t)&&(l<d||l===d&&(i.x>r.x||i.x===r.x&&_a(r,i)))&&(r=i,d=l)),i=i.next}while(i!==h);return r}(t,e);if(!r)return e;var i=Ma(r,t);return ha(i,i.next),ha(r,r.next)}function _a(t,e){return Ta(t.prev,t,e.prev)<0&&Ta(e.next,t,t.next)<0}function xa(t,e,r,i,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*s|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ya(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function ba(t,e,r,i,s,n,o,a){return(s-o)*(e-a)>=(t-o)*(n-a)&&(t-o)*(i-a)>=(r-o)*(e-a)&&(r-o)*(n-a)>=(s-o)*(i-a)}function va(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&wa(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(Pa(t,e)&&Pa(e,t)&&function(t,e){var r=t,i=!1,s=(t.x+e.x)/2,n=(t.y+e.y)/2;do{r.y>n!=r.next.y>n&&r.next.y!==r.y&&s<(r.next.x-r.x)*(n-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==t);return i}(t,e)&&(Ta(t.prev,t,e.prev)||Ta(t,e.prev,e))||Sa(t,e)&&Ta(t.prev,t,t.next)>0&&Ta(e.prev,e,e.next)>0)}function Ta(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Sa(t,e){return t.x===e.x&&t.y===e.y}function wa(t,e,r,i){var s=Aa(Ta(t,e,r)),n=Aa(Ta(t,e,i)),o=Aa(Ta(r,i,t)),a=Aa(Ta(r,i,e));return!!(s!==n&&o!==a||0===s&&Ea(t,r,e)||0===n&&Ea(t,i,e)||0===o&&Ea(r,t,i)||0===a&&Ea(r,e,i))}function Ea(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Aa(t){return t>0?1:t<0?-1:0}function Pa(t,e){return Ta(t.prev,t,t.next)<0?Ta(t,e,t.next)>=0&&Ta(t,t.prev,e)>=0:Ta(t,e,t.prev)<0||Ta(t,t.next,e)<0}function Ma(t,e){var r=new Oa(t.i,t.x,t.y),i=new Oa(e.i,e.x,e.y),s=t.next,n=e.prev;return t.next=e,e.prev=t,r.next=s,s.prev=r,i.next=r,r.prev=i,n.next=i,i.prev=n,i}function Ra(t,e,r,i){var s=new Oa(t,e,r);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function Ca(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Oa(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ia(t,e,r,i){for(var s=0,n=e,o=r-i;n<r;n+=i)s+=(t[o]-t[n])*(t[n+1]+t[o+1]),o=n;return s}aa.deviation=function(t,e,r,i){var s=e&&e.length,n=s?e[0]*r:t.length,o=Math.abs(Ia(t,0,n,r));if(s)for(var a=0,l=e.length;a<l;a++){var h=e[a]*r,u=a<l-1?e[a+1]*r:t.length;o-=Math.abs(Ia(t,h,u,r))}var c=0;for(a=0;a<i.length;a+=3){var d=i[a]*r,p=i[a+1]*r,f=i[a+2]*r;c+=Math.abs((t[d]-t[f])*(t[p+1]-t[d+1])-(t[d]-t[p])*(t[f+1]-t[d+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},aa.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},i=0,s=0;s<t.length;s++){for(var n=0;n<t[s].length;n++)for(var o=0;o<e;o++)r.vertices.push(t[s][n][o]);s>0&&(i+=t[s-1].length,r.holes.push(i))}return r};var Ba=f(oa.exports);function ka(t,e,r,i,s,n,o){const a=Ba(t,e,2);if(!a)return;for(let t=0;t<a.length;t+=3)n[o++]=a[t]+s,n[o++]=a[t+1]+s,n[o++]=a[t+2]+s;let l=s*i;for(let e=0;e<t.length;e+=2)r[l]=t[e],r[l+1]=t[e+1],l+=i}const Ga=[],Da={extension:{type:u.ShapeBuilder,name:"polygon"},build(t,e){for(let r=0;r<t.points.length;r++)e[r]=t.points[r];return e},triangulate(t,e,r,i,s,n){ka(t,Ga,e,r,i,s,n)}},Fa={extension:{type:u.ShapeBuilder,name:"rectangle"},build(t,e){const r=t,i=r.x,s=r.y,n=r.width,o=r.height;return n>=0&&o>=0&&(e[0]=i,e[1]=s,e[2]=i+n,e[3]=s,e[4]=i+n,e[5]=s+o,e[6]=i,e[7]=s+o),e},triangulate(t,e,r,i,s,n){let o=0;e[(i*=r)+o]=t[0],e[i+o+1]=t[1],o+=r,e[i+o]=t[2],e[i+o+1]=t[3],o+=r,e[i+o]=t[6],e[i+o+1]=t[7],o+=r,e[i+o]=t[4],e[i+o+1]=t[5],o+=r;const a=i/r;s[n++]=a,s[n++]=a+1,s[n++]=a+2,s[n++]=a+1,s[n++]=a+3,s[n++]=a+2}},Na={extension:{type:u.ShapeBuilder,name:"triangle"},build:(t,e)=>(e[0]=t.x,e[1]=t.y,e[2]=t.x2,e[3]=t.y2,e[4]=t.x3,e[5]=t.y3,e),triangulate(t,e,r,i,s,n){let o=0;e[(i*=r)+o]=t[0],e[i+o+1]=t[1],o+=r,e[i+o]=t[2],e[i+o+1]=t[3],o+=r,e[i+o]=t[4],e[i+o+1]=t[5];const a=i/r;s[n++]=a,s[n++]=a+1,s[n++]=a+2}},Ua=new st,La=new Rt;function za(t,e,r,i){const s=e.matrix?t.copyFrom(e.matrix).invert():t.identity();if("local"===e.textureSpace){const t=r.getBounds(La);s.translate(-t.x,-t.y),s.scale(1/t.width,1/t.height)}else{s.translate(e.texture.frame.x,e.texture.frame.y),s.scale(1/e.texture.source.width,1/e.texture.source.height);const t=e.texture.source.style;"clamp-to-edge"===t.addressMode&&(t.addressMode="repeat",t.update())}return i&&s.append(Ua.copyFrom(i).invert()),s}const Xa={};p.handleByMap(u.ShapeBuilder,Xa),p.add(Fa,Da,Na,Ko,Qo,Zo);const Ha=new Rt,ja=new st;function Va(t,e){const{geometryData:r,batches:i}=e;i.length=0,r.indices.length=0,r.vertices.length=0,r.uvs.length=0;for(let e=0;e<t.instructions.length;e++){const s=t.instructions[e];if("texture"===s.action)Wa(s.data,i,r);else if("fill"===s.action||"stroke"===s.action){const t="stroke"===s.action,e=s.data.path.shapePath,n=s.data.style,o=s.data.hole;t&&o&&$a(o.shapePath,n,!0,i,r),o&&(e.shapePrimitives[e.shapePrimitives.length-1].holes=o.shapePath.shapePrimitives),$a(e,n,t,i,r)}}}function Wa(t,e,r){const{vertices:i,uvs:s,indices:n}=r,o=n.length,a=i.length/2,l=[],h=Xa.rectangle,u=Ha,c=t.image;u.x=t.dx,u.y=t.dy,u.width=t.dw,u.height=t.dh;const d=t.transform;h.build(u,l),d&&No(l,d),h.triangulate(l,i,2,a,n,o);const p=c.uvs;s.push(p.x0,p.y0,p.x1,p.y1,p.x3,p.y3,p.x2,p.y2);const f=dt.get(Lo);f.indexOffset=o,f.indexSize=n.length-o,f.attributeOffset=a,f.attributeSize=i.length/2-a,f.baseColor=t.style,f.alpha=t.alpha,f.texture=c,f.geometryData=r,e.push(f)}function $a(t,e,r,i,s){const{vertices:n,uvs:o,indices:a}=s;t.shapePrimitives.forEach((({shape:t,transform:l,holes:h})=>{var u;const c=a.length,d=n.length/2,p=[],f=Xa[t.type];let g="triangle-list";if(f.build(t,p),l&&No(p,l),r){const r=null==(u=t.closePath)||u,i=e;i.pixelLine?(na(p,r,n,a),g="line-list"):sa(p,i,!1,r,n,a)}else if(h){const t=[],e=p.slice();(function(t){const e=[];for(let r=0;r<t.length;r++){const i=t[r].shape,s=[];Xa[i.type].build(i,s),e.push(s)}return e})(h).forEach((r=>{t.push(e.length/2),e.push(...r)})),ka(e,t,n,2,d,a,c)}else f.triangulate(p,n,2,d,a,c);const m=o.length/2,_=e.texture;if(_!==Ue.WHITE){const r=za(ja,e,t,l);Do(n,2,d,o,m,2,n.length/2-d,r)}else Fo(o,m,2,n.length/2-d);const x=dt.get(Lo);x.indexOffset=c,x.indexSize=a.length-c,x.attributeOffset=d,x.attributeSize=n.length/2-d,x.baseColor=e.color,x.alpha=e.alpha,x.texture=_,x.geometryData=s,x.topology=g,i.push(x)}))}class Ya{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class qa{constructor(){this.batcher=new Go,this.instructions=new Jt}init(){this.instructions.reset()}get geometry(){return this.batcher.geometry}}const Ka=class t{constructor(t){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),t.renderableGC.addManagedHash(this,"_gpuContextHash"),t.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(e){var r;t.defaultOptions.bezierSmoothness=null!=(r=null==e?void 0:e.bezierSmoothness)?r:t.defaultOptions.bezierSmoothness}getContextRenderData(t){return this._graphicsDataContextHash[t.uid]||this._initContextRenderData(t)}updateGpuContext(t){let e=this._gpuContextHash[t.uid]||this._initContext(t);if(t.dirty){e?this._cleanGraphicsContextData(t):e=this._initContext(t),Va(t,e);const r=t.batchMode;t.customShader||"no-batch"===r?e.isBatchable=!1:"auto"===r&&(e.isBatchable=e.geometryData.vertices.length<400),t.dirty=!1}return e}getGpuContext(t){return this._gpuContextHash[t.uid]||this._initContext(t)}_initContextRenderData(t){const e=dt.get(qa),{batches:r,geometryData:i}=this._gpuContextHash[t.uid],s=i.vertices.length,n=i.indices.length;for(let t=0;t<r.length;t++)r[t].applyTransform=!1;const o=e.batcher;o.ensureAttributeBuffer(s),o.ensureIndexBuffer(n),o.begin();for(let t=0;t<r.length;t++){const e=r[t];o.add(e)}o.finish(e.instructions);const a=o.geometry;a.indexBuffer.setDataWithSize(o.indexBuffer,o.indexSize,!0),a.buffers[0].setDataWithSize(o.attributeBuffer.float32View,o.attributeSize,!0);const l=o.batches;for(let t=0;t<l.length;t++){const e=l[t];e.bindGroup=gs(e.textures.textures,e.textures.count)}return this._graphicsDataContextHash[t.uid]=e,e}_initContext(t){const e=new Ya;return e.context=t,this._gpuContextHash[t.uid]=e,t.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]}onGraphicsContextDestroy(t){this._cleanGraphicsContextData(t),t.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]=null}_cleanGraphicsContextData(t){const e=this._gpuContextHash[t.uid];e.isBatchable||this._graphicsDataContextHash[t.uid]&&(dt.return(this.getContextRenderData(t)),this._graphicsDataContextHash[t.uid]=null),e.batches&&e.batches.forEach((t=>{dt.return(t)}))}destroy(){for(const t in this._gpuContextHash)this._gpuContextHash[t]&&this.onGraphicsContextDestroy(this._gpuContextHash[t].context)}};Ka.extension={type:[u.WebGLSystem,u.WebGPUSystem,u.CanvasSystem],name:"graphicsContext"},Ka.defaultOptions={bezierSmoothness:.5};let Qa=Ka;const Za={normal:0,add:1,multiply:2,screen:3,overlay:4,erase:5,"normal-npm":6,"add-npm":7,"screen-npm":8,min:9,max:10},Ja=class t{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}set cullMode(t){"none"!==t?(this.culling=!0,this.clockwiseFrontFace="front"===t):this.culling=!1}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend="none"!==t,this._blendMode=t,this._blendModeId=Za[t]||0}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const e=new t;return e.depthTest=!1,e.blend=!0,e}};Ja.default2d=Ja.for2d();let tl=Ja;function el(t,e,r){const i=(t>>24&255)/255;e[r++]=(255&t)/255*i,e[r++]=(t>>8&255)/255*i,e[r++]=(t>>16&255)/255*i,e[r++]=i}class rl{constructor(t,e){this.state=tl.for2d(),this._graphicsBatchesHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this.renderer=t,this._adaptor=e,this._adaptor.init(),this.renderer.renderableGC.addManagedHash(this,"_graphicsBatchesHash")}validateRenderable(t){const e=t.context,r=!!this._graphicsBatchesHash[t.uid],i=this.renderer.graphicsContext.updateGpuContext(e);return!(!i.isBatchable&&r===i.isBatchable)}addRenderable(t,e){const r=this.renderer.graphicsContext.updateGpuContext(t.context);t.didViewUpdate&&this._rebuild(t),r.isBatchable?this._addToBatcher(t,e):(this.renderer.renderPipes.batch.break(e),e.add(t))}updateRenderable(t){const e=this._graphicsBatchesHash[t.uid];if(e)for(let t=0;t<e.length;t++){const r=e[t];r._batcher.updateElement(r)}}destroyRenderable(t){this._graphicsBatchesHash[t.uid]&&this._removeBatchForRenderable(t.uid),t.off("destroyed",this._destroyRenderableBound)}execute(t){if(!t.isRenderable)return;const e=this.renderer,r=t.context;if(!e.graphicsContext.getGpuContext(r).batches.length)return;const i=r.customShader||this._adaptor.shader;this.state.blendMode=t.groupBlendMode;const s=i.resources.localUniforms.uniforms;s.uTransformMatrix=t.groupTransform,s.uRound=e._roundPixels|t._roundPixels,el(t.groupColorAlpha,s.uColor,0),this._adaptor.execute(this,t)}_rebuild(t){const e=!!this._graphicsBatchesHash[t.uid],r=this.renderer.graphicsContext.updateGpuContext(t.context);e&&this._removeBatchForRenderable(t.uid),r.isBatchable&&this._initBatchesForRenderable(t),t.batched=r.isBatchable}_addToBatcher(t,e){const r=this.renderer.renderPipes.batch,i=this._getBatchesForRenderable(t);for(let t=0;t<i.length;t++){const s=i[t];r.addToBatch(s,e)}}_getBatchesForRenderable(t){return this._graphicsBatchesHash[t.uid]||this._initBatchesForRenderable(t)}_initBatchesForRenderable(t){const e=t.context,r=this.renderer.graphicsContext.getGpuContext(e),i=this.renderer._roundPixels|t._roundPixels,s=r.batches.map((e=>{const r=dt.get(Lo);return e.copyTo(r),r.renderable=t,r.roundPixels=i,r}));return void 0===this._graphicsBatchesHash[t.uid]&&t.on("destroyed",this._destroyRenderableBound),this._graphicsBatchesHash[t.uid]=s,s}_removeBatchForRenderable(t){this._graphicsBatchesHash[t].forEach((t=>{dt.return(t)})),this._graphicsBatchesHash[t]=null}destroy(){this.renderer=null,this._adaptor.destroy(),this._adaptor=null,this.state=null;for(const t in this._graphicsBatchesHash)this._removeBatchForRenderable(t);this._graphicsBatchesHash=null}}rl.extension={type:[u.WebGLPipes,u.WebGPUPipes,u.CanvasPipes],name:"graphics"},p.add(rl),p.add(Qa);class il{constructor(){this.batcherName="default",this.packAsQuad=!1,this.indexOffset=0,this.attributeOffset=0,this.roundPixels=0,this._batcher=null,this._batch=null,this._textureMatrixUpdateId=-1,this._uvUpdateId=-1}get blendMode(){return this.renderable.groupBlendMode}get topology(){return this._topology||this.geometry.topology}set topology(t){this._topology=t}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.geometry=null,this._uvUpdateId=-1,this._textureMatrixUpdateId=-1}setTexture(t){this.texture!==t&&(this.texture=t,this._textureMatrixUpdateId=-1)}get uvs(){const t=this.geometry.getBuffer("aUV"),e=t.data;let r=e;const i=this.texture.textureMatrix;return i.isSimple||(r=this._transformedUvs,(this._textureMatrixUpdateId!==i._updateID||this._uvUpdateId!==t._updateID)&&((!r||r.length<e.length)&&(r=this._transformedUvs=new Float32Array(e.length)),this._textureMatrixUpdateId=i._updateID,this._uvUpdateId=t._updateID,i.multiplyUvs(e,r))),r}get positions(){return this.geometry.positions}get indices(){return this.geometry.indices}get color(){return this.renderable.groupColorAlpha}get groupTransform(){return this.renderable.groupTransform}get attributeSize(){return this.geometry.positions.length/2}get indexSize(){return this.geometry.indices.length}}class sl{constructor(t,e){this.localUniforms=new To({uTransformMatrix:{value:new st,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),this.localUniformsBindGroup=new os({0:this.localUniforms}),this._meshDataHash=Object.create(null),this._gpuBatchableMeshHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this.renderer=t,this._adaptor=e,this._adaptor.init(),t.renderableGC.addManagedHash(this,"_gpuBatchableMeshHash"),t.renderableGC.addManagedHash(this,"_meshDataHash")}validateRenderable(t){const e=this._getMeshData(t),r=e.batched,i=t.batched;if(e.batched=i,r!==i)return!0;if(i){const r=t._geometry;if(r.indices.length!==e.indexSize||r.positions.length!==e.vertexSize)return e.indexSize=r.indices.length,e.vertexSize=r.positions.length,!0;const i=this._getBatchableMesh(t);return i.texture.uid!==t._texture.uid&&(i._textureMatrixUpdateId=-1),!i._batcher.checkAndUpdateTexture(i,t._texture)}return!1}addRenderable(t,e){const r=this.renderer.renderPipes.batch,{batched:i}=this._getMeshData(t);if(i){const i=this._getBatchableMesh(t);i.setTexture(t._texture),i.geometry=t._geometry,r.addToBatch(i,e)}else r.break(e),e.add(t)}updateRenderable(t){if(t.batched){const e=this._gpuBatchableMeshHash[t.uid];e.setTexture(t._texture),e.geometry=t._geometry,e._batcher.updateElement(e)}}destroyRenderable(t){this._meshDataHash[t.uid]=null;const e=this._gpuBatchableMeshHash[t.uid];e&&(dt.return(e),this._gpuBatchableMeshHash[t.uid]=null),t.off("destroyed",this._destroyRenderableBound)}execute(t){if(!t.isRenderable)return;t.state.blendMode=vs(t.groupBlendMode,t.texture._source);const e=this.localUniforms;e.uniforms.uTransformMatrix=t.groupTransform,e.uniforms.uRound=this.renderer._roundPixels|t._roundPixels,e.update(),el(t.groupColorAlpha,e.uniforms.uColor,0),this._adaptor.execute(this,t)}_getMeshData(t){return this._meshDataHash[t.uid]||this._initMeshData(t)}_initMeshData(t){var e,r;return this._meshDataHash[t.uid]={batched:t.batched,indexSize:null==(e=t._geometry.indices)?void 0:e.length,vertexSize:null==(r=t._geometry.positions)?void 0:r.length},t.on("destroyed",this._destroyRenderableBound),this._meshDataHash[t.uid]}_getBatchableMesh(t){return this._gpuBatchableMeshHash[t.uid]||this._initBatchableMesh(t)}_initBatchableMesh(t){const e=dt.get(il);return e.renderable=t,e.setTexture(t._texture),e.transform=t.groupTransform,e.roundPixels=this.renderer._roundPixels|t._roundPixels,this._gpuBatchableMeshHash[t.uid]=e,e}destroy(){for(const t in this._gpuBatchableMeshHash)this._gpuBatchableMeshHash[t]&&dt.return(this._gpuBatchableMeshHash[t]);this._gpuBatchableMeshHash=null,this._meshDataHash=null,this.localUniforms=null,this.localUniformsBindGroup=null,this._adaptor.destroy(),this._adaptor=null,this.renderer=null}}sl.extension={type:[u.WebGLPipes,u.WebGPUPipes,u.CanvasPipes],name:"mesh"},p.add(sl);class nl{execute(t,e){const r=t.state,i=t.renderer,s=e.shader||t.defaultShader;s.resources.uTexture=e.texture._source,s.resources.uniforms=t.localUniforms;const n=i.gl,o=t.getBuffers(e);i.shader.bind(s),i.state.set(r),i.geometry.bind(o.geometry,s.glProgram);const a=2===o.geometry.indexBuffer.data.BYTES_PER_ELEMENT?n.UNSIGNED_SHORT:n.UNSIGNED_INT;n.drawElements(n.TRIANGLES,6*e.particleChildren.length,a,0)}}function ol(t,e=null){const r=6*t;if(r>65535?e||(e=new Uint32Array(r)):e||(e=new Uint16Array(r)),e.length!==r)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${r}`);for(let t=0,i=0;t<r;t+=6,i+=4)e[t+0]=i+0,e[t+1]=i+1,e[t+2]=i+2,e[t+3]=i+0,e[t+4]=i+2,e[t+5]=i+3;return e}function al(t){return{dynamicUpdate:ll(t,!0),staticUpdate:ll(t,!1)}}function ll(t,e){const r=[];r.push("\n      \n        var index = 0;\n\n        for (let i = 0; i < ps.length; ++i)\n        {\n            const p = ps[i];\n\n            ");let i=0;for(const s in t){const n=t[s];if(e!==n.dynamic)continue;r.push(`offset = index + ${i}`),r.push(n.code);i+=gn(n.format).stride/4}r.push("\n            index += stride * 4;\n        }\n    "),r.unshift(`\n        var stride = ${i};\n    `);const s=r.join("\n");return new Function("ps","f32v","u32v",s)}class hl{constructor(t){var e;this._size=0,this._generateParticleUpdateCache={};const r=this._size=null!=(e=t.size)?e:1e3,i=t.properties;let s=0,n=0;for(const t in i){const e=i[t],r=gn(e.format);e.dynamic?n+=r.stride:s+=r.stride}this._dynamicStride=n/4,this._staticStride=s/4,this.staticAttributeBuffer=new _s(4*r*s),this.dynamicAttributeBuffer=new _s(4*r*n),this.indexBuffer=ol(r);const o=new zs;let a=0,l=0;this._staticBuffer=new Ns({data:new Float32Array(1),label:"static-particle-buffer",shrinkToFit:!1,usage:Fs.VERTEX|Fs.COPY_DST}),this._dynamicBuffer=new Ns({data:new Float32Array(1),label:"dynamic-particle-buffer",shrinkToFit:!1,usage:Fs.VERTEX|Fs.COPY_DST});for(const t in i){const e=i[t],r=gn(e.format);e.dynamic?(o.addAttribute(e.attributeName,{buffer:this._dynamicBuffer,stride:4*this._dynamicStride,offset:4*a,format:e.format}),a+=r.size):(o.addAttribute(e.attributeName,{buffer:this._staticBuffer,stride:4*this._staticStride,offset:4*l,format:e.format}),l+=r.size)}o.addIndex(this.indexBuffer);const h=this.getParticleUpdate(i);this._dynamicUpload=h.dynamicUpdate,this._staticUpload=h.staticUpdate,this.geometry=o}getParticleUpdate(t){const e=function(t){const e=[];for(const r in t){const i=t[r];e.push(r,i.code,i.dynamic?"d":"s")}return e.join("_")}(t);return this._generateParticleUpdateCache[e]||(this._generateParticleUpdateCache[e]=this.generateParticleUpdate(t)),this._generateParticleUpdateCache[e]}generateParticleUpdate(t){return al(t)}update(t,e){t.length>this._size&&(e=!0,this._size=Math.max(t.length,1.5*this._size|0),this.staticAttributeBuffer=new _s(this._size*this._staticStride*4*4),this.dynamicAttributeBuffer=new _s(this._size*this._dynamicStride*4*4),this.indexBuffer=ol(this._size),this.geometry.indexBuffer.setDataWithSize(this.indexBuffer,this.indexBuffer.byteLength,!0));const r=this.dynamicAttributeBuffer;if(this._dynamicUpload(t,r.float32View,r.uint32View),this._dynamicBuffer.setDataWithSize(this.dynamicAttributeBuffer.float32View,t.length*this._dynamicStride*4,!0),e){const e=this.staticAttributeBuffer;this._staticUpload(t,e.float32View,e.uint32View),this._staticBuffer.setDataWithSize(e.float32View,t.length*this._staticStride*4,!0)}}destroy(){this._staticBuffer.destroy(),this._dynamicBuffer.destroy(),this.geometry.destroy()}}var ul="varying vec2 vUV;\nvarying vec4 vColor;\n\nuniform sampler2D uTexture;\n\nvoid main(void){\n    vec4 color = texture2D(uTexture, vUV) * vColor;\n    gl_FragColor = color;\n}",cl="attribute vec2 aVertex;\nattribute vec2 aUV;\nattribute vec4 aColor;\n\nattribute vec2 aPosition;\nattribute float aRotation;\n\nuniform mat3 uTranslationMatrix;\nuniform float uRound;\nuniform vec2 uResolution;\nuniform vec4 uColor;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n\nvec2 roundPixels(vec2 position, vec2 targetSize)\n{       \n    return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n}\n\nvoid main(void){\n    float cosRotation = cos(aRotation);\n    float sinRotation = sin(aRotation);\n    float x = aVertex.x * cosRotation - aVertex.y * sinRotation;\n    float y = aVertex.x * sinRotation + aVertex.y * cosRotation;\n\n    vec2 v = vec2(x, y);\n    v = v + aPosition;\n\n    gl_Position = vec4((uTranslationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    if(uRound == 1.0)\n    {\n        gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n    }\n\n    vUV = aUV;\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uColor;\n}\n",dl="\nstruct ParticleUniforms {\n  uProjectionMatrix:mat3x3<f32>,\n  uColor:vec4<f32>,\n  uResolution:vec2<f32>,\n  uRoundPixels:f32,\n};\n\n@group(0) @binding(0) var<uniform> uniforms: ParticleUniforms;\n\n@group(1) @binding(0) var uTexture: texture_2d<f32>;\n@group(1) @binding(1) var uSampler : sampler;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>,\n    @location(1) color : vec4<f32>,\n  };\n@vertex\nfn mainVertex(\n  @location(0) aVertex: vec2<f32>,\n  @location(1) aPosition: vec2<f32>,\n  @location(2) aUV: vec2<f32>,\n  @location(3) aColor: vec4<f32>,\n  @location(4) aRotation: f32,\n) -> VSOutput {\n  \n   let v = vec2(\n       aVertex.x * cos(aRotation) - aVertex.y * sin(aRotation),\n       aVertex.x * sin(aRotation) + aVertex.y * cos(aRotation)\n   ) + aPosition;\n\n   let position = vec4((uniforms.uProjectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    let vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uniforms.uColor;\n\n  return VSOutput(\n   position,\n   aUV,\n   vColor,\n  );\n}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @location(1) color: vec4<f32>,\n  @builtin(position) position: vec4<f32>,\n) -> @location(0) vec4<f32> {\n\n    var sample = textureSample(uTexture, uSampler, uv) * color;\n   \n    return sample;\n}";class pl extends Oo{constructor(){super({glProgram:pn.from({vertex:cl,fragment:ul}),gpuProgram:wn.from({fragment:{source:dl,entryPoint:"mainFragment"},vertex:{source:dl,entryPoint:"mainVertex"}}),resources:{uTexture:Ue.WHITE.source,uSampler:new ce({}),uniforms:{uTranslationMatrix:{value:new st,type:"mat3x3<f32>"},uColor:{value:new Q(16777215),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}}})}}class fl{constructor(t,e){this.state=tl.for2d(),this._gpuBufferHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this.localUniforms=new To({uTranslationMatrix:{value:new st,type:"mat3x3<f32>"},uColor:{value:new Float32Array(4),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}),this.renderer=t,this.adaptor=e,this.defaultShader=new pl,this.state=tl.for2d()}validateRenderable(t){return!1}addRenderable(t,e){this.renderer.renderPipes.batch.break(e),e.add(t)}getBuffers(t){return this._gpuBufferHash[t.uid]||this._initBuffer(t)}_initBuffer(t){return this._gpuBufferHash[t.uid]=new hl({size:t.particleChildren.length,properties:t._properties}),t.on("destroyed",this._destroyRenderableBound),this._gpuBufferHash[t.uid]}updateRenderable(t){}destroyRenderable(t){this._gpuBufferHash[t.uid].destroy(),this._gpuBufferHash[t.uid]=null,t.off("destroyed",this._destroyRenderableBound)}execute(t){const e=t.particleChildren;if(0===e.length)return;const r=this.renderer,i=this.getBuffers(t);t.texture||(t.texture=e[0].texture);const s=this.state;i.update(e,t._childrenDirty),t._childrenDirty=!1,s.blendMode=vs(t.blendMode,t.texture._source);const n=this.localUniforms.uniforms,o=n.uTranslationMatrix;t.worldTransform.copyTo(o),o.prepend(r.globalUniforms.globalUniformData.projectionMatrix),n.uResolution=r.globalUniforms.globalUniformData.resolution,n.uRound=r._roundPixels|t._roundPixels,el(t.groupColorAlpha,n.uColor,0),this.adaptor.execute(this,t)}destroy(){this.defaultShader&&(this.defaultShader.destroy(),this.defaultShader=null)}}class gl extends fl{constructor(t){super(t,new nl)}}gl.extension={type:[u.WebGLPipes],name:"particle"};class ml{execute(t,e){const r=t.renderer,i=e.shader||t.defaultShader;i.groups[0]=r.renderPipes.uniformBatch.getUniformBindGroup(t.localUniforms,!0),i.groups[1]=r.texture.getTextureBindGroup(e.texture);const s=t.state,n=t.getBuffers(e);r.encoder.draw({geometry:n.geometry,shader:e.shader||t.defaultShader,state:s,size:6*e.particleChildren.length})}}class _l extends fl{constructor(t){super(t,new ml)}}_l.extension={type:[u.WebGPUPipes],name:"particle"},p.add(gl),p.add(_l);class xl{constructor(){this.batcherName="default",this.topology="triangle-list",this.attributeSize=4,this.indexSize=6,this.packAsQuad=!0,this.roundPixels=0,this._attributeStart=0,this._batcher=null,this._batch=null}get blendMode(){return this.renderable.groupBlendMode}get color(){return this.renderable.groupColorAlpha}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.bounds=null}}function yl(t,e){const{texture:r,bounds:i}=t;Ai(i,e._anchor,r);const s=e._style.padding;i.minX-=s,i.minY-=s,i.maxX-=s,i.maxY-=s}class bl{constructor(t){this._gpuText=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=t,this._renderer.runners.resolutionChange.add(this),this._renderer.renderableGC.addManagedHash(this,"_gpuText")}resolutionChange(){for(const t in this._gpuText){const e=this._gpuText[t];if(!e)continue;const r=e.batchableSprite.renderable;r._autoResolution&&(r._resolution=this._renderer.resolution,r.onViewUpdate())}}validateRenderable(t){const e=this._getGpuText(t),r=t._getKey();return e.currentKey!==r}addRenderable(t,e){const r=this._getGpuText(t).batchableSprite;t._didTextUpdate&&this._updateText(t),this._renderer.renderPipes.batch.addToBatch(r,e)}updateRenderable(t){const e=this._getGpuText(t).batchableSprite;t._didTextUpdate&&this._updateText(t),e._batcher.updateElement(e)}destroyRenderable(t){t.off("destroyed",this._destroyRenderableBound),this._destroyRenderableById(t.uid)}_destroyRenderableById(t){const e=this._gpuText[t];this._renderer.canvasText.decreaseReferenceCount(e.currentKey),dt.return(e.batchableSprite),this._gpuText[t]=null}_updateText(t){const e=t._getKey(),r=this._getGpuText(t),i=r.batchableSprite;r.currentKey!==e&&this._updateGpuText(t),t._didTextUpdate=!1,yl(i,t)}_updateGpuText(t){const e=this._getGpuText(t),r=e.batchableSprite;e.texture&&this._renderer.canvasText.decreaseReferenceCount(e.currentKey),e.texture=r.texture=this._renderer.canvasText.getManagedTexture(t),e.currentKey=t._getKey(),r.texture=e.texture}_getGpuText(t){return this._gpuText[t.uid]||this.initGpuText(t)}initGpuText(t){const e={texture:null,currentKey:"--",batchableSprite:dt.get(xl)};return e.batchableSprite.renderable=t,e.batchableSprite.transform=t.groupTransform,e.batchableSprite.bounds={minX:0,maxX:1,minY:0,maxY:0},e.batchableSprite.roundPixels=this._renderer._roundPixels|t._roundPixels,this._gpuText[t.uid]=e,t._resolution=t._autoResolution?this._renderer.resolution:t.resolution,this._updateText(t),t.on("destroyed",this._destroyRenderableBound),e}destroy(){for(const t in this._gpuText)this._destroyRenderableById(t);this._gpuText=null,this._renderer=null}}bl.extension={type:[u.WebGLPipes,u.WebGPUPipes,u.CanvasPipes],name:"text"};class vl{constructor(t){this._canvasPool=Object.create(null),this.canvasOptions=t||{},this.enableFullScreen=!1}_createCanvasAndContext(t,e){const r=ri.get().createCanvas();r.width=t,r.height=e;const i=r.getContext("2d");return{canvas:r,context:i}}getOptimalCanvasAndContext(t,e,r=1){t=Math.ceil(t*r-1e-6),e=Math.ceil(e*r-1e-6);const i=((t=te(t))<<17)+((e=te(e))<<1);this._canvasPool[i]||(this._canvasPool[i]=[]);let s=this._canvasPool[i].pop();return s||(s=this._createCanvasAndContext(t,e)),s}returnCanvasAndContext(t){const e=t.canvas,{width:r,height:i}=e,s=(r<<17)+(i<<1);t.context.clearRect(0,0,r,i),this._canvasPool[s].push(t)}clear(){this._canvasPool={}}}const Tl=new vl;function Sl(t,e,r){for(let i=0,s=4*r*e;i<e;++i,s+=4)if(0!==t[s+3])return!1;return!0}function wl(t,e,r,i,s){const n=4*e;for(let e=i,o=i*n+4*r;e<=s;++e,o+=n)if(0!==t[o+3])return!1;return!0}function El(t,e=1){const{width:r,height:i}=t,s=t.getContext("2d",{willReadFrequently:!0});if(null===s)throw new TypeError("Failed to get canvas 2D context");const n=s.getImageData(0,0,r,i).data;let o=0,a=0,l=r-1,h=i-1;for(;a<i&&Sl(n,r,a);)++a;if(a===i)return Rt.EMPTY;for(;Sl(n,r,h);)--h;for(;wl(n,r,o,a,h);)++o;for(;wl(n,r,l,a,h);)--l;return++l,++h,new Rt(o/e,a/e,(l-o)/e,(h-a)/e)}var Al=Object.defineProperty,Pl=Object.getOwnPropertySymbols,Ml=Object.prototype.hasOwnProperty,Rl=Object.prototype.propertyIsEnumerable,Cl=(t,e,r)=>e in t?Al(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ol=(t,e)=>{for(var r in e||(e={}))Ml.call(e,r)&&Cl(t,r,e[r]);if(Pl)for(var r of Pl(e))Rl.call(e,r)&&Cl(t,r,e[r]);return t};const Il=[{offset:0,color:"white"},{offset:1,color:"black"}],Bl=class t{constructor(...e){var r;this.uid=ht("fillGradient"),this.type="linear",this.colorStops=[];let i=function(t){var e,r;let i=null!=(e=t[0])?e:{};return("number"==typeof i||t[1])&&(i={type:"linear",start:{x:t[0],y:t[1]},end:{x:t[2],y:t[3]},textureSpace:t[4],textureSize:null!=(r=t[5])?r:kl.defaultLinearOptions.textureSize}),i}(e);const s="radial"===i.type?t.defaultRadialOptions:t.defaultLinearOptions;i=Ol(Ol({},s),re(i)),this._textureSize=i.textureSize,"radial"===i.type?(this.center=i.center,this.outerCenter=null!=(r=i.outerCenter)?r:this.center,this.innerRadius=i.innerRadius,this.outerRadius=i.outerRadius,this.scale=i.scale,this.rotation=i.rotation):(this.start=i.start,this.end=i.end),this.textureSpace=i.textureSpace,this.type=i.type,i.colorStops.forEach((t=>{this.addColorStop(t.offset,t.color)}))}addColorStop(t,e){return this.colorStops.push({offset:t,color:Q.shared.setValue(e).toHexa()}),this}buildLinearGradient(){if(this.texture)return;const t=this.colorStops.length?this.colorStops:Il,e=this._textureSize,{canvas:r,context:i}=Dl(e,1),s=i.createLinearGradient(0,0,this._textureSize,0);Gl(s,t),i.fillStyle=s,i.fillRect(0,0,e,1),this.texture=new Ue({source:new Xi({resource:r})});const{x:n,y:o}=this.start,{x:a,y:l}=this.end,h=new st,u=a-n,c=l-o,d=Math.sqrt(u*u+c*c),p=Math.atan2(c,u);h.scale(d/e,1),h.rotate(p),h.translate(n,o),"local"===this.textureSpace&&h.scale(e,e),this.transform=h}buildGradient(){"linear"===this.type?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const t=this.colorStops.length?this.colorStops:Il,e=this._textureSize,{canvas:r,context:i}=Dl(e,e),{x:s,y:n}=this.center,{x:o,y:a}=this.outerCenter,l=this.innerRadius,h=this.outerRadius,u=o-h,c=a-h,d=e/(2*h),p=(s-u)*d,f=(n-c)*d,g=i.createRadialGradient(p,f,l*d,(o-u)*d,(a-c)*d,h*d);Gl(g,t),i.fillStyle=t[t.length-1].color,i.fillRect(0,0,e,e),i.fillStyle=g,i.translate(p,f),i.rotate(this.rotation),i.scale(1,this.scale),i.translate(-p,-f),i.fillRect(0,0,e,e),this.texture=new Ue({source:new Xi({resource:r,addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"})});const m=new st;m.scale(1/d,1/d),m.translate(u,c),"local"===this.textureSpace&&m.scale(e,e),this.transform=m}get styleKey(){return this.uid}destroy(){var t;null==(t=this.texture)||t.destroy(!0),this.texture=null}};Bl.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256},Bl.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256};let kl=Bl;function Gl(t,e){for(let r=0;r<e.length;r++){const i=e[r];t.addColorStop(i.offset,i.color)}}function Dl(t,e){const r=ri.get().createCanvas(t,e),i=r.getContext("2d");return{canvas:r,context:i}}const Fl={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class Nl{constructor(t,e){this.uid=ht("fillPattern"),this.transform=new st,this._styleKey=null,this.texture=t,this.transform.scale(1/t.frame.width,1/t.frame.height),e&&(t.source.style.addressModeU=Fl[e].addressModeU,t.source.style.addressModeV=Fl[e].addressModeV)}setTransform(t){const e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frame.width,1/e.frame.height),this._styleKey=null}get styleKey(){return this._styleKey||(this._styleKey=`fill-pattern-${this.uid}-${this.texture.uid}-${this.transform.toArray().join("-")}`),this._styleKey}}var Ul=function(t){var e=[];return t.replace(zl,(function(t,r,i){var s=r.toLowerCase();for(i=function(t){var e=t.match(Xl);return e?e.map(Number):[]}(i),"m"==s&&i.length>2&&(e.push([r].concat(i.splice(0,2))),s="l",r="m"==r?"l":"L");;){if(i.length==Ll[s])return i.unshift(r),e.push(i);if(i.length<Ll[s])throw new Error("malformed path data");e.push([r].concat(i.splice(0,Ll[s])))}})),e},Ll={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},zl=/([astvzqmhlc])([^astvzqmhlc]*)/gi;var Xl=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;var Hl=f(Ul);function jl(t,e){const r=Hl(t),i=[];let s=null,n=0,o=0;for(let t=0;t<r.length;t++){const a=r[t],l=a[0],h=a;switch(l){case"M":n=h[1],o=h[2],e.moveTo(n,o);break;case"m":n+=h[1],o+=h[2],e.moveTo(n,o);break;case"H":n=h[1],e.lineTo(n,o);break;case"h":n+=h[1],e.lineTo(n,o);break;case"V":o=h[1],e.lineTo(n,o);break;case"v":o+=h[1],e.lineTo(n,o);break;case"L":n=h[1],o=h[2],e.lineTo(n,o);break;case"l":n+=h[1],o+=h[2],e.lineTo(n,o);break;case"C":n=h[5],o=h[6],e.bezierCurveTo(h[1],h[2],h[3],h[4],n,o);break;case"c":e.bezierCurveTo(n+h[1],o+h[2],n+h[3],o+h[4],n+h[5],o+h[6]),n+=h[5],o+=h[6];break;case"S":n=h[3],o=h[4],e.bezierCurveToShort(h[1],h[2],n,o);break;case"s":e.bezierCurveToShort(n+h[1],o+h[2],n+h[3],o+h[4]),n+=h[3],o+=h[4];break;case"Q":n=h[3],o=h[4],e.quadraticCurveTo(h[1],h[2],n,o);break;case"q":e.quadraticCurveTo(n+h[1],o+h[2],n+h[3],o+h[4]),n+=h[3],o+=h[4];break;case"T":n=h[1],o=h[2],e.quadraticCurveToShort(n,o);break;case"t":n+=h[1],o+=h[2],e.quadraticCurveToShort(n,o);break;case"A":n=h[6],o=h[7],e.arcToSvg(h[1],h[2],h[3],h[4],h[5],n,o);break;case"a":n+=h[6],o+=h[7],e.arcToSvg(h[1],h[2],h[3],h[4],h[5],n,o);break;case"Z":case"z":e.closePath(),i.length>0&&(s=i.pop(),s?(n=s.startX,o=s.startY):(n=0,o=0)),s=null}"Z"!==l&&"z"!==l&&null===s&&(s={startX:n,startY:o},i.push(s))}return e}class Vl{constructor(t=0,e=0,r=0){this.type="circle",this.x=t,this.y=e,this.radius=r}clone(){return new Vl(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const r=this.radius*this.radius;let i=this.x-t,s=this.y-e;return i*=i,s*=s,i+s<=r}strokeContains(t,e,r,i=.5){if(0===this.radius)return!1;const s=this.x-t,n=this.y-e,o=this.radius,a=(1-i)*r,l=Math.sqrt(s*s+n*n);return l<=o+a&&l>o-(r-a)}getBounds(t){return t||(t=new Rt),t.x=this.x-this.radius,t.y=this.y-this.radius,t.width=2*this.radius,t.height=2*this.radius,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}}class Wl{constructor(t=0,e=0,r=0,i=0){this.type="ellipse",this.x=t,this.y=e,this.halfWidth=r,this.halfHeight=i}clone(){return new Wl(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let r=(t-this.x)/this.halfWidth,i=(e-this.y)/this.halfHeight;return r*=r,i*=i,r+i<=1}strokeContains(t,e,r,i=.5){const{halfWidth:s,halfHeight:n}=this;if(s<=0||n<=0)return!1;const o=r*(1-i),a=r-o,l=s-a,h=n-a,u=s+o,c=n+o,d=t-this.x,p=e-this.y;return d*d/(l*l)+p*p/(h*h)>1&&d*d/(u*u)+p*p/(c*c)<=1}getBounds(t){return t||(t=new Rt),t.x=this.x-this.halfWidth,t.y=this.y-this.halfHeight,t.width=2*this.halfWidth,t.height=2*this.halfHeight,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}}function $l(t,e,r,i,s,n){const o=s-r,a=n-i,l=o*o+a*a;let h,u,c=-1;0!==l&&(c=((t-r)*o+(e-i)*a)/l),c<0?(h=r,u=i):c>1?(h=s,u=n):(h=r+c*o,u=i+c*a);const d=t-h,p=e-u;return d*d+p*p}class Yl{constructor(...t){this.type="polygon";let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){const t=[];for(let r=0,i=e.length;r<i;r++)t.push(e[r].x,e[r].y);e=t}this.points=e,this.closePath=!0}isClockwise(){let t=0;const e=this.points,r=e.length;for(let i=0;i<r;i+=2){const s=e[i],n=e[i+1];t+=(e[(i+2)%r]-s)*(e[(i+3)%r]+n)}return t<0}containsPolygon(t){const e=this.getBounds(undefined),r=t.getBounds(undefined);if(!e.containsRect(r))return!1;const i=t.points;for(let t=0;t<i.length;t+=2){const e=i[t],r=i[t+1];if(!this.contains(e,r))return!1}return!0}clone(){const t=this.points.slice(),e=new Yl(t);return e.closePath=this.closePath,e}contains(t,e){let r=!1;const i=this.points.length/2;for(let s=0,n=i-1;s<i;n=s++){const i=this.points[2*s],o=this.points[2*s+1],a=this.points[2*n],l=this.points[2*n+1];o>e!=l>e&&t<(e-o)/(l-o)*(a-i)+i&&(r=!r)}return r}strokeContains(t,e,r,i=.5){const s=r*r,n=s*(1-i),o=s-n,{points:a}=this,l=a.length-(this.closePath?0:2);for(let r=0;r<l;r+=2){const i=a[r],s=a[r+1],l=a[(r+2)%a.length],h=a[(r+3)%a.length];if($l(t,e,i,s,l,h)<=(Math.sign((l-i)*(e-s)-(h-s)*(t-i))<0?o:n))return!0}return!1}getBounds(t){t||(t=new Rt);const e=this.points;let r=1/0,i=-1/0,s=1/0,n=-1/0;for(let t=0,o=e.length;t<o;t+=2){const o=e[t],a=e[t+1];r=o<r?o:r,i=o>i?o:i,s=a<s?a:s,n=a>n?a:n}return t.x=r,t.width=i-r,t.y=s,t.height=n-s,t}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return this.points[this.points.length-2]}get y(){return this.points[this.points.length-1]}}const ql=(t,e,r,i,s,n,o)=>{const a=t-r,l=e-i,h=Math.sqrt(a*a+l*l);return h>=s-n&&h<=s+o};class Kl{constructor(t=0,e=0,r=0,i=0,s=20){this.type="roundedRectangle",this.x=t,this.y=e,this.width=r,this.height=i,this.radius=s}getBounds(t){return t||(t=new Rt),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}clone(){return new Kl(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+r&&e<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;let i=t-(this.x+r),s=e-(this.y+r);const n=r*r;if(i*i+s*s<=n||(i=t-(this.x+this.width-r),i*i+s*s<=n)||(s=e-(this.y+this.height-r),i*i+s*s<=n)||(i=t-(this.x+r),i*i+s*s<=n))return!0}return!1}strokeContains(t,e,r,i=.5){const{x:s,y:n,width:o,height:a,radius:l}=this,h=r*(1-i),u=r-h,c=s+l,d=n+l,p=s+o,f=n+a;return(t>=s-h&&t<=s+u||t>=p-u&&t<=p+h)&&e>=d&&e<=d+(a-2*l)||(e>=n-h&&e<=n+u||e>=f-u&&e<=f+h)&&t>=c&&t<=c+(o-2*l)||(t<c&&e<d&&ql(t,e,c,d,l,u,h)||t>p-l&&e<d&&ql(t,e,p-l,d,l,u,h)||t>p-l&&e>f-l&&ql(t,e,p-l,f-l,l,u,h)||t<c&&e>f-l&&ql(t,e,c,f-l,l,u,h))}}const Ql=1.1920929e-7;function Zl(t,e,r,i,s,n,o,a,l,h){let u=(1-Math.min(.99,Math.max(0,null!=h?h:Qa.defaultOptions.bezierSmoothness)))/1;return u*=u,function(t,e,r,i,s,n,o,a,l,h){Jl(t,e,r,i,s,n,o,a,l,h,0),l.push(o,a)}(e,r,i,s,n,o,a,l,t,u),t}function Jl(t,e,r,i,s,n,o,a,l,h,u){if(u>8)return;Math.PI;const c=(t+r)/2,d=(e+i)/2,p=(r+s)/2,f=(i+n)/2,g=(s+o)/2,m=(n+a)/2,_=(c+p)/2,x=(d+f)/2,y=(p+g)/2,b=(f+m)/2,v=(_+y)/2,T=(x+b)/2;if(u>0){let u=o-t,c=a-e;const d=Math.abs((r-o)*c-(i-a)*u),p=Math.abs((s-o)*c-(n-a)*u);if(d>Ql&&p>Ql){if((d+p)*(d+p)<=h*(u*u+c*c))return void l.push(v,T)}else if(d>Ql){if(d*d<=h*(u*u+c*c))return void l.push(v,T)}else if(p>Ql){if(p*p<=h*(u*u+c*c))return void l.push(v,T)}else if(u=v-(t+o)/2,c=T-(e+a)/2,u*u+c*c<=h)return void l.push(v,T)}Jl(t,e,c,d,_,x,v,T,l,h,u+1),Jl(v,T,y,b,g,m,o,a,l,h,u+1)}function th(t,e,r,i,s,n,o,a){let l=(1-Math.min(.99,Math.max(0,null!=a?a:Qa.defaultOptions.bezierSmoothness)))/1;return l*=l,function(t,e,r,i,s,n,o,a){eh(o,t,e,r,i,s,n,a,0),o.push(s,n)}(e,r,i,s,n,o,t,l),t}function eh(t,e,r,i,s,n,o,a,l){if(l>8)return;Math.PI;const h=(e+i)/2,u=(r+s)/2,c=(i+n)/2,d=(s+o)/2,p=(h+c)/2,f=(u+d)/2;let g=n-e,m=o-r;const _=Math.abs((i-n)*m-(s-o)*g);if(_>1.1920929e-7){if(_*_<=a*(g*g+m*m))return void t.push(p,f)}else if(g=p-(e+n)/2,m=f-(r+o)/2,g*g+m*m<=a)return void t.push(p,f);eh(t,e,r,h,u,p,f,a,l+1),eh(t,p,f,c,d,n,o,a,l+1)}function rh(t,e,r,i,s,n,o,a){let l=Math.abs(s-n);(!o&&s>n||o&&n>s)&&(l=2*Math.PI-l),a||(a=Math.max(6,Math.floor(6*Math.pow(i,.3333333333333333)*(l/Math.PI))));let h=l/(a=Math.max(a,3)),u=s;h*=o?-1:1;for(let s=0;s<a+1;s++){const s=e+Math.cos(u)*i,n=r+Math.sin(u)*i;t.push(s,n),u+=h}}function ih(t,e,r,i,s,n){const o=t[t.length-2],a=t[t.length-1]-r,l=o-e,h=s-r,u=i-e,c=Math.abs(a*u-l*h);if(c<1e-8||0===n)return void((t[t.length-2]!==e||t[t.length-1]!==r)&&t.push(e,r));const d=a*a+l*l,p=h*h+u*u,f=a*h+l*u,g=n*Math.sqrt(d)/c,m=n*Math.sqrt(p)/c,_=g*f/d,x=m*f/p,y=g*u+m*l,b=g*h+m*a,v=l*(m+_),T=a*(m+_),S=u*(g+x),w=h*(g+x);rh(t,y+e,b+r,n,Math.atan2(T-b,v-y),Math.atan2(w-b,S-y),l*h>u*a)}const sh=2*Math.PI,nh={centerX:0,centerY:0,ang1:0,ang2:0},oh=({x:t,y:e},r,i,s,n,o,a,l)=>{const h=s*(t*=r)-n*(e*=i),u=n*t+s*e;return l.x=h+o,l.y=u+a,l};function ah(t,e){const r=-1.5707963267948966===e?-.551915024494:1.3333333333333333*Math.tan(e/4),i=1.5707963267948966===e?.551915024494:r,s=Math.cos(t),n=Math.sin(t),o=Math.cos(t+e),a=Math.sin(t+e);return[{x:s-n*i,y:n+s*i},{x:o+a*i,y:a-o*i},{x:o,y:a}]}const lh=(t,e,r,i)=>{let s=t*r+e*i;return s>1&&(s=1),s<-1&&(s=-1),(t*i-e*r<0?-1:1)*Math.acos(s)};function hh(t,e,r,i,s,n,o,a=0,l=0,h=0){if(0===n||0===o)return;const u=Math.sin(a*sh/360),c=Math.cos(a*sh/360),d=c*(e-i)/2+u*(r-s)/2,p=-u*(e-i)/2+c*(r-s)/2;if(0===d&&0===p)return;n=Math.abs(n),o=Math.abs(o);const f=Math.pow(d,2)/Math.pow(n,2)+Math.pow(p,2)/Math.pow(o,2);f>1&&(n*=Math.sqrt(f),o*=Math.sqrt(f)),((t,e,r,i,s,n,o,a,l,h,u,c,d)=>{const p=Math.pow(s,2),f=Math.pow(n,2),g=Math.pow(u,2),m=Math.pow(c,2);let _=p*f-p*m-f*g;_<0&&(_=0),_/=p*m+f*g,_=Math.sqrt(_)*(o===a?-1:1);const x=_*s/n*c,y=_*-n/s*u,b=h*x-l*y+(t+r)/2,v=l*x+h*y+(e+i)/2,T=(u-x)/s,S=(c-y)/n,w=(-u-x)/s,E=(-c-y)/n,A=lh(1,0,T,S);let P=lh(T,S,w,E);0===a&&P>0&&(P-=sh),1===a&&P<0&&(P+=sh),d.centerX=b,d.centerY=v,d.ang1=A,d.ang2=P})(e,r,i,s,n,o,l,h,u,c,d,p,nh);let{ang1:g,ang2:m}=nh;const{centerX:_,centerY:x}=nh;let y=Math.abs(m)/(sh/4);Math.abs(1-y)<1e-7&&(y=1);const b=Math.max(Math.ceil(y),1);m/=b;let v=t[t.length-2],T=t[t.length-1];const S={x:0,y:0};for(let e=0;e<b;e++){const e=ah(g,m),{x:r,y:i}=oh(e[0],n,o,c,u,_,x,S),{x:s,y:a}=oh(e[1],n,o,c,u,_,x,S),{x:l,y:h}=oh(e[2],n,o,c,u,_,x,S);Zl(t,v,T,r,i,s,a,l,h),v=l,T=h,g+=m}}function uh(t,e,r){var i;const s=(t,e)=>{const r=e.x-t.x,i=e.y-t.y,s=Math.sqrt(r*r+i*i);return{len:s,nx:r/s,ny:i/s}},n=(e,r)=>{0===e?t.moveTo(r.x,r.y):t.lineTo(r.x,r.y)};let o=e[e.length-1];for(let a=0;a<e.length;a++){const l=e[a%e.length],h=null!=(i=l.radius)?i:r;if(h<=0){n(a,l),o=l;continue}const u=e[(a+1)%e.length],c=s(l,o),d=s(l,u);if(c.len<1e-4||d.len<1e-4){n(a,l),o=l;continue}let p=Math.asin(c.nx*d.ny-c.ny*d.nx),f=1,g=!1;c.nx*d.nx-c.ny*-d.ny<0?p<0?p=Math.PI+p:(p=Math.PI-p,f=-1,g=!0):p>0&&(f=-1,g=!0);const m=p/2;let _,x=Math.abs(Math.cos(m)*h/Math.sin(m));x>Math.min(c.len/2,d.len/2)?(x=Math.min(c.len/2,d.len/2),_=Math.abs(x*Math.sin(m)/Math.cos(m))):_=h;const y=l.x+d.nx*x+-d.ny*_*f,b=l.y+d.ny*x+d.nx*_*f,v=Math.atan2(c.ny,c.nx)+Math.PI/2*f,T=Math.atan2(d.ny,d.nx)-Math.PI/2*f;0===a&&t.moveTo(y+Math.cos(v)*_,b+Math.sin(v)*_),t.arc(y,b,_,v,T,g),o=l}}function ch(t,e,r,i){var s;const n=(t,e)=>Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2),o=(t,e,r)=>({x:t.x+(e.x-t.x)*r,y:t.y+(e.y-t.y)*r}),a=e.length;for(let l=0;l<a;l++){const h=e[(l+1)%a],u=null!=(s=h.radius)?s:r;if(u<=0){0===l?t.moveTo(h.x,h.y):t.lineTo(h.x,h.y);continue}const c=e[l],d=e[(l+2)%a],p=n(c,h);let f;if(p<1e-4)f=h;else{f=o(h,c,Math.min(p/2,u)/p)}const g=n(d,h);let m;if(g<1e-4)m=h;else{m=o(h,d,Math.min(g/2,u)/g)}0===l?t.moveTo(f.x,f.y):t.lineTo(f.x,f.y),t.quadraticCurveTo(h.x,h.y,m.x,m.y,i)}}const dh=new Rt;class ph{constructor(t){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new Ot,this._graphicsPath2D=t,this.signed=t.checkForHoles}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();const r=this._currentPoly.points,i=r[r.length-2],s=r[r.length-1];return(i!==t||s!==e)&&r.push(t,e),this}arc(t,e,r,i,s,n){this._ensurePoly(!1);return rh(this._currentPoly.points,t,e,r,i,s,n),this}arcTo(t,e,r,i,s){this._ensurePoly();return ih(this._currentPoly.points,t,e,r,i,s),this}arcToSvg(t,e,r,i,s,n,o){return hh(this._currentPoly.points,this._currentPoly.lastX,this._currentPoly.lastY,n,o,t,e,r,i,s),this}bezierCurveTo(t,e,r,i,s,n,o){this._ensurePoly();const a=this._currentPoly;return Zl(this._currentPoly.points,a.lastX,a.lastY,t,e,r,i,s,n,o),this}quadraticCurveTo(t,e,r,i,s){this._ensurePoly();const n=this._currentPoly;return th(this._currentPoly.points,n.lastX,n.lastY,t,e,r,i,s),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0)).transform(e);const r=this.shapePrimitives,i=r.length;for(let e=0;e<t.instructions.length;e++){const r=t.instructions[e];this[r.action](...r.data)}if(t.checkForHoles&&r.length-i>1){let t=null;for(let e=i;e<r.length;e++){const i=r[e];if("polygon"===i.shape.type){const s=i.shape,n=null==t?void 0:t.shape;n&&n.containsPolygon(s)?(t.holes||(t.holes=[]),t.holes.push(i),r.copyWithin(e,e+1),r.length--,e--):t=i}}}return this}finish(t=!1){this.endPoly(t)}rect(t,e,r,i,s){return this.drawShape(new Rt(t,e,r,i),s),this}circle(t,e,r,i){return this.drawShape(new Vl(t,e,r),i),this}poly(t,e,r){const i=new Yl(t);return i.closePath=e,this.drawShape(i,r),this}regularPoly(t,e,r,i,s=0,n){i=Math.max(0|i,3);const o=-1*Math.PI/2+s,a=2*Math.PI/i,l=[];for(let s=0;s<i;s++){const i=o-s*a;l.push(t+r*Math.cos(i),e+r*Math.sin(i))}return this.poly(l,!0,n),this}roundPoly(t,e,r,i,s,n=0,o){if(i=Math.max(0|i,3),s<=0)return this.regularPoly(t,e,r,i,n);const a=r*Math.sin(Math.PI/i)-.001;s=Math.min(s,a);const l=-1*Math.PI/2+n,h=2*Math.PI/i,u=(i-2)*Math.PI/i/2;for(let n=0;n<i;n++){const i=n*h+l,a=t+r*Math.cos(i),c=e+r*Math.sin(i),d=i+Math.PI+u,p=i-Math.PI-u,f=a+s*Math.cos(d),g=c+s*Math.sin(d),m=a+s*Math.cos(p),_=c+s*Math.sin(p);0===n?this.moveTo(f,g):this.lineTo(f,g),this.quadraticCurveTo(a,c,m,_,o)}return this.closePath()}roundShape(t,e,r=!1,i){return t.length<3?this:(r?ch(this,t,e,i):uh(this,t,e),this.closePath())}filletRect(t,e,r,i,s){if(0===s)return this.rect(t,e,r,i);const n=Math.min(r,i)/2,o=Math.min(n,Math.max(-n,s)),a=t+r,l=e+i,h=o<0?-o:0,u=Math.abs(o);return this.moveTo(t,e+u).arcTo(t+h,e+h,t+u,e,u).lineTo(a-u,e).arcTo(a-h,e+h,a,e+u,u).lineTo(a,l-u).arcTo(a-h,l-h,t+r-u,l,u).lineTo(t+u,l).arcTo(t+h,l-h,t,l-u,u).closePath()}chamferRect(t,e,r,i,s,n){if(s<=0)return this.rect(t,e,r,i);const o=Math.min(s,Math.min(r,i)/2),a=t+r,l=e+i,h=[t+o,e,a-o,e,a,e+o,a,l-o,a-o,l,t+o,l,t,l-o,t,e+o];for(let t=h.length-1;t>=2;t-=2)h[t]===h[t-2]&&h[t-1]===h[t-3]&&h.splice(t-1,2);return this.poly(h,!0,n)}ellipse(t,e,r,i,s){return this.drawShape(new Wl(t,e,r,i),s),this}roundRect(t,e,r,i,s,n){return this.drawShape(new Kl(t,e,r,i,s),n),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){let r=this._currentPoly;return r&&this.endPoly(),r=new Yl,r.points.push(t,e),this._currentPoly=r,this}endPoly(t=!1){const e=this._currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this._currentPoly=null,this}_ensurePoly(t=!0){if(!this._currentPoly&&(this._currentPoly=new Yl,t)){const t=this.shapePrimitives[this.shapePrimitives.length-1];if(t){let e=t.shape.x,r=t.shape.y;if(t.transform&&!t.transform.isIdentity()){const i=t.transform,s=e;e=i.a*e+i.c*r+i.tx,r=i.b*s+i.d*r+i.ty}this._currentPoly.points.push(e,r)}else this._currentPoly.points.push(0,0)}}buildPath(){const t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let e=0;e<t.instructions.length;e++){const r=t.instructions[e];this[r.action](...r.data)}this.finish()}get bounds(){const t=this._bounds;t.clear();const e=this.shapePrimitives;for(let r=0;r<e.length;r++){const i=e[r],s=i.shape.getBounds(dh);i.transform?t.addRect(s,i.transform):t.addRect(s)}return t}}class fh{constructor(t,e=!1){var r;this.instructions=[],this.uid=ht("graphicsPath"),this._dirty=!0,this.checkForHoles=e,"string"==typeof t?jl(t,this):this.instructions=null!=(r=null==t?void 0:t.slice())?r:[]}get shapePath(){return this._shapePath||(this._shapePath=new ph(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this._dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this._dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this._dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this._dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this._dirty=!0,this}bezierCurveToShort(t,e,r,i,s){const n=this.instructions[this.instructions.length-1],o=this.getLastPoint(rt.shared);let a=0,l=0;if(n&&"bezierCurveTo"===n.action){a=n.data[2],l=n.data[3];const t=o.x,e=o.y;a=t+(t-a),l=e+(e-l)}else a=o.x,l=o.y;return this.instructions.push({action:"bezierCurveTo",data:[a,l,t,e,r,i,s]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this._dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this._dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this._dirty=!0,this}quadraticCurveToShort(t,e,r){const i=this.instructions[this.instructions.length-1],s=this.getLastPoint(rt.shared);let n=0,o=0;if(i&&"quadraticCurveTo"===i.action){n=i.data[0],o=i.data[1];const t=s.x,e=s.y;n=t+(t-n),o=e+(e-o)}else n=s.x,o=s.y;return this.instructions.push({action:"quadraticCurveTo",data:[n,o,t,e,r]}),this._dirty=!0,this}rect(t,e,r,i,s){return this.instructions.push({action:"rect",data:[t,e,r,i,s]}),this._dirty=!0,this}circle(t,e,r,i){return this.instructions.push({action:"circle",data:[t,e,r,i]}),this._dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this._dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this._dirty=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this._dirty=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this._dirty=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this._dirty=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this._dirty=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this._dirty=!0,this}star(t,e,r,i,s,n,o){s||(s=i/2);const a=-1*Math.PI/2+n,l=2*r,h=2*Math.PI/l,u=[];for(let r=0;r<l;r++){const n=r%2?s:i,o=r*h+a;u.push(t+n*Math.cos(o),e+n*Math.sin(o))}return this.poly(u,!0,o),this}clone(t=!1){const e=new fh;if(e.checkForHoles=this.checkForHoles,t)for(let t=0;t<this.instructions.length;t++){const r=this.instructions[t];e.instructions.push({action:r.action,data:r.data.slice()})}else e.instructions=this.instructions.slice();return e}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(t){if(t.isIdentity())return this;const e=t.a,r=t.b,i=t.c,s=t.d,n=t.tx,o=t.ty;let a=0,l=0,h=0,u=0,c=0,d=0,p=0,f=0;for(let g=0;g<this.instructions.length;g++){const m=this.instructions[g],_=m.data;switch(m.action){case"moveTo":case"lineTo":a=_[0],l=_[1],_[0]=e*a+i*l+n,_[1]=r*a+s*l+o;break;case"bezierCurveTo":h=_[0],u=_[1],c=_[2],d=_[3],a=_[4],l=_[5],_[0]=e*h+i*u+n,_[1]=r*h+s*u+o,_[2]=e*c+i*d+n,_[3]=r*c+s*d+o,_[4]=e*a+i*l+n,_[5]=r*a+s*l+o;break;case"quadraticCurveTo":h=_[0],u=_[1],a=_[2],l=_[3],_[0]=e*h+i*u+n,_[1]=r*h+s*u+o,_[2]=e*a+i*l+n,_[3]=r*a+s*l+o;break;case"arcToSvg":a=_[5],l=_[6],p=_[0],f=_[1],_[0]=e*p+i*f,_[1]=r*p+s*f,_[5]=e*a+i*l+n,_[6]=r*a+s*l+o;break;case"circle":_[4]=gh(_[3],t);break;case"rect":_[4]=gh(_[4],t);break;case"ellipse":_[8]=gh(_[8],t);break;case"roundRect":_[5]=gh(_[5],t);break;case"addPath":_[0].transform(t);break;case"poly":_[2]=gh(_[2],t)}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let e=this.instructions.length-1,r=this.instructions[e];if(!r)return t.x=0,t.y=0,t;for(;"closePath"===r.action;){if(e--,e<0)return t.x=0,t.y=0,t;r=this.instructions[e]}switch(r.action){case"moveTo":case"lineTo":t.x=r.data[0],t.y=r.data[1];break;case"quadraticCurveTo":t.x=r.data[2],t.y=r.data[3];break;case"bezierCurveTo":t.x=r.data[4],t.y=r.data[5];break;case"arc":case"arcToSvg":t.x=r.data[5],t.y=r.data[6];break;case"addPath":r.data[0].getLastPoint(t)}return t}}function gh(t,e){return t?t.prepend(e):e.clone()}let mh=0;function _h(...t){500!==mh&&(mh++,500===mh?console.warn("PixiJS Warning: too many warnings, no more warnings will be reported to the console by PixiJS."):console.warn("PixiJS Warning: ",...t))}function xh(t,e,r){const i=t.getAttribute(e);return i?Number(i):r}function yh(t,e){const r=t.querySelectorAll("defs");for(let t=0;t<r.length;t++){const i=r[t];for(let t=0;t<i.children.length;t++){const r=i.children[t];switch(r.nodeName.toLowerCase()){case"lineargradient":e.defs[r.id]=bh(r);break;case"radialgradient":e.defs[r.id]=vh(r)}}}}function bh(t){const e=xh(t,"x1",0),r=xh(t,"y1",0),i=xh(t,"x2",1),s=xh(t,"y2",0),n=t.getAttribute("gradientUnits")||"objectBoundingBox",o=new kl(e,r,i,s,"objectBoundingBox"===n?"local":"global");for(let e=0;e<t.children.length;e++){const r=t.children[e],i=xh(r,"offset",0),s=Q.shared.setValue(r.getAttribute("stop-color")).toNumber();o.addColorStop(i,s)}return o}function vh(t){return new kl(0,0,1,0)}function Th(t){const e=t.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return e?e[1]:""}const Sh={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function wh(t,e){const r=t.getAttribute("style"),i={},s={},n={strokeStyle:i,fillStyle:s,useFill:!1,useStroke:!1};for(const r in Sh){const i=t.getAttribute(r);i&&Eh(e,n,r,i.trim())}if(r){const t=r.split(";");for(let r=0;r<t.length;r++){const i=t[r].trim(),[s,o]=i.split(":");Sh[s]&&Eh(e,n,s,o.trim())}}return{strokeStyle:n.useStroke?i:null,fillStyle:n.useFill?s:null,useFill:n.useFill,useStroke:n.useStroke}}function Eh(t,e,r,i){switch(r){case"stroke":if("none"!==i){if(i.startsWith("url(")){const r=Th(i);e.strokeStyle.fill=t.defs[r]}else e.strokeStyle.color=Q.shared.setValue(i).toNumber();e.useStroke=!0}break;case"stroke-width":e.strokeStyle.width=Number(i);break;case"fill":if("none"!==i){if(i.startsWith("url(")){const r=Th(i);e.fillStyle.fill=t.defs[r]}else e.fillStyle.color=Q.shared.setValue(i).toNumber();e.useFill=!0}break;case"fill-opacity":e.fillStyle.alpha=Number(i);break;case"stroke-opacity":e.strokeStyle.alpha=Number(i);break;case"opacity":e.fillStyle.alpha=Number(i),e.strokeStyle.alpha=Number(i)}}var Ah=Object.defineProperty,Ph=Object.getOwnPropertySymbols,Mh=Object.prototype.hasOwnProperty,Rh=Object.prototype.propertyIsEnumerable,Ch=(t,e,r)=>e in t?Ah(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Oh=(t,e)=>{for(var r in e||(e={}))Mh.call(e,r)&&Ch(t,r,e[r]);if(Ph)for(var r of Ph(e))Rh.call(e,r)&&Ch(t,r,e[r]);return t};function Ih(t,e){if("string"==typeof t){const e=document.createElement("div");e.innerHTML=t.trim(),t=e.querySelector("svg")}const r={context:e,defs:{},path:new fh};yh(t,r);const i=t.children,{fillStyle:s,strokeStyle:n}=wh(t,r);for(let t=0;t<i.length;t++){const e=i[t];"defs"!==e.nodeName.toLowerCase()&&Bh(e,r,s,n)}return e}function Bh(t,e,r,i){const s=t.children,{fillStyle:n,strokeStyle:o}=wh(t,e);n&&r?r=Oh(Oh({},r),n):n&&(r=n),o&&i?i=Oh(Oh({},i),o):o&&(i=o);const a=!r&&!i;let l,h,u,c,d,p,f,g,m,_,x,y,b,v,T,S,w;switch(a&&(r={color:0}),t.nodeName.toLowerCase()){case"path":v=t.getAttribute("d"),t.getAttribute("fill-rule"),T=new fh(v,!0),e.context.path(T),r&&e.context.fill(r),i&&e.context.stroke(i);break;case"circle":f=xh(t,"cx",0),g=xh(t,"cy",0),m=xh(t,"r",0),e.context.ellipse(f,g,m,m),r&&e.context.fill(r),i&&e.context.stroke(i);break;case"rect":l=xh(t,"x",0),h=xh(t,"y",0),S=xh(t,"width",0),w=xh(t,"height",0),_=xh(t,"rx",0),x=xh(t,"ry",0),_||x?e.context.roundRect(l,h,S,w,_||x):e.context.rect(l,h,S,w),r&&e.context.fill(r),i&&e.context.stroke(i);break;case"ellipse":f=xh(t,"cx",0),g=xh(t,"cy",0),_=xh(t,"rx",0),x=xh(t,"ry",0),e.context.beginPath(),e.context.ellipse(f,g,_,x),r&&e.context.fill(r),i&&e.context.stroke(i);break;case"line":u=xh(t,"x1",0),c=xh(t,"y1",0),d=xh(t,"x2",0),p=xh(t,"y2",0),e.context.beginPath(),e.context.moveTo(u,c),e.context.lineTo(d,p),i&&e.context.stroke(i);break;case"polygon":b=t.getAttribute("points"),y=b.match(/\d+/g).map((t=>parseInt(t,10))),e.context.poly(y,!0),r&&e.context.fill(r),i&&e.context.stroke(i);break;case"polyline":b=t.getAttribute("points"),y=b.match(/\d+/g).map((t=>parseInt(t,10))),e.context.poly(y,!1),i&&e.context.stroke(i);break;case"g":case"svg":break;default:_h(`[SVG parser] <${t.nodeName}> elements unsupported`)}a&&(r=null);for(let t=0;t<s.length;t++)Bh(s[t],e,r,i)}var kh=Object.defineProperty,Gh=Object.getOwnPropertySymbols,Dh=Object.prototype.hasOwnProperty,Fh=Object.prototype.propertyIsEnumerable,Nh=(t,e,r)=>e in t?kh(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Uh=(t,e)=>{for(var r in e||(e={}))Dh.call(e,r)&&Nh(t,r,e[r]);if(Gh)for(var r of Gh(e))Fh.call(e,r)&&Nh(t,r,e[r]);return t};function Lh(t){return t instanceof Nl}function zh(t){return t instanceof kl}function Xh(t,e,r){return t.fill=e,t.color=16777215,t.texture=e.texture,t.matrix=e.transform,Uh(Uh({},r),t)}function Hh(t,e,r){return e.buildGradient(),t.fill=e,t.color=16777215,t.texture=e.texture,t.matrix=e.transform,t.textureSpace=e.textureSpace,Uh(Uh({},r),t)}function jh(t,e){if(null==t)return null;const r={},i=t;return function(t){return Q.isColorLike(t)}(t)?function(t,e,r){const i=Q.shared.setValue(null!=e?e:0);return t.color=i.toNumber(),t.alpha=1===i.alpha?r.alpha:i.alpha,t.texture=Ue.WHITE,Uh(Uh({},r),t)}(r,t,e):function(t){return t instanceof Ue}(t)?function(t,e,r){return t.texture=e,Uh(Uh({},r),t)}(r,t,e):Lh(t)?Xh(r,t,e):zh(t)?Hh(r,t,e):i.fill&&Lh(i.fill)?Xh(i,i.fill,e):i.fill&&zh(i.fill)?Hh(i,i.fill,e):function(t,e){const r=Uh(Uh({},e),t),i=Q.shared.setValue(r.color);return r.alpha*=i.alpha,r.color=i.toNumber(),r}(i,e)}function Vh(t,e){const r=e,{width:i,alignment:s,miterLimit:n,cap:o,join:a,pixelLine:l}=r,h=((t,e)=>{var r={};for(var i in t)Dh.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&Gh)for(var i of Gh(t))e.indexOf(i)<0&&Fh.call(t,i)&&(r[i]=t[i]);return r})(r,["width","alignment","miterLimit","cap","join","pixelLine"]),u=jh(t,h);return u?Uh({width:i,alignment:s,miterLimit:n,cap:o,join:a,pixelLine:l},u):null}var Wh=Object.defineProperty,$h=Object.getOwnPropertySymbols,Yh=Object.prototype.hasOwnProperty,qh=Object.prototype.propertyIsEnumerable,Kh=(t,e,r)=>e in t?Wh(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Qh=(t,e)=>{for(var r in e||(e={}))Yh.call(e,r)&&Kh(t,r,e[r]);if($h)for(var r of $h(e))qh.call(e,r)&&Kh(t,r,e[r]);return t};const Zh=new rt,Jh=new st,tu=class t extends m{constructor(){super(...arguments),this.uid=ht("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new fh,this._transform=new st,this._fillStyle=Qh({},t.defaultFillStyle),this._strokeStyle=Qh({},t.defaultStrokeStyle),this._stateStack=[],this._tick=0,this._bounds=new Ot,this._boundsDirty=!0}clone(){const e=new t;return e.batchMode=this.batchMode,e.instructions=this.instructions.slice(),e._activePath=this._activePath.clone(),e._transform=this._transform.clone(),e._fillStyle=Qh({},this._fillStyle),e._strokeStyle=Qh({},this._strokeStyle),e._stateStack=this._stateStack.slice(),e._bounds=this._bounds.clone(),e._boundsDirty=!0,e}get fillStyle(){return this._fillStyle}set fillStyle(e){this._fillStyle=jh(e,t.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(e){this._strokeStyle=Vh(e,t.defaultStrokeStyle)}setFillStyle(e){return this._fillStyle=jh(e,t.defaultFillStyle),this}setStrokeStyle(e){return this._strokeStyle=jh(e,t.defaultStrokeStyle),this}texture(t,e,r,i,s,n){return this.instructions.push({action:"texture",data:{image:t,dx:r||0,dy:i||0,dw:s||t.frame.width,dh:n||t.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:e?Q.shared.setValue(e).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new fh,this}fill(e,r){let i;const s=this.instructions[this.instructions.length-1];return i=0===this._tick&&s&&"stroke"===s.action?s.data.path:this._activePath.clone(),i?(null!=e&&(void 0!==r&&"number"==typeof e&&(e={color:e,alpha:r}),this._fillStyle=jh(e,t.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:i}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:t,y:e}=this._activePath.getLastPoint(rt.shared);this._activePath.clear(),this._activePath.moveTo(t,e)}stroke(e){let r;const i=this.instructions[this.instructions.length-1];return r=0===this._tick&&i&&"fill"===i.action?i.data.path:this._activePath.clone(),r?(null!=e&&(this._strokeStyle=Vh(e,t.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:r}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let t=0;t<2;t++){const e=this.instructions[this.instructions.length-1-t],r=this._activePath.clone();if(e&&("stroke"===e.action||"fill"===e.action)){if(!e.data.hole){e.data.hole=r;break}e.data.hole.addPath(r)}}return this._initNextPathLocation(),this}arc(t,e,r,i,s,n){this._tick++;const o=this._transform;return this._activePath.arc(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,r,i,s,n),this}arcTo(t,e,r,i,s){this._tick++;const n=this._transform;return this._activePath.arcTo(n.a*t+n.c*e+n.tx,n.b*t+n.d*e+n.ty,n.a*r+n.c*i+n.tx,n.b*r+n.d*i+n.ty,s),this}arcToSvg(t,e,r,i,s,n,o){this._tick++;const a=this._transform;return this._activePath.arcToSvg(t,e,r,i,s,a.a*n+a.c*o+a.tx,a.b*n+a.d*o+a.ty),this}bezierCurveTo(t,e,r,i,s,n,o){this._tick++;const a=this._transform;return this._activePath.bezierCurveTo(a.a*t+a.c*e+a.tx,a.b*t+a.d*e+a.ty,a.a*r+a.c*i+a.tx,a.b*r+a.d*i+a.ty,a.a*s+a.c*n+a.tx,a.b*s+a.d*n+a.ty,o),this}closePath(){var t;return this._tick++,null==(t=this._activePath)||t.closePath(),this}ellipse(t,e,r,i){return this._tick++,this._activePath.ellipse(t,e,r,i,this._transform.clone()),this}circle(t,e,r){return this._tick++,this._activePath.circle(t,e,r,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;const r=this._transform;return this._activePath.lineTo(r.a*t+r.c*e+r.tx,r.b*t+r.d*e+r.ty),this}moveTo(t,e){this._tick++;const r=this._transform,i=this._activePath.instructions,s=r.a*t+r.c*e+r.tx,n=r.b*t+r.d*e+r.ty;return 1===i.length&&"moveTo"===i[0].action?(i[0].data[0]=s,i[0].data[1]=n,this):(this._activePath.moveTo(s,n),this)}quadraticCurveTo(t,e,r,i,s){this._tick++;const n=this._transform;return this._activePath.quadraticCurveTo(n.a*t+n.c*e+n.tx,n.b*t+n.d*e+n.ty,n.a*r+n.c*i+n.tx,n.b*r+n.d*i+n.ty,s),this}rect(t,e,r,i){return this._tick++,this._activePath.rect(t,e,r,i,this._transform.clone()),this}roundRect(t,e,r,i,s){return this._tick++,this._activePath.roundRect(t,e,r,i,s,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}regularPoly(t,e,r,i,s=0,n){return this._tick++,this._activePath.regularPoly(t,e,r,i,s,n),this}roundPoly(t,e,r,i,s,n){return this._tick++,this._activePath.roundPoly(t,e,r,i,s,n),this}roundShape(t,e,r,i){return this._tick++,this._activePath.roundShape(t,e,r,i),this}filletRect(t,e,r,i,s){return this._tick++,this._activePath.filletRect(t,e,r,i,s),this}chamferRect(t,e,r,i,s,n){return this._tick++,this._activePath.chamferRect(t,e,r,i,s,n),this}star(t,e,r,i,s=0,n=0){return this._tick++,this._activePath.star(t,e,r,i,s,n,this._transform.clone()),this}svg(t){return this._tick++,Ih(t,this),this}restore(){const t=this._stateStack.pop();return t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:Qh({},this._fillStyle),strokeStyle:Qh({},this._strokeStyle)}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,e=t){return this._transform.scale(t,e),this}setTransform(t,e,r,i,s,n){return t instanceof st?(this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this._transform.set(t,e,r,i,s,n),this)}transform(t,e,r,i,s,n){return t instanceof st?(this._transform.append(t),this):(Jh.set(t,e,r,i,s,n),this._transform.append(Jh),this)}translate(t,e=t){return this._transform.translate(t,e),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this.dirty||(this.emit("update",this,16),this.dirty=!0,this._boundsDirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;const t=this._bounds;t.clear();for(let e=0;e<this.instructions.length;e++){const r=this.instructions[e],i=r.action;if("fill"===i){const e=r.data;t.addBounds(e.path.bounds)}else if("texture"===i){const e=r.data;t.addFrame(e.dx,e.dy,e.dx+e.dw,e.dy+e.dh,e.transform)}if("stroke"===i){const e=r.data,i=e.style.alignment,s=e.style.width*(1-i),n=e.path.bounds;t.addFrame(n.minX-s,n.minY-s,n.maxX+s,n.maxY+s)}}return t}containsPoint(t){var e;if(!this.bounds.containsPoint(t.x,t.y))return!1;const r=this.instructions;let i=!1;for(let s=0;s<r.length;s++){const n=r[s],o=n.data,a=o.path;if(!n.action||!a)continue;const l=o.style,h=a.shapePath.shapePrimitives;for(let r=0;r<h.length;r++){const s=h[r].shape;if(!l||!s)continue;const a=h[r].transform,u=a?a.applyInverse(t,Zh):t;if("fill"===n.action)i=s.contains(u.x,u.y);else{const t=l;i=s.strokeContains(u.x,u.y,t.width,t.alignment)}const c=o.hole;if(c){const t=null==(e=c.shapePath)?void 0:e.shapePrimitives;if(t)for(let e=0;e<t.length;e++)t[e].shape.contains(u.x,u.y)&&(i=!1)}if(i)return!0}}return i}destroy(t=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),"boolean"==typeof t?t:null==t?void 0:t.texture){const e="boolean"==typeof t?t:null==t?void 0:t.textureSource;this._fillStyle.texture&&this._fillStyle.texture.destroy(e),this._strokeStyle.texture&&this._strokeStyle.texture.destroy(e)}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};tu.defaultFillStyle={color:16777215,alpha:1,texture:Ue.WHITE,matrix:null,fill:null,textureSpace:"local"},tu.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:Ue.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let eu=tu;const ru=["align","breakWords","cssOverrides","fontVariant","fontWeight","leading","letterSpacing","lineHeight","padding","textBaseline","trim","whiteSpace","wordWrap","wordWrapWidth","fontFamily","fontStyle","fontSize"];function iu(t){const e=[];let r=0;for(let i=0;i<ru.length;i++){const s=`_${ru[i]}`;e[r++]=t[s]}return r=su(t._fill,e,r),r=function(t,e,r){return t&&(r=su(t,e,r),e[r++]=t.width,e[r++]=t.alignment,e[r++]=t.cap,e[r++]=t.join,e[r++]=t.miterLimit),r}(t._stroke,e,r),r=function(t,e,r){return t&&(e[r++]=t.alpha,e[r++]=t.angle,e[r++]=t.blur,e[r++]=t.distance,e[r++]=Q.shared.setValue(t.color).toNumber()),r}(t.dropShadow,e,r),e.join("-")}function su(t,e,r){var i;return t&&(e[r++]=t.color,e[r++]=t.alpha,e[r++]=null==(i=t.fill)?void 0:i.styleKey),r}var nu=Object.defineProperty,ou=Object.defineProperties,au=Object.getOwnPropertyDescriptors,lu=Object.getOwnPropertySymbols,hu=Object.prototype.hasOwnProperty,uu=Object.prototype.propertyIsEnumerable,cu=(t,e,r)=>e in t?nu(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,du=(t,e)=>{for(var r in e||(e={}))hu.call(e,r)&&cu(t,r,e[r]);if(lu)for(var r of lu(e))uu.call(e,r)&&cu(t,r,e[r]);return t};const pu=class t extends m{constructor(e={}){super(),function(t){var e,r,i,s,n;const o=t;if("boolean"==typeof o.dropShadow&&o.dropShadow){const a=fu.defaultDropShadow;t.dropShadow={alpha:null!=(e=o.dropShadowAlpha)?e:a.alpha,angle:null!=(r=o.dropShadowAngle)?r:a.angle,blur:null!=(i=o.dropShadowBlur)?i:a.blur,color:null!=(s=o.dropShadowColor)?s:a.color,distance:null!=(n=o.dropShadowDistance)?n:a.distance}}if(void 0!==o.strokeThickness){const e=o.stroke;let r={};if(Q.isColorLike(e))r.color=e;else if(e instanceof kl||e instanceof Nl)r.fill=e;else{if(!Object.hasOwnProperty.call(e,"color")&&!Object.hasOwnProperty.call(e,"fill"))throw new Error("Invalid stroke value.");r=e}t.stroke=((t,e)=>ou(t,au(e)))(du({},r),{width:o.strokeThickness})}if(Array.isArray(o.fillGradientStops)){let e;null==t.fontSize?t.fontSize=fu.defaultTextStyle.fontSize:e="string"==typeof t.fontSize?parseInt(t.fontSize,10):t.fontSize;const r=new kl({start:{x:0,y:0},end:{x:0,y:1.7*(e||0)}}),i=o.fillGradientStops.map((t=>Q.shared.setValue(t).toNumber()));i.forEach(((t,e)=>{const s=e/(i.length-1);r.addColorStop(s,t)})),t.fill={fill:r}}}(e);const r=du(du({},t.defaultTextStyle),e);for(const t in r){this[t]=r[t]}this.update()}get align(){return this._align}set align(t){this._align=t,this.update()}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords=t,this.update()}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow=null!==e&&"object"==typeof e?this._createProxy(du(du({},t.defaultDropShadow),e)):e?this._createProxy(du({},t.defaultDropShadow)):null,this.update()}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t,this.update()}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize="string"==typeof t?parseInt(t,10):t,this.update()}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t.toLowerCase(),this.update()}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t,this.update()}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t,this.update()}get leading(){return this._leading}set leading(t){this._leading=t,this.update()}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing=t,this.update()}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.update()}get padding(){return this._padding}set padding(t){this._padding=t,this.update()}get trim(){return this._trim}set trim(t){this._trim=t,this.update()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.update()}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace=t,this.update()}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap=t,this.update()}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth=t,this.update()}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._isFillStyle(t)&&(this._originalFill=this._createProxy(du(du({},eu.defaultFillStyle),t),(()=>{this._fill=jh(du({},this._originalFill),eu.defaultFillStyle)}))),this._fill=jh(0===t?"black":t,eu.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._isFillStyle(t)&&(this._originalStroke=this._createProxy(du(du({},eu.defaultStrokeStyle),t),(()=>{this._stroke=Vh(du({},this._originalStroke),eu.defaultStrokeStyle)}))),this._stroke=Vh(t,eu.defaultStrokeStyle),this.update())}_generateKey(){return this._styleKey=iu(this),this._styleKey}update(){this._styleKey=null,this.emit("update",this)}reset(){const e=t.defaultTextStyle;for(const t in e)this[t]=e[t]}get styleKey(){return this._styleKey||this._generateKey()}clone(){return new t({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?du({},this._dropShadow):null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth})}destroy(t=!1){var e,r,i,s;if(this.removeAllListeners(),"boolean"==typeof t?t:null==t?void 0:t.texture){const n="boolean"==typeof t?t:null==t?void 0:t.textureSource;null!=(e=this._fill)&&e.texture&&this._fill.texture.destroy(n),null!=(r=this._originalFill)&&r.texture&&this._originalFill.texture.destroy(n),null!=(i=this._stroke)&&i.texture&&this._stroke.texture.destroy(n),null!=(s=this._originalStroke)&&s.texture&&this._originalStroke.texture.destroy(n)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(t,e){return new Proxy(t,{set:(t,r,i)=>(t[r]=i,null==e||e(r,i),this.update(),!0)})}_isFillStyle(t){return null!==(null!=t?t:null)&&!(Q.isColorLike(t)||t instanceof kl||t instanceof Nl)}};pu.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5},pu.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let fu=pu;const gu=new Ot;function mu(t,e,r,i){const s=gu;s.minX=0,s.minY=0,s.maxX=t.width/i|0,s.maxY=t.height/i|0;const n=qe.getOptimalTexture(s.width,s.height,i,!1);return n.source.uploadMethodId="image",n.source.resource=t,n.source.alphaMode="premultiply-alpha-on-upload",n.frame.width=e/i,n.frame.height=r/i,n.source.emit("update",n.source),n.updateUvs(),n}const _u=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function xu(t){const e="number"==typeof t.fontSize?`${t.fontSize}px`:t.fontSize;let r=t.fontFamily;Array.isArray(t.fontFamily)||(r=t.fontFamily.split(","));for(let t=r.length-1;t>=0;t--){let e=r[t].trim();!/([\"\'])[^\'\"]+\1/.test(e)&&!_u.includes(e)&&(e=`"${e}"`),r[t]=e}return`${t.fontStyle} ${t.fontVariant} ${t.fontWeight} ${e} ${r.join(",")}`}const yu={willReadFrequently:!0},bu=class t{static get experimentalLetterSpacingSupported(){let e=t._experimentalLetterSpacingSupported;if(void 0!==e){const r=ri.get().getCanvasRenderingContext2D().prototype;e=t._experimentalLetterSpacingSupported="letterSpacing"in r||"textLetterSpacing"in r}return e}constructor(t,e,r,i,s,n,o,a,l){this.text=t,this.style=e,this.width=r,this.height=i,this.lines=s,this.lineWidths=n,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=l}static measureText(e=" ",r,i=t._canvas,s=r.wordWrap){var n;const o=`${e}:${r.styleKey}`;if(t._measurementCache[o])return t._measurementCache[o];const a=xu(r),l=t.measureFont(a);0===l.fontSize&&(l.fontSize=r.fontSize,l.ascent=r.fontSize);const h=t.__context;h.font=a;const u=(s?t._wordWrap(e,r,i):e).split(/(?:\r\n|\r|\n)/),c=new Array(u.length);let d=0;for(let e=0;e<u.length;e++){const i=t._measureText(u[e],r.letterSpacing,h);c[e]=i,d=Math.max(d,i)}const p=(null==(n=r._stroke)?void 0:n.width)||0;let f=d+p;r.dropShadow&&(f+=r.dropShadow.distance);const g=r.lineHeight||l.fontSize;let m=Math.max(g,l.fontSize+p)+(u.length-1)*(g+r.leading);return r.dropShadow&&(m+=r.dropShadow.distance),new t(e,r,f,m,u,c,g+r.leading,d,l)}static _measureText(e,r,i){let s=!1;t.experimentalLetterSpacingSupported&&(t.experimentalLetterSpacing?(i.letterSpacing=`${r}px`,i.textLetterSpacing=`${r}px`,s=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));const n=i.measureText(e);let o=n.width;const a=-n.actualBoundingBoxLeft;let l=n.actualBoundingBoxRight-a;if(o>0)if(s)o-=r,l-=r;else{const i=(t.graphemeSegmenter(e).length-1)*r;o+=i,l+=i}return Math.max(o,l)}static _wordWrap(e,r,i=t._canvas){const s=i.getContext("2d",yu);let n=0,o="",a="";const l=Object.create(null),{letterSpacing:h,whiteSpace:u}=r,c=t._collapseSpaces(u),d=t._collapseNewlines(u);let p=!c;const f=r.wordWrapWidth+h,g=t._tokenize(e);for(let e=0;e<g.length;e++){let i=g[e];if(t._isNewline(i)){if(!d){a+=t._addLine(o),p=!c,o="",n=0;continue}i=" "}if(c){const e=t.isBreakingSpace(i),r=t.isBreakingSpace(o[o.length-1]);if(e&&r)continue}const u=t._getFromCache(i,h,l,s);if(u>f)if(""!==o&&(a+=t._addLine(o),o="",n=0),t.canBreakWords(i,r.breakWords)){const e=t.wordWrapSplit(i);for(let u=0;u<e.length;u++){let c=e[u],d=c,g=1;for(;e[u+g];){const s=e[u+g];if(t.canBreakChars(d,s,i,u,r.breakWords))break;c+=s,d=s,g++}u+=g-1;const m=t._getFromCache(c,h,l,s);m+n>f&&(a+=t._addLine(o),p=!1,o="",n=0),o+=c,n+=m}}else{o.length>0&&(a+=t._addLine(o),o="",n=0);const r=e===g.length-1;a+=t._addLine(i,!r),p=!1,o="",n=0}else u+n>f&&(p=!1,a+=t._addLine(o),o="",n=0),(o.length>0||!t.isBreakingSpace(i)||p)&&(o+=i,n+=u)}return a+=t._addLine(o,!1),a}static _addLine(e,r=!0){return e=t._trimRight(e),e=r?`${e}\n`:e}static _getFromCache(e,r,i,s){let n=i[e];return"number"!=typeof n&&(n=t._measureText(e,r,s)+r,i[e]=n),n}static _collapseSpaces(t){return"normal"===t||"pre-line"===t}static _collapseNewlines(t){return"normal"===t}static _trimRight(e){if("string"!=typeof e)return"";for(let r=e.length-1;r>=0;r--){const i=e[r];if(!t.isBreakingSpace(i))break;e=e.slice(0,-1)}return e}static _isNewline(e){return"string"==typeof e&&t._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,r){return"string"==typeof e&&t._breakingSpaces.includes(e.charCodeAt(0))}static _tokenize(e){const r=[];let i="";if("string"!=typeof e)return r;for(let s=0;s<e.length;s++){const n=e[s],o=e[s+1];t.isBreakingSpace(n,o)||t._isNewline(n)?(""!==i&&(r.push(i),i=""),r.push(n)):i+=n}return""!==i&&r.push(i),r}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,i,s){return!0}static wordWrapSplit(e){return t.graphemeSegmenter(e)}static measureFont(e){if(t._fonts[e])return t._fonts[e];const r=t._context;r.font=e;const i=r.measureText(t.METRICS_STRING+t.BASELINE_SYMBOL),s={ascent:i.actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent,fontSize:i.actualBoundingBoxAscent+i.actualBoundingBoxDescent};return t._fonts[e]=s,s}static clearMetrics(e=""){e?delete t._fonts[e]:t._fonts={}}static get _canvas(){if(!t.__canvas){let e;try{const r=new OffscreenCanvas(0,0),i=r.getContext("2d",yu);if(null!=i&&i.measureText)return t.__canvas=r,r;e=ri.get().createCanvas()}catch(t){e=ri.get().createCanvas()}e.width=e.height=10,t.__canvas=e}return t.__canvas}static get _context(){return t.__context||(t.__context=t._canvas.getContext("2d",yu)),t.__context}};bu.METRICS_STRING="|q",bu.BASELINE_SYMBOL="M",bu.BASELINE_MULTIPLIER=1.4,bu.HEIGHT_MULTIPLIER=2,bu.graphemeSegmenter=(()=>{if("function"==typeof(null==Intl?void 0:Intl.Segmenter)){const t=new Intl.Segmenter;return e=>[...t.segment(e)].map((t=>t.segment))}return t=>[...t]})(),bu.experimentalLetterSpacing=!1,bu._fonts={},bu._newlines=[10,13],bu._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288],bu._measurementCache={};let vu=bu;const Tu=1e5;function Su(t,e,r,i=0){var s;if(t.texture===Ue.WHITE&&!t.fill)return Q.shared.setValue(t.color).setAlpha(null!=(s=t.alpha)?s:1).toHexa();if(!t.fill){const r=e.createPattern(t.texture.source.resource,"repeat"),i=t.matrix.copyTo(st.shared);return i.scale(t.texture.frame.width,t.texture.frame.height),r.setTransform(i),r}if(t.fill instanceof Nl){const r=t.fill,i=e.createPattern(r.texture.source.resource,"repeat"),s=r.transform.copyTo(st.shared);return s.scale(r.texture.frame.width,r.texture.frame.height),i.setTransform(s),i}if(t.fill instanceof kl){const s=t.fill,n="linear"===s.type,o="local"===s.textureSpace;let a=1,l=1;o&&r&&(a=r.width+i,l=r.height+i);let h,u=!1;if(n){const{start:t,end:r}=s;h=e.createLinearGradient(t.x*a,t.y*l,r.x*a,r.y*l),u=Math.abs(r.x-t.x)<Math.abs(.1*(r.y-t.y))}else{const{center:t,innerRadius:r,outerCenter:i,outerRadius:n}=s;h=e.createRadialGradient(t.x*a,t.y*l,r*a,i.x*a,i.y*l,n*a)}if(u&&o&&r){const t=r.lineHeight/l;for(let e=0;e<r.lines.length;e++){const n=(e*r.lineHeight+i/2)/l;s.colorStops.forEach((e=>{const r=n+e.offset*t;h.addColorStop(Math.floor(r*Tu)/Tu,Q.shared.setValue(e.color).toHex())}))}}else s.colorStops.forEach((t=>{h.addColorStop(t.offset,Q.shared.setValue(t.color).toHex())}));return h}return"red"}class wu{constructor(t){this._activeTextures={},this._renderer=t}getTextureSize(t,e,r){const i=vu.measureText(t||" ",r);let s=Math.ceil(Math.ceil(Math.max(1,i.width)+2*r.padding)*e),n=Math.ceil(Math.ceil(Math.max(1,i.height)+2*r.padding)*e);return s=Math.ceil(s-1e-6),n=Math.ceil(n-1e-6),s=te(s),n=te(n),{width:s,height:n}}getTexture(t,e,r,i){"string"==typeof t&&(t={text:t,style:r,resolution:e}),t.style instanceof fu||(t.style=new fu(t.style));const{texture:s,canvasAndContext:n}=this.createTextureAndCanvas(t);return this._renderer.texture.initSource(s._source),Tl.returnCanvasAndContext(n),s}createTextureAndCanvas(t){var e;const{text:r,style:i}=t,s=null!=(e=t.resolution)?e:this._renderer.resolution,n=vu.measureText(r||" ",i),o=Math.ceil(Math.ceil(Math.max(1,n.width)+2*i.padding)*s),a=Math.ceil(Math.ceil(Math.max(1,n.height)+2*i.padding)*s),l=Tl.getOptimalCanvasAndContext(o,a),{canvas:h}=l;this.renderTextToCanvas(r,i,s,l);const u=mu(h,o,a,s);if(i.trim){const t=El(h,s);u.frame.copyFrom(t),u.updateUvs()}return{texture:u,canvasAndContext:l}}getManagedTexture(t){t._resolution=t._autoResolution?this._renderer.resolution:t.resolution;const e=t._getKey();if(this._activeTextures[e])return this._increaseReferenceCount(e),this._activeTextures[e].texture;const{texture:r,canvasAndContext:i}=this.createTextureAndCanvas(t);return this._activeTextures[e]={canvasAndContext:i,texture:r,usageCount:1},r}_increaseReferenceCount(t){this._activeTextures[t].usageCount++}returnTexture(t){const e=t.source;e.resource=null,e.uploadMethodId="unknown",e.alphaMode="no-premultiply-alpha",qe.returnTexture(t)}decreaseReferenceCount(t){const e=this._activeTextures[t];e.usageCount--,0===e.usageCount&&(Tl.returnCanvasAndContext(e.canvasAndContext),this.returnTexture(e.texture),this._activeTextures[t]=null)}getReferenceCount(t){return this._activeTextures[t].usageCount}renderTextToCanvas(t,e,r,i){var s,n,o,a,l;const{canvas:h,context:u}=i,c=xu(e),d=vu.measureText(t||" ",e),p=d.lines,f=d.lineHeight,g=d.lineWidths,m=d.maxLineWidth,_=d.fontProperties,x=h.height;if(u.resetTransform(),u.scale(r,r),u.textBaseline=e.textBaseline,null!=(s=e._stroke)&&s.width){const t=e._stroke;u.lineWidth=t.width,u.miterLimit=t.miterLimit,u.lineJoin=t.join,u.lineCap=t.cap}let y,b;u.font=c;const v=e.dropShadow?2:1;for(let t=0;t<v;++t){const s=e.dropShadow&&0===t,h=s?Math.ceil(Math.max(1,x)+2*e.padding):0,c=h*r;if(s){u.fillStyle="black",u.strokeStyle="black";const t=e.dropShadow,i=t.color,s=t.alpha;u.shadowColor=Q.shared.setValue(i).setAlpha(s).toRgbaString();const n=t.blur*r,o=t.distance*r;u.shadowBlur=n,u.shadowOffsetX=Math.cos(t.angle)*o,u.shadowOffsetY=Math.sin(t.angle)*o+c}else{if(u.fillStyle=e._fill?Su(e._fill,u,d):null,null!=(n=e._stroke)&&n.width){const t=e._stroke.width*e._stroke.alignment;u.strokeStyle=Su(e._stroke,u,d,t)}u.shadowColor="black"}let v=(f-_.fontSize)/2;f-_.fontSize<0&&(v=0);const T=null!=(a=null==(o=e._stroke)?void 0:o.width)?a:0;for(let t=0;t<p.length;t++)y=T/2,b=T/2+t*f+_.ascent+v,"right"===e.align?y+=m-g[t]:"center"===e.align&&(y+=(m-g[t])/2),null!=(l=e._stroke)&&l.width&&this._drawLetterSpacing(p[t],e,i,y+e.padding,b+e.padding-h,!0),void 0!==e._fill&&this._drawLetterSpacing(p[t],e,i,y+e.padding,b+e.padding-h)}}_drawLetterSpacing(t,e,r,i,s,n=!1){const{context:o}=r,a=e.letterSpacing;let l=!1;if(vu.experimentalLetterSpacingSupported&&(vu.experimentalLetterSpacing?(o.letterSpacing=`${a}px`,o.textLetterSpacing=`${a}px`,l=!0):(o.letterSpacing="0px",o.textLetterSpacing="0px")),0===a||l)return void(n?o.strokeText(t,i,s):o.fillText(t,i,s));let h=i;const u=vu.graphemeSegmenter(t);let c=o.measureText(t).width,d=0;for(let t=0;t<u.length;++t){const e=u[t];n?o.strokeText(e,h,s):o.fillText(e,h,s);let r="";for(let e=t+1;e<u.length;++e)r+=u[e];d=o.measureText(r).width,h+=c-d+a,c=d}}destroy(){this._activeTextures=null}}wu.extension={type:[u.WebGLSystem,u.WebGPUSystem,u.CanvasSystem],name:"canvasText"},p.add(wu),p.add(bl);var Eu=Object.defineProperty,Au=Object.getOwnPropertySymbols,Pu=Object.prototype.hasOwnProperty,Mu=Object.prototype.propertyIsEnumerable,Ru=(t,e,r)=>e in t?Eu(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;class Cu extends Pi{constructor(t){t instanceof eu&&(t={context:t});const e=t||{},{context:r,roundPixels:i}=e,s=((t,e)=>{var r={};for(var i in t)Pu.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&Au)for(var i of Au(t))e.indexOf(i)<0&&Mu.call(t,i)&&(r[i]=t[i]);return r})(e,["context","roundPixels"]);super(((t,e)=>{for(var r in e||(e={}))Pu.call(e,r)&&Ru(t,r,e[r]);if(Au)for(var r of Au(e))Mu.call(e,r)&&Ru(t,r,e[r]);return t})({label:"Graphics"},s)),this.renderPipeId="graphics",this._context=r||(this._ownedContext=new eu),this._context.on("update",this.onViewUpdate,this),this.allowChildren=!1,this.roundPixels=null!=i&&i}set context(t){t!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=t,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(t){return this._context.containsPoint(t)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):(!0===t||!0===(null==t?void 0:t.context))&&this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){return t?new Cu(this._context.clone()):(this._ownedContext=null,new Cu(this._context))}lineStyle(t,e,r){const i={};return t&&(i.width=t),e&&(i.color=e),r&&(i.alpha=r),this.context.strokeStyle=i,this}beginFill(t,e){const r={};return void 0!==t&&(r.color=t),void 0!==e&&(r.alpha=e),this.context.fillStyle=r,this}endFill(){this.context.fill();const t=this.context.strokeStyle;return(t.width!==eu.defaultStrokeStyle.width||t.color!==eu.defaultStrokeStyle.color||t.alpha!==eu.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...t){return this._callContextMethod("circle",t)}drawEllipse(...t){return this._callContextMethod("ellipse",t)}drawPolygon(...t){return this._callContextMethod("poly",t)}drawRect(...t){return this._callContextMethod("rect",t)}drawRoundedRect(...t){return this._callContextMethod("roundRect",t)}drawStar(...t){return this._callContextMethod("star",t)}}const Ou={name:"local-uniform-msdf-bit",vertex:{header:"\n            struct LocalUniforms {\n                uColor:vec4<f32>,\n                uTransformMatrix:mat3x3<f32>,\n                uDistance: f32,\n                uRound:f32,\n            }\n\n            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;\n        ",main:"\n            vColor *= localUniforms.uColor;\n            modelMatrix *= localUniforms.uTransformMatrix;\n        ",end:"\n            if(localUniforms.uRound == 1)\n            {\n                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n            }\n        "},fragment:{header:"\n            struct LocalUniforms {\n                uColor:vec4<f32>,\n                uTransformMatrix:mat3x3<f32>,\n                uDistance: f32\n            }\n\n            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;\n         ",main:" \n            outColor = vec4<f32>(calculateMSDFAlpha(outColor, localUniforms.uColor, localUniforms.uDistance));\n        "}},Iu={name:"local-uniform-msdf-bit",vertex:{header:"\n            uniform mat3 uTransformMatrix;\n            uniform vec4 uColor;\n            uniform float uRound;\n        ",main:"\n            vColor *= uColor;\n            modelMatrix *= uTransformMatrix;\n        ",end:"\n            if(uRound == 1.)\n            {\n                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n            }\n        "},fragment:{header:"\n            uniform float uDistance;\n         ",main:" \n            outColor = vec4(calculateMSDFAlpha(outColor, vColor, uDistance));\n        "}},Bu={name:"msdf-bit",fragment:{header:"\n            fn calculateMSDFAlpha(msdfColor:vec4<f32>, shapeColor:vec4<f32>, distance:f32) -> f32 {\n                \n                // MSDF\n                var median = msdfColor.r + msdfColor.g + msdfColor.b -\n                    min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -\n                    max(msdfColor.r, max(msdfColor.g, msdfColor.b));\n            \n                // SDF\n                median = min(median, msdfColor.a);\n\n                var screenPxDistance = distance * (median - 0.5);\n                var alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n                if (median < 0.01) {\n                    alpha = 0.0;\n                } else if (median > 0.99) {\n                    alpha = 1.0;\n                }\n\n                // Gamma correction for coverage-like alpha\n                var luma: f32 = dot(shapeColor.rgb, vec3<f32>(0.299, 0.587, 0.114));\n                var gamma: f32 = mix(1.0, 1.0 / 2.2, luma);\n                var coverage: f32 = pow(shapeColor.a * alpha, gamma);\n\n                return coverage;\n             \n            }\n        "}},ku={name:"msdf-bit",fragment:{header:"\n            float calculateMSDFAlpha(vec4 msdfColor, vec4 shapeColor, float distance) {\n                \n                // MSDF\n                float median = msdfColor.r + msdfColor.g + msdfColor.b -\n                                min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -\n                                max(msdfColor.r, max(msdfColor.g, msdfColor.b));\n               \n                // SDF\n                median = min(median, msdfColor.a);\n            \n                float screenPxDistance = distance * (median - 0.5);\n                float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n           \n                if (median < 0.01) {\n                    alpha = 0.0;\n                } else if (median > 0.99) {\n                    alpha = 1.0;\n                }\n\n                // Gamma correction for coverage-like alpha\n                float luma = dot(shapeColor.rgb, vec3(0.299, 0.587, 0.114));\n                float gamma = mix(1.0, 1.0 / 2.2, luma);\n                float coverage = pow(shapeColor.a * alpha, gamma);  \n              \n                return coverage;\n            }\n        "}};let Gu,Du;class Fu extends Oo{constructor(){const t=new To({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new st,type:"mat3x3<f32>"},uDistance:{value:4,type:"f32"},uRound:{value:0,type:"f32"}}),e=ps();null!=Gu||(Gu=Zn({name:"sdf-shader",bits:[to,no(e),Ou,Bu,ho]})),null!=Du||(Du=Jn({name:"sdf-shader",bits:[eo,lo(e),Iu,ku,uo]})),super({glProgram:Du,gpuProgram:Gu,resources:{localUniforms:t,batchSamplers:wo(e)}})}}class Nu extends m{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return this.fontFamily}get pageTextures(){return this.pages}get size(){return this.fontMetrics.fontSize}get distanceFieldRange(){return this.distanceField.range}get distanceFieldType(){return this.distanceField.type}destroy(t=!1){var e;this.emit("destroy",this),this.removeAllListeners();for(const t in this.chars)null==(e=this.chars[t].texture)||e.destroy();this.chars=null,t&&(this.pages.forEach((t=>t.texture.destroy(!0))),this.pages=null)}}function Uu(t){if(""===t)return[];"string"==typeof t&&(t=[t]);const e=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];if(Array.isArray(i)){if(2!==i.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${i.length}.`);if(0===i[0].length||0===i[1].length)throw new Error("[BitmapFont]: Invalid character delimiter.");const t=i[0].charCodeAt(0),r=i[1].charCodeAt(0);if(r<t)throw new Error("[BitmapFont]: Invalid character range.");for(let i=t,s=r;i<=s;i++)e.push(String.fromCharCode(i))}else e.push(...Array.from(i))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}var Lu=Object.defineProperty,zu=Object.getOwnPropertySymbols,Xu=Object.prototype.hasOwnProperty,Hu=Object.prototype.propertyIsEnumerable,ju=(t,e,r)=>e in t?Lu(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Vu=(t,e)=>{for(var r in e||(e={}))Xu.call(e,r)&&ju(t,r,e[r]);if(zu)for(var r of zu(e))Hu.call(e,r)&&ju(t,r,e[r]);return t};const Wu=class t extends Nu{constructor(e){var r,i,s;super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentPageIndex=-1,this._skipKerning=!1;const n=Vu(Vu({},t.defaultOptions),e);this._textureSize=n.textureSize,this._mipmap=n.mipmap;const o=n.style.clone();n.overrideFill&&(o._fill.color=16777215,o._fill.alpha=1,o._fill.texture=Ue.WHITE,o._fill.fill=null),this.applyFillAsTint=n.overrideFill;const a=o.fontSize;o.fontSize=this.baseMeasurementFontSize;const l=xu(o);n.overrideSize?o._stroke&&(o._stroke.width*=this.baseRenderedFontSize/a):o.fontSize=this.baseRenderedFontSize=a,this._style=o,this._skipKerning=null!=(r=n.skipKerning)&&r,this.resolution=null!=(i=n.resolution)?i:1,this._padding=null!=(s=n.padding)?s:4,this.fontMetrics=vu.measureFont(l),this.lineHeight=o.lineHeight||this.fontMetrics.fontSize||o.fontSize}ensureCharacters(t){var e,r,i,s;const n=Uu(t).filter((t=>!this._currentChars.includes(t))).filter(((t,e,r)=>r.indexOf(t)===e));if(!n.length)return;let o;this._currentChars=[...this._currentChars,...n],o=-1===this._currentPageIndex?this._nextPage():this.pages[this._currentPageIndex];let{canvas:a,context:l}=o.canvasAndContext,h=o.texture.source;const u=this._style;let c=this._currentX,d=this._currentY;const p=this.baseRenderedFontSize/this.baseMeasurementFontSize,f=this._padding*p;let g=0,m=!1;const _=a.width/this.resolution,x=a.height/this.resolution;for(let t=0;t<n.length;t++){const o=n[t],y=vu.measureText(o,u,a,!1);y.lineHeight=y.height;const b=y.width*p,v=Math.ceil(("italic"===u.fontStyle?2:1)*b)+2*f,T=y.height*p+2*f;if(m=!1,"\n"!==o&&"\r"!==o&&"\t"!==o&&" "!==o&&(m=!0,g=Math.ceil(Math.max(T,g))),c+v>_&&(d+=g,g=T,c=0,d+g>x)){h.update();const t=this._nextPage();a=t.canvasAndContext.canvas,l=t.canvasAndContext.context,h=t.texture.source,d=0}const S=b/p-(null!=(r=null==(e=u.dropShadow)?void 0:e.distance)?r:0)-(null!=(s=null==(i=u._stroke)?void 0:i.width)?s:0);if(this.chars[o]={id:o.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:S,kerning:{}},m){this._drawGlyph(l,y,c+f,d+f,p,u);const t=h.width*p,e=h.height*p,r=new Rt(c/t*h.width,d/e*h.height,v/t*h.width,T/e*h.height);this.chars[o].texture=new Ue({source:h,frame:r}),c+=Math.ceil(v)}}h.update(),this._currentX=c,this._currentY=d,this._skipKerning&&this._applyKerning(n,l)}get pageTextures(){return this.pages}_applyKerning(t,e){const r=this._measureCache;for(let i=0;i<t.length;i++){const s=t[i];for(let t=0;t<this._currentChars.length;t++){const i=this._currentChars[t];let n=r[s];n||(n=r[s]=e.measureText(s).width);let o=r[i];o||(o=r[i]=e.measureText(i).width);let a=e.measureText(s+i).width,l=a-(n+o);l&&(this.chars[s].kerning[i]=l),a=e.measureText(s+i).width,l=a-(n+o),l&&(this.chars[i].kerning[s]=l)}}}_nextPage(){this._currentPageIndex++;const t=this.resolution,e=Tl.getOptimalCanvasAndContext(this._textureSize,this._textureSize,t);this._setupContext(e.context,this._style,t);const r=t*(this.baseRenderedFontSize/this.baseMeasurementFontSize),i={canvasAndContext:e,texture:new Ue({source:new Xi({resource:e.canvas,resolution:r,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})})};return this.pages[this._currentPageIndex]=i,i}_setupContext(t,e,r){var i;e.fontSize=this.baseRenderedFontSize,t.scale(r,r),t.font=xu(e),e.fontSize=this.baseMeasurementFontSize,t.textBaseline=e.textBaseline;const s=e._stroke,n=null!=(i=null==s?void 0:s.width)?i:0;if(s&&(t.lineWidth=n,t.lineJoin=s.join,t.miterLimit=s.miterLimit,t.strokeStyle=Su(s,t)),e._fill&&(t.fillStyle=Su(e._fill,t)),e.dropShadow){const i=e.dropShadow,s=Q.shared.setValue(i.color).toArray(),n=i.blur*r,o=i.distance*r;t.shadowColor=`rgba(${255*s[0]},${255*s[1]},${255*s[2]},${i.alpha})`,t.shadowBlur=n,t.shadowOffsetX=Math.cos(i.angle)*o,t.shadowOffsetY=Math.sin(i.angle)*o}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}_drawGlyph(t,e,r,i,s,n){var o;const a=e.text,l=e.fontProperties,h=n._stroke,u=(null!=(o=null==h?void 0:h.width)?o:0)*s,c=r+u/2,d=i-u/2,p=l.descent*s,f=e.lineHeight*s;n.stroke&&u&&t.strokeText(a,c,d+f-p),n._fill&&t.fillText(a,c,d+f-p)}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{canvasAndContext:e,texture:r}=this.pages[t];Tl.returnCanvasAndContext(e),r.destroy(!0)}this.pages=null}};Wu.defaultOptions={textureSize:512,style:new fu,mipmap:!0};let $u=Wu;function Yu(t,e,r,i){const s={width:0,height:0,offsetY:0,scale:e.fontSize/r.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};s.offsetY=r.baseLineOffset;let n=s.lines[0],o=null,a=!0;const l={spaceWord:!1,width:0,start:0,index:0,positions:[],chars:[]},h=t=>{const e=n.width;for(let r=0;r<l.index;r++){const i=t.positions[r];n.chars.push(t.chars[r]),n.charPositions.push(i+e)}n.width+=t.width,a=!1,l.width=0,l.index=0,l.chars.length=0},u=()=>{let t=n.chars.length-1;if(i){let e=n.chars[t];for(;" "===e;)n.width-=r.chars[e].xAdvance,e=n.chars[--t]}s.width=Math.max(s.width,n.width),n={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},a=!0,s.lines.push(n),s.height+=r.lineHeight},c=r.baseMeasurementFontSize/e.fontSize,d=e.letterSpacing*c,p=e.wordWrapWidth*c;for(let i=0;i<t.length+1;i++){let s;const c=i===t.length;c||(s=t[i]);const f=r.chars[s]||r.chars[" "];if(/(?:\s)/.test(s)||"\r"===s||"\n"===s||c){if(!a&&e.wordWrap&&n.width+l.width-d>p?(u(),h(l),c||n.charPositions.push(0)):(l.start=n.width,h(l),c||n.charPositions.push(0)),"\r"===s||"\n"===s)0!==n.width&&u();else if(!c){const t=f.xAdvance+(f.kerning[o]||0)+d;n.width+=t,n.spaceWidth=t,n.spacesIndex.push(n.charPositions.length),n.chars.push(s)}}else{const t=f.kerning[o]||0,e=f.xAdvance+t+d;l.positions[l.index++]=l.width+t,l.chars.push(s),l.width+=e}o=s}return u(),"center"===e.align?function(t){for(let e=0;e<t.lines.length;e++){const r=t.lines[e],i=t.width/2-r.width/2;for(let t=0;t<r.charPositions.length;t++)r.charPositions[t]+=i}}(s):"right"===e.align?function(t){for(let e=0;e<t.lines.length;e++){const r=t.lines[e],i=t.width-r.width;for(let t=0;t<r.charPositions.length;t++)r.charPositions[t]+=i}}(s):"justify"===e.align&&function(t){const e=t.width;for(let r=0;r<t.lines.length;r++){const i=t.lines[r];let s=0,n=i.spacesIndex[s++],o=0;const a=i.spacesIndex.length,l=(e-i.width)/a;for(let t=0;t<i.charPositions.length;t++)t===n&&(n=i.spacesIndex[s++],o+=l),i.charPositions[t]+=o}}(s),s}var qu=Object.defineProperty,Ku=Object.getOwnPropertySymbols,Qu=Object.prototype.hasOwnProperty,Zu=Object.prototype.propertyIsEnumerable,Ju=(t,e,r)=>e in t?qu(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,tc=(t,e)=>{for(var r in e||(e={}))Qu.call(e,r)&&Ju(t,r,e[r]);if(Ku)for(var r of Ku(e))Zu.call(e,r)&&Ju(t,r,e[r]);return t};let ec=0;const rc=new class{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1}}getFont(t,e){var r;let i=`${e.fontFamily}-bitmap`,s=!0;if(e._fill.fill&&!e._stroke)i+=e._fill.fill.styleKey,s=!1;else if(e._stroke||e.dropShadow){let t=e.styleKey;t=t.substring(0,t.lastIndexOf("-")),i=`${t}-bitmap`,s=!1}if(!es.has(i)){const t=new $u(tc({style:e,overrideFill:s,overrideSize:!0},this.defaultOptions));ec++,ec>50&&_h("BitmapText",`You have dynamically created ${ec} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),t.once("destroy",(()=>{ec--,es.remove(i)})),es.set(i,t)}const n=es.get(i);return null==(r=n.ensureCharacters)||r.call(n,t),n}getLayout(t,e,r=!0){const i=this.getFont(t,e);return Yu([...t],e,i,r)}measureText(t,e,r=!0){return this.getLayout(t,e,r)}install(...t){var e,r,i,s;let n=t[0];"string"==typeof n&&(n={name:n,style:t[1],chars:null==(e=t[2])?void 0:e.chars,resolution:null==(r=t[2])?void 0:r.resolution,padding:null==(i=t[2])?void 0:i.padding,skipKerning:null==(s=t[2])?void 0:s.skipKerning});const o=null==n?void 0:n.name;if(!o)throw new Error("[BitmapFontManager] Property `name` is required.");n=tc(tc({},this.defaultOptions),n);const a=n.style,l=a instanceof fu?a:new fu(a),h=null!==l._fill.fill&&void 0!==l._fill.fill,u=new $u({style:l,overrideFill:h,skipKerning:n.skipKerning,padding:n.padding,resolution:n.resolution,overrideSize:!1}),c=Uu(n.chars);return u.ensureCharacters(c.join("")),es.set(`${o}-bitmap`,u),u.once("destroy",(()=>es.remove(`${o}-bitmap`))),u}uninstall(t){const e=`${t}-bitmap`,r=es.get(e);r&&r.destroy()}};class ic{constructor(t){this._gpuBitmapText={},this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_gpuBitmapText")}validateRenderable(t){const e=this._getGpuBitmapText(t);return t._didTextUpdate&&(t._didTextUpdate=!1,this._updateContext(t,e)),this._renderer.renderPipes.graphics.validateRenderable(e)}addRenderable(t,e){const r=this._getGpuBitmapText(t);sc(t,r),t._didTextUpdate&&(t._didTextUpdate=!1,this._updateContext(t,r)),this._renderer.renderPipes.graphics.addRenderable(r,e),r.context.customShader&&this._updateDistanceField(t)}destroyRenderable(t){t.off("destroyed",this._destroyRenderableBound),this._destroyRenderableByUid(t.uid)}_destroyRenderableByUid(t){const e=this._gpuBitmapText[t].context;e.customShader&&(dt.return(e.customShader),e.customShader=null),dt.return(this._gpuBitmapText[t]),this._gpuBitmapText[t]=null}updateRenderable(t){const e=this._getGpuBitmapText(t);sc(t,e),this._renderer.renderPipes.graphics.updateRenderable(e),e.context.customShader&&this._updateDistanceField(t)}_updateContext(t,e){const{context:r}=e,i=rc.getFont(t.text,t._style);r.clear(),"none"!==i.distanceField.type&&(r.customShader||(r.customShader=dt.get(Fu)));const s=Array.from(t.text),n=t._style;let o=i.baseLineOffset;const a=Yu(s,n,i,!0);let l=0;const h=n.padding,u=a.scale;let c=a.width,d=a.height+a.offsetY;n._stroke&&(c+=n._stroke.width/u,d+=n._stroke.width/u),r.translate(-t._anchor._x*c-h,-t._anchor._y*d-h).scale(u,u);const p=i.applyFillAsTint?n._fill.color:16777215;for(let t=0;t<a.lines.length;t++){const e=a.lines[t];for(let t=0;t<e.charPositions.length;t++){const n=s[l++],a=i.chars[n];null!=a&&a.texture&&r.texture(a.texture,p||"black",Math.round(e.charPositions[t]+a.xOffset),Math.round(o+a.yOffset))}o+=i.lineHeight}}_getGpuBitmapText(t){return this._gpuBitmapText[t.uid]||this.initGpuText(t)}initGpuText(t){const e=dt.get(Cu);return this._gpuBitmapText[t.uid]=e,this._updateContext(t,e),t.on("destroyed",this._destroyRenderableBound),this._gpuBitmapText[t.uid]}_updateDistanceField(t){const e=this._getGpuBitmapText(t).context,r=t._style.fontFamily,i=es.get(`${r}-bitmap`),{a:s,b:n,c:o,d:a}=t.groupTransform,l=Math.sqrt(s*s+n*n),h=Math.sqrt(o*o+a*a),u=(Math.abs(l)+Math.abs(h))/2,c=i.baseRenderedFontSize/t._style.fontSize,d=u*i.distanceField.range*(1/c);e.customShader.resources.localUniforms.uniforms.uDistance=d}destroy(){for(const t in this._gpuBitmapText)this._destroyRenderableByUid(t);this._gpuBitmapText=null,this._renderer=null}}function sc(t,e){e.groupTransform=t.groupTransform,e.groupColorAlpha=t.groupColorAlpha,e.groupColor=t.groupColor,e.groupBlendMode=t.groupBlendMode,e.globalDisplayStatus=t.globalDisplayStatus,e.groupTransform=t.groupTransform,e.localDisplayStatus=t.localDisplayStatus,e.groupAlpha=t.groupAlpha,e._roundPixels=t._roundPixels}ic.extension={type:[u.WebGLPipes,u.WebGPUPipes,u.CanvasPipes],name:"bitmapText"},p.add(ic);class nc{constructor(t){this._gpuText=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=t,this._renderer.runners.resolutionChange.add(this),this._renderer.renderableGC.addManagedHash(this,"_gpuText")}resolutionChange(){for(const t in this._gpuText){const e=this._gpuText[t];if(!e)continue;const r=e.batchableSprite.renderable;r._autoResolution&&(r._resolution=this._renderer.resolution,r.onViewUpdate())}}validateRenderable(t){const e=this._getGpuText(t),r=t._getKey();return e.textureNeedsUploading?(e.textureNeedsUploading=!1,!0):e.currentKey!==r}addRenderable(t,e){const r=this._getGpuText(t).batchableSprite;t._didTextUpdate&&this._updateText(t),this._renderer.renderPipes.batch.addToBatch(r,e)}updateRenderable(t){const e=this._getGpuText(t).batchableSprite;t._didTextUpdate&&this._updateText(t),e._batcher.updateElement(e)}destroyRenderable(t){t.off("destroyed",this._destroyRenderableBound),this._destroyRenderableById(t.uid)}_destroyRenderableById(t){const e=this._gpuText[t];this._renderer.htmlText.decreaseReferenceCount(e.currentKey),dt.return(e.batchableSprite),this._gpuText[t]=null}_updateText(t){const e=t._getKey(),r=this._getGpuText(t),i=r.batchableSprite;r.currentKey!==e&&this._updateGpuText(t).catch((t=>{console.error(t)})),t._didTextUpdate=!1,yl(i,t)}async _updateGpuText(t){var e;t._didTextUpdate=!1;const r=this._getGpuText(t);if(r.generatingTexture)return;const i=t._getKey();this._renderer.htmlText.decreaseReferenceCount(r.currentKey),r.generatingTexture=!0,r.currentKey=i;const s=null!=(e=t.resolution)?e:this._renderer.resolution,n=await this._renderer.htmlText.getManagedTexture(t.text,s,t._style,t._getKey()),o=r.batchableSprite;o.texture=r.texture=n,r.generatingTexture=!1,r.textureNeedsUploading=!0,t.onViewUpdate(),yl(o,t)}_getGpuText(t){return this._gpuText[t.uid]||this.initGpuText(t)}initGpuText(t){const e={texture:Ue.EMPTY,currentKey:"--",batchableSprite:dt.get(xl),textureNeedsUploading:!1,generatingTexture:!1},r=e.batchableSprite;return r.renderable=t,r.transform=t.groupTransform,r.texture=Ue.EMPTY,r.bounds={minX:0,maxX:1,minY:0,maxY:0},r.roundPixels=this._renderer._roundPixels|t._roundPixels,t._resolution=t._autoResolution?this._renderer.resolution:t.resolution,this._gpuText[t.uid]=e,t.on("destroyed",this._destroyRenderableBound),e}destroy(){for(const t in this._gpuText)this._destroyRenderableById(t);this._gpuText=null,this._renderer=null}}function oc(){const{userAgent:t}=ri.get().getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}nc.extension={type:[u.WebGLPipes,u.WebGPUPipes,u.CanvasPipes],name:"htmlText"};const ac="http://www.w3.org/2000/svg",lc="http://www.w3.org/1999/xhtml";class hc{constructor(){this.svgRoot=document.createElementNS(ac,"svg"),this.foreignObject=document.createElementNS(ac,"foreignObject"),this.domElement=document.createElementNS(lc,"div"),this.styleElement=document.createElementNS(lc,"style"),this.image=new Image;const{foreignObject:t,svgRoot:e,styleElement:r,domElement:i}=this;t.setAttribute("width","10000"),t.setAttribute("height","10000"),t.style.overflow="hidden",e.appendChild(t),t.appendChild(r),t.appendChild(i)}}function uc(t){const e=t._stroke,r=t._fill,i=[`div { ${[`color: ${Q.shared.setValue(r.color).toHex()}`,`font-size: ${t.fontSize}px`,`font-family: ${t.fontFamily}`,`font-weight: ${t.fontWeight}`,`font-style: ${t.fontStyle}`,`font-variant: ${t.fontVariant}`,`letter-spacing: ${t.letterSpacing}px`,`text-align: ${t.align}`,`padding: ${t.padding}px`,`white-space: ${"pre"===t.whiteSpace&&t.wordWrap?"pre-wrap":t.whiteSpace}`,...t.lineHeight?[`line-height: ${t.lineHeight}px`]:[],...t.wordWrap?["word-wrap: "+(t.breakWords?"break-all":"break-word"),`max-width: ${t.wordWrapWidth}px`]:[],...e?[dc(e)]:[],...t.dropShadow?[cc(t.dropShadow)]:[],...t.cssOverrides].join(";")} }`];return function(t,e){for(const r in t){const i=t[r],s=[];for(const t in i)fc[t]?s.push(fc[t](i[t])):pc[t]&&s.push(pc[t].replace("{{VALUE}}",i[t]));e.push(`${r} { ${s.join(";")} }`)}}(t.tagStyles,i),i.join(" ")}function cc(t){const e=Q.shared.setValue(t.color).setAlpha(t.alpha).toHexa(),r=`${Math.round(Math.cos(t.angle)*t.distance)}px ${Math.round(Math.sin(t.angle)*t.distance)}px`;return t.blur>0?`text-shadow: ${r} ${t.blur}px ${e}`:`text-shadow: ${r} ${e}`}function dc(t){return[`-webkit-text-stroke-width: ${t.width}px`,`-webkit-text-stroke-color: ${Q.shared.setValue(t.color).toHex()}`,`text-stroke-width: ${t.width}px`,`text-stroke-color: ${Q.shared.setValue(t.color).toHex()}`,"paint-order: stroke"].join(";")}const pc={fontSize:"font-size: {{VALUE}}px",fontFamily:"font-family: {{VALUE}}",fontWeight:"font-weight: {{VALUE}}",fontStyle:"font-style: {{VALUE}}",fontVariant:"font-variant: {{VALUE}}",letterSpacing:"letter-spacing: {{VALUE}}px",align:"text-align: {{VALUE}}",padding:"padding: {{VALUE}}px",whiteSpace:"white-space: {{VALUE}}",lineHeight:"line-height: {{VALUE}}px",wordWrapWidth:"max-width: {{VALUE}}px"},fc={fill:t=>`color: ${Q.shared.setValue(t).toHex()}`,breakWords:t=>"word-wrap: "+(t?"break-all":"break-word"),stroke:dc,dropShadow:cc};var gc=Object.defineProperty,mc=Object.getOwnPropertySymbols,_c=Object.prototype.hasOwnProperty,xc=Object.prototype.propertyIsEnumerable,yc=(t,e,r)=>e in t?gc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,bc=(t,e)=>{for(var r in e||(e={}))_c.call(e,r)&&yc(t,r,e[r]);if(mc)for(var r of mc(e))xc.call(e,r)&&yc(t,r,e[r]);return t};class vc extends fu{constructor(t={}){var e;super(t),this._cssOverrides=[],null!=this.cssOverrides||(this.cssOverrides=t.cssOverrides),this.tagStyles=null!=(e=t.tagStyles)?e:{}}set cssOverrides(t){this._cssOverrides=t instanceof Array?t:[t],this.update()}get cssOverrides(){return this._cssOverrides}_generateKey(){return this._styleKey=iu(this)+this._cssOverrides.join("-"),this._styleKey}update(){this._cssStyle=null,super.update()}clone(){return new vc({align:this.align,breakWords:this.breakWords,dropShadow:this.dropShadow?bc({},this.dropShadow):null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,cssOverrides:this.cssOverrides})}get cssStyle(){return this._cssStyle||(this._cssStyle=uc(this)),this._cssStyle}addOverride(...t){const e=t.filter((t=>!this.cssOverrides.includes(t)));e.length>0&&(this.cssOverrides.push(...e),this.update())}removeOverride(...t){const e=t.filter((t=>this.cssOverrides.includes(t)));e.length>0&&(this.cssOverrides=this.cssOverrides.filter((t=>!e.includes(t))),this.update())}set fill(t){super.fill=t}set stroke(t){super.stroke=t}}function Tc(t,e){const r=e.fontFamily,i=[],s={},n=t.match(/font-family:([^;"\s]+)/g);function o(t){s[t]||(i.push(t),s[t]=!0)}if(Array.isArray(r))for(let t=0;t<r.length;t++)o(r[t]);else o(r);n&&n.forEach((t=>{o(t.split(":")[1].trim())}));for(const t in e.tagStyles){o(e.tagStyles[t].fontFamily)}return i}async function Sc(t){const e=await(await ri.get().fetch(t)).blob(),r=new FileReader;return await new Promise(((t,i)=>{r.onloadend=()=>t(r.result),r.onerror=i,r.readAsDataURL(e)}))}async function wc(t,e){const r=await Sc(e);return`@font-face {\n        font-family: "${t.fontFamily}";\n        src: url('${r}');\n        font-weight: ${t.fontWeight};\n        font-style: ${t.fontStyle};\n    }`}const Ec=new Map;async function Ac(t,e,r){const i=t.filter((t=>es.has(`${t}-and-url`))).map(((t,i)=>{if(!Ec.has(t)){const{url:s}=es.get(`${t}-and-url`);0===i?Ec.set(t,wc({fontWeight:e.fontWeight,fontStyle:e.fontStyle,fontFamily:t},s)):Ec.set(t,wc({fontWeight:r.fontWeight,fontStyle:r.fontStyle,fontFamily:t},s))}return Ec.get(t)}));return(await Promise.all(i)).join("\n")}function Pc(t,e,r,i,s){const{domElement:n,styleElement:o,svgRoot:a}=s;n.innerHTML=`<style>${e.cssStyle}</style><div style='padding:0;'>${t}</div>`,n.setAttribute("style",`transform: scale(${r});transform-origin: top left; display: inline-block`),o.textContent=i;const{width:l,height:h}=s.image;return a.setAttribute("width",l.toString()),a.setAttribute("height",h.toString()),(new XMLSerializer).serializeToString(a)}function Mc(t,e){const r=Tl.getOptimalCanvasAndContext(t.width,t.height,e),{context:i}=r;return i.clearRect(0,0,t.width,t.height),i.drawImage(t,0,0),r}function Rc(t,e,r){return new Promise((async i=>{r&&await new Promise((t=>setTimeout(t,100))),t.onload=()=>{i()},t.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(e)}`,t.crossOrigin="anonymous"}))}let Cc;function Oc(t,e,r,i){i||(i=Cc||(Cc=new hc));const{domElement:s,styleElement:n,svgRoot:o}=i;s.innerHTML=`<style>${e.cssStyle};</style><div style='padding:0'>${t}</div>`,s.setAttribute("style","transform-origin: top left; display: inline-block"),r&&(n.textContent=r),document.body.appendChild(o);const a=s.getBoundingClientRect();o.remove();const l=2*e.padding;return{width:a.width-l,height:a.height-l}}class Ic{constructor(t){this._activeTextures={},this._renderer=t,this._createCanvas=t.type===Eo.WEBGPU}getTexture(t){return this._buildTexturePromise(t.text,t.resolution,t.style)}getManagedTexture(t,e,r,i){if(this._activeTextures[i])return this._increaseReferenceCount(i),this._activeTextures[i].promise;const s=this._buildTexturePromise(t,e,r).then((t=>(this._activeTextures[i].texture=t,t)));return this._activeTextures[i]={texture:null,promise:s,usageCount:1},s}async _buildTexturePromise(t,e,r){const i=dt.get(hc),s=Tc(t,r),n=await Ac(s,r,vc.defaultTextStyle),o=Oc(t,r,n,i),a=Math.ceil(Math.ceil(Math.max(1,o.width)+2*r.padding)*e),l=Math.ceil(Math.ceil(Math.max(1,o.height)+2*r.padding)*e),h=i.image;h.width=2+(0|a),h.height=2+(0|l);const u=Pc(t,r,e,n,i);await Rc(h,u,oc()&&s.length>0);const c=h;let d;this._createCanvas&&(d=Mc(h,e));const p=mu(d?d.canvas:c,h.width-2,h.height-2,e);return this._createCanvas&&(this._renderer.texture.initSource(p.source),Tl.returnCanvasAndContext(d)),dt.return(i),p}_increaseReferenceCount(t){this._activeTextures[t].usageCount++}decreaseReferenceCount(t){const e=this._activeTextures[t];e&&(e.usageCount--,0===e.usageCount&&(e.texture?this._cleanUp(e):e.promise.then((t=>{e.texture=t,this._cleanUp(e)})).catch((()=>{})),this._activeTextures[t]=null))}_cleanUp(t){qe.returnTexture(t.texture),t.texture.source.resource=null,t.texture.source.uploadMethodId="unknown"}getReferenceCount(t){return this._activeTextures[t].usageCount}destroy(){this._activeTextures=null}}Ic.extension={type:[u.WebGLSystem,u.WebGPUSystem,u.CanvasSystem],name:"htmlText"},Ic.defaultFontOptions={fontFamily:"Arial",fontStyle:"normal",fontWeight:"normal"},p.add(Ic),p.add(nc);var Bc=Object.defineProperty,kc=Object.getOwnPropertySymbols,Gc=Object.prototype.hasOwnProperty,Dc=Object.prototype.propertyIsEnumerable,Fc=(t,e,r)=>e in t?Bc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Nc=(t,e)=>{for(var r in e||(e={}))Gc.call(e,r)&&Fc(t,r,e[r]);if(kc)for(var r of kc(e))Dc.call(e,r)&&Fc(t,r,e[r]);return t};const Uc=class t extends zs{constructor(...e){var r;let i=null!=(r=e[0])?r:{};i instanceof Float32Array&&(i={positions:i,uvs:e[1],indices:e[2]}),i=Nc(Nc({},t.defaultOptions),i);const s=i.positions||new Float32Array([0,0,1,0,1,1,0,1]);let n=i.uvs;n||(n=i.positions?new Float32Array(s.length):new Float32Array([0,0,1,0,1,1,0,1]));const o=i.indices||new Uint32Array([0,1,2,0,2,3]),a=i.shrinkBuffersToFit;super({attributes:{aPosition:{buffer:new Ns({data:s,label:"attribute-mesh-positions",shrinkToFit:a,usage:Fs.VERTEX|Fs.COPY_DST}),format:"float32x2",stride:8,offset:0},aUV:{buffer:new Ns({data:n,label:"attribute-mesh-uvs",shrinkToFit:a,usage:Fs.VERTEX|Fs.COPY_DST}),format:"float32x2",stride:8,offset:0}},indexBuffer:new Ns({data:o,label:"index-mesh-buffer",shrinkToFit:a,usage:Fs.INDEX|Fs.COPY_DST}),topology:i.topology}),this.batchMode="auto"}get positions(){return this.attributes.aPosition.buffer.data}set positions(t){this.attributes.aPosition.buffer.data=t}get uvs(){return this.attributes.aUV.buffer.data}set uvs(t){this.attributes.aUV.buffer.data=t}get indices(){return this.indexBuffer.data}set indices(t){this.indexBuffer.data=t}};Uc.defaultOptions={topology:"triangle-list",shrinkBuffersToFit:!1};let Lc=Uc;var zc=Object.defineProperty,Xc=Object.defineProperties,Hc=Object.getOwnPropertyDescriptors,jc=Object.getOwnPropertySymbols,Vc=Object.prototype.hasOwnProperty,Wc=Object.prototype.propertyIsEnumerable,$c=(t,e,r)=>e in t?zc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Yc=(t,e)=>{for(var r in e||(e={}))Vc.call(e,r)&&$c(t,r,e[r]);if(jc)for(var r of jc(e))Wc.call(e,r)&&$c(t,r,e[r]);return t},qc=(t,e)=>Xc(t,Hc(e));const Kc={name:"local-uniform-bit",vertex:{header:"\n\n            struct LocalUniforms {\n                uTransformMatrix:mat3x3<f32>,\n                uColor:vec4<f32>,\n                uRound:f32,\n            }\n\n            @group(1) @binding(0) var<uniform> localUniforms : LocalUniforms;\n        ",main:"\n            vColor *= localUniforms.uColor;\n            modelMatrix *= localUniforms.uTransformMatrix;\n        ",end:"\n            if(localUniforms.uRound == 1)\n            {\n                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n            }\n        "}},Qc=qc(Yc({},Kc),{vertex:qc(Yc({},Kc.vertex),{header:Kc.vertex.header.replace("group(1)","group(2)")})}),Zc={name:"local-uniform-bit",vertex:{header:"\n\n            uniform mat3 uTransformMatrix;\n            uniform vec4 uColor;\n            uniform float uRound;\n        ",main:"\n            vColor *= uColor;\n            modelMatrix = uTransformMatrix;\n        ",end:"\n            if(uRound == 1.)\n            {\n                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n            }\n        "}},Jc={name:"tiling-bit",vertex:{header:"\n            struct TilingUniforms {\n                uMapCoord:mat3x3<f32>,\n                uClampFrame:vec4<f32>,\n                uClampOffset:vec2<f32>,\n                uTextureTransform:mat3x3<f32>,\n                uSizeAnchor:vec4<f32>\n            };\n\n            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;\n            @group(2) @binding(1) var uTexture: texture_2d<f32>;\n            @group(2) @binding(2) var uSampler: sampler;\n        ",main:"\n            uv = (tilingUniforms.uTextureTransform * vec3(uv, 1.0)).xy;\n\n            position = (position - tilingUniforms.uSizeAnchor.zw) * tilingUniforms.uSizeAnchor.xy;\n        "},fragment:{header:"\n            struct TilingUniforms {\n                uMapCoord:mat3x3<f32>,\n                uClampFrame:vec4<f32>,\n                uClampOffset:vec2<f32>,\n                uTextureTransform:mat3x3<f32>,\n                uSizeAnchor:vec4<f32>\n            };\n\n            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;\n            @group(2) @binding(1) var uTexture: texture_2d<f32>;\n            @group(2) @binding(2) var uSampler: sampler;\n        ",main:"\n\n            var coord = vUV + ceil(tilingUniforms.uClampOffset - vUV);\n            coord = (tilingUniforms.uMapCoord * vec3(coord, 1.0)).xy;\n            var unclamped = coord;\n            coord = clamp(coord, tilingUniforms.uClampFrame.xy, tilingUniforms.uClampFrame.zw);\n\n            var bias = 0.;\n\n            if(unclamped.x == coord.x && unclamped.y == coord.y)\n            {\n                bias = -32.;\n            } \n\n            outColor = textureSampleBias(uTexture, uSampler, coord, bias);\n        "}},td={name:"tiling-bit",vertex:{header:"\n            uniform mat3 uTextureTransform;\n            uniform vec4 uSizeAnchor;\n        \n        ",main:"\n            uv = (uTextureTransform * vec3(aUV, 1.0)).xy;\n\n            position = (position - uSizeAnchor.zw) * uSizeAnchor.xy;\n        "},fragment:{header:"\n            uniform sampler2D uTexture;\n            uniform mat3 uMapCoord;\n            uniform vec4 uClampFrame;\n            uniform vec2 uClampOffset;\n        ",main:"\n\n        vec2 coord = vUV + ceil(uClampOffset - vUV);\n        coord = (uMapCoord * vec3(coord, 1.0)).xy;\n        vec2 unclamped = coord;\n        coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n        \n        outColor = texture(uTexture, coord, unclamped == coord ? 0.0 : -32.0);// lod-bias very negative to force lod 0\n    \n        "}};let ed,rd;class id extends Oo{constructor(){null!=ed||(ed=Zn({name:"tiling-sprite-shader",bits:[Kc,Jc,ho]})),null!=rd||(rd=Jn({name:"tiling-sprite-shader",bits:[Zc,td,uo]}));const t=new To({uMapCoord:{value:new st,type:"mat3x3<f32>"},uClampFrame:{value:new Float32Array([0,0,1,1]),type:"vec4<f32>"},uClampOffset:{value:new Float32Array([0,0]),type:"vec2<f32>"},uTextureTransform:{value:new st,type:"mat3x3<f32>"},uSizeAnchor:{value:new Float32Array([100,100,.5,.5]),type:"vec4<f32>"}});super({glProgram:rd,gpuProgram:ed,resources:{localUniforms:new To({uTransformMatrix:{value:new st,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),tilingUniforms:t,uTexture:Ue.EMPTY.source,uSampler:Ue.EMPTY.source.style}})}updateUniforms(t,e,r,i,s,n){const o=this.resources.tilingUniforms,a=n.width,l=n.height,h=n.textureMatrix,u=o.uniforms.uTextureTransform;u.set(r.a*a/t,r.b*a/e,r.c*l/t,r.d*l/e,r.tx/t,r.ty/e),u.invert(),o.uniforms.uMapCoord=h.mapCoord,o.uniforms.uClampFrame=h.uClampFrame,o.uniforms.uClampOffset=h.uClampOffset,o.uniforms.uTextureTransform=u,o.uniforms.uSizeAnchor[0]=t,o.uniforms.uSizeAnchor[1]=e,o.uniforms.uSizeAnchor[2]=i,o.uniforms.uSizeAnchor[3]=s,n&&(this.resources.uTexture=n.source,this.resources.uSampler=n.source.style)}}class sd extends Lc{constructor(){super({positions:new Float32Array([0,0,1,0,1,1,0,1]),uvs:new Float32Array([0,0,1,0,1,1,0,1]),indices:new Uint32Array([0,1,2,0,2,3])})}}function nd(t,e){const r=t.anchor.x,i=t.anchor.y;e[0]=-r*t.width,e[1]=-i*t.height,e[2]=(1-r)*t.width,e[3]=-i*t.height,e[4]=(1-r)*t.width,e[5]=(1-i)*t.height,e[6]=-r*t.width,e[7]=(1-i)*t.height}function od(t,e,r,i){let s=0;const n=t.length/(e||2),o=i.a,a=i.b,l=i.c,h=i.d,u=i.tx,c=i.ty;for(r*=e;s<n;){const i=t[r],n=t[r+1];t[r]=o*i+l*n+u,t[r+1]=a*i+h*n+c,r+=e,s++}}function ad(t,e){const r=t.texture,i=r.frame.width,s=r.frame.height;let n=0,o=0;t.applyAnchorToTexture&&(n=t.anchor.x,o=t.anchor.y),e[0]=e[6]=-n,e[2]=e[4]=1-n,e[1]=e[3]=-o,e[5]=e[7]=1-o;const a=st.shared;a.copyFrom(t._tileTransform.matrix),a.tx/=t.width,a.ty/=t.height,a.invert(),a.scale(t.width/i,t.height/s),od(e,2,0,a)}const ld=new sd;class hd{constructor(t){this._state=tl.default2d,this._tilingSpriteDataHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_tilingSpriteDataHash")}validateRenderable(t){const e=this._getTilingSpriteData(t),r=e.canBatch;this._updateCanBatch(t);const i=e.canBatch;if(i&&i===r){const{batchableMesh:r}=e;return!r._batcher.checkAndUpdateTexture(r,t.texture)}return r!==i}addRenderable(t,e){const r=this._renderer.renderPipes.batch;this._updateCanBatch(t);const i=this._getTilingSpriteData(t),{geometry:s,canBatch:n}=i;if(n){i.batchableMesh||(i.batchableMesh=new il);const n=i.batchableMesh;t.didViewUpdate&&(this._updateBatchableMesh(t),n.geometry=s,n.renderable=t,n.transform=t.groupTransform,n.setTexture(t._texture)),n.roundPixels=this._renderer._roundPixels|t._roundPixels,r.addToBatch(n,e)}else r.break(e),i.shader||(i.shader=new id),this.updateRenderable(t),e.add(t)}execute(t){const{shader:e}=this._tilingSpriteDataHash[t.uid];e.groups[0]=this._renderer.globalUniforms.bindGroup;const r=e.resources.localUniforms.uniforms;r.uTransformMatrix=t.groupTransform,r.uRound=this._renderer._roundPixels|t._roundPixels,el(t.groupColorAlpha,r.uColor,0),this._state.blendMode=vs(t.groupBlendMode,t.texture._source),this._renderer.encoder.draw({geometry:ld,shader:e,state:this._state})}updateRenderable(t){const e=this._getTilingSpriteData(t),{canBatch:r}=e;if(r){const{batchableMesh:r}=e;t.didViewUpdate&&this._updateBatchableMesh(t),r._batcher.updateElement(r)}else if(t.didViewUpdate){const{shader:r}=e;r.updateUniforms(t.width,t.height,t._tileTransform.matrix,t.anchor.x,t.anchor.y,t.texture)}}destroyRenderable(t){var e;const r=this._getTilingSpriteData(t);r.batchableMesh=null,null==(e=r.shader)||e.destroy(),this._tilingSpriteDataHash[t.uid]=null,t.off("destroyed",this._destroyRenderableBound)}_getTilingSpriteData(t){return this._tilingSpriteDataHash[t.uid]||this._initTilingSpriteData(t)}_initTilingSpriteData(t){const e=new Lc({indices:ld.indices,positions:ld.positions.slice(),uvs:ld.uvs.slice()});return this._tilingSpriteDataHash[t.uid]={canBatch:!0,renderable:t,geometry:e},t.on("destroyed",this._destroyRenderableBound),this._tilingSpriteDataHash[t.uid]}_updateBatchableMesh(t){const e=this._getTilingSpriteData(t),{geometry:r}=e,i=t.texture.source.style;"repeat"!==i.addressMode&&(i.addressMode="repeat",i.update()),ad(t,r.uvs),nd(t,r.positions)}destroy(){for(const t in this._tilingSpriteDataHash)this.destroyRenderable(this._tilingSpriteDataHash[t].renderable);this._tilingSpriteDataHash=null,this._renderer=null}_updateCanBatch(t){const e=this._getTilingSpriteData(t),r=t.texture;let i=!0;return this._renderer.type===Eo.WEBGL&&(i=this._renderer.context.supports.nonPowOf2wrapping),e.canBatch=r.textureMatrix.isSimple&&(i||r.source.isPowerOfTwo),e.canBatch}}hd.extension={type:[u.WebGLPipes,u.WebGPUPipes,u.CanvasPipes],name:"tilingSprite"},p.add(hd);var ud=Object.defineProperty,cd=Object.getOwnPropertySymbols,dd=Object.prototype.hasOwnProperty,pd=Object.prototype.propertyIsEnumerable,fd=(t,e,r)=>e in t?ud(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,gd=(t,e)=>{for(var r in e||(e={}))dd.call(e,r)&&fd(t,r,e[r]);if(cd)for(var r of cd(e))pd.call(e,r)&&fd(t,r,e[r]);return t};const md=class t extends Lc{constructor(...t){var e;super({});let r=null!=(e=t[0])?e:{};"number"==typeof r&&(r={width:r,height:t[1],verticesX:t[2],verticesY:t[3]}),this.build(r)}build(e){var r,i,s,n;e=gd(gd({},t.defaultOptions),e),this.verticesX=null!=(r=this.verticesX)?r:e.verticesX,this.verticesY=null!=(i=this.verticesY)?i:e.verticesY,this.width=null!=(s=this.width)?s:e.width,this.height=null!=(n=this.height)?n:e.height;const o=this.verticesX*this.verticesY,a=[],l=[],h=[],u=this.verticesX-1,c=this.verticesY-1,d=this.width/u,p=this.height/c;for(let t=0;t<o;t++){const e=t%this.verticesX,r=t/this.verticesX|0;a.push(e*d,r*p),l.push(e/u,r/c)}const f=u*c;for(let t=0;t<f;t++){const e=t%u,r=t/u|0,i=r*this.verticesX+e,s=r*this.verticesX+e+1,n=(r+1)*this.verticesX+e,o=(r+1)*this.verticesX+e+1;h.push(i,s,n,s,o,n)}this.buffers[0].data=new Float32Array(a),this.buffers[1].data=new Float32Array(l),this.indexBuffer.data=new Uint32Array(h),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}};md.defaultOptions={width:100,height:100,verticesX:10,verticesY:10};let _d=md;var xd=Object.defineProperty,yd=Object.getOwnPropertySymbols,bd=Object.prototype.hasOwnProperty,vd=Object.prototype.propertyIsEnumerable,Td=(t,e,r)=>e in t?xd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Sd=(t,e)=>{for(var r in e||(e={}))bd.call(e,r)&&Td(t,r,e[r]);if(yd)for(var r of yd(e))vd.call(e,r)&&Td(t,r,e[r]);return t};const wd=class t extends _d{constructor(e={}){super({width:(e=Sd(Sd({},t.defaultOptions),e)).width,height:e.height,verticesX:4,verticesY:4}),this.update(e)}update(t){var e,r,i,s,n,o,a,l,h,u;this.width=null!=(e=t.width)?e:this.width,this.height=null!=(r=t.height)?r:this.height,this._originalWidth=null!=(i=t.originalWidth)?i:this._originalWidth,this._originalHeight=null!=(s=t.originalHeight)?s:this._originalHeight,this._leftWidth=null!=(n=t.leftWidth)?n:this._leftWidth,this._rightWidth=null!=(o=t.rightWidth)?o:this._rightWidth,this._topHeight=null!=(a=t.topHeight)?a:this._topHeight,this._bottomHeight=null!=(l=t.bottomHeight)?l:this._bottomHeight,this._anchorX=null==(h=t.anchor)?void 0:h.x,this._anchorY=null==(u=t.anchor)?void 0:u.y,this.updateUvs(),this.updatePositions()}updatePositions(){const t=this.positions,{width:e,height:r,_leftWidth:i,_rightWidth:s,_topHeight:n,_bottomHeight:o,_anchorX:a,_anchorY:l}=this,h=i+s,u=e>h?1:e/h,c=n+o,d=r>c?1:r/c,p=Math.min(u,d),f=a*e,g=l*r;t[0]=t[8]=t[16]=t[24]=-f,t[2]=t[10]=t[18]=t[26]=i*p-f,t[4]=t[12]=t[20]=t[28]=e-s*p-f,t[6]=t[14]=t[22]=t[30]=e-f,t[1]=t[3]=t[5]=t[7]=-g,t[9]=t[11]=t[13]=t[15]=n*p-g,t[17]=t[19]=t[21]=t[23]=r-o*p-g,t[25]=t[27]=t[29]=t[31]=r-g,this.getBuffer("aPosition").update()}updateUvs(){const t=this.uvs;t[0]=t[8]=t[16]=t[24]=0,t[1]=t[3]=t[5]=t[7]=0,t[6]=t[14]=t[22]=t[30]=1,t[25]=t[27]=t[29]=t[31]=1;const e=1/this._originalWidth,r=1/this._originalHeight;t[2]=t[10]=t[18]=t[26]=e*this._leftWidth,t[9]=t[11]=t[13]=t[15]=r*this._topHeight,t[4]=t[12]=t[20]=t[28]=1-e*this._rightWidth,t[17]=t[19]=t[21]=t[23]=1-r*this._bottomHeight,this.getBuffer("aUV").update()}};wd.defaultOptions={width:100,height:100,leftWidth:10,topHeight:10,rightWidth:10,bottomHeight:10,originalWidth:100,originalHeight:100};let Ed=wd;class Ad{constructor(t){this._gpuSpriteHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_gpuSpriteHash")}addRenderable(t,e){const r=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,r),this._renderer.renderPipes.batch.addToBatch(r,e)}updateRenderable(t){const e=this._gpuSpriteHash[t.uid];t.didViewUpdate&&this._updateBatchableSprite(t,e),e._batcher.updateElement(e)}validateRenderable(t){const e=this._getGpuSprite(t);return!e._batcher.checkAndUpdateTexture(e,t._texture)}destroyRenderable(t){const e=this._gpuSpriteHash[t.uid];dt.return(e.geometry),dt.return(e),this._gpuSpriteHash[t.uid]=null,t.off("destroyed",this._destroyRenderableBound)}_updateBatchableSprite(t,e){e.geometry.update(t),e.setTexture(t._texture)}_getGpuSprite(t){return this._gpuSpriteHash[t.uid]||this._initGPUSprite(t)}_initGPUSprite(t){const e=dt.get(il);return e.geometry=dt.get(Ed),e.renderable=t,e.transform=t.groupTransform,e.texture=t._texture,e.roundPixels=this._renderer._roundPixels|t._roundPixels,this._gpuSpriteHash[t.uid]=e,t.didViewUpdate||this._updateBatchableSprite(t,e),t.on("destroyed",this._destroyRenderableBound),e}destroy(){for(const t in this._gpuSpriteHash)this._gpuSpriteHash[t].geometry.destroy();this._gpuSpriteHash=null,this._renderer=null}}Ad.extension={type:[u.WebGLPipes,u.WebGPUPipes,u.CanvasPipes],name:"nineSliceSprite"},p.add(Ad);class Pd{constructor(t){this._renderer=t}push(t,e,r){this._renderer.renderPipes.batch.break(r),r.add({renderPipeId:"filter",canBundle:!1,action:"pushFilter",container:e,filterEffect:t})}pop(t,e,r){this._renderer.renderPipes.batch.break(r),r.add({renderPipeId:"filter",action:"popFilter",canBundle:!1})}execute(t){"pushFilter"===t.action?this._renderer.filter.push(t):"popFilter"===t.action&&this._renderer.filter.pop()}destroy(){this._renderer=null}}function Md(t,e){e.clear();const r=e.matrix;for(let r=0;r<t.length;r++){const i=t[r];i.globalDisplayStatus<7||(e.matrix=i.worldTransform,e.addBounds(i.bounds))}return e.matrix=r,e}Pd.extension={type:[u.WebGLPipes,u.WebGPUPipes,u.CanvasPipes],name:"filter"};const Rd=new zs({attributes:{aPosition:{buffer:new Float32Array([0,0,1,0,1,1,0,1]),format:"float32x2",stride:8,offset:0}},indexBuffer:new Uint32Array([0,1,2,0,2,3])});class Cd{constructor(t){this._filterStackIndex=0,this._filterStack=[],this._filterGlobalUniforms=new To({uInputSize:{value:new Float32Array(4),type:"vec4<f32>"},uInputPixel:{value:new Float32Array(4),type:"vec4<f32>"},uInputClamp:{value:new Float32Array(4),type:"vec4<f32>"},uOutputFrame:{value:new Float32Array(4),type:"vec4<f32>"},uGlobalFrame:{value:new Float32Array(4),type:"vec4<f32>"},uOutputTexture:{value:new Float32Array(4),type:"vec4<f32>"}}),this._globalFilterBindGroup=new os({}),this.renderer=t}get activeBackTexture(){var t;return null==(t=this._activeFilterData)?void 0:t.backTexture}push(t){var e,r;const i=this.renderer,s=t.filterEffect.filters;this._filterStack[this._filterStackIndex]||(this._filterStack[this._filterStackIndex]=this._getFilterData());const n=this._filterStack[this._filterStackIndex];if(this._filterStackIndex++,0===s.length)return void(n.skip=!0);const o=n.bounds;if(t.renderables?Md(t.renderables,o):t.filterEffect.filterArea?(o.clear(),o.addRect(t.filterEffect.filterArea),o.applyMatrix(t.container.worldTransform)):t.container.getFastGlobalBounds(!0,o),t.container){const e=(t.container.renderGroup||t.container.parentRenderGroup).cacheToLocalTransform;e&&o.applyMatrix(e)}const a=i.renderTarget.renderTarget.colorTexture.source;let l=1/0,h=0,u=!0,c=!1,d=!1,p=!0;for(let t=0;t<s.length;t++){const n=s[t];if(l=Math.min(l,"inherit"===n.resolution?a._resolution:n.resolution),h+=n.padding,"off"===n.antialias?u=!1:"inherit"===n.antialias&&u&&(u=a.antialias),n.clipToViewport||(p=!1),!(n.compatibleRenderers&i.type)){d=!1;break}if(n.blendRequired&&null!=(r=null==(e=i.backBuffer)?void 0:e.useBackBuffer)&&!r){d=!1;break}d=n.enabled||d,c||(c=n.blendRequired)}if(d){if(p){const t=i.renderTarget.rootViewPort,e=i.renderTarget.renderTarget.resolution;o.fitBounds(0,t.width/e,0,t.height/e)}o.scale(l).ceil().scale(1/l).pad(0|h),o.isPositive?(n.skip=!1,n.bounds=o,n.blendRequired=c,n.container=t.container,n.filterEffect=t.filterEffect,n.previousRenderSurface=i.renderTarget.renderSurface,n.inputTexture=qe.getOptimalTexture(o.width,o.height,l,u),i.renderTarget.bind(n.inputTexture,!0),i.globalUniforms.push({offset:o})):n.skip=!0}else n.skip=!0}pop(){const t=this.renderer;this._filterStackIndex--;const e=this._filterStack[this._filterStackIndex];if(e.skip)return;this._activeFilterData=e;const r=e.inputTexture,i=e.bounds;let s=Ue.EMPTY;if(t.renderTarget.finishRenderPass(),e.blendRequired){const r=this._filterStackIndex>0?this._filterStack[this._filterStackIndex-1].bounds:null,n=t.renderTarget.getRenderTarget(e.previousRenderSurface);s=this.getBackTexture(n,i,r)}e.backTexture=s;const n=e.filterEffect.filters;if(this._globalFilterBindGroup.setResource(r.source.style,2),this._globalFilterBindGroup.setResource(s.source,3),t.globalUniforms.pop(),1===n.length)n[0].apply(this,r,e.previousRenderSurface,!1),qe.returnTexture(r);else{let t=e.inputTexture,r=qe.getOptimalTexture(i.width,i.height,t.source._resolution,!1),s=0;for(s=0;s<n.length-1;++s){n[s].apply(this,t,r,!0);const e=t;t=r,r=e}n[s].apply(this,t,e.previousRenderSurface,!1),qe.returnTexture(t),qe.returnTexture(r)}e.blendRequired&&qe.returnTexture(s)}getBackTexture(t,e,r){const i=t.colorTexture.source._resolution,s=qe.getOptimalTexture(e.width,e.height,i,!1);let n=e.minX,o=e.minY;r&&(n-=r.minX,o-=r.minY),n=Math.floor(n*i),o=Math.floor(o*i);const a=Math.ceil(e.width*i),l=Math.ceil(e.height*i);return this.renderer.renderTarget.copyToTexture(t,s,{x:n,y:o},{width:a,height:l},{x:0,y:0}),s}applyFilter(t,e,r,i){const s=this.renderer,n=this._filterStack[this._filterStackIndex],o=n.bounds,a=rt.shared,l=n.previousRenderSurface===r;let h=this.renderer.renderTarget.rootRenderTarget.colorTexture.source._resolution,u=this._filterStackIndex-1;for(;u>0&&this._filterStack[u].skip;)--u;u>0&&(h=this._filterStack[u].inputTexture.source._resolution);const c=this._filterGlobalUniforms,d=c.uniforms,p=d.uOutputFrame,f=d.uInputSize,g=d.uInputPixel,m=d.uInputClamp,_=d.uGlobalFrame,x=d.uOutputTexture;if(l){let t=this._filterStackIndex;for(;t>0;){t--;const e=this._filterStack[this._filterStackIndex-1];if(!e.skip){a.x=e.bounds.minX,a.y=e.bounds.minY;break}}p[0]=o.minX-a.x,p[1]=o.minY-a.y}else p[0]=0,p[1]=0;p[2]=e.frame.width,p[3]=e.frame.height,f[0]=e.source.width,f[1]=e.source.height,f[2]=1/f[0],f[3]=1/f[1],g[0]=e.source.pixelWidth,g[1]=e.source.pixelHeight,g[2]=1/g[0],g[3]=1/g[1],m[0]=.5*g[2],m[1]=.5*g[3],m[2]=e.frame.width*f[2]-.5*g[2],m[3]=e.frame.height*f[3]-.5*g[3];const y=this.renderer.renderTarget.rootRenderTarget.colorTexture;_[0]=a.x*h,_[1]=a.y*h,_[2]=y.source.width*h,_[3]=y.source.height*h;const b=this.renderer.renderTarget.getRenderTarget(r);if(s.renderTarget.bind(r,!!i),r instanceof Ue?(x[0]=r.frame.width,x[1]=r.frame.height):(x[0]=b.width,x[1]=b.height),x[2]=b.isRoot?-1:1,c.update(),s.renderPipes.uniformBatch){const t=s.renderPipes.uniformBatch.getUboResource(c);this._globalFilterBindGroup.setResource(t,0)}else this._globalFilterBindGroup.setResource(c,0);this._globalFilterBindGroup.setResource(e.source,1),this._globalFilterBindGroup.setResource(e.source.style,2),t.groups[0]=this._globalFilterBindGroup,s.encoder.draw({geometry:Rd,shader:t,state:t._state,topology:"triangle-list"}),s.type===Eo.WEBGL&&s.renderTarget.finishRenderPass()}_getFilterData(){return{skip:!1,inputTexture:null,bounds:new Ot,container:null,filterEffect:null,blendRequired:!1,previousRenderSurface:null}}calculateSpriteMatrix(t,e){const r=this._activeFilterData,i=t.set(r.inputTexture._source.width,0,0,r.inputTexture._source.height,r.bounds.minX,r.bounds.minY),s=e.worldTransform.copyTo(st.shared),n=e.renderGroup||e.parentRenderGroup;return n&&n.cacheToLocalTransform&&s.prepend(n.cacheToLocalTransform),s.invert(),i.prepend(s),i.scale(1/e.texture.frame.width,1/e.texture.frame.height),i.translate(e.anchor.x,e.anchor.y),i}}Cd.extension={type:[u.WebGLSystem,u.WebGPUSystem],name:"filter"},p.add(Cd),p.add(Pd);var Od={__proto__:null};const Id=[];async function Bd(t){if(!t)for(let t=0;t<Id.length;t++){const e=Id[t];if(e.value.test())return void await e.value.load()}}let kd;function Gd(){if("boolean"==typeof kd)return kd;try{kd=!0===new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")}catch(t){kd=!1}return kd}p.handleByNamedList(u.Environment,Id);var Dd=(t=>(t[t.NONE=0]="NONE",t[t.COLOR=16384]="COLOR",t[t.STENCIL=1024]="STENCIL",t[t.DEPTH=256]="DEPTH",t[t.COLOR_DEPTH=16640]="COLOR_DEPTH",t[t.COLOR_STENCIL=17408]="COLOR_STENCIL",t[t.DEPTH_STENCIL=1280]="DEPTH_STENCIL",t[t.ALL=17664]="ALL",t))(Dd||{});class Fd{constructor(t){this.items=[],this._name=t}emit(t,e,r,i,s,n,o,a){const{name:l,items:h}=this;for(let u=0,c=h.length;u<c;u++)h[u][l](t,e,r,i,s,n,o,a);return this}add(t){return t[this._name]&&(this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return-1!==e&&this.items.splice(e,1),this}contains(t){return-1!==this.items.indexOf(t)}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return 0===this.items.length}get name(){return this._name}}var Nd=Object.defineProperty,Ud=Object.getOwnPropertySymbols,Ld=Object.prototype.hasOwnProperty,zd=Object.prototype.propertyIsEnumerable,Xd=(t,e,r)=>e in t?Nd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Hd=(t,e)=>{for(var r in e||(e={}))Ld.call(e,r)&&Xd(t,r,e[r]);if(Ud)for(var r of Ud(e))zd.call(e,r)&&Xd(t,r,e[r]);return t};const jd=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],Vd=class t extends m{constructor(t){var e;super(),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=t.type,this.name=t.name,this.config=t;const r=[...jd,...null!=(e=this.config.runners)?e:[]];this._addRunners(...r),this._unsafeEvalCheck()}async init(e={}){const r=!0===e.skipExtensionImports||!1===e.manageImports;await Bd(r),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const t in this._systemsHash){const r=this._systemsHash[t].constructor.defaultOptions;e=Hd(Hd({},r),e)}e=Hd(Hd({},t.defaultOptions),e),this._roundPixels=e.roundPixels?1:0;for(let t=0;t<this.runners.init.items.length;t++)await this.runners.init.items[t].init(e);this._initOptions=e}render(t,e){let r=t;if(r instanceof er&&(r={container:r},e&&(r.target=e.renderTexture)),r.target||(r.target=this.view.renderTarget),r.target===this.view.renderTarget&&(this._lastObjectRendered=r.container,null!=r.clearColor||(r.clearColor=this.background.colorRgba),null!=r.clear||(r.clear=this.background.clearBeforeRender)),r.clearColor){const t=Array.isArray(r.clearColor)&&4===r.clearColor.length;r.clearColor=t?r.clearColor:Q.shared.setValue(r.clearColor).toArray()}r.transform||(r.container.updateLocalTransform(),r.transform=r.container.localTransform),r.container.enableRenderGroup(),this.runners.prerender.emit(r),this.runners.renderStart.emit(r),this.runners.render.emit(r),this.runners.renderEnd.emit(r),this.runners.postrender.emit(r)}resize(t,e,r){const i=this.view.resolution;this.view.resize(t,e,r),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),void 0!==r&&r!==i&&this.runners.resolutionChange.emit(r)}clear(t={}){t.target||(t.target=this.renderTarget.renderTarget),t.clearColor||(t.clearColor=this.background.colorRgba),null!=t.clear||(t.clear=Dd.ALL);const{clear:e,clearColor:r,target:i}=t;Q.shared.setValue(null!=r?r:this.background.colorRgba),this.renderTarget.clear(i,e,Q.shared.toArray())}get resolution(){return this.view.resolution}set resolution(t){this.view.resolution=t,this.runners.resolutionChange.emit(t)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...t){t.forEach((t=>{this.runners[t]=new Fd(t)}))}_addSystems(t){let e;for(e in t){const r=t[e];this._addSystem(r.value,r.name)}}_addSystem(t,e){const r=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=r,this._systemsHash[e]=r;for(const t in this.runners)this.runners[t].add(r);return this}_addPipes(t,e){const r=e.reduce(((t,e)=>(t[e.name]=e.value,t)),{});t.forEach((t=>{const e=t.value,i=t.name,s=r[i];this.renderPipes[i]=new e(this,s?new s:null)}))}destroy(t=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(t),Object.values(this.runners).forEach((t=>{t.destroy()})),this._systemsHash=null,this.renderPipes=null}generateTexture(t){return this.textureGenerator.generateTexture(t)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!Gd())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};Vd.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let Wd,$d,Yd=Vd;function qd(t){return void 0!==Wd||(Wd=(()=>{var e;const r={stencil:!0,failIfMajorPerformanceCaveat:null!=t?t:Yd.defaultOptions.failIfMajorPerformanceCaveat};try{if(!ri.get().getWebGLRenderingContext())return!1;let t=ri.get().createCanvas().getContext("webgl",r);const i=!(null==(e=null==t?void 0:t.getContextAttributes())||!e.stencil);if(t){const e=t.getExtension("WEBGL_lose_context");e&&e.loseContext()}return t=null,i}catch(t){return!1}})()),Wd}async function Kd(t={}){return void 0!==$d||($d=await(async()=>{const e=ri.get().getNavigator().gpu;if(!e)return!1;try{return await(await e.requestAdapter(t)).requestDevice(),!0}catch(t){return!1}})()),$d}var Qd=Object.defineProperty,Zd=Object.getOwnPropertySymbols,Jd=Object.prototype.hasOwnProperty,tp=Object.prototype.propertyIsEnumerable,ep=(t,e,r)=>e in t?Qd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,rp=(t,e)=>{for(var r in e||(e={}))Jd.call(e,r)&&ep(t,r,e[r]);if(Zd)for(var r of Zd(e))tp.call(e,r)&&ep(t,r,e[r]);return t};const ip=["webgl","webgpu","canvas"];async function sp(t){var e;let r=[];t.preference?(r.push(t.preference),ip.forEach((e=>{e!==t.preference&&r.push(e)}))):r=ip.slice();let i,s={};for(let n=0;n<r.length;n++){const o=r[n];if("webgpu"===o&&await Kd()){const{WebGPURenderer:e}=await Promise.resolve().then((function(){return HS}));i=e,s=rp(rp({},t),t.webgpu);break}if("webgl"===o&&qd(null!=(e=t.failIfMajorPerformanceCaveat)?e:Yd.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:e}=await Promise.resolve().then((function(){return jT}));i=e,s=rp(rp({},t),t.webgl);break}if("canvas"===o)throw s=rp({},t),new Error("CanvasRenderer is not yet implemented")}if(delete s.webgpu,delete s.webgl,!i)throw new Error("No available renderer for the current environment");const n=new i;return await n.init(s),n}const np="8.8.0";class op{static init(){var t;null==(t=globalThis.__PIXI_APP_INIT__)||t.call(globalThis,this,np)}static destroy(){}}op.extension=u.Application;class ap{constructor(t){this._renderer=t}init(){var t;null==(t=globalThis.__PIXI_RENDERER_INIT__)||t.call(globalThis,this._renderer,np)}destroy(){this._renderer=null}}ap.extension={type:[u.WebGLSystem,u.WebGPUSystem],name:"initHook",priority:-10};var lp=Object.defineProperty,hp=Object.getOwnPropertySymbols,up=Object.prototype.hasOwnProperty,cp=Object.prototype.propertyIsEnumerable,dp=(t,e,r)=>e in t?lp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;const pp=class t{constructor(...t){this.stage=new er}async init(e){e=((t,e)=>{for(var r in e||(e={}))up.call(e,r)&&dp(t,r,e[r]);if(hp)for(var r of hp(e))cp.call(e,r)&&dp(t,r,e[r]);return t})({},e),this.renderer=await sp(e),t._plugins.forEach((t=>{t.init.call(this,e)}))}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return this.renderer.canvas}get screen(){return this.renderer.screen}destroy(e=!1,r=!1){const i=t._plugins.slice(0);i.reverse(),i.forEach((t=>{t.destroy.call(this)})),this.stage.destroy(r),this.stage=null,this.renderer.destroy(e),this.renderer=null}};pp._plugins=[];let fp=pp;p.handleByList(u.Application,fp._plugins),p.add(op);class gp extends Nu{constructor(t,e){var r;super();const{textures:i,data:s}=t;Object.keys(s.pages).forEach((t=>{const e=s.pages[parseInt(t,10)],r=i[e.id];this.pages.push({texture:r})})),Object.keys(s.chars).forEach((t=>{var e;const r=s.chars[t],{frame:n,source:o}=i[r.page],a=new Rt(r.x+n.x,r.y+n.y,r.width,r.height),l=new Ue({source:o,frame:a});this.chars[t]={id:t.codePointAt(0),xOffset:r.xOffset,yOffset:r.yOffset,xAdvance:r.xAdvance,kerning:null!=(e=r.kerning)?e:{},texture:l}})),this.baseRenderedFontSize=s.fontSize,this.baseMeasurementFontSize=s.fontSize,this.fontMetrics={ascent:0,descent:0,fontSize:s.fontSize},this.baseLineOffset=s.baseLineOffset,this.lineHeight=s.lineHeight,this.fontFamily=s.fontFamily,this.distanceField=null!=(r=s.distanceField)?r:{type:"none",range:0},this.url=e}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{texture:e}=this.pages[t];e.destroy(!0)}this.pages=null}static install(t){rc.install(t)}static uninstall(t){rc.uninstall(t)}}const mp={test:t=>"string"==typeof t&&t.startsWith("info face="),parse(t){var e,r,i;const s=t.match(/^[a-z]+\s+.+$/gm),n={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const t in s){const e=s[t].match(/^[a-z]+/gm)[0],r=s[t].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),i={};for(const t in r){const e=r[t].split("="),s=e[0],n=e[1].replace(/"/gm,""),o=parseFloat(n),a=isNaN(o)?n:o;i[s]=a}n[e].push(i)}const o={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[a]=n.info,[l]=n.common,[h]=null!=(e=n.distanceField)?e:[];h&&(o.distanceField={range:parseInt(h.distanceRange,10),type:h.fieldType}),o.fontSize=parseInt(a.size,10),o.fontFamily=a.face,o.lineHeight=parseInt(l.lineHeight,10);const u=n.page;for(let t=0;t<u.length;t++)o.pages.push({id:parseInt(u[t].id,10)||0,file:u[t].file});const c={};o.baseLineOffset=o.lineHeight-parseInt(l.base,10);const d=n.char;for(let t=0;t<d.length;t++){const e=d[t],s=parseInt(e.id,10);let n=null!=(i=null!=(r=e.letter)?r:e.char)?i:String.fromCharCode(s);"space"===n&&(n=" "),c[s]=n,o.chars[n]={id:s,page:parseInt(e.page,10)||0,x:parseInt(e.x,10),y:parseInt(e.y,10),width:parseInt(e.width,10),height:parseInt(e.height,10),xOffset:parseInt(e.xoffset,10),yOffset:parseInt(e.yoffset,10),xAdvance:parseInt(e.xadvance,10),kerning:{}}}const p=n.kerning||[];for(let t=0;t<p.length;t++){const e=parseInt(p[t].first,10),r=parseInt(p[t].second,10),i=parseInt(p[t].amount,10);o.chars[c[r]].kerning[c[e]]=i}return o}},_p={test(t){const e=t;return"string"!=typeof e&&"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&null!==e.getElementsByTagName("info")[0].getAttribute("face")},parse(t){var e,r;const i={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},s=t.getElementsByTagName("info")[0],n=t.getElementsByTagName("common")[0],o=t.getElementsByTagName("distanceField")[0];o&&(i.distanceField={type:o.getAttribute("fieldType"),range:parseInt(o.getAttribute("distanceRange"),10)});const a=t.getElementsByTagName("page"),l=t.getElementsByTagName("char"),h=t.getElementsByTagName("kerning");i.fontSize=parseInt(s.getAttribute("size"),10),i.fontFamily=s.getAttribute("face"),i.lineHeight=parseInt(n.getAttribute("lineHeight"),10);for(let t=0;t<a.length;t++)i.pages.push({id:parseInt(a[t].getAttribute("id"),10)||0,file:a[t].getAttribute("file")});const u={};i.baseLineOffset=i.lineHeight-parseInt(n.getAttribute("base"),10);for(let t=0;t<l.length;t++){const s=l[t],n=parseInt(s.getAttribute("id"),10);let o=null!=(r=null!=(e=s.getAttribute("letter"))?e:s.getAttribute("char"))?r:String.fromCharCode(n);"space"===o&&(o=" "),u[n]=o,i.chars[o]={id:n,page:parseInt(s.getAttribute("page"),10)||0,x:parseInt(s.getAttribute("x"),10),y:parseInt(s.getAttribute("y"),10),width:parseInt(s.getAttribute("width"),10),height:parseInt(s.getAttribute("height"),10),xOffset:parseInt(s.getAttribute("xoffset"),10),yOffset:parseInt(s.getAttribute("yoffset"),10),xAdvance:parseInt(s.getAttribute("xadvance"),10),kerning:{}}}for(let t=0;t<h.length;t++){const e=parseInt(h[t].getAttribute("first"),10),r=parseInt(h[t].getAttribute("second"),10),s=parseInt(h[t].getAttribute("amount"),10);i.chars[u[r]].kerning[u[e]]=s}return i}},xp={test:t=>!("string"!=typeof t||!t.includes("<font>"))&&_p.test(ri.get().parseXML(t)),parse:t=>_p.parse(ri.get().parseXML(t))},yp=[".xml",".fnt"],bp={extension:{type:u.CacheParser,name:"cacheBitmapFont"},test:t=>t instanceof gp,getCacheableAssets(t,e){const r={};return t.forEach((t=>{r[t]=e,r[`${t}-bitmap`]=e})),r[`${e.fontFamily}-bitmap`]=e,r}},vp={extension:{type:u.LoadParser,priority:Jr.Normal},name:"loadBitmapFont",test:t=>yp.includes(ni.extname(t).toLowerCase()),testParse:async t=>mp.test(t)||xp.test(t),async parse(t,e,r){const i=mp.test(t)?mp.parse(t):xp.parse(t),{src:s}=e,{pages:n}=i,o=[],a=i.distanceField?{scaleMode:"linear",alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:!1,resolution:1}:{};for(let t=0;t<n.length;++t){const e=n[t].file;let r=ni.join(ni.dirname(s),e);r=bi(r,s),o.push({src:r,data:a})}const l=await r.load(o),h=o.map((t=>l[t.src]));return new gp({data:i,textures:h},s)},load:async(t,e)=>await(await ri.get().fetch(t)).text(),async unload(t,e,r){await Promise.all(t.pages.map((t=>r.unload(t.texture.source._sourceOrigin)))),t.destroy()}};class Tp{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach((t=>{this._assetList.push(t)})),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<e;r++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}const Sp={extension:{type:u.CacheParser,name:"cacheTextureArray"},test:t=>Array.isArray(t)&&t.every((t=>t instanceof Ue)),getCacheableAssets:(t,e)=>{const r={};return t.forEach((t=>{e.forEach(((e,i)=>{r[t+(0===i?"":i+1)]=e}))})),r}};async function wp(t){if("Image"in globalThis)return new Promise((e=>{const r=new Image;r.onload=()=>{e(!0)},r.onerror=()=>{e(!1)},r.src=t}));if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const e=await(await fetch(t)).blob();await createImageBitmap(e)}catch(t){return!1}return!0}return!1}const Ep={extension:{type:u.DetectionParser,priority:1},test:async()=>wp("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async t=>[...t,"avif"],remove:async t=>t.filter((t=>"avif"!==t))},Ap=["png","jpg","jpeg"],Pp={extension:{type:u.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async t=>[...t,...Ap],remove:async t=>t.filter((t=>!Ap.includes(t)))},Mp="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Rp(t){return!Mp&&""!==document.createElement("video").canPlayType(t)}const Cp={extension:{type:u.DetectionParser,priority:0},test:async()=>Rp("video/mp4"),add:async t=>[...t,"mp4","m4v"],remove:async t=>t.filter((t=>"mp4"!==t&&"m4v"!==t))},Op={extension:{type:u.DetectionParser,priority:0},test:async()=>Rp("video/ogg"),add:async t=>[...t,"ogv"],remove:async t=>t.filter((t=>"ogv"!==t))},Ip={extension:{type:u.DetectionParser,priority:0},test:async()=>Rp("video/webm"),add:async t=>[...t,"webm"],remove:async t=>t.filter((t=>"webm"!==t))},Bp={extension:{type:u.DetectionParser,priority:0},test:async()=>wp("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async t=>[...t,"webp"],remove:async t=>t.filter((t=>"webp"!==t))};var kp=Object.defineProperty,Gp=Object.defineProperties,Dp=Object.getOwnPropertyDescriptors,Fp=Object.getOwnPropertySymbols,Np=Object.prototype.hasOwnProperty,Up=Object.prototype.propertyIsEnumerable,Lp=(t,e,r)=>e in t?kp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;class zp{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,r)=>(this._parsersValidated=!1,t[e]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const r={promise:null,parser:null};return r.promise=(async()=>{var i,s;let n=null,o=null;if(e.loadParser&&(o=this._parserHash[e.loadParser]),!o){for(let r=0;r<this.parsers.length;r++){const s=this.parsers[r];if(s.load&&null!=(i=s.test)&&i.call(s,t,e,this)){o=s;break}}if(!o)return null}n=await o.load(t,e,this),r.parser=o;for(let t=0;t<this.parsers.length;t++){const i=this.parsers[t];i.parse&&i.parse&&await(null==(s=i.testParse)?void 0:s.call(i,n,e,this))&&(n=await i.parse(n,e,this)||n,r.parser=i)}return n})(),r}async load(t,e){this._parsersValidated||this._validateParsers();let r=0;const i={},s=hi(t),n=oi(t,(t=>({alias:[t],src:t,data:{}}))),o=n.length,a=n.map((async t=>{const s=ni.toAbsolute(t.src);if(!i[t.src])try{this.promiseCache[s]||(this.promiseCache[s]=this._getLoadPromiseAndParser(s,t)),i[t.src]=await this.promiseCache[s].promise,e&&e(++r/o)}catch(e){throw delete this.promiseCache[s],delete i[t.src],new Error(`[Loader.load] Failed to load ${s}.\n${e}`)}}));return await Promise.all(a),s?i[n[0].src]:i}async unload(t){const e=oi(t,(t=>({alias:[t],src:t}))).map((async t=>{var e,r;const i=ni.toAbsolute(t.src),s=this.promiseCache[i];if(s){const n=await s.promise;delete this.promiseCache[i],await(null==(r=null==(e=s.parser)?void 0:e.unload)?void 0:r.call(e,n,t,this))}}));await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter((t=>t.name)).reduce(((t,e)=>(e.name&&t[e.name],((t,e)=>Gp(t,Dp(e)))(((t,e)=>{for(var r in e||(e={}))Np.call(e,r)&&Lp(t,r,e[r]);if(Fp)for(var r of Fp(e))Up.call(e,r)&&Lp(t,r,e[r]);return t})({},t),{[e.name]:e}))),{})}}function Xp(t,e){if(Array.isArray(e)){for(const r of e)if(t.startsWith(`data:${r}`))return!0;return!1}return t.startsWith(`data:${e}`)}function Hp(t,e){const r=t.split("?")[0],i=ni.extname(r).toLowerCase();return Array.isArray(e)?e.includes(i):i===e}const jp={extension:{type:u.LoadParser,priority:Jr.Low},name:"loadJson",test:t=>Xp(t,"application/json")||Hp(t,".json"),load:async t=>await(await ri.get().fetch(t)).json()},Vp={name:"loadTxt",extension:{type:u.LoadParser,priority:Jr.Low,name:"loadTxt"},test:t=>Xp(t,"text/plain")||Hp(t,".txt"),load:async t=>await(await ri.get().fetch(t)).text()};var Wp=Object.defineProperty,$p=Object.defineProperties,Yp=Object.getOwnPropertyDescriptors,qp=Object.getOwnPropertySymbols,Kp=Object.prototype.hasOwnProperty,Qp=Object.prototype.propertyIsEnumerable,Zp=(t,e,r)=>e in t?Wp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Jp=(t,e)=>{for(var r in e||(e={}))Kp.call(e,r)&&Zp(t,r,e[r]);if(qp)for(var r of qp(e))Qp.call(e,r)&&Zp(t,r,e[r]);return t},tf=(t,e)=>$p(t,Yp(e));const ef=["normal","bold","100","200","300","400","500","600","700","800","900"],rf=[".ttf",".otf",".woff",".woff2"],sf=["font/ttf","font/otf","font/woff","font/woff2"],nf=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function of(t){const e=ni.extname(t),r=ni.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map((t=>t.charAt(0).toUpperCase()+t.slice(1)));let i=r.length>0;for(const t of r)if(!t.match(nf)){i=!1;break}let s=r.join(" ");return i||(s=`"${s.replace(/[\\"]/g,"\\$&")}"`),s}const af=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function lf(t){return af.test(t)?t:encodeURI(t)}const hf={extension:{type:u.LoadParser,priority:Jr.Low},name:"loadWebFont",test:t=>Xp(t,sf)||Hp(t,rf),async load(t,e){var r,i,s,n,o,a;const l=ri.get().getFontFaceSet();if(l){const h=[],u=null!=(i=null==(r=e.data)?void 0:r.family)?i:of(t),c=null!=(o=null==(n=null==(s=e.data)?void 0:s.weights)?void 0:n.filter((t=>ef.includes(t))))?o:["normal"],d=null!=(a=e.data)?a:{};for(let e=0;e<c.length;e++){const r=c[e],i=new FontFace(u,`url(${lf(t)})`,tf(Jp({},d),{weight:r}));await i.load(),l.add(i),h.push(i)}return es.set(`${u}-and-url`,{url:t,fontFaces:h}),1===h.length?h[0]:h}return null},unload(t){(Array.isArray(t)?t:[t]).forEach((t=>{es.remove(`${t.family}-and-url`),ri.get().getFontFaceSet().delete(t)}))}};function uf(t,e=1){var r;const i=null==(r=xi.RETINA_PREFIX)?void 0:r.exec(t);return i?parseFloat(i[1]):e}function cf(t,e,r){t.label=r,t._sourceOrigin=r;const i=new Ue({source:t,label:r}),s=()=>{delete e.promiseCache[r],es.has(r)&&es.remove(r)};return i.source.once("destroy",(()=>{e.promiseCache[r]&&s()})),i.once("destroy",(()=>{t.destroyed||s()})),i}var df=Object.defineProperty,pf=Object.getOwnPropertySymbols,ff=Object.prototype.hasOwnProperty,gf=Object.prototype.propertyIsEnumerable,mf=(t,e,r)=>e in t?df(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;const _f={extension:{type:u.LoadParser,priority:Jr.Low,name:"loadSVG"},name:"loadSVG",config:{crossOrigin:"anonymous",parseAsGraphicsContext:!1},test:t=>Xp(t,"image/svg+xml")||Hp(t,".svg"),async load(t,e,r){var i,s;return(null!=(s=null==(i=e.data)?void 0:i.parseAsGraphicsContext)?s:this.config.parseAsGraphicsContext)?async function(t){const e=await(await ri.get().fetch(t)).text(),r=new eu;return r.svg(e),r}(t):async function(t,e,r,i){var s,n,o,a,l,h;const u=await(await ri.get().fetch(t)).blob(),c=URL.createObjectURL(u),d=new Image;d.src=c,d.crossOrigin=i,await d.decode(),URL.revokeObjectURL(c);const p=document.createElement("canvas"),f=p.getContext("2d"),g=(null==(s=e.data)?void 0:s.resolution)||uf(t),m=null!=(o=null==(n=e.data)?void 0:n.width)?o:d.width,_=null!=(l=null==(a=e.data)?void 0:a.height)?l:d.height;p.width=m*g,p.height=_*g,f.drawImage(d,0,0,m*g,_*g);const x=null!=(h=e.data)?h:{},{parseAsGraphicsContext:y}=x,b=((t,e)=>{var r={};for(var i in t)ff.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&pf)for(var i of pf(t))e.indexOf(i)<0&&gf.call(t,i)&&(r[i]=t[i]);return r})(x,["parseAsGraphicsContext"]);return cf(new Xi(((t,e)=>{for(var r in e||(e={}))ff.call(e,r)&&mf(t,r,e[r]);if(pf)for(var r of pf(e))gf.call(e,r)&&mf(t,r,e[r]);return t})({resource:p,alphaMode:"premultiply-alpha-on-upload",resolution:g},b)),r,t)}(t,e,r,this.config.crossOrigin)},unload(t){t.destroy(!0)}};let xf=null,yf=class{constructor(){xf||(xf=URL.createObjectURL(new Blob(['(function(){"use strict";const e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";async function a(){try{if(typeof createImageBitmap!="function")return!1;const A=await(await fetch(e)).blob(),t=await createImageBitmap(A);return t.width===1&&t.height===1}catch(A){return!1}}a().then(A=>{self.postMessage(A)})})();\n'],{type:"application/javascript"}))),this.worker=new Worker(xf)}};yf.revokeObjectURL=function(){xf&&(URL.revokeObjectURL(xf),xf=null)};let bf=null,vf=class{constructor(){bf||(bf=URL.createObjectURL(new Blob(['(function(){"use strict";async function s(a,t){const e=await fetch(a);if(!e.ok)throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${a}: ${e.status} ${e.statusText}`);const i=await e.blob();return t==="premultiplied-alpha"?createImageBitmap(i,{premultiplyAlpha:"none"}):createImageBitmap(i)}self.onmessage=async a=>{try{const t=await s(a.data.data[0],a.data.data[1]);self.postMessage({data:t,uuid:a.data.uuid,id:a.data.id},[t])}catch(t){self.postMessage({error:t,uuid:a.data.uuid,id:a.data.id})}}})();\n'],{type:"application/javascript"}))),this.worker=new Worker(bf)}};vf.revokeObjectURL=function(){bf&&(URL.revokeObjectURL(bf),bf=null)};let Tf,Sf=0;const wf=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise((t=>{const{worker:e}=new yf;e.addEventListener("message",(r=>{e.terminate(),yf.revokeObjectURL(),t(r.data)}))}))),this._isImageBitmapSupported}loadImageBitmap(t,e){var r;return this._run("loadImageBitmap",[t,null==(r=null==e?void 0:e.data)?void 0:r.alphaMode])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){void 0===Tf&&(Tf=navigator.hardwareConcurrency||4);let t=this._workerPool.pop();return!t&&this._createdWorkers<Tf&&(this._createdWorkers++,t=(new vf).worker,t.addEventListener("message",(t=>{this._complete(t.data),this._returnWorker(t.target),this._next()}))),t}_returnWorker(t){this._workerPool.push(t)}_complete(t){void 0!==t.error?this._resolveHash[t.uuid].reject(t.error):this._resolveHash[t.uuid].resolve(t.data),this._resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const r=new Promise(((r,i)=>{this._queue.push({id:t,arguments:e,resolve:r,reject:i})}));return this._next(),r}_next(){if(!this._queue.length)return;const t=this._getWorker();if(!t)return;const e=this._queue.pop(),r=e.id;this._resolveHash[Sf]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Sf++,id:r})}};var Ef=Object.defineProperty,Af=Object.getOwnPropertySymbols,Pf=Object.prototype.hasOwnProperty,Mf=Object.prototype.propertyIsEnumerable,Rf=(t,e,r)=>e in t?Ef(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;const Cf=[".jpeg",".jpg",".png",".webp",".avif"],Of=["image/jpeg","image/png","image/webp","image/avif"];async function If(t,e){var r;const i=await ri.get().fetch(t);if(!i.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${i.status} ${i.statusText}`);const s=await i.blob();return"premultiplied-alpha"===(null==(r=null==e?void 0:e.data)?void 0:r.alphaMode)?createImageBitmap(s,{premultiplyAlpha:"none"}):createImageBitmap(s)}const Bf={name:"loadTextures",extension:{type:u.LoadParser,priority:Jr.High,name:"loadTextures"},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:t=>Xp(t,Of)||Hp(t,Cf),async load(t,e,r){var i;let s=null;s=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await wf.isImageBitmapSupported()?await wf.loadImageBitmap(t,e):await If(t,e):await new Promise(((e,r)=>{s=new Image,s.crossOrigin=this.config.crossOrigin,s.src=t,s.complete?e(s):(s.onload=()=>{e(s)},s.onerror=r)}));const n=new Xi(((t,e)=>{for(var r in e||(e={}))Pf.call(e,r)&&Rf(t,r,e[r]);if(Af)for(var r of Af(e))Mf.call(e,r)&&Rf(t,r,e[r]);return t})({resource:s,alphaMode:"premultiply-alpha-on-upload",resolution:(null==(i=e.data)?void 0:i.resolution)||uf(t)},e.data));return cf(n,r,t)},unload(t){t.destroy(!0)}};var kf=Object.defineProperty,Gf=Object.defineProperties,Df=Object.getOwnPropertyDescriptors,Ff=Object.getOwnPropertySymbols,Nf=Object.prototype.hasOwnProperty,Uf=Object.prototype.propertyIsEnumerable,Lf=(t,e,r)=>e in t?kf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,zf=(t,e)=>{for(var r in e||(e={}))Nf.call(e,r)&&Lf(t,r,e[r]);if(Ff)for(var r of Ff(e))Uf.call(e,r)&&Lf(t,r,e[r]);return t},Xf=(t,e)=>Gf(t,Df(e));const Hf=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"],jf=Hf.map((t=>`video/${t.substring(1)}`));function Vf(t,e,r){void 0!==r||e.startsWith("data:")?!1!==r&&(t.crossOrigin="string"==typeof r?r:"anonymous"):t.crossOrigin=$f(e)}function Wf(t){return new Promise(((e,r)=>{function i(){n(),e()}function s(t){n(),r(t)}function n(){t.removeEventListener("canplaythrough",i),t.removeEventListener("error",s)}t.addEventListener("canplaythrough",i),t.addEventListener("error",s),t.load()}))}function $f(t,e=globalThis.location){if(t.startsWith("data:"))return"";e||(e=globalThis.location);const r=new URL(t,document.baseURI);return r.hostname!==e.hostname||r.port!==e.port||r.protocol!==e.protocol?"anonymous":""}const Yf={name:"loadVideo",extension:{type:u.LoadParser,name:"loadVideo"},test(t){const e=Xp(t,jf),r=Hp(t,Hf);return e||r},async load(t,e,r){var i,s;const n=zf(Xf(zf({},ts.defaultOptions),{resolution:(null==(i=e.data)?void 0:i.resolution)||uf(t),alphaMode:(null==(s=e.data)?void 0:s.alphaMode)||await ji()}),e.data),o=document.createElement("video"),a={preload:!1!==n.autoLoad?"auto":void 0,"webkit-playsinline":!1!==n.playsinline?"":void 0,playsinline:!1!==n.playsinline?"":void 0,muted:!0===n.muted?"":void 0,loop:!0===n.loop?"":void 0,autoplay:!1!==n.autoPlay?"":void 0};Object.keys(a).forEach((t=>{const e=a[t];void 0!==e&&o.setAttribute(t,e)})),!0===n.muted&&(o.muted=!0),Vf(o,t,n.crossorigin);const l=document.createElement("source");let h;if(t.startsWith("data:"))h=t.slice(5,t.indexOf(";"));else if(!t.startsWith("blob:")){const e=t.split("?")[0].slice(t.lastIndexOf(".")+1).toLowerCase();h=ts.MIME_TYPES[e]||`video/${e}`}return l.src=t,h&&(l.type=h),new Promise((i=>{const s=async()=>{const a=new ts(Xf(zf({},n),{resource:o}));o.removeEventListener("canplay",s),e.data.preload&&await Wf(o),i(cf(a,r,t))};o.addEventListener("canplay",s),o.appendChild(l)}))},unload(t){t.destroy(!0)}},qf={extension:{type:u.ResolveParser,name:"resolveTexture"},test:Bf.test,parse:t=>{var e,r;return{resolution:parseFloat(null!=(r=null==(e=xi.RETINA_PREFIX.exec(t))?void 0:e[1])?r:"1"),format:t.split(".").pop(),src:t}}},Kf={extension:{type:u.ResolveParser,priority:-2,name:"resolveJson"},test:t=>xi.RETINA_PREFIX.test(t)&&t.endsWith(".json"),parse:qf.parse};class Qf{constructor(){this._detections=[],this._initialized=!1,this.resolver=new xi,this.loader=new zp,this.cache=es,this._backgroundLoader=new Tp(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var e,r,i;if(this._initialized)return;if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let e=t.manifest;"string"==typeof e&&(e=await this.load(e)),this.resolver.addManifest(e)}const s=null!=(r=null==(e=t.texturePreference)?void 0:e.resolution)?r:1,n="number"==typeof s?[s]:s,o=await this._detectFormats({preferredFormats:null==(i=t.texturePreference)?void 0:i.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:o,resolution:n}}),t.preferences&&this.setPreferences(t.preferences)}add(t){this.resolver.add(t)}async load(t,e){this._initialized||await this.init();const r=hi(t),i=oi(t).map((t=>{if("string"!=typeof t){const e=this.resolver.getAlias(t);return e.some((t=>!this.resolver.hasKey(t)))&&this.add(t),Array.isArray(e)?e[0]:e}return this.resolver.hasKey(t)||this.add({alias:t,src:t}),t})),s=this.resolver.resolve(i),n=await this._mapLoadToResolve(s,e);return r?n[i[0]]:n}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let r=!1;"string"==typeof t&&(r=!0,t=[t]);const i=this.resolver.resolveBundle(t),s={},n=Object.keys(i);let o=0,a=0;const l=()=>{null==e||e(++o/a)},h=n.map((t=>{const e=i[t];return a+=Object.keys(e).length,this._mapLoadToResolve(e,l).then((e=>{s[t]=e}))}));return await Promise.all(h),r?s[t[0]]:s}async backgroundLoad(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach((t=>{this._backgroundLoader.add(Object.values(t))}))}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if("string"==typeof t)return es.get(t);const e={};for(let r=0;r<t.length;r++)e[r]=es.get(t[r]);return e}async _mapLoadToResolve(t,e){const r=[...new Set(Object.values(t))];this._backgroundLoader.active=!1;const i=await this.loader.load(r,e);this._backgroundLoader.active=!0;const s={};return r.forEach((t=>{const e=i[t.src],r=[t.src];t.alias&&r.push(...t.alias),r.forEach((t=>{s[t]=e})),es.set(r,e)})),s}async unload(t){this._initialized||await this.init();const e=oi(t).map((t=>"string"!=typeof t?t.src:t)),r=this.resolver.resolve(e);await this._unloadFromResolved(r)}async unloadBundle(t){this._initialized||await this.init(),t=oi(t);const e=this.resolver.resolveBundle(t),r=Object.keys(e).map((t=>this._unloadFromResolved(e[t])));await Promise.all(r)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach((t=>{es.remove(t.src)})),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const r of t.detections)t.skipDetections||await r.test()?e=await r.add(e):t.skipDetections||(e=await r.remove(e));return e=e.filter(((t,r)=>e.indexOf(t)===r)),e}get detections(){return this._detections}setPreferences(t){this.loader.parsers.forEach((e=>{e.config&&Object.keys(e.config).filter((e=>e in t)).forEach((r=>{e.config[r]=t[r]}))}))}}const Zf=new Qf;p.handleByList(u.LoadParser,Zf.loader.parsers).handleByList(u.ResolveParser,Zf.resolver.parsers).handleByList(u.CacheParser,Zf.cache.parsers).handleByList(u.DetectionParser,Zf.detections),p.add(Sp,Pp,Ep,Bp,Cp,Op,Ip,jp,Vp,hf,_f,Bf,Yf,vp,bp,qf,Kf);const Jf={loader:u.LoadParser,resolver:u.ResolveParser,cache:u.CacheParser,detection:u.DetectionParser};p.handle(u.Asset,(t=>{const e=t.ref;Object.entries(Jf).filter((([t])=>!!e[t])).forEach((([t,r])=>{var i;return p.add(Object.assign(e[t],{extension:null!=(i=e[t].extension)?i:r}))}))}),(t=>{const e=t.ref;Object.keys(Jf).filter((t=>!!e[t])).forEach((t=>p.remove(e[t])))}));const tg={extension:{type:u.DetectionParser,priority:3},test:async()=>!(!await Kd()&&!qd()),add:async t=>[...t,"basis"],remove:async t=>t.filter((t=>"basis"!==t))};class eg extends ye{constructor(t){super(t),this.uploadMethodId="compressed",this.resource=t.resource,this.mipLevelCount=this.resource.length}}let rg,ig,sg;function ng(){if(rg)return rg;const t=document.createElement("canvas").getContext("webgl");return t?(rg=[...t.getExtension("EXT_texture_compression_bptc")?["bc6h-rgb-ufloat","bc6h-rgb-float","bc7-rgba-unorm","bc7-rgba-unorm-srgb"]:[],...t.getExtension("WEBGL_compressed_texture_s3tc")?["bc1-rgba-unorm","bc2-rgba-unorm","bc3-rgba-unorm"]:[],...t.getExtension("WEBGL_compressed_texture_s3tc_srgb")?["bc1-rgba-unorm-srgb","bc2-rgba-unorm-srgb","bc3-rgba-unorm-srgb"]:[],...t.getExtension("EXT_texture_compression_rgtc")?["bc4-r-unorm","bc4-r-snorm","bc5-rg-unorm","bc5-rg-snorm"]:[],...t.getExtension("WEBGL_compressed_texture_etc")?["etc2-rgb8unorm","etc2-rgb8unorm-srgb","etc2-rgba8unorm","etc2-rgba8unorm-srgb","etc2-rgb8a1unorm","etc2-rgb8a1unorm-srgb","eac-r11unorm","eac-rg11unorm"]:[],...t.getExtension("WEBGL_compressed_texture_astc")?["astc-4x4-unorm","astc-4x4-unorm-srgb","astc-5x4-unorm","astc-5x4-unorm-srgb","astc-5x5-unorm","astc-5x5-unorm-srgb","astc-6x5-unorm","astc-6x5-unorm-srgb","astc-6x6-unorm","astc-6x6-unorm-srgb","astc-8x5-unorm","astc-8x5-unorm-srgb","astc-8x6-unorm","astc-8x6-unorm-srgb","astc-8x8-unorm","astc-8x8-unorm-srgb","astc-10x5-unorm","astc-10x5-unorm-srgb","astc-10x6-unorm","astc-10x6-unorm-srgb","astc-10x8-unorm","astc-10x8-unorm-srgb","astc-10x10-unorm","astc-10x10-unorm-srgb","astc-12x10-unorm","astc-12x10-unorm-srgb","astc-12x12-unorm","astc-12x12-unorm-srgb"]:[]],rg):[]}async function og(){if(ig)return ig;const t=await ri.get().getNavigator().gpu.requestAdapter();return ig=[...t.features.has("texture-compression-bc")?["bc1-rgba-unorm","bc1-rgba-unorm-srgb","bc2-rgba-unorm","bc2-rgba-unorm-srgb","bc3-rgba-unorm","bc3-rgba-unorm-srgb","bc4-r-unorm","bc4-r-snorm","bc5-rg-unorm","bc5-rg-snorm","bc6h-rgb-ufloat","bc6h-rgb-float","bc7-rgba-unorm","bc7-rgba-unorm-srgb"]:[],...t.features.has("texture-compression-etc2")?["etc2-rgb8unorm","etc2-rgb8unorm-srgb","etc2-rgb8a1unorm","etc2-rgb8a1unorm-srgb","etc2-rgba8unorm","etc2-rgba8unorm-srgb","eac-r11unorm","eac-r11snorm","eac-rg11unorm","eac-rg11snorm"]:[],...t.features.has("texture-compression-astc")?["astc-4x4-unorm","astc-4x4-unorm-srgb","astc-5x4-unorm","astc-5x4-unorm-srgb","astc-5x5-unorm","astc-5x5-unorm-srgb","astc-6x5-unorm","astc-6x5-unorm-srgb","astc-6x6-unorm","astc-6x6-unorm-srgb","astc-8x5-unorm","astc-8x5-unorm-srgb","astc-8x6-unorm","astc-8x6-unorm-srgb","astc-8x8-unorm","astc-8x8-unorm-srgb","astc-10x5-unorm","astc-10x5-unorm-srgb","astc-10x6-unorm","astc-10x6-unorm-srgb","astc-10x8-unorm","astc-10x8-unorm-srgb","astc-10x10-unorm","astc-10x10-unorm-srgb","astc-12x10-unorm","astc-12x10-unorm-srgb","astc-12x12-unorm","astc-12x12-unorm-srgb"]:[]],ig}async function ag(){return void 0!==sg||(sg=await(async()=>{const t=await Kd(),e=qd();if(t&&e){const t=await og(),e=ng();return t.filter((t=>e.includes(t)))}return t?await og():e?ng():[]})()),sg}const lg=["r8unorm","r8snorm","r8uint","r8sint","r16uint","r16sint","r16float","rg8unorm","rg8snorm","rg8uint","rg8sint","r32uint","r32sint","r32float","rg16uint","rg16sint","rg16float","rgba8unorm","rgba8unorm-srgb","rgba8snorm","rgba8uint","rgba8sint","bgra8unorm","bgra8unorm-srgb","rgb9e5ufloat","rgb10a2unorm","rg11b10ufloat","rg32uint","rg32sint","rg32float","rgba16uint","rgba16sint","rgba16float","rgba32uint","rgba32sint","rgba32float","stencil8","depth16unorm","depth24plus","depth24plus-stencil8","depth32float","depth32float-stencil8"];let hg;async function ug(){if(void 0!==hg)return hg;const t=await ag();return hg=[...lg,...t],hg}let cg=null,dg=class{constructor(){cg||(cg=URL.createObjectURL(new Blob(['(function(){"use strict";function g(r,a){const t=r.getNumImages(),s=r.getNumLevels(0);if(!r.startTranscoding())throw new Error("startTranscoding failed");const m=[];for(let e=0;e<s;++e)for(let o=0;o<t;++o){const B=r.getImageTranscodedSizeInBytes(o,e,a),f=new Uint8Array(B);if(!r.transcodeImage(f,o,e,a,1,0))throw new Error("transcodeImage failed");m.push(f)}return m}const w={"bc3-rgba-unorm":3,"bc7-rgba-unorm":6,"etc2-rgba8unorm":1,"astc-4x4-unorm":10,rgba8unorm:13,rgba4unorm:16};function d(r){const a=w[r];if(a)return a;throw new Error(`Unsupported transcoderFormat: ${r}`)}const n={jsUrl:"basis/basis_transcoder.js",wasmUrl:"basis/basis_transcoder.wasm"};let u,i,c;async function l(){if(!c){const r=new URL(n.jsUrl,location.origin).href,a=new URL(n.wasmUrl,location.origin).href;importScripts(r),c=new Promise(t=>{BASIS({locateFile:s=>a}).then(s=>{s.initializeBasis(),t(s.BasisFile)})})}return c}async function b(r,a){const t=await fetch(r);if(t.ok){const s=await t.arrayBuffer();return new a(new Uint8Array(s))}throw new Error(`Failed to load Basis texture: ${r}`)}const h=["bc7-rgba-unorm","astc-4x4-unorm","etc2-rgba8unorm","bc3-rgba-unorm","rgba8unorm"];async function p(r){const a=await l(),t=await b(r,a),s=g(t,u);return{width:t.getImageWidth(0,0),height:t.getImageHeight(0,0),format:i,resource:s,alphaMode:"no-premultiply-alpha"}}async function y(r,a,t){r&&(n.jsUrl=r),a&&(n.wasmUrl=a),i=h.filter(s=>t.includes(s))[0],u=d(i),await l()}const U={init:async r=>{const{jsUrl:a,wasmUrl:t,supportedTextures:s}=r;await y(a,t,s)},load:async r=>{var a;try{const t=await p(r.url);return{type:"load",url:r.url,success:!0,textureOptions:t,transferables:(a=t.resource)==null?void 0:a.map(s=>s.buffer)}}catch(t){throw t}}};self.onmessage=async r=>{const a=r.data,t=await U[a.type](a);t&&self.postMessage(t,t.transferables)}})();\n'],{type:"application/javascript"}))),this.worker=new Worker(cg)}};dg.revokeObjectURL=function(){cg&&(URL.revokeObjectURL(cg),cg=null)};const pg={jsUrl:"https://files.pixijs.download/transcoders/basis/basis_transcoder.js",wasmUrl:"https://files.pixijs.download/transcoders/basis/basis_transcoder.wasm"};let fg;const gg={};function mg(t,e){const r=function(t){return fg||(fg=(new dg).worker,fg.onmessage=t=>{const{success:e,url:r,textureOptions:i}=t.data;e||console.warn("Failed to load Basis texture",r),gg[r](i)},fg.postMessage({type:"init",jsUrl:pg.jsUrl,wasmUrl:pg.wasmUrl,supportedTextures:t})),fg}(e);return new Promise((e=>{gg[t]=e,r.postMessage({type:"load",url:t})}))}const _g={extension:{type:u.LoadParser,priority:Jr.High,name:"loadBasis"},name:"loadBasis",test:t=>Hp(t,[".basis"]),async load(t,e,r){const i=await ug(),s=await mg(t,i);return cf(new eg(s),r,t)},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};const xg={"bc3-rgba-unorm":3,"bc7-rgba-unorm":6,"etc2-rgba8unorm":1,"astc-4x4-unorm":10,rgba8unorm:13,rgba4unorm:16};var yg=(t=>(t[t.DXGI_FORMAT_UNKNOWN=0]="DXGI_FORMAT_UNKNOWN",t[t.DXGI_FORMAT_R32G32B32A32_TYPELESS=1]="DXGI_FORMAT_R32G32B32A32_TYPELESS",t[t.DXGI_FORMAT_R32G32B32A32_FLOAT=2]="DXGI_FORMAT_R32G32B32A32_FLOAT",t[t.DXGI_FORMAT_R32G32B32A32_UINT=3]="DXGI_FORMAT_R32G32B32A32_UINT",t[t.DXGI_FORMAT_R32G32B32A32_SINT=4]="DXGI_FORMAT_R32G32B32A32_SINT",t[t.DXGI_FORMAT_R32G32B32_TYPELESS=5]="DXGI_FORMAT_R32G32B32_TYPELESS",t[t.DXGI_FORMAT_R32G32B32_FLOAT=6]="DXGI_FORMAT_R32G32B32_FLOAT",t[t.DXGI_FORMAT_R32G32B32_UINT=7]="DXGI_FORMAT_R32G32B32_UINT",t[t.DXGI_FORMAT_R32G32B32_SINT=8]="DXGI_FORMAT_R32G32B32_SINT",t[t.DXGI_FORMAT_R16G16B16A16_TYPELESS=9]="DXGI_FORMAT_R16G16B16A16_TYPELESS",t[t.DXGI_FORMAT_R16G16B16A16_FLOAT=10]="DXGI_FORMAT_R16G16B16A16_FLOAT",t[t.DXGI_FORMAT_R16G16B16A16_UNORM=11]="DXGI_FORMAT_R16G16B16A16_UNORM",t[t.DXGI_FORMAT_R16G16B16A16_UINT=12]="DXGI_FORMAT_R16G16B16A16_UINT",t[t.DXGI_FORMAT_R16G16B16A16_SNORM=13]="DXGI_FORMAT_R16G16B16A16_SNORM",t[t.DXGI_FORMAT_R16G16B16A16_SINT=14]="DXGI_FORMAT_R16G16B16A16_SINT",t[t.DXGI_FORMAT_R32G32_TYPELESS=15]="DXGI_FORMAT_R32G32_TYPELESS",t[t.DXGI_FORMAT_R32G32_FLOAT=16]="DXGI_FORMAT_R32G32_FLOAT",t[t.DXGI_FORMAT_R32G32_UINT=17]="DXGI_FORMAT_R32G32_UINT",t[t.DXGI_FORMAT_R32G32_SINT=18]="DXGI_FORMAT_R32G32_SINT",t[t.DXGI_FORMAT_R32G8X24_TYPELESS=19]="DXGI_FORMAT_R32G8X24_TYPELESS",t[t.DXGI_FORMAT_D32_FLOAT_S8X24_UINT=20]="DXGI_FORMAT_D32_FLOAT_S8X24_UINT",t[t.DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS=21]="DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS",t[t.DXGI_FORMAT_X32_TYPELESS_G8X24_UINT=22]="DXGI_FORMAT_X32_TYPELESS_G8X24_UINT",t[t.DXGI_FORMAT_R10G10B10A2_TYPELESS=23]="DXGI_FORMAT_R10G10B10A2_TYPELESS",t[t.DXGI_FORMAT_R10G10B10A2_UNORM=24]="DXGI_FORMAT_R10G10B10A2_UNORM",t[t.DXGI_FORMAT_R10G10B10A2_UINT=25]="DXGI_FORMAT_R10G10B10A2_UINT",t[t.DXGI_FORMAT_R11G11B10_FLOAT=26]="DXGI_FORMAT_R11G11B10_FLOAT",t[t.DXGI_FORMAT_R8G8B8A8_TYPELESS=27]="DXGI_FORMAT_R8G8B8A8_TYPELESS",t[t.DXGI_FORMAT_R8G8B8A8_UNORM=28]="DXGI_FORMAT_R8G8B8A8_UNORM",t[t.DXGI_FORMAT_R8G8B8A8_UNORM_SRGB=29]="DXGI_FORMAT_R8G8B8A8_UNORM_SRGB",t[t.DXGI_FORMAT_R8G8B8A8_UINT=30]="DXGI_FORMAT_R8G8B8A8_UINT",t[t.DXGI_FORMAT_R8G8B8A8_SNORM=31]="DXGI_FORMAT_R8G8B8A8_SNORM",t[t.DXGI_FORMAT_R8G8B8A8_SINT=32]="DXGI_FORMAT_R8G8B8A8_SINT",t[t.DXGI_FORMAT_R16G16_TYPELESS=33]="DXGI_FORMAT_R16G16_TYPELESS",t[t.DXGI_FORMAT_R16G16_FLOAT=34]="DXGI_FORMAT_R16G16_FLOAT",t[t.DXGI_FORMAT_R16G16_UNORM=35]="DXGI_FORMAT_R16G16_UNORM",t[t.DXGI_FORMAT_R16G16_UINT=36]="DXGI_FORMAT_R16G16_UINT",t[t.DXGI_FORMAT_R16G16_SNORM=37]="DXGI_FORMAT_R16G16_SNORM",t[t.DXGI_FORMAT_R16G16_SINT=38]="DXGI_FORMAT_R16G16_SINT",t[t.DXGI_FORMAT_R32_TYPELESS=39]="DXGI_FORMAT_R32_TYPELESS",t[t.DXGI_FORMAT_D32_FLOAT=40]="DXGI_FORMAT_D32_FLOAT",t[t.DXGI_FORMAT_R32_FLOAT=41]="DXGI_FORMAT_R32_FLOAT",t[t.DXGI_FORMAT_R32_UINT=42]="DXGI_FORMAT_R32_UINT",t[t.DXGI_FORMAT_R32_SINT=43]="DXGI_FORMAT_R32_SINT",t[t.DXGI_FORMAT_R24G8_TYPELESS=44]="DXGI_FORMAT_R24G8_TYPELESS",t[t.DXGI_FORMAT_D24_UNORM_S8_UINT=45]="DXGI_FORMAT_D24_UNORM_S8_UINT",t[t.DXGI_FORMAT_R24_UNORM_X8_TYPELESS=46]="DXGI_FORMAT_R24_UNORM_X8_TYPELESS",t[t.DXGI_FORMAT_X24_TYPELESS_G8_UINT=47]="DXGI_FORMAT_X24_TYPELESS_G8_UINT",t[t.DXGI_FORMAT_R8G8_TYPELESS=48]="DXGI_FORMAT_R8G8_TYPELESS",t[t.DXGI_FORMAT_R8G8_UNORM=49]="DXGI_FORMAT_R8G8_UNORM",t[t.DXGI_FORMAT_R8G8_UINT=50]="DXGI_FORMAT_R8G8_UINT",t[t.DXGI_FORMAT_R8G8_SNORM=51]="DXGI_FORMAT_R8G8_SNORM",t[t.DXGI_FORMAT_R8G8_SINT=52]="DXGI_FORMAT_R8G8_SINT",t[t.DXGI_FORMAT_R16_TYPELESS=53]="DXGI_FORMAT_R16_TYPELESS",t[t.DXGI_FORMAT_R16_FLOAT=54]="DXGI_FORMAT_R16_FLOAT",t[t.DXGI_FORMAT_D16_UNORM=55]="DXGI_FORMAT_D16_UNORM",t[t.DXGI_FORMAT_R16_UNORM=56]="DXGI_FORMAT_R16_UNORM",t[t.DXGI_FORMAT_R16_UINT=57]="DXGI_FORMAT_R16_UINT",t[t.DXGI_FORMAT_R16_SNORM=58]="DXGI_FORMAT_R16_SNORM",t[t.DXGI_FORMAT_R16_SINT=59]="DXGI_FORMAT_R16_SINT",t[t.DXGI_FORMAT_R8_TYPELESS=60]="DXGI_FORMAT_R8_TYPELESS",t[t.DXGI_FORMAT_R8_UNORM=61]="DXGI_FORMAT_R8_UNORM",t[t.DXGI_FORMAT_R8_UINT=62]="DXGI_FORMAT_R8_UINT",t[t.DXGI_FORMAT_R8_SNORM=63]="DXGI_FORMAT_R8_SNORM",t[t.DXGI_FORMAT_R8_SINT=64]="DXGI_FORMAT_R8_SINT",t[t.DXGI_FORMAT_A8_UNORM=65]="DXGI_FORMAT_A8_UNORM",t[t.DXGI_FORMAT_R1_UNORM=66]="DXGI_FORMAT_R1_UNORM",t[t.DXGI_FORMAT_R9G9B9E5_SHAREDEXP=67]="DXGI_FORMAT_R9G9B9E5_SHAREDEXP",t[t.DXGI_FORMAT_R8G8_B8G8_UNORM=68]="DXGI_FORMAT_R8G8_B8G8_UNORM",t[t.DXGI_FORMAT_G8R8_G8B8_UNORM=69]="DXGI_FORMAT_G8R8_G8B8_UNORM",t[t.DXGI_FORMAT_BC1_TYPELESS=70]="DXGI_FORMAT_BC1_TYPELESS",t[t.DXGI_FORMAT_BC1_UNORM=71]="DXGI_FORMAT_BC1_UNORM",t[t.DXGI_FORMAT_BC1_UNORM_SRGB=72]="DXGI_FORMAT_BC1_UNORM_SRGB",t[t.DXGI_FORMAT_BC2_TYPELESS=73]="DXGI_FORMAT_BC2_TYPELESS",t[t.DXGI_FORMAT_BC2_UNORM=74]="DXGI_FORMAT_BC2_UNORM",t[t.DXGI_FORMAT_BC2_UNORM_SRGB=75]="DXGI_FORMAT_BC2_UNORM_SRGB",t[t.DXGI_FORMAT_BC3_TYPELESS=76]="DXGI_FORMAT_BC3_TYPELESS",t[t.DXGI_FORMAT_BC3_UNORM=77]="DXGI_FORMAT_BC3_UNORM",t[t.DXGI_FORMAT_BC3_UNORM_SRGB=78]="DXGI_FORMAT_BC3_UNORM_SRGB",t[t.DXGI_FORMAT_BC4_TYPELESS=79]="DXGI_FORMAT_BC4_TYPELESS",t[t.DXGI_FORMAT_BC4_UNORM=80]="DXGI_FORMAT_BC4_UNORM",t[t.DXGI_FORMAT_BC4_SNORM=81]="DXGI_FORMAT_BC4_SNORM",t[t.DXGI_FORMAT_BC5_TYPELESS=82]="DXGI_FORMAT_BC5_TYPELESS",t[t.DXGI_FORMAT_BC5_UNORM=83]="DXGI_FORMAT_BC5_UNORM",t[t.DXGI_FORMAT_BC5_SNORM=84]="DXGI_FORMAT_BC5_SNORM",t[t.DXGI_FORMAT_B5G6R5_UNORM=85]="DXGI_FORMAT_B5G6R5_UNORM",t[t.DXGI_FORMAT_B5G5R5A1_UNORM=86]="DXGI_FORMAT_B5G5R5A1_UNORM",t[t.DXGI_FORMAT_B8G8R8A8_UNORM=87]="DXGI_FORMAT_B8G8R8A8_UNORM",t[t.DXGI_FORMAT_B8G8R8X8_UNORM=88]="DXGI_FORMAT_B8G8R8X8_UNORM",t[t.DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM=89]="DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM",t[t.DXGI_FORMAT_B8G8R8A8_TYPELESS=90]="DXGI_FORMAT_B8G8R8A8_TYPELESS",t[t.DXGI_FORMAT_B8G8R8A8_UNORM_SRGB=91]="DXGI_FORMAT_B8G8R8A8_UNORM_SRGB",t[t.DXGI_FORMAT_B8G8R8X8_TYPELESS=92]="DXGI_FORMAT_B8G8R8X8_TYPELESS",t[t.DXGI_FORMAT_B8G8R8X8_UNORM_SRGB=93]="DXGI_FORMAT_B8G8R8X8_UNORM_SRGB",t[t.DXGI_FORMAT_BC6H_TYPELESS=94]="DXGI_FORMAT_BC6H_TYPELESS",t[t.DXGI_FORMAT_BC6H_UF16=95]="DXGI_FORMAT_BC6H_UF16",t[t.DXGI_FORMAT_BC6H_SF16=96]="DXGI_FORMAT_BC6H_SF16",t[t.DXGI_FORMAT_BC7_TYPELESS=97]="DXGI_FORMAT_BC7_TYPELESS",t[t.DXGI_FORMAT_BC7_UNORM=98]="DXGI_FORMAT_BC7_UNORM",t[t.DXGI_FORMAT_BC7_UNORM_SRGB=99]="DXGI_FORMAT_BC7_UNORM_SRGB",t[t.DXGI_FORMAT_AYUV=100]="DXGI_FORMAT_AYUV",t[t.DXGI_FORMAT_Y410=101]="DXGI_FORMAT_Y410",t[t.DXGI_FORMAT_Y416=102]="DXGI_FORMAT_Y416",t[t.DXGI_FORMAT_NV12=103]="DXGI_FORMAT_NV12",t[t.DXGI_FORMAT_P010=104]="DXGI_FORMAT_P010",t[t.DXGI_FORMAT_P016=105]="DXGI_FORMAT_P016",t[t.DXGI_FORMAT_420_OPAQUE=106]="DXGI_FORMAT_420_OPAQUE",t[t.DXGI_FORMAT_YUY2=107]="DXGI_FORMAT_YUY2",t[t.DXGI_FORMAT_Y210=108]="DXGI_FORMAT_Y210",t[t.DXGI_FORMAT_Y216=109]="DXGI_FORMAT_Y216",t[t.DXGI_FORMAT_NV11=110]="DXGI_FORMAT_NV11",t[t.DXGI_FORMAT_AI44=111]="DXGI_FORMAT_AI44",t[t.DXGI_FORMAT_IA44=112]="DXGI_FORMAT_IA44",t[t.DXGI_FORMAT_P8=113]="DXGI_FORMAT_P8",t[t.DXGI_FORMAT_A8P8=114]="DXGI_FORMAT_A8P8",t[t.DXGI_FORMAT_B4G4R4A4_UNORM=115]="DXGI_FORMAT_B4G4R4A4_UNORM",t[t.DXGI_FORMAT_P208=116]="DXGI_FORMAT_P208",t[t.DXGI_FORMAT_V208=117]="DXGI_FORMAT_V208",t[t.DXGI_FORMAT_V408=118]="DXGI_FORMAT_V408",t[t.DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE=119]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE",t[t.DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE=120]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE",t[t.DXGI_FORMAT_FORCE_UINT=121]="DXGI_FORMAT_FORCE_UINT",t))(yg||{}),bg=(t=>(t[t.DDS_DIMENSION_TEXTURE1D=2]="DDS_DIMENSION_TEXTURE1D",t[t.DDS_DIMENSION_TEXTURE2D=3]="DDS_DIMENSION_TEXTURE2D",t[t.DDS_DIMENSION_TEXTURE3D=6]="DDS_DIMENSION_TEXTURE3D",t))(bg||{});function vg(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}var Tg=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.R8G8B8=20]="R8G8B8",t[t.A8R8G8B8=21]="A8R8G8B8",t[t.X8R8G8B8=22]="X8R8G8B8",t[t.R5G6B5=23]="R5G6B5",t[t.X1R5G5B5=24]="X1R5G5B5",t[t.A1R5G5B5=25]="A1R5G5B5",t[t.A4R4G4B4=26]="A4R4G4B4",t[t.R3G3B2=27]="R3G3B2",t[t.A8=28]="A8",t[t.A8R3G3B2=29]="A8R3G3B2",t[t.X4R4G4B4=30]="X4R4G4B4",t[t.A2B10G10R10=31]="A2B10G10R10",t[t.A8B8G8R8=32]="A8B8G8R8",t[t.X8B8G8R8=33]="X8B8G8R8",t[t.G16R16=34]="G16R16",t[t.A2R10G10B10=35]="A2R10G10B10",t[t.A16B16G16R16=36]="A16B16G16R16",t[t.A8P8=40]="A8P8",t[t.P8=41]="P8",t[t.L8=50]="L8",t[t.A8L8=51]="A8L8",t[t.A4L4=52]="A4L4",t[t.V8U8=60]="V8U8",t[t.L6V5U5=61]="L6V5U5",t[t.X8L8V8U8=62]="X8L8V8U8",t[t.Q8W8V8U8=63]="Q8W8V8U8",t[t.V16U16=64]="V16U16",t[t.A2W10V10U10=67]="A2W10V10U10",t[t.Q16W16V16U16=110]="Q16W16V16U16",t[t.R16F=111]="R16F",t[t.G16R16F=112]="G16R16F",t[t.A16B16G16R16F=113]="A16B16G16R16F",t[t.R32F=114]="R32F",t[t.G32R32F=115]="G32R32F",t[t.A32B32G32R32F=116]="A32B32G32R32F",t[t.UYVY=vg("UYVY")]="UYVY",t[t.R8G8_B8G8=vg("RGBG")]="R8G8_B8G8",t[t.YUY2=vg("YUY2")]="YUY2",t[t.D3DFMT_G8R8_G8B8=vg("GRGB")]="D3DFMT_G8R8_G8B8",t[t.DXT1=vg("DXT1")]="DXT1",t[t.DXT2=vg("DXT2")]="DXT2",t[t.DXT3=vg("DXT3")]="DXT3",t[t.DXT4=vg("DXT4")]="DXT4",t[t.DXT5=vg("DXT5")]="DXT5",t[t.ATI1=vg("ATI1")]="ATI1",t[t.AT1N=vg("AT1N")]="AT1N",t[t.ATI2=vg("ATI2")]="ATI2",t[t.AT2N=vg("AT2N")]="AT2N",t[t.BC4U=vg("BC4U")]="BC4U",t[t.BC4S=vg("BC4S")]="BC4S",t[t.BC5U=vg("BC5U")]="BC5U",t[t.BC5S=vg("BC5S")]="BC5S",t[t.DX10=vg("DX10")]="DX10",t))(Tg||{});const Sg={[Tg.DXT1]:"bc1-rgba-unorm",[Tg.DXT2]:"bc2-rgba-unorm",[Tg.DXT3]:"bc2-rgba-unorm",[Tg.DXT4]:"bc3-rgba-unorm",[Tg.DXT5]:"bc3-rgba-unorm",[Tg.ATI1]:"bc4-r-unorm",[Tg.BC4U]:"bc4-r-unorm",[Tg.BC4S]:"bc4-r-snorm",[Tg.ATI2]:"bc5-rg-unorm",[Tg.BC5U]:"bc5-rg-unorm",[Tg.BC5S]:"bc5-rg-snorm",36:"rgba16uint",110:"rgba16sint",111:"r16float",112:"rg16float",113:"rgba16float",114:"r32float",115:"rg32float",116:"rgba32float"},wg={70:"bc1-rgba-unorm",71:"bc1-rgba-unorm",72:"bc1-rgba-unorm-srgb",73:"bc2-rgba-unorm",74:"bc2-rgba-unorm",75:"bc2-rgba-unorm-srgb",76:"bc3-rgba-unorm",77:"bc3-rgba-unorm",78:"bc3-rgba-unorm-srgb",79:"bc4-r-unorm",80:"bc4-r-unorm",81:"bc4-r-snorm",82:"bc5-rg-unorm",83:"bc5-rg-unorm",84:"bc5-rg-snorm",94:"bc6h-rgb-ufloat",95:"bc6h-rgb-ufloat",96:"bc6h-rgb-float",97:"bc7-rgba-unorm",98:"bc7-rgba-unorm",99:"bc7-rgba-unorm-srgb",28:"rgba8unorm",29:"rgba8unorm-srgb",87:"bgra8unorm",91:"bgra8unorm-srgb",41:"r32float",49:"rg8unorm",56:"r16uint",61:"r8unorm",24:"rgb10a2unorm",11:"rgba16uint",13:"rgba16sint",10:"rgba16float",54:"r16float",34:"rg16float",16:"rg32float",2:"rgba32float"},Eg={MAGIC_VALUE:542327876,MAGIC_SIZE:4,HEADER_SIZE:124,HEADER_DX10_SIZE:20,PIXEL_FORMAT_FLAGS:{ALPHAPIXELS:1,ALPHA:2,FOURCC:4,RGB:64,RGBA:65,YUV:512,LUMINANCE:131072,LUMINANCEA:131073},RESOURCE_MISC_TEXTURECUBE:4,HEADER_FIELDS:{MAGIC:0,SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19,PF_FLAGS:20,FOURCC:21,RGB_BITCOUNT:22,R_BIT_MASK:23,G_BIT_MASK:24,B_BIT_MASK:25,A_BIT_MASK:26},HEADER_DX10_FIELDS:{DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},DXGI_FORMAT:yg,D3D10_RESOURCE_DIMENSION:bg,D3DFMT:Tg},Ag={"bc1-rgba-unorm":8,"bc1-rgba-unorm-srgb":8,"bc2-rgba-unorm":16,"bc2-rgba-unorm-srgb":16,"bc3-rgba-unorm":16,"bc3-rgba-unorm-srgb":16,"bc4-r-unorm":8,"bc4-r-snorm":8,"bc5-rg-unorm":16,"bc5-rg-snorm":16,"bc6h-rgb-ufloat":16,"bc6h-rgb-float":16,"bc7-rgba-unorm":16,"bc7-rgba-unorm-srgb":16};function Pg(t,e){const{format:r,fourCC:i,width:s,height:n,dataOffset:o,mipmapCount:a}=function(t){const e=new Uint32Array(t,0,Eg.HEADER_SIZE/Uint32Array.BYTES_PER_ELEMENT);if(e[Eg.HEADER_FIELDS.MAGIC]!==Eg.MAGIC_VALUE)throw new Error("Invalid magic number in DDS header");const r=e[Eg.HEADER_FIELDS.HEIGHT],i=e[Eg.HEADER_FIELDS.WIDTH],s=Math.max(1,e[Eg.HEADER_FIELDS.MIPMAP_COUNT]),n=e[Eg.HEADER_FIELDS.PF_FLAGS],o=e[Eg.HEADER_FIELDS.FOURCC],a=function(t,e,r,i){if(e&Eg.PIXEL_FORMAT_FLAGS.FOURCC){if(r===Eg.D3DFMT.DX10){const t=new Uint32Array(i,Eg.MAGIC_SIZE+Eg.HEADER_SIZE,Eg.HEADER_DX10_SIZE/Uint32Array.BYTES_PER_ELEMENT);if(t[Eg.HEADER_DX10_FIELDS.MISC_FLAG]===Eg.RESOURCE_MISC_TEXTURECUBE)throw new Error("DDSParser does not support cubemap textures");if(t[Eg.HEADER_DX10_FIELDS.RESOURCE_DIMENSION]===Eg.D3D10_RESOURCE_DIMENSION.DDS_DIMENSION_TEXTURE3D)throw new Error("DDSParser does not supported 3D texture data");const e=t[Eg.HEADER_DX10_FIELDS.DXGI_FORMAT];if(e in wg)return wg[e];throw new Error(`DDSParser cannot parse texture data with DXGI format ${e}`)}if(r in Sg)return Sg[r];throw new Error(`DDSParser cannot parse texture data with fourCC format ${r}`)}if(e&Eg.PIXEL_FORMAT_FLAGS.RGB||e&Eg.PIXEL_FORMAT_FLAGS.RGBA)return function(t){const e=t[Eg.HEADER_FIELDS.RGB_BITCOUNT],r=t[Eg.HEADER_FIELDS.R_BIT_MASK],i=t[Eg.HEADER_FIELDS.G_BIT_MASK],s=t[Eg.HEADER_FIELDS.B_BIT_MASK],n=t[Eg.HEADER_FIELDS.A_BIT_MASK];switch(e){case 32:if(255===r&&65280===i&&16711680===s&&4278190080===n)return wg[Eg.DXGI_FORMAT.DXGI_FORMAT_R8G8B8A8_UNORM];if(16711680===r&&65280===i&&255===s&&4278190080===n)return wg[Eg.DXGI_FORMAT.DXGI_FORMAT_B8G8R8A8_UNORM];if(1072693248===r&&1047552===i&&1023===s&&3221225472===n)return wg[Eg.DXGI_FORMAT.DXGI_FORMAT_R10G10B10A2_UNORM];if(65535===r&&4294901760===i&&0===s&&0===n)return wg[Eg.DXGI_FORMAT.DXGI_FORMAT_R16G16_UNORM];if(4294967295===r&&0===i&&0===s&&0===n)return wg[Eg.DXGI_FORMAT.DXGI_FORMAT_R32_FLOAT];break;case 24:break;case 16:if(31744===r&&992===i&&31===s&&32768===n)return wg[Eg.DXGI_FORMAT.DXGI_FORMAT_B5G5R5A1_UNORM];if(63488===r&&2016===i&&31===s&&0===n)return wg[Eg.DXGI_FORMAT.DXGI_FORMAT_B5G6R5_UNORM];if(3840===r&&240===i&&15===s&&61440===n)return wg[Eg.DXGI_FORMAT.DXGI_FORMAT_B4G4R4A4_UNORM];if(255===r&&0===i&&0===s&&65280===n)return wg[Eg.DXGI_FORMAT.DXGI_FORMAT_R8G8_UNORM];if(65535===r&&0===i&&0===s&&0===n)return wg[Eg.DXGI_FORMAT.DXGI_FORMAT_R16_UNORM];break;case 8:if(255===r&&0===i&&0===s&&0===n)return wg[Eg.DXGI_FORMAT.DXGI_FORMAT_R8_UNORM]}throw new Error(`DDSParser does not support uncompressed texture with configuration:\n                bitCount = ${e}, rBitMask = ${r}, gBitMask = ${i}, aBitMask = ${n}`)}(t);throw e&Eg.PIXEL_FORMAT_FLAGS.YUV?new Error("DDSParser does not supported YUV uncompressed texture data."):e&Eg.PIXEL_FORMAT_FLAGS.LUMINANCE||e&Eg.PIXEL_FORMAT_FLAGS.LUMINANCEA?new Error("DDSParser does not support single-channel (lumninance) texture data!"):e&Eg.PIXEL_FORMAT_FLAGS.ALPHA||e&Eg.PIXEL_FORMAT_FLAGS.ALPHAPIXELS?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}(e,n,o,t),l=Eg.MAGIC_SIZE+Eg.HEADER_SIZE+(o===Eg.D3DFMT.DX10?Eg.HEADER_DX10_SIZE:0);return{format:a,fourCC:o,width:i,height:r,dataOffset:l,mipmapCount:s}}(t);if(!e.includes(r))throw new Error(`Unsupported texture format: ${i} ${r}, supported: ${e}`);if(a<=1)return{format:r,width:s,height:n,resource:[new Uint8Array(t,o)],alphaMode:"no-premultiply-alpha"};const l=function(t,e,r,i,s,n){const o=[],a=Ag[t];let l=e,h=r,u=i;for(let t=0;t<s;++t){const t=4*Math.ceil(Math.max(4,l)/4),e=4*Math.ceil(Math.max(4,h)/4),r=a?t/4*e/4*a:l*h*4,i=new Uint8Array(n,u,r);o.push(i),u+=r,l=Math.max(l>>1,1),h=Math.max(h>>1,1)}return o}(r,s,n,o,a,t);return{format:r,width:s,height:n,resource:l,alphaMode:"no-premultiply-alpha"}}const Mg={extension:{type:u.LoadParser,priority:Jr.High,name:"loadDDS"},name:"loadDDS",test:t=>Hp(t,[".dds"]),async load(t,e,r){const i=await ug(),s=Pg(await(await fetch(t)).arrayBuffer(),i);return cf(new eg(s),r,t)},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};var Rg=(t=>(t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGBA=6408]="RGBA",t[t.RGBA8UI=36220]="RGBA8UI",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGBA8I=36238]="RGBA8I",t[t.RGBA8=32856]="RGBA8",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t))(Rg||{}),Cg=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(Cg||{}),Og=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(Og||{});const Ig={FILE_HEADER_SIZE:64,FILE_IDENTIFIER:[171,75,84,88,32,49,49,187,13,10,26,10],FORMATS_TO_COMPONENTS:{6408:4,6407:3,33319:2,6403:1,6409:1,6410:2,6406:1},INTERNAL_FORMAT_TO_BYTES_PER_PIXEL:{33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,36283:.5,36284:.5,36285:1,36286:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,37808:1,37840:1,37809:.8,37841:.8,37810:.64,37842:.64,37811:.53375,37843:.53375,37812:.445,37844:.445,37813:.4,37845:.4,37814:.33375,37846:.33375,37815:.25,37847:.25,37816:.32,37848:.32,37817:.26625,37849:.26625,37818:.2,37850:.2,37819:.16,37851:.16,37820:.13375,37852:.13375,37821:.11125,37853:.11125,36492:1,36493:1,36494:1,36495:1},INTERNAL_FORMAT_TO_TEXTURE_FORMATS:{33776:"bc1-rgba-unorm",33777:"bc1-rgba-unorm",33778:"bc2-rgba-unorm",33779:"bc3-rgba-unorm",35916:"bc1-rgba-unorm-srgb",35917:"bc1-rgba-unorm-srgb",35918:"bc2-rgba-unorm-srgb",35919:"bc3-rgba-unorm-srgb",36283:"bc4-r-unorm",36284:"bc4-r-snorm",36285:"bc5-rg-unorm",36286:"bc5-rg-snorm",37488:"eac-r11unorm",37490:"eac-rg11snorm",37492:"etc2-rgb8unorm",37496:"etc2-rgba8unorm",37493:"etc2-rgb8unorm-srgb",37497:"etc2-rgba8unorm-srgb",37494:"etc2-rgb8a1unorm",37495:"etc2-rgb8a1unorm-srgb",37808:"astc-4x4-unorm",37840:"astc-4x4-unorm-srgb",37809:"astc-5x4-unorm",37841:"astc-5x4-unorm-srgb",37810:"astc-5x5-unorm",37842:"astc-5x5-unorm-srgb",37811:"astc-6x5-unorm",37843:"astc-6x5-unorm-srgb",37812:"astc-6x6-unorm",37844:"astc-6x6-unorm-srgb",37813:"astc-8x5-unorm",37845:"astc-8x5-unorm-srgb",37814:"astc-8x6-unorm",37846:"astc-8x6-unorm-srgb",37815:"astc-8x8-unorm",37847:"astc-8x8-unorm-srgb",37816:"astc-10x5-unorm",37848:"astc-10x5-unorm-srgb",37817:"astc-10x6-unorm",37849:"astc-10x6-unorm-srgb",37818:"astc-10x8-unorm",37850:"astc-10x8-unorm-srgb",37819:"astc-10x10-unorm",37851:"astc-10x10-unorm-srgb",37820:"astc-12x10-unorm",37852:"astc-12x10-unorm-srgb",37821:"astc-12x12-unorm",37853:"astc-12x12-unorm-srgb",36492:"bc7-rgba-unorm",36493:"bc7-rgba-unorm-srgb",36494:"bc6h-rgb-float",36495:"bc6h-rgb-ufloat",35907:"rgba8unorm-srgb",36759:"rgba8snorm",36220:"rgba8uint",36238:"rgba8sint",6408:"rgba8unorm"},FIELDS:{FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},TYPES_TO_BYTES_PER_COMPONENT:{5121:1,5123:2,5124:4,5125:4,5126:4,36193:8},TYPES_TO_BYTES_PER_PIXEL:{32819:2,32820:2,33635:2},ENDIANNESS:67305985};function Bg(t,e){const r=new DataView(t);if(!function(t){for(let e=0;e<Ig.FILE_IDENTIFIER.length;e++)if(t.getUint8(e)!==Ig.FILE_IDENTIFIER[e])return!1;return!0}(r))throw new Error("Invalid KTX identifier in header");const{littleEndian:i,glType:s,glFormat:n,glInternalFormat:o,pixelWidth:a,pixelHeight:l,numberOfMipmapLevels:h,offset:u}=function(t){const e=t.getUint32(Ig.FIELDS.ENDIANNESS,!0)===Ig.ENDIANNESS,r=t.getUint32(Ig.FIELDS.GL_TYPE,e),i=t.getUint32(Ig.FIELDS.GL_FORMAT,e),s=t.getUint32(Ig.FIELDS.GL_INTERNAL_FORMAT,e),n=t.getUint32(Ig.FIELDS.PIXEL_WIDTH,e),o=t.getUint32(Ig.FIELDS.PIXEL_HEIGHT,e)||1,a=t.getUint32(Ig.FIELDS.PIXEL_DEPTH,e)||1,l=t.getUint32(Ig.FIELDS.NUMBER_OF_ARRAY_ELEMENTS,e)||1,h=t.getUint32(Ig.FIELDS.NUMBER_OF_FACES,e),u=t.getUint32(Ig.FIELDS.NUMBER_OF_MIPMAP_LEVELS,e),c=t.getUint32(Ig.FIELDS.BYTES_OF_KEY_VALUE_DATA,e);if(0===o||1!==a)throw new Error("Only 2D textures are supported");if(1!==h)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==l)throw new Error("WebGL does not support array textures");return{littleEndian:e,glType:r,glFormat:i,glInternalFormat:s,pixelWidth:n,pixelHeight:o,numberOfMipmapLevels:u,offset:Ig.FILE_HEADER_SIZE+c}}(r),c=Ig.INTERNAL_FORMAT_TO_TEXTURE_FORMATS[o];if(!c)throw new Error(`Unknown texture format ${o}`);if(!e.includes(c))throw new Error(`Unsupported texture format: ${c}, supportedFormats: ${e}`);const d=function(t,e,r){let i=Ig.INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[r];if(0!==t&&(i=Ig.TYPES_TO_BYTES_PER_COMPONENT[t]?Ig.TYPES_TO_BYTES_PER_COMPONENT[t]*Ig.FORMATS_TO_COMPONENTS[e]:Ig.TYPES_TO_BYTES_PER_PIXEL[t]),void 0===i)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");return i}(s,n,o),p=function(t,e,r,i,s,n,o,a){const l=i+3&-4,h=s+3&-4;let u=i*s;0===e&&(u=l*h);let c=u*r,d=i,p=s,f=l,g=h,m=n;const _=new Array(o);for(let e=0;e<o;e++){const i=t.getUint32(m,a);let s=m+4;_[e]=new Uint8Array(t.buffer,s,c),s+=c,m+=i+4,m=m%4!=0?m+4-m%4:m,d=d>>1||1,p=p>>1||1,f=d+4-1&-4,g=p+4-1&-4,c=f*g*r}return _}(r,s,d,a,l,u,h,i);return{format:c,width:a,height:l,resource:p,alphaMode:"no-premultiply-alpha"}}const kg={extension:{type:u.LoadParser,priority:Jr.High,name:"loadKTX"},name:"loadKTX",test:t=>Hp(t,".ktx"),async load(t,e,r){const i=await ug(),s=Bg(await(await fetch(t)).arrayBuffer(),i);return cf(new eg(s),r,t)},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};let Gg=null;class Dg{constructor(){Gg||(Gg=URL.createObjectURL(new Blob(['(function(){"use strict";const s={rgb8unorm:{convertedFormat:"rgba8unorm",convertFunction:i},"rgb8unorm-srgb":{convertedFormat:"rgba8unorm-srgb",convertFunction:i}};function f(r){const t=r.format;if(s[t]){const n=s[t].convertFunction,o=r.resource;for(let e=0;e<o.length;e++)o[e]=n(o[e]);r.format=s[t].convertedFormat}}function i(r){const t=r.byteLength/3,n=new Uint32Array(t);for(let o=0;o<t;++o)n[o]=r[o*3]+(r[o*3+1]<<8)+(r[o*3+2]<<16)+4278190080;return new Uint8Array(n.buffer)}function d(r){const t=[];for(let n=0;n<r.numLevels;n++){const o=r.getImageData(n,0,0),e=new Uint8Array(o.byteLength);e.set(o),t.push(e)}return t}const w={6408:"rgba8unorm",32856:"bgra8unorm",32857:"rgb10a2unorm",33189:"depth16unorm",33190:"depth24plus",33321:"r8unorm",33323:"rg8unorm",33325:"r16float",33326:"r32float",33327:"rg16float",33328:"rg32float",33329:"r8sint",33330:"r8uint",33331:"r16sint",33332:"r16uint",33333:"r32sint",33334:"r32uint",33335:"rg8sint",33336:"rg8uint",33337:"rg16sint",33338:"rg16uint",33339:"rg32sint",33340:"rg32uint",33778:"bc2-rgba-unorm",33779:"bc3-rgba-unorm",34836:"rgba32float",34842:"rgba16float",35056:"depth24plus-stencil8",35898:"rg11b10ufloat",35901:"rgb9e5ufloat",35907:"rgba8unorm-srgb",36012:"depth32float",36013:"depth32float-stencil8",36168:"stencil8",36208:"rgba32uint",36214:"rgba16uint",36220:"rgba8uint",36226:"rgba32sint",36232:"rgba16sint",36238:"rgba8sint",36492:"bc7-rgba-unorm",36756:"r8snorm",36757:"rg8snorm",36759:"rgba8snorm",37496:"etc2-rgba8unorm",37808:"astc-4x4-unorm"};function p(r){const t=w[r];if(t)return t;throw new Error(`Unsupported glInternalFormat: ${r}`)}const h={23:"rgb8unorm",37:"rgba8unorm",43:"rgba8unorm-srgb"};function F(r){const t=h[r];if(t)return t;throw new Error(`Unsupported VkFormat: ${r}`)}function U(r){return r.classId===2?F(r.vkFormat):p(r.glInternalformat)}const T={"bc3-rgba-unorm":"BC3_RGBA","bc7-rgba-unorm":"BC7_M5_RGBA","etc2-rgba8unorm":"ETC2_RGBA","astc-4x4-unorm":"ASTC_4x4_RGBA",rgba8unorm:"RGBA32",rg11b10ufloat:"R11F_G11F_B10F"};function y(r){const t=T[r];if(t)return t;throw new Error(`Unsupported transcoderFormat: ${r}`)}const a={jsUrl:"",wasmUrl:""};let l,u,c;async function g(){if(!c){const r=new URL(a.jsUrl,location.origin).href,t=new URL(a.wasmUrl,location.origin).href;importScripts(r),c=new Promise(n=>{LIBKTX({locateFile:o=>t}).then(o=>{n(o)})})}return c}async function v(r,t){const n=await fetch(r);if(n.ok){const o=await n.arrayBuffer();return new t.ktxTexture(new Uint8Array(o))}throw new Error(`Failed to load KTX(2) texture: ${r}`)}const x=["bc7-rgba-unorm","astc-4x4-unorm","etc2-rgba8unorm","bc3-rgba-unorm","rgba8unorm"];async function B(r){const t=await g(),n=await v(r,t);let o;if(n.needsTranscoding){o=u;const R=t.TranscodeTarget[l];if(n.transcodeBasis(R,0)!==t.ErrorCode.SUCCESS)throw new Error("Unable to transcode basis texture.")}else o=U(n);const e=d(n),b={width:n.baseWidth,height:n.baseHeight,format:o,mipLevelCount:n.numLevels,resource:e,alphaMode:"no-premultiply-alpha"};return f(b),b}async function A(r,t,n){r&&(a.jsUrl=r),t&&(a.wasmUrl=t),u=x.filter(o=>n.includes(o))[0],l=y(u),await g()}const m={init:async r=>{const{jsUrl:t,wasmUrl:n,supportedTextures:o}=r;await A(t,n,o)},load:async r=>{var t;try{const n=await B(r.url);return{type:"load",url:r.url,success:!0,textureOptions:n,transferables:(t=n.resource)==null?void 0:t.map(o=>o.buffer)}}catch(n){throw n}}};self.onmessage=async r=>{var t;const n=r.data,o=await((t=m[n.type])==null?void 0:t.call(m,n));o&&self.postMessage(o,o.transferables)}})();\n'],{type:"application/javascript"}))),this.worker=new Worker(Gg)}}Dg.revokeObjectURL=function(){Gg&&(URL.revokeObjectURL(Gg),Gg=null)};const Fg={jsUrl:"https://files.pixijs.download/transcoders/ktx/libktx.js",wasmUrl:"https://files.pixijs.download/transcoders/ktx/libktx.wasm"};let Ng;const Ug={};function Lg(t,e){const r=function(t){return Ng||(Ng=(new Dg).worker,Ng.onmessage=t=>{const{success:e,url:r,textureOptions:i}=t.data;e||console.warn("Failed to load KTX texture",r),Ug[r](i)},Ng.postMessage({type:"init",jsUrl:Fg.jsUrl,wasmUrl:Fg.wasmUrl,supportedTextures:t})),Ng}(e);return new Promise((e=>{Ug[t]=e,r.postMessage({type:"load",url:t})}))}const zg={extension:{type:u.LoadParser,priority:Jr.High,name:"loadKTX2"},name:"loadKTX2",test:t=>Hp(t,".ktx2"),async load(t,e,r){const i=await ug(),s=await Lg(t,i);return cf(new eg(s),r,t)},async unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}},Xg={rgb8unorm:{convertedFormat:"rgba8unorm",convertFunction:Hg},"rgb8unorm-srgb":{convertedFormat:"rgba8unorm-srgb",convertFunction:Hg}};function Hg(t){const e=t.byteLength/3,r=new Uint32Array(e);for(let i=0;i<e;++i)r[i]=t[3*i]+(t[3*i+1]<<8)+(t[3*i+2]<<16)+4278190080;return new Uint8Array(r.buffer)}const jg={6408:"rgba8unorm",32856:"bgra8unorm",32857:"rgb10a2unorm",33189:"depth16unorm",33190:"depth24plus",33321:"r8unorm",33323:"rg8unorm",33325:"r16float",33326:"r32float",33327:"rg16float",33328:"rg32float",33329:"r8sint",33330:"r8uint",33331:"r16sint",33332:"r16uint",33333:"r32sint",33334:"r32uint",33335:"rg8sint",33336:"rg8uint",33337:"rg16sint",33338:"rg16uint",33339:"rg32sint",33340:"rg32uint",33778:"bc2-rgba-unorm",33779:"bc3-rgba-unorm",34836:"rgba32float",34842:"rgba16float",35056:"depth24plus-stencil8",35898:"rg11b10ufloat",35901:"rgb9e5ufloat",35907:"rgba8unorm-srgb",36012:"depth32float",36013:"depth32float-stencil8",36168:"stencil8",36208:"rgba32uint",36214:"rgba16uint",36220:"rgba8uint",36226:"rgba32sint",36232:"rgba16sint",36238:"rgba8sint",36492:"bc7-rgba-unorm",36756:"r8snorm",36757:"rg8snorm",36759:"rgba8snorm",37496:"etc2-rgba8unorm",37808:"astc-4x4-unorm"};function Vg(t){const e=jg[t];if(e)return e;throw new Error(`Unsupported glInternalFormat: ${t}`)}const Wg={23:"rgb8unorm",37:"rgba8unorm",43:"rgba8unorm-srgb"};function $g(t){const e=Wg[t];if(e)return e;throw new Error(`Unsupported VkFormat: ${t}`)}const Yg={"bc3-rgba-unorm":"BC3_RGBA","bc7-rgba-unorm":"BC7_M5_RGBA","etc2-rgba8unorm":"ETC2_RGBA","astc-4x4-unorm":"ASTC_4x4_RGBA",rgba8unorm:"RGBA32",rg11b10ufloat:"R11F_G11F_B10F"};const qg=["basis","bc7","bc6h","astc","etc2","bc5","bc4","bc3","bc2","bc1","eac"],Kg={extension:u.ResolveParser,test:t=>Hp(t,[".ktx",".ktx2",".dds"]),parse:t=>{var e,r;let i;const s=t.split(".");if(s.length>2){const t=s[s.length-2];qg.includes(t)&&(i=t)}else i=s[s.length-1];return{resolution:parseFloat(null!=(r=null==(e=xi.RETINA_PREFIX.exec(t))?void 0:e[1])?r:"1"),format:i,src:t}}};let Qg;const Zg={extension:{type:u.DetectionParser,priority:2},test:async()=>!(!await Kd()&&!qd()),add:async t=>{const e=await ag();return Qg=function(t){const e=["basis"],r={};return t.forEach((t=>{const i=t.split("-")[0];i&&!r[i]&&(r[i]=!0,e.push(i))})),e.sort(((t,e)=>{const r=qg.indexOf(t),i=qg.indexOf(e);return-1===r?1:-1===i?-1:r-i})),e}(e),[...Qg,...t]},remove:async t=>Qg?t.filter((t=>!(t in Qg))):t};const Jg=new Ot,tm=class{cull(t,e,r=!0){this._cullRecursive(t,e,r)}_cullRecursive(t,e,r=!0){var i;if(t.cullable&&t.measurable&&t.includeInBuild){const s=null!=(i=t.cullArea)?i:Dt(t,r,Jg);t.culled=s.x>=e.x+e.width||s.y>=e.y+e.height||s.x+s.width<=e.x||s.y+s.height<=e.y}else t.culled=!1;if(t.cullableChildren&&!t.culled&&t.renderable&&t.measurable&&t.includeInBuild)for(let i=0;i<t.children.length;i++)this._cullRecursive(t.children[i],e,r)}};tm.shared=new tm;let em=tm;class rm{static init(){this._renderRef=this.render.bind(this),this.render=()=>{em.shared.cull(this.stage,this.renderer.screen),this.renderer.render({container:this.stage})}}static destroy(){this.render=this._renderRef}}rm.extension={priority:10,type:u.Application,name:"culler"};const im={extension:{type:u.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await Promise.resolve().then((function(){return Od}))}};var sm=Object.defineProperty,nm=Object.getOwnPropertySymbols,om=Object.prototype.hasOwnProperty,am=Object.prototype.propertyIsEnumerable,lm=(t,e,r)=>e in t?sm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,hm=(t,e)=>{for(var r in e||(e={}))om.call(e,r)&&lm(t,r,e[r]);if(nm)for(var r of nm(e))am.call(e,r)&&lm(t,r,e[r]);return t};const um=class t extends Oo{constructor(e){super(e=hm(hm({},t.defaultOptions),e)),this.enabled=!0,this._state=tl.for2d(),this.blendMode=e.blendMode,this.padding=e.padding,"boolean"==typeof e.antialias?this.antialias=e.antialias?"on":"off":this.antialias=e.antialias,this.resolution=e.resolution,this.blendRequired=e.blendRequired,this.clipToViewport=e.clipToViewport,this.addResource("uTexture",0,1)}apply(t,e,r,i){t.applyFilter(this,e,r,i)}get blendMode(){return this._state.blendMode}set blendMode(t){this._state.blendMode=t}static from(e){const r=e,{gpu:i,gl:s}=r,n=((t,e)=>{var r={};for(var i in t)om.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&nm)for(var i of nm(t))e.indexOf(i)<0&&am.call(t,i)&&(r[i]=t[i]);return r})(r,["gpu","gl"]);let o,a;return i&&(o=wn.from(i)),s&&(a=pn.from(s)),new t(hm({gpuProgram:o,glProgram:a},n))}};um.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1,clipToViewport:!0};let cm=um;var dm="\nin vec2 vTextureCoord;\nin vec4 vColor;\n\nout vec4 finalColor;\n\nuniform float uBlend;\n\nuniform sampler2D uTexture;\nuniform sampler2D uBackTexture;\n\n{FUNCTIONS}\n\nvoid main()\n{ \n    vec4 back = texture(uBackTexture, vTextureCoord);\n    vec4 front = texture(uTexture, vTextureCoord);\n    float blendedAlpha = front.a + back.a * (1.0 - front.a);\n    \n    {MAIN}\n}\n",pm="in vec2 aPosition;\nout vec2 vTextureCoord;\nout vec2 backgroundUv;\n\nuniform vec4 uInputSize;\nuniform vec4 uOutputFrame;\nuniform vec4 uOutputTexture;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;\n    \n    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aPosition * (uOutputFrame.zw * uInputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",fm="\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\nstruct BlendUniforms {\n  uBlend:f32,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n@group(0) @binding(1) var uTexture: texture_2d<f32>;\n@group(0) @binding(2) var uSampler : sampler;\n@group(0) @binding(3) var uBackTexture: texture_2d<f32>;\n\n@group(1) @binding(0) var<uniform> blendUniforms : BlendUniforms;\n\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>\n  };\n\nfn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\nfn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  \n}\n  \n@vertex\nfn mainVertex(\n  @location(0) aPosition : vec2<f32>, \n) -> VSOutput {\n  return VSOutput(\n   filterVertexPosition(aPosition),\n   filterTextureCoord(aPosition)\n  );\n}\n\n{FUNCTIONS}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>\n) -> @location(0) vec4<f32> {\n\n\n   var back =  textureSample(uBackTexture, uSampler, uv);\n   var front = textureSample(uTexture, uSampler, uv);\n   var blendedAlpha = front.a + back.a * (1.0 - front.a);\n   \n   var out = vec4<f32>(0.0,0.0,0.0,0.0);\n\n   {MAIN}\n\n   return out;\n}",gm=Object.defineProperty,mm=Object.getOwnPropertySymbols,_m=Object.prototype.hasOwnProperty,xm=Object.prototype.propertyIsEnumerable,ym=(t,e,r)=>e in t?gm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,bm=(t,e)=>{for(var r in e||(e={}))_m.call(e,r)&&ym(t,r,e[r]);if(mm)for(var r of mm(e))xm.call(e,r)&&ym(t,r,e[r]);return t};function vm(t){const{source:e,functions:r,main:i}=t;return e.replace("{FUNCTIONS}",r).replace("{MAIN}",i)}var Tm="in vec2 aPosition;\nout vec2 vTextureCoord;\n\nuniform vec4 uInputSize;\nuniform vec4 uOutputFrame;\nuniform vec4 uOutputTexture;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;\n    \n    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aPosition * (uOutputFrame.zw * uInputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",Sm="\nin vec2 vTextureCoord;\n\nout vec4 finalColor;\n\nuniform float uAlpha;\nuniform sampler2D uTexture;\n\nvoid main()\n{\n    finalColor =  texture(uTexture, vTextureCoord) * uAlpha;\n}\n",wm="struct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\nstruct AlphaUniforms {\n  uAlpha:f32,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n@group(0) @binding(1) var uTexture: texture_2d<f32>;\n@group(0) @binding(2) var uSampler : sampler;\n\n@group(1) @binding(0) var<uniform> alphaUniforms : AlphaUniforms;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>\n  };\n\nfn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\nfn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  \n}\n\nfn getSize() -> vec2<f32>\n{\n  return gfu.uGlobalFrame.zw;\n}\n  \n@vertex\nfn mainVertex(\n  @location(0) aPosition : vec2<f32>, \n) -> VSOutput {\n  return VSOutput(\n   filterVertexPosition(aPosition),\n   filterTextureCoord(aPosition)\n  );\n}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @builtin(position) position: vec4<f32>\n) -> @location(0) vec4<f32> {\n \n    var sample = textureSample(uTexture, uSampler, uv);\n    \n    return sample * alphaUniforms.uAlpha;\n}",Em=Object.defineProperty,Am=Object.defineProperties,Pm=Object.getOwnPropertyDescriptors,Mm=Object.getOwnPropertySymbols,Rm=Object.prototype.hasOwnProperty,Cm=Object.prototype.propertyIsEnumerable,Om=(t,e,r)=>e in t?Em(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Im=(t,e)=>{for(var r in e||(e={}))Rm.call(e,r)&&Om(t,r,e[r]);if(Mm)for(var r of Mm(e))Cm.call(e,r)&&Om(t,r,e[r]);return t};const Bm=class t extends cm{constructor(e){e=Im(Im({},t.defaultOptions),e);const r=wn.from({vertex:{source:wm,entryPoint:"mainVertex"},fragment:{source:wm,entryPoint:"mainFragment"}}),i=pn.from({vertex:Tm,fragment:Sm,name:"alpha-filter"}),s=e,{alpha:n}=s,o=((t,e)=>{var r={};for(var i in t)Rm.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&Mm)for(var i of Mm(t))e.indexOf(i)<0&&Cm.call(t,i)&&(r[i]=t[i]);return r})(s,["alpha"]),a=new To({uAlpha:{value:n,type:"f32"}});super(((t,e)=>Am(t,Pm(e)))(Im({},o),{gpuProgram:r,glProgram:i,resources:{alphaUniforms:a}}))}get alpha(){return this.resources.alphaUniforms.uniforms.uAlpha}set alpha(t){this.resources.alphaUniforms.uniforms.uAlpha=t}};Bm.defaultOptions={alpha:1};let km=Bm;const Gm={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},Dm=["in vec2 vBlurTexCoords[%size%];","uniform sampler2D uTexture;","out vec4 finalColor;","void main(void)","{","    finalColor = vec4(0.0);","    %blur%","}"].join("\n");function Fm(t){const e=Gm[t],r=e.length;let i=Dm,s="";let n;for(let i=0;i<t;i++){let o="finalColor += texture(uTexture, vBlurTexCoords[%index%]) * %value%;".replace("%index%",i.toString());n=i,i>=r&&(n=t-i-1),o=o.replace("%value%",e[n].toString()),s+=o,s+="\n"}return i=i.replace("%blur%",s),i=i.replace("%size%",t.toString()),i}function Nm(t,e){const r=Math.ceil(t/2);let i,s="\n    in vec2 aPosition;\n\n    uniform float uStrength;\n\n    out vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 uInputSize;\n    uniform vec4 uOutputFrame;\n    uniform vec4 uOutputTexture;\n\n    vec4 filterVertexPosition( void )\n{\n    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;\n    \n    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\n    vec2 filterTextureCoord( void )\n    {\n        return aPosition * (uOutputFrame.zw * uInputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        float pixelStrength = uInputSize.%dimension% * uStrength;\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",n="";i=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * pixelStrength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * pixelStrength);";for(let e=0;e<t;e++){let t=i.replace("%index%",e.toString());t=t.replace("%sampleIndex%",e-(r-1)+".0"),n+=t,n+="\n"}return s=s.replace("%blur%",n),s=s.replace("%size%",t.toString()),s=s.replace("%dimension%",e?"z":"w"),s}function Um(t,e){const r=Nm(e,t),i=Fm(e);return pn.from({vertex:r,fragment:i,name:`blur-${t?"horizontal":"vertical"}-pass-filter`})}var Lm="\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\nstruct BlurUniforms {\n  uStrength:f32,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n@group(0) @binding(1) var uTexture: texture_2d<f32>;\n@group(0) @binding(2) var uSampler : sampler;\n\n@group(1) @binding(0) var<uniform> blurUniforms : BlurUniforms;\n\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    %blur-struct%\n  };\n\nfn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\nfn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  \n}\n\nfn getSize() -> vec2<f32>\n{\n  return gfu.uGlobalFrame.zw;\n}\n\n\n@vertex\nfn mainVertex(\n  @location(0) aPosition : vec2<f32>, \n) -> VSOutput {\n\n  let filteredCord = filterTextureCoord(aPosition);\n\n  let pixelStrength = gfu.uInputSize.%dimension% * blurUniforms.uStrength;\n\n  return VSOutput(\n   filterVertexPosition(aPosition),\n    %blur-vertex-out%\n  );\n}\n\n@fragment\nfn mainFragment(\n  @builtin(position) position: vec4<f32>,\n  %blur-fragment-in%\n) -> @location(0) vec4<f32> {\n\n    var   finalColor = vec4(0.0);\n\n    %blur-sampling%\n\n    return finalColor;\n}";function zm(t,e){const r=Gm[e],i=r.length,s=[],n=[],o=[];for(let a=0;a<e;a++){s[a]=`@location(${a}) offset${a}: vec2<f32>,`,n[a]=t?`filteredCord + vec2(${a-i+1} * pixelStrength, 0.0),`:`filteredCord + vec2(0.0, ${a-i+1} * pixelStrength),`;const l=r[a<i?a:e-a-1].toString();o[a]=`finalColor += textureSample(uTexture, uSampler, offset${a}) * ${l};`}const a=s.join("\n"),l=n.join("\n"),h=o.join("\n"),u=Lm.replace("%blur-struct%",a).replace("%blur-vertex-out%",l).replace("%blur-fragment-in%",a).replace("%blur-sampling%",h).replace("%dimension%",t?"z":"w");return wn.from({vertex:{source:u,entryPoint:"mainVertex"},fragment:{source:u,entryPoint:"mainFragment"}})}var Xm=Object.defineProperty,Hm=Object.getOwnPropertySymbols,jm=Object.prototype.hasOwnProperty,Vm=Object.prototype.propertyIsEnumerable,Wm=(t,e,r)=>e in t?Xm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$m=(t,e)=>{for(var r in e||(e={}))jm.call(e,r)&&Wm(t,r,e[r]);if(Hm)for(var r of Hm(e))Vm.call(e,r)&&Wm(t,r,e[r]);return t};const Ym=class t extends cm{constructor(e){const r=Um((e=$m($m({},t.defaultOptions),e)).horizontal,e.kernelSize),i=zm(e.horizontal,e.kernelSize);super($m({glProgram:r,gpuProgram:i,resources:{blurUniforms:{uStrength:{value:0,type:"f32"}}}},e)),this.horizontal=e.horizontal,this._quality=0,this.quality=e.quality,this.blur=e.strength,this._uniforms=this.resources.blurUniforms.uniforms}apply(t,e,r,i){if(this._uniforms.uStrength=this.strength/this.passes,1===this.passes)t.applyFilter(this,e,r,i);else{const s=qe.getSameSizeTexture(e);let n=e,o=s;this._state.blend=!1;const a=t.renderer.type===Eo.WEBGPU;for(let e=0;e<this.passes-1;e++){t.applyFilter(this,n,o,0===e||a);const r=o;o=n,n=r}this._state.blend=!0,t.applyFilter(this,n,r,i),qe.returnTexture(s)}}get blur(){return this.strength}set blur(t){this.padding=1+2*Math.abs(t),this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}};Ym.defaultOptions={strength:8,quality:4,kernelSize:5};let qm=Ym;var Km=Object.defineProperty,Qm=Object.defineProperties,Zm=Object.getOwnPropertyDescriptors,Jm=Object.getOwnPropertySymbols,t_=Object.prototype.hasOwnProperty,e_=Object.prototype.propertyIsEnumerable,r_=(t,e,r)=>e in t?Km(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,i_=(t,e)=>{for(var r in e||(e={}))t_.call(e,r)&&r_(t,r,e[r]);if(Jm)for(var r of Jm(e))e_.call(e,r)&&r_(t,r,e[r]);return t};class s_ extends cm{constructor(...t){var e;let r=null!=(e=t[0])?e:{};"number"==typeof r&&(r={strength:r},void 0!==t[1]&&(r.quality=t[1]),void 0!==t[2]&&(r.resolution=t[2]||"inherit"),void 0!==t[3]&&(r.kernelSize=t[3])),r=i_(i_({},qm.defaultOptions),r);const i=r,{strength:s,strengthX:n,strengthY:o,quality:a}=i,l=((t,e)=>{var r={};for(var i in t)t_.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&Jm)for(var i of Jm(t))e.indexOf(i)<0&&e_.call(t,i)&&(r[i]=t[i]);return r})(i,["strength","strengthX","strengthY","quality"]);super(((t,e)=>Qm(t,Zm(e)))(i_({},l),{compatibleRenderers:Eo.BOTH,resources:{}})),this._repeatEdgePixels=!1,this.blurXFilter=new qm(i_({horizontal:!0},r)),this.blurYFilter=new qm(i_({horizontal:!1},r)),this.quality=a,this.strengthX=null!=n?n:s,this.strengthY=null!=o?o:s,this.repeatEdgePixels=!1}apply(t,e,r,i){const s=Math.abs(this.blurXFilter.strength),n=Math.abs(this.blurYFilter.strength);if(s&&n){const s=qe.getSameSizeTexture(e);this.blurXFilter.blendMode="normal",this.blurXFilter.apply(t,e,s,!0),this.blurYFilter.blendMode=this.blendMode,this.blurYFilter.apply(t,s,r,i),qe.returnTexture(s)}else n?(this.blurYFilter.blendMode=this.blendMode,this.blurYFilter.apply(t,e,r,i)):(this.blurXFilter.blendMode=this.blendMode,this.blurXFilter.apply(t,e,r,i))}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.blur),Math.abs(this.blurYFilter.blur))}get strength(){if(this.strengthX!==this.strengthY)throw new Error("BlurFilter's strengthX and strengthY are different");return this.strengthX}set strength(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get strengthX(){return this.blurXFilter.blur}set strengthX(t){this.blurXFilter.blur=t,this.updatePadding()}get strengthY(){return this.blurYFilter.blur}set strengthY(t){this.blurYFilter.blur=t,this.updatePadding()}get blur(){return this.strength}set blur(t){this.strength=t}get blurX(){return this.strengthX}set blurX(t){this.strengthX=t}get blurY(){return this.strengthY}set blurY(t){this.strengthY=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}s_.defaultOptions={strength:8,quality:4,kernelSize:5};var n_="\nin vec2 vTextureCoord;\nin vec4 vColor;\n\nout vec4 finalColor;\n\nuniform float uColorMatrix[20];\nuniform float uAlpha;\n\nuniform sampler2D uTexture;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture(uTexture, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * 0.2);\n    float diff = (randomValue - 0.5) *  0.5;\n\n    if (uAlpha == 0.0) {\n        finalColor = color;\n        return;\n    }\n\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    vec4 result;\n\n    result.r = (uColorMatrix[0] * color.r);\n        result.r += (uColorMatrix[1] * color.g);\n        result.r += (uColorMatrix[2] * color.b);\n        result.r += (uColorMatrix[3] * color.a);\n        result.r += uColorMatrix[4];\n\n    result.g = (uColorMatrix[5] * color.r);\n        result.g += (uColorMatrix[6] * color.g);\n        result.g += (uColorMatrix[7] * color.b);\n        result.g += (uColorMatrix[8] * color.a);\n        result.g += uColorMatrix[9];\n\n    result.b = (uColorMatrix[10] * color.r);\n       result.b += (uColorMatrix[11] * color.g);\n       result.b += (uColorMatrix[12] * color.b);\n       result.b += (uColorMatrix[13] * color.a);\n       result.b += uColorMatrix[14];\n\n    result.a = (uColorMatrix[15] * color.r);\n       result.a += (uColorMatrix[16] * color.g);\n       result.a += (uColorMatrix[17] * color.b);\n       result.a += (uColorMatrix[18] * color.a);\n       result.a += uColorMatrix[19];\n\n    vec3 rgb = mix(color.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    finalColor = vec4(rgb, result.a);\n}\n",o_="struct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\nstruct ColorMatrixUniforms {\n  uColorMatrix:array<vec4<f32>, 5>,\n  uAlpha:f32,\n};\n\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n@group(0) @binding(1) var uTexture: texture_2d<f32>;\n@group(0) @binding(2) var uSampler : sampler;\n@group(1) @binding(0) var<uniform> colorMatrixUniforms : ColorMatrixUniforms;\n\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>,\n  };\n  \nfn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\n@vertex\nfn mainVertex(\n  @location(0) aPosition : vec2<f32>, \n) -> VSOutput {\n  return VSOutput(\n   filterVertexPosition(aPosition),\n   filterTextureCoord(aPosition),\n  );\n}\n\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n) -> @location(0) vec4<f32> {\n\n\n  var c = textureSample(uTexture, uSampler, uv);\n  \n  if (colorMatrixUniforms.uAlpha == 0.0) {\n    return c;\n  }\n\n \n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.r /= c.a;\n      c.g /= c.a;\n      c.b /= c.a;\n    }\n\n    var cm = colorMatrixUniforms.uColorMatrix;\n\n\n    var result = vec4<f32>(0.);\n\n    result.r = (cm[0][0] * c.r);\n    result.r += (cm[0][1] * c.g);\n    result.r += (cm[0][2] * c.b);\n    result.r += (cm[0][3] * c.a);\n    result.r += cm[1][0];\n\n    result.g = (cm[1][1] * c.r);\n    result.g += (cm[1][2] * c.g);\n    result.g += (cm[1][3] * c.b);\n    result.g += (cm[2][0] * c.a);\n    result.g += cm[2][1];\n\n    result.b = (cm[2][2] * c.r);\n    result.b += (cm[2][3] * c.g);\n    result.b += (cm[3][0] * c.b);\n    result.b += (cm[3][1] * c.a);\n    result.b += cm[3][2];\n\n    result.a = (cm[3][3] * c.r);\n    result.a += (cm[4][0] * c.g);\n    result.a += (cm[4][1] * c.b);\n    result.a += (cm[4][2] * c.a);\n    result.a += cm[4][3];\n\n    var rgb = mix(c.rgb, result.rgb, colorMatrixUniforms.uAlpha);\n\n    rgb.r *= result.a;\n    rgb.g *= result.a;\n    rgb.b *= result.a;\n\n    return vec4(rgb, result.a);\n}",a_=Object.defineProperty,l_=Object.defineProperties,h_=Object.getOwnPropertyDescriptors,u_=Object.getOwnPropertySymbols,c_=Object.prototype.hasOwnProperty,d_=Object.prototype.propertyIsEnumerable,p_=(t,e,r)=>e in t?a_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var f_="\nin vec2 vTextureCoord;\nin vec2 vFilterUv;\n\nout vec4 finalColor;\n\nuniform sampler2D uTexture;\nuniform sampler2D uMapTexture;\n\nuniform vec4 uInputClamp;\nuniform highp vec4 uInputSize;\nuniform mat2 uRotation;\nuniform vec2 uScale;\n\nvoid main()\n{\n    vec4 map = texture(uMapTexture, vFilterUv);\n    \n    vec2 offset = uInputSize.zw * (uRotation * (map.xy - 0.5)) * uScale; \n\n    finalColor = texture(uTexture, clamp(vTextureCoord + offset, uInputClamp.xy, uInputClamp.zw));\n}\n",g_="in vec2 aPosition;\nout vec2 vTextureCoord;\nout vec2 vFilterUv;\n\n\nuniform vec4 uInputSize;\nuniform vec4 uOutputFrame;\nuniform vec4 uOutputTexture;\n\nuniform mat3 uFilterMatrix;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;\n    \n    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aPosition * (uOutputFrame.zw * uInputSize.zw);\n}\n\nvec2 getFilterCoord( void )\n{\n  return ( uFilterMatrix * vec3( filterTextureCoord(), 1.0)  ).xy;\n}\n\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n    vFilterUv = getFilterCoord();\n}\n",m_="\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\nstruct DisplacementUniforms {\n  uFilterMatrix:mat3x3<f32>,\n  uScale:vec2<f32>,\n  uRotation:mat2x2<f32>\n};\n\n\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n@group(0) @binding(1) var uTexture: texture_2d<f32>;\n@group(0) @binding(2) var uSampler : sampler;\n\n@group(1) @binding(0) var<uniform> filterUniforms : DisplacementUniforms;\n@group(1) @binding(1) var uMapTexture: texture_2d<f32>;\n@group(1) @binding(2) var uMapSampler : sampler;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>,\n    @location(1) filterUv : vec2<f32>,\n  };\n\nfn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\nfn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  \n}\n\nfn getFilterCoord(aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return ( filterUniforms.uFilterMatrix * vec3( filterTextureCoord(aPosition), 1.0)  ).xy;\n}\n\nfn getSize() -> vec2<f32>\n{\n\n  \n  return gfu.uGlobalFrame.zw;\n}\n  \n@vertex\nfn mainVertex(\n  @location(0) aPosition : vec2<f32>, \n) -> VSOutput {\n  return VSOutput(\n   filterVertexPosition(aPosition),\n   filterTextureCoord(aPosition),\n   getFilterCoord(aPosition)\n  );\n}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @location(1) filterUv: vec2<f32>,\n  @builtin(position) position: vec4<f32>\n) -> @location(0) vec4<f32> {\n\n    var map = textureSample(uMapTexture, uMapSampler, filterUv);\n\n    var offset =  gfu.uInputSize.zw * (filterUniforms.uRotation * (map.xy - 0.5)) * filterUniforms.uScale; \n   \n    return textureSample(uTexture, uSampler, clamp(uv + offset, gfu.uInputClamp.xy, gfu.uInputClamp.zw));\n}",__=Object.defineProperty,x_=Object.defineProperties,y_=Object.getOwnPropertyDescriptors,b_=Object.getOwnPropertySymbols,v_=Object.prototype.hasOwnProperty,T_=Object.prototype.propertyIsEnumerable,S_=(t,e,r)=>e in t?__(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var w_="\nin vec2 vTextureCoord;\nin vec4 vColor;\n\nout vec4 finalColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uTexture;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture(uTexture, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) *  uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    finalColor = color;\n}\n",E_="\n\nstruct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\nstruct NoiseUniforms {\n  uNoise:f32,\n  uSeed:f32,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n@group(0) @binding(1) var uTexture: texture_2d<f32>;\n@group(0) @binding(2) var uSampler : sampler;\n\n@group(1) @binding(0) var<uniform> noiseUniforms : NoiseUniforms;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>\n  };\n\nfn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\nfn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  \n}\n\nfn getSize() -> vec2<f32>\n{\n  return gfu.uGlobalFrame.zw;\n}\n  \n@vertex\nfn mainVertex(\n  @location(0) aPosition : vec2<f32>, \n) -> VSOutput {\n  return VSOutput(\n   filterVertexPosition(aPosition),\n   filterTextureCoord(aPosition)\n  );\n}\n\nfn rand(co:vec2<f32>) -> f32\n{\n  return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\n\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @builtin(position) position: vec4<f32>\n) -> @location(0) vec4<f32> {\n\n    var pixelPosition =  globalTextureCoord(position.xy);// / (getSize());//-  gfu.uOutputFrame.xy);\n  \n    \n    var sample = textureSample(uTexture, uSampler, uv);\n    var randomValue =  rand(pixelPosition.xy * noiseUniforms.uSeed);\n    var diff = (randomValue - 0.5) * noiseUniforms.uNoise;\n  \n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (sample.a > 0.0) {\n      sample.r /= sample.a;\n      sample.g /= sample.a;\n      sample.b /= sample.a;\n    }\n\n    sample.r += diff;\n    sample.g += diff;\n    sample.b += diff;\n\n    // Premultiply alpha again.\n    sample.r *= sample.a;\n    sample.g *= sample.a;\n    sample.b *= sample.a;\n    \n    return sample;\n}",A_=Object.defineProperty,P_=Object.defineProperties,M_=Object.getOwnPropertyDescriptors,R_=Object.getOwnPropertySymbols,C_=Object.prototype.hasOwnProperty,O_=Object.prototype.propertyIsEnumerable,I_=(t,e,r)=>e in t?A_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,B_=(t,e)=>{for(var r in e||(e={}))C_.call(e,r)&&I_(t,r,e[r]);if(R_)for(var r of R_(e))O_.call(e,r)&&I_(t,r,e[r]);return t};const k_=class t extends cm{constructor(e={}){e=B_(B_({},t.defaultOptions),e);const r=wn.from({vertex:{source:E_,entryPoint:"mainVertex"},fragment:{source:E_,entryPoint:"mainFragment"}}),i=pn.from({vertex:Tm,fragment:w_,name:"noise-filter"}),s=e,{noise:n,seed:o}=s,a=((t,e)=>{var r={};for(var i in t)C_.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&R_)for(var i of R_(t))e.indexOf(i)<0&&O_.call(t,i)&&(r[i]=t[i]);return r})(s,["noise","seed"]);super(((t,e)=>P_(t,M_(e)))(B_({},a),{gpuProgram:r,glProgram:i,resources:{noiseUniforms:new To({uNoise:{value:1,type:"f32"},uSeed:{value:1,type:"f32"}})}})),this.noise=n,this.seed=null!=o?o:Math.random()}get noise(){return this.resources.noiseUniforms.uniforms.uNoise}set noise(t){this.resources.noiseUniforms.uniforms.uNoise=t}get seed(){return this.resources.noiseUniforms.uniforms.uSeed}set seed(t){this.resources.noiseUniforms.uniforms.uSeed=t}};k_.defaultOptions={noise:.5};let G_=k_;var D_="in vec2 vMaskCoord;\nin vec2 vTextureCoord;\n\nuniform sampler2D uTexture;\nuniform sampler2D uMaskTexture;\n\nuniform float uAlpha;\nuniform vec4 uMaskClamp;\nuniform float uInverse;\n\nout vec4 finalColor;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(uMaskClamp.x, vMaskCoord.x) +\n        step(uMaskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, uMaskClamp.z) +\n        step(vMaskCoord.y, uMaskClamp.w));\n\n    // TODO look into why this is needed\n    float npmAlpha = uAlpha;\n    vec4 original = texture(uTexture, vTextureCoord);\n    vec4 masky = texture(uMaskTexture, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    float a = alphaMul * masky.r * npmAlpha * clip;\n\n    if (uInverse == 1.0) {\n        a = 1.0 - a;\n    }\n\n    finalColor = original * a;\n}\n",F_="in vec2 aPosition;\n\nout vec2 vTextureCoord;\nout vec2 vMaskCoord;\n\n\nuniform vec4 uInputSize;\nuniform vec4 uOutputFrame;\nuniform vec4 uOutputTexture;\nuniform mat3 uFilterMatrix;\n\nvec4 filterVertexPosition(  vec2 aPosition )\n{\n    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;\n       \n    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord(  vec2 aPosition )\n{\n    return aPosition * (uOutputFrame.zw * uInputSize.zw);\n}\n\nvec2 getFilterCoord( vec2 aPosition )\n{\n    return  ( uFilterMatrix * vec3( filterTextureCoord(aPosition), 1.0)  ).xy;\n}   \n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition(aPosition);\n    vTextureCoord = filterTextureCoord(aPosition);\n    vMaskCoord = getFilterCoord(aPosition);\n}\n",N_="struct GlobalFilterUniforms {\n  uInputSize:vec4<f32>,\n  uInputPixel:vec4<f32>,\n  uInputClamp:vec4<f32>,\n  uOutputFrame:vec4<f32>,\n  uGlobalFrame:vec4<f32>,\n  uOutputTexture:vec4<f32>,\n};\n\nstruct MaskUniforms {\n  uFilterMatrix:mat3x3<f32>,\n  uMaskClamp:vec4<f32>,\n  uAlpha:f32,\n  uInverse:f32,\n};\n\n@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;\n@group(0) @binding(1) var uTexture: texture_2d<f32>;\n@group(0) @binding(2) var uSampler : sampler;\n\n@group(1) @binding(0) var<uniform> filterUniforms : MaskUniforms;\n@group(1) @binding(1) var uMaskTexture: texture_2d<f32>;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>,\n    @location(1) filterUv : vec2<f32>,\n};\n\nfn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\nfn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);\n}\n\nfn getFilterCoord(aPosition:vec2<f32> ) -> vec2<f32>\n{\n  return ( filterUniforms.uFilterMatrix * vec3( filterTextureCoord(aPosition), 1.0)  ).xy;\n}\n\nfn getSize() -> vec2<f32>\n{\n  return gfu.uGlobalFrame.zw;\n}\n\n@vertex\nfn mainVertex(\n  @location(0) aPosition : vec2<f32>,\n) -> VSOutput {\n  return VSOutput(\n   filterVertexPosition(aPosition),\n   filterTextureCoord(aPosition),\n   getFilterCoord(aPosition)\n  );\n}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @location(1) filterUv: vec2<f32>,\n  @builtin(position) position: vec4<f32>\n) -> @location(0) vec4<f32> {\n\n    var maskClamp = filterUniforms.uMaskClamp;\n    var uAlpha = filterUniforms.uAlpha;\n\n    var clip = step(3.5,\n      step(maskClamp.x, filterUv.x) +\n      step(maskClamp.y, filterUv.y) +\n      step(filterUv.x, maskClamp.z) +\n      step(filterUv.y, maskClamp.w));\n\n    var mask = textureSample(uMaskTexture, uSampler, filterUv);\n    var source = textureSample(uTexture, uSampler, uv);\n    var alphaMul = 1.0 - uAlpha * (1.0 - mask.a);\n\n    var a: f32 = alphaMul * mask.r * uAlpha * clip;\n\n    if (filterUniforms.uInverse == 1.0) {\n        a = 1.0 - a;\n    }\n\n    return source * a;\n}\n",U_=Object.defineProperty,L_=Object.defineProperties,z_=Object.getOwnPropertyDescriptors,X_=Object.getOwnPropertySymbols,H_=Object.prototype.hasOwnProperty,j_=Object.prototype.propertyIsEnumerable,V_=(t,e,r)=>e in t?U_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;class W_ extends cm{constructor(t){const e=t,{sprite:r}=e,i=((t,e)=>{var r={};for(var i in t)H_.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&X_)for(var i of X_(t))e.indexOf(i)<0&&j_.call(t,i)&&(r[i]=t[i]);return r})(e,["sprite"]),s=new Ne(r.texture),n=new To({uFilterMatrix:{value:new st,type:"mat3x3<f32>"},uMaskClamp:{value:s.uClampFrame,type:"vec4<f32>"},uAlpha:{value:1,type:"f32"},uInverse:{value:t.inverse?1:0,type:"f32"}}),o=wn.from({vertex:{source:N_,entryPoint:"mainVertex"},fragment:{source:N_,entryPoint:"mainFragment"}}),a=pn.from({vertex:F_,fragment:D_,name:"mask-filter"});super(((t,e)=>L_(t,z_(e)))(((t,e)=>{for(var r in e||(e={}))H_.call(e,r)&&V_(t,r,e[r]);if(X_)for(var r of X_(e))j_.call(e,r)&&V_(t,r,e[r]);return t})({},i),{gpuProgram:o,glProgram:a,resources:{filterUniforms:n,uMaskTexture:r.texture.source}})),this.sprite=r,this._textureMatrix=s}set inverse(t){this.resources.filterUniforms.uniforms.uInverse=t?1:0}get inverse(){return 1===this.resources.filterUniforms.uniforms.uInverse}apply(t,e,r,i){this._textureMatrix.texture=this.sprite.texture,t.calculateSpriteMatrix(this.resources.filterUniforms.uniforms.uFilterMatrix,this.sprite).prepend(this._textureMatrix.mapCoord),this.resources.uMaskTexture=this.sprite.texture.source,t.applyFilter(this,e,r,i)}}function $_(t,e,r,i,s,n,o,a){const l=o-r,h=a-i,u=s-r,c=n-i,d=t-r,p=e-i,f=l*l+h*h,g=l*u+h*c,m=l*d+h*p,_=u*u+c*c,x=u*d+c*p,y=1/(f*_-g*g),b=(_*m-g*x)*y,v=(f*x-g*m)*y;return b>=0&&v>=0&&b+v<1}class Y_{constructor(t=0,e=0,r=0,i=0,s=0,n=0){this.type="triangle",this.x=t,this.y=e,this.x2=r,this.y2=i,this.x3=s,this.y3=n}contains(t,e){const r=(this.x-this.x3)*(e-this.y3)-(this.y-this.y3)*(t-this.x3),i=(this.x2-this.x)*(e-this.y)-(this.y2-this.y)*(t-this.x);if(r<0!=i<0&&0!==r&&0!==i)return!1;const s=(this.x3-this.x2)*(e-this.y2)-(this.y3-this.y2)*(t-this.x2);return 0===s||s<0==r+i<=0}strokeContains(t,e,r,i=.5){const s=r/2,n=s*s,{x:o,x2:a,x3:l,y:h,y2:u,y3:c}=this;return $l(t,e,o,h,a,c)<=n||$l(t,e,a,u,l,c)<=n||$l(t,e,l,c,o,h)<=n}clone(){return new Y_(this.x,this.y,this.x2,this.y2,this.x3,this.y3)}copyFrom(t){return this.x=t.x,this.y=t.y,this.x2=t.x2,this.y2=t.y2,this.x3=t.x3,this.y3=t.y3,this}copyTo(t){return t.copyFrom(this),t}getBounds(t){t||(t=new Rt);const e=Math.min(this.x,this.x2,this.x3),r=Math.max(this.x,this.x2,this.x3),i=Math.min(this.y,this.y2,this.y3),s=Math.max(this.y,this.y2,this.y3);return t.x=e,t.y=i,t.width=r-e,t.height=s-i,t}}const q_=class t{constructor(e){this._tick=()=>{this.timeout=setTimeout(this._processQueue,0)},this._processQueue=()=>{const{queue:e}=this;let r=0;for(;e.length&&r<t.uploadsPerFrame;){const t=e.shift();this.uploadQueueItem(t),r++}e.length?Gr.system.addOnce(this._tick,this,Ir.UTILITY):this._resolve()},this.renderer=e,this.queue=[],this.resolves=[]}getQueue(){return[...this.queue]}add(t){const e=Array.isArray(t)?t:[t];for(const t of e)t instanceof er?this._addContainer(t):this.resolveQueueItem(t,this.queue);return this}_addContainer(t){this.resolveQueueItem(t,this.queue);for(const e of t.children)this._addContainer(e)}upload(t){return t&&this.add(t),new Promise((t=>{this.queue.length?(this.resolves.push(t),this.dedupeQueue(),Gr.system.addOnce(this._tick,this,Ir.UTILITY)):t()}))}dedupeQueue(){const t=Object.create(null);let e=0;for(let r=0;r<this.queue.length;r++){const i=this.queue[r];t[i.uid]||(t[i.uid]=!0,this.queue[e++]=i)}this.queue.length=e}_resolve(){const{resolves:t}=this,e=t.slice(0);t.length=0;for(const t of e)t()}};q_.uploadsPerFrame=4;let K_=q_;var Q_=Object.defineProperty,Z_=Object.getOwnPropertySymbols,J_=Object.prototype.hasOwnProperty,tx=Object.prototype.propertyIsEnumerable,ex=(t,e,r)=>e in t?Q_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;class rx extends Pi{constructor(...t){var e;let r=t[0];r instanceof zs&&(r={geometry:r,shader:t[1]},t[3]&&(r.geometry.topology=t[3]));const i=r,{geometry:s,shader:n,texture:o,roundPixels:a,state:l}=i,h=((t,e)=>{var r={};for(var i in t)J_.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&Z_)for(var i of Z_(t))e.indexOf(i)<0&&tx.call(t,i)&&(r[i]=t[i]);return r})(i,["geometry","shader","texture","roundPixels","state"]);super(((t,e)=>{for(var r in e||(e={}))J_.call(e,r)&&ex(t,r,e[r]);if(Z_)for(var r of Z_(e))tx.call(e,r)&&ex(t,r,e[r]);return t})({label:"Mesh"},h)),this.renderPipeId="mesh",this._shader=null,this.allowChildren=!1,this.shader=null!=n?n:null,this.texture=null!=(e=null!=o?o:null==n?void 0:n.texture)?e:Ue.WHITE,this.state=null!=l?l:tl.for2d(),this._geometry=s,this._geometry.on("update",this.onViewUpdate,this),this.roundPixels=null!=a&&a}get material(){return this._shader}set shader(t){this._shader!==t&&(this._shader=t,this.onViewUpdate())}get shader(){return this._shader}set geometry(t){var e;this._geometry!==t&&(null==(e=this._geometry)||e.off("update",this.onViewUpdate,this),t.on("update",this.onViewUpdate,this),this._geometry=t,this.onViewUpdate())}get geometry(){return this._geometry}set texture(t){t||(t=Ue.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this.shader&&(this.shader.texture=t),this._texture=t,this.onViewUpdate())}get texture(){return this._texture}get batched(){return!(this._shader||12&this.state.data)&&(this._geometry instanceof Lc&&("auto"===this._geometry.batchMode?this._geometry.positions.length/2<=100:"batch"===this._geometry.batchMode))}get bounds(){return this._geometry.bounds}updateBounds(){this._bounds=this._geometry.bounds}containsPoint(t){const{x:e,y:r}=t;if(!this.bounds.containsPoint(e,r))return!1;const i=this.geometry.getBuffer("aPosition").data,s="triangle-strip"===this.geometry.topology?3:1;if(this.geometry.getIndex()){const t=this.geometry.getIndex().data,n=t.length;for(let o=0;o+2<n;o+=s){const s=2*t[o],n=2*t[o+1],a=2*t[o+2];if($_(e,r,i[s],i[s+1],i[n],i[n+1],i[a],i[a+1]))return!0}}else{const t=i.length/2;for(let n=0;n+2<t;n+=s){const t=2*n,s=2*(n+1),o=2*(n+2);if($_(e,r,i[t],i[t+1],i[s],i[s+1],i[o],i[o+1]))return!0}}return!1}destroy(t){var e;if(super.destroy(t),"boolean"==typeof t?t:null==t?void 0:t.texture){const e="boolean"==typeof t?t:null==t?void 0:t.textureSource;this._texture.destroy(e)}null==(e=this._geometry)||e.off("update",this.onViewUpdate,this),this._texture=null,this._geometry=null,this._shader=null}}var ix=Object.defineProperty,sx=Object.defineProperties,nx=Object.getOwnPropertyDescriptors,ox=Object.getOwnPropertySymbols,ax=Object.prototype.hasOwnProperty,lx=Object.prototype.propertyIsEnumerable,hx=(t,e,r)=>e in t?ix(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;class ux extends Bi{constructor(...t){let e=t[0];Array.isArray(t[0])&&(e={textures:t[0],autoUpdate:t[1]});const r=e,{animationSpeed:i=1,autoPlay:s=!1,autoUpdate:n=!0,loop:o=!0,onComplete:a=null,onFrameChange:l=null,onLoop:h=null,textures:u,updateAnchor:c=!1}=r,d=((t,e)=>{var r={};for(var i in t)ax.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&ox)for(var i of ox(t))e.indexOf(i)<0&&lx.call(t,i)&&(r[i]=t[i]);return r})(r,["animationSpeed","autoPlay","autoUpdate","loop","onComplete","onFrameChange","onLoop","textures","updateAnchor"]),[p]=u;super(((t,e)=>sx(t,nx(e)))(((t,e)=>{for(var r in e||(e={}))ax.call(e,r)&&hx(t,r,e[r]);if(ox)for(var r of ox(e))lx.call(e,r)&&hx(t,r,e[r]);return t})({},d),{texture:p instanceof Ue?p:p.texture})),this._textures=null,this._durations=null,this._autoUpdate=n,this._isConnectedToTicker=!1,this.animationSpeed=i,this.loop=o,this.updateAnchor=c,this.onComplete=a,this.onFrameChange=l,this.onLoop=h,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=u,s&&this.play()}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Gr.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Gr.shared.add(this.update,this,Ir.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;const e=t.deltaTime,r=this.animationSpeed*e,i=this.currentFrame;if(null!==this._durations){let t=this._currentTime%1*this._durations[this.currentFrame];for(t+=r/60*1e3;t<0;)this._currentTime--,t+=this._durations[this.currentFrame];const i=Math.sign(this.animationSpeed*e);for(this._currentTime=Math.floor(this._currentTime);t>=this._durations[this.currentFrame];)t-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=t/this._durations[this.currentFrame]}else this._currentTime+=r;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):i!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<i||this.animationSpeed<0&&this.currentFrame>i)&&this.onLoop(),this._updateTexture())}_updateTexture(){const t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this.texture=this._textures[t],this.updateAnchor&&this.texture.defaultAnchor&&this.anchor.copyFrom(this.texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(){this.stop(),super.destroy(),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){const e=[];for(let r=0;r<t.length;++r)e.push(Ue.from(t[r]));return new ux(e)}static fromImages(t){const e=[];for(let r=0;r<t.length;++r)e.push(Ue.from(t[r]));return new ux(e)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof Ue)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this._updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this._updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Gr.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Gr.shared.add(this.update,this),this._isConnectedToTicker=!0))}}class cx{constructor({matrix:t,observer:e}={}){this.dirty=!0,this._matrix=null!=t?t:new st,this.observer=e,this.position=new at(this,0,0),this.scale=new at(this,1,1),this.pivot=new at(this,0,0),this.skew=new at(this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1}get matrix(){const t=this._matrix;return this.dirty&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this.dirty=!1),t}_onUpdate(t){var e;this.dirty=!0,t===this.skew&&this.updateSkew(),null==(e=this.observer)||e._onUpdate(this)}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this.dirty=!0}setFromMatrix(t){t.decompose(this),this.dirty=!0}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this._onUpdate(this.skew))}}var dx=Object.defineProperty,px=Object.getOwnPropertySymbols,fx=Object.prototype.hasOwnProperty,gx=Object.prototype.propertyIsEnumerable,mx=(t,e,r)=>e in t?dx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_x=(t,e)=>{for(var r in e||(e={}))fx.call(e,r)&&mx(t,r,e[r]);if(px)for(var r of px(e))gx.call(e,r)&&mx(t,r,e[r]);return t};const xx=class t extends Pi{constructor(...e){let r=e[0]||{};r instanceof Ue&&(r={texture:r}),e.length>1&&(r.width=e[1],r.height=e[2]),r=_x(_x({},t.defaultOptions),r);const i=null!=r?r:{},{texture:s,anchor:n,tilePosition:o,tileScale:a,tileRotation:l,width:h,height:u,applyAnchorToTexture:c,roundPixels:d}=i,p=((t,e)=>{var r={};for(var i in t)fx.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&px)for(var i of px(t))e.indexOf(i)<0&&gx.call(t,i)&&(r[i]=t[i]);return r})(i,["texture","anchor","tilePosition","tileScale","tileRotation","width","height","applyAnchorToTexture","roundPixels"]);super(_x({label:"TilingSprite"},p)),this.renderPipeId="tilingSprite",this.batched=!0,this.allowChildren=!1,this._anchor=new at({_onUpdate:()=>{this.onViewUpdate()}}),this.applyAnchorToTexture=c,this.texture=s,this._width=null!=h?h:s.width,this._height=null!=u?u:s.height,this._tileTransform=new cx({observer:{_onUpdate:()=>this.onViewUpdate()}}),n&&(this.anchor=n),this.tilePosition=o,this.tileScale=a,this.tileRotation=l,this.roundPixels=null!=d&&d}static from(e,r={}){return new t(_x("string"==typeof e?{texture:es.get(e)}:{texture:e},r))}get uvRespectAnchor(){return _h("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture}set uvRespectAnchor(t){_h("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture=t}get clampMargin(){return this._texture.textureMatrix.clampMargin}set clampMargin(t){this._texture.textureMatrix.clampMargin=t}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get tilePosition(){return this._tileTransform.position}set tilePosition(t){this._tileTransform.position.copyFrom(t)}get tileScale(){return this._tileTransform.scale}set tileScale(t){"number"==typeof t?this._tileTransform.scale.set(t):this._tileTransform.scale.copyFrom(t)}set tileRotation(t){this._tileTransform.rotation=t}get tileRotation(){return this._tileTransform.rotation}get tileTransform(){return this._tileTransform}set texture(t){t||(t=Ue.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this.onViewUpdate())}get texture(){return this._texture}set width(t){this._width=t,this.onViewUpdate()}get width(){return this._width}set height(t){this._height=t,this.onViewUpdate()}get height(){return this._height}setSize(t,e){var r;"object"==typeof t&&(e=null!=(r=t.height)?r:t.width,t=t.width),this._width=t,this._height=null!=e?e:t,this.onViewUpdate()}getSize(t){return t||(t={}),t.width=this._width,t.height=this._height,t}updateBounds(){const t=this._bounds,e=this._anchor,r=this._width,i=this._height;t.minX=-e._x*r,t.maxX=t.minX+r,t.minY=-e._y*i,t.maxY=t.minY+i}containsPoint(t){const e=this._width,r=this._height,i=-e*this._anchor._x;let s=0;return t.x>=i&&t.x<=i+e&&(s=-r*this._anchor._y,t.y>=s&&t.y<=s+r)}destroy(t=!1){if(super.destroy(t),this._anchor=null,this._tileTransform=null,this._bounds=null,"boolean"==typeof t?t:null==t?void 0:t.texture){const e="boolean"==typeof t?t:null==t?void 0:t.textureSource;this._texture.destroy(e)}this._texture=null}};xx.defaultOptions={texture:Ue.EMPTY,anchor:{x:0,y:0},tilePosition:{x:0,y:0},tileScale:{x:1,y:1},tileRotation:0,applyAnchorToTexture:!1};let yx=xx;var bx=Object.defineProperty,vx=Object.getOwnPropertySymbols,Tx=Object.prototype.hasOwnProperty,Sx=Object.prototype.propertyIsEnumerable,wx=(t,e,r)=>e in t?bx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;class Ex extends Pi{constructor(t,e){const r=t,{text:i,resolution:s,style:n,anchor:o,width:a,height:l,roundPixels:h}=r,u=((t,e)=>{var r={};for(var i in t)Tx.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&vx)for(var i of vx(t))e.indexOf(i)<0&&Sx.call(t,i)&&(r[i]=t[i]);return r})(r,["text","resolution","style","anchor","width","height","roundPixels"]);super(((t,e)=>{for(var r in e||(e={}))Tx.call(e,r)&&wx(t,r,e[r]);if(vx)for(var r of vx(e))Sx.call(e,r)&&wx(t,r,e[r]);return t})({},u)),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=e,this.text=null!=i?i:"",this.style=n,this.resolution=null!=s?s:null,this.allowChildren=!1,this._anchor=new at({_onUpdate:()=>{this.onViewUpdate()}}),o&&(this.anchor=o),this.roundPixels=null!=h&&h,void 0!==a&&(this.width=a),void 0!==l&&(this.height=l)}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}set text(t){t=t.toString(),this._text!==t&&(this._text=t,this.onViewUpdate())}get text(){return this._text}set resolution(t){this._autoResolution=null===t,this._resolution=t,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(t){var e;t||(t={}),null==(e=this._style)||e.off("update",this.onViewUpdate,this),t instanceof this._styleClass?this._style=t:this._style=new this._styleClass(t),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(t){this._setWidth(t,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(t){this._setHeight(t,this.bounds.height)}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this.bounds.width,t.height=Math.abs(this.scale.y)*this.bounds.height,t}setSize(t,e){var r;"object"==typeof t?(e=null!=(r=t.height)?r:t.width,t=t.width):null!=e||(e=t),void 0!==t&&this._setWidth(t,this.bounds.width),void 0!==e&&this._setHeight(e,this.bounds.height)}containsPoint(t){const e=this.bounds.width,r=this.bounds.height,i=-e*this.anchor.x;let s=0;return t.x>=i&&t.x<=i+e&&(s=-r*this.anchor.y,t.y>=s&&t.y<=s+r)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}_getKey(){return`${this.text}:${this._style.styleKey}:${this._resolution}`}destroy(t=!1){super.destroy(t),this.owner=null,this._bounds=null,this._anchor=null,("boolean"==typeof t?t:null!=t&&t.style)&&this._style.destroy(t),this._style=null,this._text=null}}function Ax(t,e){var r;let i=null!=(r=t[0])?r:{};return("string"==typeof i||t[1])&&(i={text:i,style:t[1]}),i}class Px extends Ex{constructor(...t){super(Ax(t),fu),this.renderPipeId="text"}updateBounds(){const t=this._bounds,e=this._anchor,r=vu.measureText(this._text,this._style),{width:i,height:s}=r;t.minX=-e._x*i,t.maxX=t.minX+i,t.minY=-e._y*s,t.maxY=t.minY+s}}class Mx extends K_{resolveQueueItem(t,e){return t instanceof er?this.resolveContainerQueueItem(t,e):t instanceof ye||t instanceof Ue?e.push(t.source):t instanceof eu&&e.push(t),null}resolveContainerQueueItem(t,e){t instanceof Bi||t instanceof yx||t instanceof rx?e.push(t.texture.source):t instanceof Px?e.push(t):t instanceof Cu?e.push(t.context):t instanceof ux&&t.textures.forEach((t=>{t.source?e.push(t.source):e.push(t.texture.source)}))}resolveGraphicsContextQueueItem(t){this.renderer.graphicsContext.getGpuContext(t);const{instructions:e}=t;for(const t of e){if("texture"===t.action){const{image:e}=t.data;return e.source}if("fill"===t.action){const{texture:e}=t.data.style;return e.source}}return null}}class Rx extends Ex{constructor(...t){var e;const r=Ax(t);null!=r.style||(r.style=r.style||{}),null!=(e=r.style).fill||(e.fill=16777215),super(r,fu),this.renderPipeId="bitmapText"}updateBounds(){const t=this._bounds,e=this._anchor,r=rc.measureText(this.text,this._style),i=r.scale,s=r.offsetY*i;let n=r.width*i,o=r.height*i;const a=this._style._stroke;a&&(n+=a.width,o+=a.width),t.minX=-e._x*n,t.maxX=t.minX+n,t.minY=-e._y*(o+s),t.maxY=t.minY+o}set resolution(t){}get resolution(){return this._resolution}}class Cx extends Ex{constructor(...t){super(Ax(t),vc),this.renderPipeId="htmlText"}updateBounds(){const t=this._bounds,e=this._anchor,r=Oc(this.text,this._style),{width:i,height:s}=r;t.minX=-e._x*i,t.maxX=t.minX+i,t.minY=-e._y*s,t.maxY=t.minY+s}}class Ox extends Mx{uploadQueueItem(t){t instanceof ye?this.uploadTextureSource(t):t instanceof Px?this.uploadText(t):t instanceof Cx?this.uploadHTMLText(t):t instanceof Rx?this.uploadBitmapText(t):t instanceof eu&&this.uploadGraphicsContext(t)}uploadTextureSource(t){this.renderer.texture.initSource(t)}uploadText(t){this.renderer.renderPipes.text.initGpuText(t)}uploadBitmapText(t){this.renderer.renderPipes.bitmapText.initGpuText(t)}uploadHTMLText(t){this.renderer.renderPipes.htmlText.initGpuText(t)}uploadGraphicsContext(t){this.renderer.graphicsContext.getGpuContext(t);const{instructions:e}=t;for(const t of e)if("texture"===t.action){const{image:e}=t.data;this.uploadTextureSource(e.source)}else if("fill"===t.action){const{texture:e}=t.data.style;this.uploadTextureSource(e.source)}return null}}class Ix extends Ox{destroy(){clearTimeout(this.timeout),this.renderer=null,this.queue=null,this.resolves=null}}Ix.extension={type:[u.WebGLSystem,u.WebGPUSystem],name:"prepare"};class Bx{constructor(){this._tempState=tl.for2d(),this._didUploadHash={}}init(t){t.renderer.runners.contextChange.add(this)}contextChange(){this._didUploadHash={}}start(t,e,r){const i=t.renderer,s=this._didUploadHash[r.uid];i.shader.bind(r,s),s||(this._didUploadHash[r.uid]=!0),i.shader.updateUniformGroup(i.globalUniforms.uniformGroup),i.geometry.bind(e,r.glProgram)}execute(t,e){const r=t.renderer;this._tempState.blendMode=e.blendMode,r.state.set(this._tempState);const i=e.textures.textures;for(let t=0;t<e.textures.count;t++)r.texture.bind(i[t],t);r.geometry.draw(e.topology,e.size,e.start)}}Bx.extension={type:[u.WebGLPipesAdaptor],name:"batch"};const kx=tl.for2d();class Gx{start(t,e,r){const i=t.renderer,s=i.encoder,n=r.gpuProgram;this._shader=r,this._geometry=e,s.setGeometry(e,n),kx.blendMode="normal",i.pipeline.getPipeline(e,n,kx);const o=i.globalUniforms.bindGroup;s.resetBindGroup(1),s.setBindGroup(0,o,n)}execute(t,e){const r=this._shader.gpuProgram,i=t.renderer,s=i.encoder;if(!e.bindGroup){const t=e.textures;e.bindGroup=gs(t.textures,t.count)}kx.blendMode=e.blendMode;const n=i.bindGroup.getBindGroup(e.bindGroup,r,1),o=i.pipeline.getPipeline(this._geometry,r,kx,e.topology);e.bindGroup._touch(i.textureGC.count),s.setPipeline(o),s.renderPassEncoder.setBindGroup(1,n),s.renderPassEncoder.drawIndexed(e.size,1,e.start)}}Gx.extension={type:[u.WebGPUPipesAdaptor],name:"batch"};const Dx=class t{constructor(t,e){var r,i;this.state=tl.for2d(),this._batchersByInstructionSet=Object.create(null),this._activeBatches=Object.create(null),this.renderer=t,this._adaptor=e,null==(i=(r=this._adaptor).init)||i.call(r,this)}static getBatcher(t){return new this._availableBatchers[t]}buildStart(t){let e=this._batchersByInstructionSet[t.uid];e||(e=this._batchersByInstructionSet[t.uid]=Object.create(null),e.default||(e.default=new Go)),this._activeBatches=e,this._activeBatch=this._activeBatches.default;for(const t in this._activeBatches)this._activeBatches[t].begin()}addToBatch(e,r){if(this._activeBatch.name!==e.batcherName){this._activeBatch.break(r);let i=this._activeBatches[e.batcherName];i||(i=this._activeBatches[e.batcherName]=t.getBatcher(e.batcherName),i.begin()),this._activeBatch=i}this._activeBatch.add(e)}break(t){this._activeBatch.break(t)}buildEnd(t){this._activeBatch.break(t);const e=this._activeBatches;for(const t in e){const r=e[t],i=r.geometry;i.indexBuffer.setDataWithSize(r.indexBuffer,r.indexSize,!0),i.buffers[0].setDataWithSize(r.attributeBuffer.float32View,r.attributeSize,!1)}}upload(t){const e=this._batchersByInstructionSet[t.uid];for(const t in e){const r=e[t],i=r.geometry;r.dirty&&(r.dirty=!1,i.buffers[0].update(4*r.attributeSize))}}execute(t){if("startBatch"===t.action){const e=t.batcher,r=e.geometry,i=e.shader;this._adaptor.start(this,r,i)}this._adaptor.execute(this,t)}destroy(){this.state=null,this.renderer=null,this._adaptor=null;for(const t in this._activeBatches)this._activeBatches[t].destroy();this._activeBatches=null}};Dx.extension={type:[u.WebGLPipes,u.WebGPUPipes,u.CanvasPipes],name:"batch"},Dx._availableBatchers=Object.create(null);let Fx=Dx;p.handleByMap(u.Batcher,Fx._availableBatchers),p.add(Go);const Nx={name:"texture-bit",vertex:{header:"\n\n        struct TextureUniforms {\n            uTextureMatrix:mat3x3<f32>,\n        }\n\n        @group(2) @binding(2) var<uniform> textureUniforms : TextureUniforms;\n        ",main:"\n            uv = (textureUniforms.uTextureMatrix * vec3(uv, 1.0)).xy;\n        "},fragment:{header:"\n            @group(2) @binding(0) var uTexture: texture_2d<f32>;\n            @group(2) @binding(1) var uSampler: sampler;\n\n         \n        ",main:"\n            outColor = textureSample(uTexture, uSampler, vUV);\n        "}},Ux={name:"texture-bit",vertex:{header:"\n            uniform mat3 uTextureMatrix;\n        ",main:"\n            uv = (uTextureMatrix * vec3(uv, 1.0)).xy;\n        "},fragment:{header:"\n        uniform sampler2D uTexture;\n\n         \n        ",main:"\n            outColor = texture(uTexture, vUV);\n        "}},Lx=new Ot;let zx=class extends _t{constructor(){super(),this.filters=[new W_({sprite:new Bi(Ue.EMPTY),inverse:!1,resolution:"inherit",antialias:"inherit"})]}get sprite(){return this.filters[0].sprite}set sprite(t){this.filters[0].sprite=t}get inverse(){return this.filters[0].inverse}set inverse(t){this.filters[0].inverse=t}};class Xx{constructor(t){this._activeMaskStage=[],this._renderer=t}push(t,e,r){const i=this._renderer;if(i.renderPipes.batch.break(r),r.add({renderPipeId:"alphaMask",action:"pushMaskBegin",mask:t,inverse:e._maskOptions.inverse,canBundle:!1,maskedContainer:e}),t.inverse=e._maskOptions.inverse,t.renderMaskToTexture){const e=t.mask;e.includeInBuild=!0,e.collectRenderables(r,i,null),e.includeInBuild=!1}i.renderPipes.batch.break(r),r.add({renderPipeId:"alphaMask",action:"pushMaskEnd",mask:t,maskedContainer:e,inverse:e._maskOptions.inverse,canBundle:!1})}pop(t,e,r){this._renderer.renderPipes.batch.break(r),r.add({renderPipeId:"alphaMask",action:"popMaskEnd",mask:t,inverse:e._maskOptions.inverse,canBundle:!1})}execute(t){const e=this._renderer,r=t.mask.renderMaskToTexture;if("pushMaskBegin"===t.action){const i=dt.get(zx);if(i.inverse=t.inverse,r){t.mask.mask.measurable=!0;const r=Dt(t.mask.mask,!0,Lx);t.mask.mask.measurable=!1,r.ceil();const s=e.renderTarget.renderTarget.colorTexture.source,n=qe.getOptimalTexture(r.width,r.height,s._resolution,s.antialias);e.renderTarget.push(n,!0),e.globalUniforms.push({offset:r,worldColor:4294967295});const o=i.sprite;o.texture=n,o.worldTransform.tx=r.minX,o.worldTransform.ty=r.minY,this._activeMaskStage.push({filterEffect:i,maskedContainer:t.maskedContainer,filterTexture:n})}else i.sprite=t.mask.mask,this._activeMaskStage.push({filterEffect:i,maskedContainer:t.maskedContainer})}else if("pushMaskEnd"===t.action){const t=this._activeMaskStage[this._activeMaskStage.length-1];r&&(e.type===Eo.WEBGL&&e.renderTarget.finishRenderPass(),e.renderTarget.pop(),e.globalUniforms.pop()),e.filter.push({renderPipeId:"filter",action:"pushFilter",container:t.maskedContainer,filterEffect:t.filterEffect,canBundle:!1})}else if("popMaskEnd"===t.action){e.filter.pop();const t=this._activeMaskStage.pop();r&&qe.returnTexture(t.filterTexture),dt.return(t.filterEffect)}}destroy(){this._renderer=null,this._activeMaskStage=null}}Xx.extension={type:[u.WebGLPipes,u.WebGPUPipes,u.CanvasPipes],name:"alphaMask"};class Hx{constructor(t){this._colorStack=[],this._colorStackIndex=0,this._currentColor=0,this._renderer=t}buildStart(){this._colorStack[0]=15,this._colorStackIndex=1,this._currentColor=15}push(t,e,r){this._renderer.renderPipes.batch.break(r);const i=this._colorStack;i[this._colorStackIndex]=i[this._colorStackIndex-1]&t.mask;const s=this._colorStack[this._colorStackIndex];s!==this._currentColor&&(this._currentColor=s,r.add({renderPipeId:"colorMask",colorMask:s,canBundle:!1})),this._colorStackIndex++}pop(t,e,r){this._renderer.renderPipes.batch.break(r);const i=this._colorStack;this._colorStackIndex--;const s=i[this._colorStackIndex-1];s!==this._currentColor&&(this._currentColor=s,r.add({renderPipeId:"colorMask",colorMask:s,canBundle:!1}))}execute(t){this._renderer.colorMask.setMask(t.colorMask)}destroy(){this._colorStack=null}}Hx.extension={type:[u.WebGLPipes,u.WebGPUPipes,u.CanvasPipes],name:"colorMask"};class jx{constructor(t){this._maskStackHash={},this._maskHash=new WeakMap,this._renderer=t}push(t,e,r){var i;const s=t,n=this._renderer;n.renderPipes.batch.break(r),n.renderPipes.blendMode.setBlendMode(s.mask,"none",r),r.add({renderPipeId:"stencilMask",action:"pushMaskBegin",mask:t,inverse:e._maskOptions.inverse,canBundle:!1});const o=s.mask;o.includeInBuild=!0,this._maskHash.has(s)||this._maskHash.set(s,{instructionsStart:0,instructionsLength:0});const a=this._maskHash.get(s);a.instructionsStart=r.instructionSize,o.collectRenderables(r,n,null),o.includeInBuild=!1,n.renderPipes.batch.break(r),r.add({renderPipeId:"stencilMask",action:"pushMaskEnd",mask:t,inverse:e._maskOptions.inverse,canBundle:!1});const l=r.instructionSize-a.instructionsStart-1;a.instructionsLength=l;const h=n.renderTarget.renderTarget.uid;null!=(i=this._maskStackHash)[h]||(i[h]=0)}pop(t,e,r){const i=t,s=this._renderer;s.renderPipes.batch.break(r),s.renderPipes.blendMode.setBlendMode(i.mask,"none",r),r.add({renderPipeId:"stencilMask",action:"popMaskBegin",inverse:e._maskOptions.inverse,canBundle:!1});const n=this._maskHash.get(t);for(let t=0;t<n.instructionsLength;t++)r.instructions[r.instructionSize++]=r.instructions[n.instructionsStart++];r.add({renderPipeId:"stencilMask",action:"popMaskEnd",canBundle:!1})}execute(t){var e,r;const i=this._renderer,s=i.renderTarget.renderTarget.uid;let n=null!=(r=(e=this._maskStackHash)[s])?r:e[s]=0;"pushMaskBegin"===t.action?(i.renderTarget.ensureDepthStencil(),i.stencil.setStencilMode(bs.RENDERING_MASK_ADD,n),n++,i.colorMask.setMask(0)):"pushMaskEnd"===t.action?(t.inverse?i.stencil.setStencilMode(bs.INVERSE_MASK_ACTIVE,n):i.stencil.setStencilMode(bs.MASK_ACTIVE,n),i.colorMask.setMask(15)):"popMaskBegin"===t.action?(i.colorMask.setMask(0),0!==n?i.stencil.setStencilMode(bs.RENDERING_MASK_REMOVE,n):(i.renderTarget.clear(null,Dd.STENCIL),i.stencil.setStencilMode(bs.DISABLED,n)),n--):"popMaskEnd"===t.action&&(t.inverse?i.stencil.setStencilMode(bs.INVERSE_MASK_ACTIVE,n):i.stencil.setStencilMode(bs.MASK_ACTIVE,n),i.colorMask.setMask(15)),this._maskStackHash[s]=n}destroy(){this._renderer=null,this._maskStackHash=null,this._maskHash=null}}jx.extension={type:[u.WebGLPipes,u.WebGPUPipes,u.CanvasPipes],name:"stencilMask"};var Vx=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(Vx||{});class Wx{constructor(t,e){this._lastBindBaseLocation=-1,this._lastBindCallId=-1,this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.type=e}}class $x{constructor(t){this._gpuBuffers=Object.create(null),this._boundBufferBases=Object.create(null),this._minBaseLocation=0,this._nextBindBaseIndex=this._minBaseLocation,this._bindCallId=0,this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_gpuBuffers")}destroy(){this._renderer=null,this._gl=null,this._gpuBuffers=null,this._boundBufferBases=null}contextChange(){const t=this._gl=this._renderer.gl;this._gpuBuffers=Object.create(null),this._maxBindings=t.MAX_UNIFORM_BUFFER_BINDINGS?t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS):0}getGlBuffer(t){return this._gpuBuffers[t.uid]||this.createGLBuffer(t)}bind(t){const{_gl:e}=this,r=this.getGlBuffer(t);e.bindBuffer(r.type,r.buffer)}bindBufferBase(t,e){const{_gl:r}=this;this._boundBufferBases[e]!==t&&(this._boundBufferBases[e]=t,t._lastBindBaseLocation=e,r.bindBufferBase(r.UNIFORM_BUFFER,e,t.buffer))}nextBindBase(t){this._bindCallId++,this._minBaseLocation=0,t&&(this._boundBufferBases[0]=null,this._minBaseLocation=1,this._nextBindBaseIndex<1&&(this._nextBindBaseIndex=1))}freeLocationForBufferBase(t){let e=this.getLastBindBaseLocation(t);if(e>=this._minBaseLocation)return t._lastBindCallId=this._bindCallId,e;let r=0,i=this._nextBindBaseIndex;for(;r<2;){i>=this._maxBindings&&(i=this._minBaseLocation,r++);const t=this._boundBufferBases[i];if(!t||t._lastBindCallId!==this._bindCallId)break;i++}return e=i,this._nextBindBaseIndex=i+1,r>=2?-1:(t._lastBindCallId=this._bindCallId,this._boundBufferBases[e]=null,e)}getLastBindBaseLocation(t){const e=t._lastBindBaseLocation;return this._boundBufferBases[e]===t?e:-1}bindBufferRange(t,e,r,i){const{_gl:s}=this;r||(r=0),e||(e=0),this._boundBufferBases[e]=null,s.bindBufferRange(s.UNIFORM_BUFFER,e||0,t.buffer,256*r,i||256)}updateBuffer(t){const{_gl:e}=this,r=this.getGlBuffer(t);if(t._updateID===r.updateID)return r;r.updateID=t._updateID,e.bindBuffer(r.type,r.buffer);const i=t.data,s=t.descriptor.usage&Fs.STATIC?e.STATIC_DRAW:e.DYNAMIC_DRAW;return i?r.byteLength>=i.byteLength?e.bufferSubData(r.type,0,i,0,t._updateSize/i.BYTES_PER_ELEMENT):(r.byteLength=i.byteLength,e.bufferData(r.type,i,s)):(r.byteLength=t.descriptor.size,e.bufferData(r.type,r.byteLength,s)),r}destroyAll(){const t=this._gl;for(const e in this._gpuBuffers)t.deleteBuffer(this._gpuBuffers[e].buffer);this._gpuBuffers=Object.create(null)}onBufferDestroy(t,e){const r=this._gpuBuffers[t.uid],i=this._gl;e||i.deleteBuffer(r.buffer),this._gpuBuffers[t.uid]=null}createGLBuffer(t){const{_gl:e}=this;let r=Vx.ARRAY_BUFFER;t.descriptor.usage&Fs.INDEX?r=Vx.ELEMENT_ARRAY_BUFFER:t.descriptor.usage&Fs.UNIFORM&&(r=Vx.UNIFORM_BUFFER);const i=new Wx(e.createBuffer(),r);return this._gpuBuffers[t.uid]=i,t.on("destroy",this.onBufferDestroy,this),i}resetState(){this._boundBufferBases=Object.create(null)}}$x.extension={type:[u.WebGLSystem],name:"buffer"};var Yx=Object.defineProperty,qx=Object.defineProperties,Kx=Object.getOwnPropertyDescriptors,Qx=Object.getOwnPropertySymbols,Zx=Object.prototype.hasOwnProperty,Jx=Object.prototype.propertyIsEnumerable,ty=(t,e,r)=>e in t?Yx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ey=(t,e)=>{for(var r in e||(e={}))Zx.call(e,r)&&ty(t,r,e[r]);if(Qx)for(var r of Qx(e))Jx.call(e,r)&&ty(t,r,e[r]);return t},ry=(t,e)=>qx(t,Kx(e));const iy=class t{constructor(t){this.supports={uint32Indices:!0,uniformBufferObject:!0,vertexArrayObject:!0,srgbTextures:!0,nonPowOf2wrapping:!0,msaa:!0,nonPowOf2mipmaps:!0},this._renderer=t,this.extensions=Object.create(null),this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this._renderer.gl=t}init(e){var r,i;e=ey(ey({},t.defaultOptions),e);let s=this.multiView=e.multiView;if(e.context&&s&&(_h("Renderer created with both a context and multiview enabled. Disabling multiView as both cannot work together."),s=!1),this.canvas=s?ri.get().createCanvas(this._renderer.canvas.width,this._renderer.canvas.height):this._renderer.view.canvas,e.context)this.initFromContext(e.context);else{const t=this._renderer.background.alpha<1,s=null==(r=e.premultipliedAlpha)||r,n=e.antialias&&!this._renderer.backBuffer.useBackBuffer;this.createContext(e.preferWebGLVersion,{alpha:t,premultipliedAlpha:s,antialias:n,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:null!=(i=e.powerPreference)?i:"default"})}}ensureCanvasSize(t){if(!this.multiView)return void(t!==this.canvas&&_h("multiView is disabled, but targetCanvas is not the main canvas"));const{canvas:e}=this;(e.width<t.width||e.height<t.height)&&(e.width=Math.max(t.width,t.width),e.height=Math.max(t.height,t.height))}initFromContext(t){this.gl=t,this.webGLVersion=t instanceof ri.get().getWebGLRenderingContext()?1:2,this.getExtensions(),this.validateContext(t),this._renderer.runners.contextChange.emit(t);const e=this._renderer.view.canvas;e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}createContext(t,e){let r;const i=this.canvas;if(2===t&&(r=i.getContext("webgl2",e)),!r&&(r=i.getContext("webgl",e),!r))throw new Error("This browser does not support WebGL. Try using the canvas renderer");this.gl=r,this.initFromContext(this.gl)}getExtensions(){const{gl:t}=this,e={anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc"),bptc:t.getExtension("EXT_texture_compression_bptc"),rgtc:t.getExtension("EXT_texture_compression_rgtc"),loseContext:t.getExtension("WEBGL_lose_context")};if(1===this.webGLVersion)this.extensions=ry(ey({},e),{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear"),vertexAttribDivisorANGLE:t.getExtension("ANGLE_instanced_arrays"),srgb:t.getExtension("EXT_sRGB")});else{this.extensions=ry(ey({},e),{colorBufferFloat:t.getExtension("EXT_color_buffer_float")});const r=t.getExtension("WEBGL_provoking_vertex");r&&r.provokingVertexWEBGL(r.FIRST_VERTEX_CONVENTION_WEBGL)}}handleContextLost(t){t.preventDefault(),this._contextLossForced&&(this._contextLossForced=!1,setTimeout((()=>{var t;this.gl.isContextLost()&&(null==(t=this.extensions.loseContext)||t.restoreContext())}),0))}handleContextRestored(){this._renderer.runners.contextChange.emit(this.gl)}destroy(){var t;const e=this._renderer.view.canvas;this._renderer=null,e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),null==(t=this.extensions.loseContext)||t.loseContext()}forceContextLoss(){var t;null==(t=this.extensions.loseContext)||t.loseContext(),this._contextLossForced=!0}validateContext(t){const e=t.getContextAttributes();e&&e.stencil;const r=this.supports,i=2===this.webGLVersion,s=this.extensions;r.uint32Indices=i||!!s.uint32ElementIndex,r.uniformBufferObject=i,r.vertexArrayObject=i||!!s.vertexArrayObject,r.srgbTextures=i||!!s.srgb,r.nonPowOf2wrapping=i,r.nonPowOf2mipmaps=i,r.msaa=i,r.uint32Indices}};iy.extension={type:[u.WebGLSystem],name:"context"},iy.defaultOptions={context:null,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:void 0,preferWebGLVersion:2,multiView:!1};let sy=iy;function ny(t,e){for(const r in t.attributes){const i=t.attributes[r],s=e[r];s?(null!=i.format||(i.format=s.format),null!=i.offset||(i.offset=s.offset),null!=i.instance||(i.instance=s.instance)):_h(`Attribute ${r} is not present in the shader, but is present in the geometry. Unable to infer attribute details.`)}!function(t){const{buffers:e,attributes:r}=t,i={},s={};for(const t in e){const r=e[t];i[r.uid]=0,s[r.uid]=0}for(const t in r){const e=r[t];i[e.buffer.uid]+=gn(e.format).stride}for(const t in r){const e=r[t];null!=e.stride||(e.stride=i[e.buffer.uid]),null!=e.start||(e.start=s[e.buffer.uid]),s[e.buffer.uid]+=gn(e.format).stride}}(t)}var oy=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(oy||{}),ay=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(ay||{}),ly=(t=>(t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t))(ly||{}),hy=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(hy||{});const uy={uint8x2:hy.UNSIGNED_BYTE,uint8x4:hy.UNSIGNED_BYTE,sint8x2:hy.BYTE,sint8x4:hy.BYTE,unorm8x2:hy.UNSIGNED_BYTE,unorm8x4:hy.UNSIGNED_BYTE,snorm8x2:hy.BYTE,snorm8x4:hy.BYTE,uint16x2:hy.UNSIGNED_SHORT,uint16x4:hy.UNSIGNED_SHORT,sint16x2:hy.SHORT,sint16x4:hy.SHORT,unorm16x2:hy.UNSIGNED_SHORT,unorm16x4:hy.UNSIGNED_SHORT,snorm16x2:hy.SHORT,snorm16x4:hy.SHORT,float16x2:hy.HALF_FLOAT,float16x4:hy.HALF_FLOAT,float32:hy.FLOAT,float32x2:hy.FLOAT,float32x3:hy.FLOAT,float32x4:hy.FLOAT,uint32:hy.UNSIGNED_INT,uint32x2:hy.UNSIGNED_INT,uint32x3:hy.UNSIGNED_INT,uint32x4:hy.UNSIGNED_INT,sint32:hy.INT,sint32x2:hy.INT,sint32x3:hy.INT,sint32x4:hy.INT};function cy(t){var e;return null!=(e=uy[t])?e:uy.float32}const dy={"point-list":0,"line-list":1,"line-strip":3,"triangle-list":4,"triangle-strip":5};class py{constructor(t){this._geometryVaoHash=Object.create(null),this._renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this._renderer.renderableGC.addManagedHash(this,"_geometryVaoHash")}contextChange(){const t=this.gl=this._renderer.gl;if(!this._renderer.context.supports.vertexArrayObject)throw new Error("[PixiJS] Vertex Array Objects are not supported on this device");const e=this._renderer.context.extensions.vertexArrayObject;e&&(t.createVertexArray=()=>e.createVertexArrayOES(),t.bindVertexArray=t=>e.bindVertexArrayOES(t),t.deleteVertexArray=t=>e.deleteVertexArrayOES(t));const r=this._renderer.context.extensions.vertexAttribDivisorANGLE;r&&(t.drawArraysInstanced=(t,e,i,s)=>{r.drawArraysInstancedANGLE(t,e,i,s)},t.drawElementsInstanced=(t,e,i,s,n)=>{r.drawElementsInstancedANGLE(t,e,i,s,n)},t.vertexAttribDivisor=(t,e)=>r.vertexAttribDivisorANGLE(t,e)),this._activeGeometry=null,this._activeVao=null,this._geometryVaoHash=Object.create(null)}bind(t,e){const r=this.gl;this._activeGeometry=t;const i=this.getVao(t,e);this._activeVao!==i&&(this._activeVao=i,r.bindVertexArray(i)),this.updateBuffers()}resetState(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this._renderer.buffer;for(let r=0;r<t.buffers.length;r++){const i=t.buffers[r];e.updateBuffer(i)}}checkCompatibility(t,e){const r=t.attributes,i=e._attributeData;for(const t in i)if(!r[t])throw new Error(`shader and geometry incompatible, geometry missing the "${t}" attribute`)}getSignature(t,e){const r=t.attributes,i=e._attributeData,s=["g",t.uid];for(const t in r)i[t]&&s.push(t,i[t].location);return s.join("-")}getVao(t,e){var r;return(null==(r=this._geometryVaoHash[t.uid])?void 0:r[e._key])||this.initGeometryVao(t,e)}initGeometryVao(t,e,r=!0){const i=this._renderer.gl,s=this._renderer.buffer;this._renderer.shader._getProgramData(e),this.checkCompatibility(t,e);const n=this.getSignature(t,e);this._geometryVaoHash[t.uid]||(this._geometryVaoHash[t.uid]=Object.create(null),t.on("destroy",this.onGeometryDestroy,this));const o=this._geometryVaoHash[t.uid];let a=o[n];if(a)return o[e._key]=a,a;ny(t,e._attributeData);const l=t.buffers;a=i.createVertexArray(),i.bindVertexArray(a);for(let t=0;t<l.length;t++){const e=l[t];s.bind(e)}return this.activateVao(t,e),o[e._key]=a,o[n]=a,i.bindVertexArray(null),a}onGeometryDestroy(t,e){const r=this._geometryVaoHash[t.uid],i=this.gl;if(r){if(e)for(const t in r)this._activeVao!==r[t]&&this.unbind(),i.deleteVertexArray(r[t]);this._geometryVaoHash[t.uid]=null}}destroyAll(t=!1){const e=this.gl;for(const r in this._geometryVaoHash){if(t)for(const t in this._geometryVaoHash[r]){const i=this._geometryVaoHash[r];this._activeVao!==i&&this.unbind(),e.deleteVertexArray(i[t])}this._geometryVaoHash[r]=null}}activateVao(t,e){var r,i;const s=this._renderer.gl,n=this._renderer.buffer,o=t.attributes;t.indexBuffer&&n.bind(t.indexBuffer);let a=null;for(const t in o){const l=o[t],h=l.buffer,u=n.getGlBuffer(h),c=e._attributeData[t];if(c){a!==u&&(n.bind(h),a=u);const t=c.location;s.enableVertexAttribArray(t);const e=gn(l.format),o=cy(l.format);if("int"===(null==(r=c.format)?void 0:r.substring(1,4))?s.vertexAttribIPointer(t,e.size,o,l.stride,l.offset):s.vertexAttribPointer(t,e.size,o,e.normalised,l.stride,l.offset),l.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");{const e=null!=(i=l.divisor)?i:1;s.vertexAttribDivisor(t,e)}}}}}draw(t,e,r,i){const{gl:s}=this._renderer,n=this._activeGeometry,o=dy[t||n.topology];if(null!=i||(i=n.instanceCount),n.indexBuffer){const t=n.indexBuffer.data.BYTES_PER_ELEMENT,a=2===t?s.UNSIGNED_SHORT:s.UNSIGNED_INT;i>1?s.drawElementsInstanced(o,e||n.indexBuffer.data.length,a,(r||0)*t,i):s.drawElements(o,e||n.indexBuffer.data.length,a,(r||0)*t)}else i>1?s.drawArraysInstanced(o,r||0,e||n.getSize(),i):s.drawArrays(o,r||0,e||n.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this._renderer=null,this.gl=null,this._activeVao=null,this._activeGeometry=null}}py.extension={type:[u.WebGLSystem],name:"geometry"};var fy=Object.defineProperty,gy=Object.getOwnPropertySymbols,my=Object.prototype.hasOwnProperty,_y=Object.prototype.propertyIsEnumerable,xy=(t,e,r)=>e in t?fy(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yy=(t,e)=>{for(var r in e||(e={}))my.call(e,r)&&xy(t,r,e[r]);if(gy)for(var r of gy(e))_y.call(e,r)&&xy(t,r,e[r]);return t};const by=new zs({attributes:{aPosition:[-1,-1,3,-1,-1,3]}}),vy=class t{constructor(t){this.useBackBuffer=!1,this._useBackBufferThisRender=!1,this._renderer=t}init(e={}){const{useBackBuffer:r,antialias:i}=yy(yy({},t.defaultOptions),e);this.useBackBuffer=r,this._antialias=i,this._renderer.context.supports.msaa||(_h("antialiasing, is not supported on when using the back buffer"),this._antialias=!1),this._state=tl.for2d();const s=new pn({vertex:"\n                attribute vec2 aPosition;\n                out vec2 vUv;\n\n                void main() {\n                    gl_Position = vec4(aPosition, 0.0, 1.0);\n\n                    vUv = (aPosition + 1.0) / 2.0;\n\n                    // flip dem UVs\n                    vUv.y = 1.0 - vUv.y;\n                }",fragment:"\n                in vec2 vUv;\n                out vec4 finalColor;\n\n                uniform sampler2D uTexture;\n\n                void main() {\n                    finalColor = texture(uTexture, vUv);\n                }",name:"big-triangle"});this._bigTriangleShader=new Oo({glProgram:s,resources:{uTexture:Ue.WHITE.source}})}renderStart(t){const e=this._renderer.renderTarget.getRenderTarget(t.target);if(this._useBackBufferThisRender=this.useBackBuffer&&!!e.isRoot,this._useBackBufferThisRender){const e=this._renderer.renderTarget.getRenderTarget(t.target);this._targetTexture=e.colorTexture,t.target=this._getBackBufferTexture(e.colorTexture)}}renderEnd(){this._presentBackBuffer()}_presentBackBuffer(){const t=this._renderer;t.renderTarget.finishRenderPass(),this._useBackBufferThisRender&&(t.renderTarget.bind(this._targetTexture,!1),this._bigTriangleShader.resources.uTexture=this._backBufferTexture.source,t.encoder.draw({geometry:by,shader:this._bigTriangleShader,state:this._state}))}_getBackBufferTexture(t){return this._backBufferTexture=this._backBufferTexture||new Ue({source:new ye({width:t.width,height:t.height,resolution:t._resolution,antialias:this._antialias})}),this._backBufferTexture.source.resize(t.width,t.height,t._resolution),this._backBufferTexture}destroy(){this._backBufferTexture&&(this._backBufferTexture.destroy(),this._backBufferTexture=null)}};vy.extension={type:[u.WebGLSystem],name:"backBuffer",priority:1},vy.defaultOptions={useBackBuffer:!1};let Ty=vy;class Sy{constructor(t){this._colorMaskCache=15,this._renderer=t}setMask(t){this._colorMaskCache!==t&&(this._colorMaskCache=t,this._renderer.gl.colorMask(!!(8&t),!!(4&t),!!(2&t),!!(1&t)))}}Sy.extension={type:[u.WebGLSystem],name:"colorMask"};class wy{constructor(t){this.commandFinished=Promise.resolve(),this._renderer=t}setGeometry(t,e){this._renderer.geometry.bind(t,e.glProgram)}finishRenderPass(){}draw(t){const e=this._renderer,{geometry:r,shader:i,state:s,skipSync:n,topology:o,size:a,start:l,instanceCount:h}=t;e.shader.bind(i,n),e.geometry.bind(r,e.shader._activeProgram),s&&e.state.set(s),e.geometry.draw(o,a,l,null!=h?h:r.instanceCount)}destroy(){this._renderer=null}}wy.extension={type:[u.WebGLSystem],name:"encoder"};class Ey{constructor(){this.width=-1,this.height=-1,this.msaa=!1,this.msaaRenderBuffer=[]}}const Ay=[];Ay[bs.NONE]=void 0,Ay[bs.DISABLED]={stencilWriteMask:0,stencilReadMask:0},Ay[bs.RENDERING_MASK_ADD]={stencilFront:{compare:"equal",passOp:"increment-clamp"},stencilBack:{compare:"equal",passOp:"increment-clamp"}},Ay[bs.RENDERING_MASK_REMOVE]={stencilFront:{compare:"equal",passOp:"decrement-clamp"},stencilBack:{compare:"equal",passOp:"decrement-clamp"}},Ay[bs.MASK_ACTIVE]={stencilWriteMask:0,stencilFront:{compare:"equal",passOp:"keep"},stencilBack:{compare:"equal",passOp:"keep"}},Ay[bs.INVERSE_MASK_ACTIVE]={stencilWriteMask:0,stencilFront:{compare:"not-equal",passOp:"replace"},stencilBack:{compare:"not-equal",passOp:"replace"}};class Py{constructor(t){this._stencilCache={enabled:!1,stencilReference:0,stencilMode:bs.NONE},this._renderTargetStencilState=Object.create(null),t.renderTarget.onRenderTargetChange.add(this)}contextChange(t){this._gl=t,this._comparisonFuncMapping={always:t.ALWAYS,never:t.NEVER,equal:t.EQUAL,"not-equal":t.NOTEQUAL,less:t.LESS,"less-equal":t.LEQUAL,greater:t.GREATER,"greater-equal":t.GEQUAL},this._stencilOpsMapping={keep:t.KEEP,zero:t.ZERO,replace:t.REPLACE,invert:t.INVERT,"increment-clamp":t.INCR,"decrement-clamp":t.DECR,"increment-wrap":t.INCR_WRAP,"decrement-wrap":t.DECR_WRAP},this.resetState()}onRenderTargetChange(t){if(this._activeRenderTarget===t)return;this._activeRenderTarget=t;let e=this._renderTargetStencilState[t.uid];e||(e=this._renderTargetStencilState[t.uid]={stencilMode:bs.DISABLED,stencilReference:0}),this.setStencilMode(e.stencilMode,e.stencilReference)}resetState(){this._stencilCache.enabled=!1,this._stencilCache.stencilMode=bs.NONE,this._stencilCache.stencilReference=0}setStencilMode(t,e){const r=this._renderTargetStencilState[this._activeRenderTarget.uid],i=this._gl,s=Ay[t],n=this._stencilCache;r.stencilMode=t,r.stencilReference=e,t!==bs.DISABLED?(this._stencilCache.enabled||(this._stencilCache.enabled=!0,i.enable(i.STENCIL_TEST)),(t!==n.stencilMode||n.stencilReference!==e)&&(n.stencilMode=t,n.stencilReference=e,i.stencilFunc(this._comparisonFuncMapping[s.stencilBack.compare],e,255),i.stencilOp(i.KEEP,i.KEEP,this._stencilOpsMapping[s.stencilBack.passOp]))):this._stencilCache.enabled&&(this._stencilCache.enabled=!1,i.disable(i.STENCIL_TEST))}}Py.extension={type:[u.WebGLSystem],name:"stencil"};class My{constructor(t){this._syncFunctionHash=Object.create(null),this._adaptor=t,this._systemCheck()}_systemCheck(){if(!Gd())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}ensureUniformGroup(t){const e=this.getUniformGroupData(t);t.buffer||(t.buffer=new Ns({data:new Float32Array(e.layout.size/4),usage:Fs.UNIFORM|Fs.COPY_DST}))}getUniformGroupData(t){return this._syncFunctionHash[t._signature]||this._initUniformGroup(t)}_initUniformGroup(t){const e=t._signature;let r=this._syncFunctionHash[e];if(!r){const i=Object.keys(t.uniformStructures).map((e=>t.uniformStructures[e])),s=this._adaptor.createUboElements(i),n=this._generateUboSync(s.uboElements);r=this._syncFunctionHash[e]={layout:s,syncFunction:n}}return this._syncFunctionHash[e]}_generateUboSync(t){return this._adaptor.generateUboSync(t)}syncUniformGroup(t,e,r){const i=this.getUniformGroupData(t);t.buffer||(t.buffer=new Ns({data:new Float32Array(i.layout.size/4),usage:Fs.UNIFORM|Fs.COPY_DST}));let s=null;return e||(e=t.buffer.data,s=t.buffer.dataInt32),r||(r=0),i.syncFunction(t.uniforms,e,s,r),!0}updateUniformGroup(t){if(t.isStatic&&!t._dirtyId)return!1;t._dirtyId=0;const e=this.syncUniformGroup(t);return t.buffer.update(),e}destroy(){this._syncFunctionHash=null}}const Ry={f32:4,i32:4,"vec2<f32>":8,"vec3<f32>":12,"vec4<f32>":16,"vec2<i32>":8,"vec3<i32>":12,"vec4<i32>":16,"mat2x2<f32>":32,"mat3x3<f32>":48,"mat4x4<f32>":64};function Cy(t){const e=t.map((t=>({data:t,offset:0,size:0})));let r=0,i=0;for(let t=0;t<e.length;t++){const s=e[t];if(r=Ry[s.data.type],!r)throw new Error(`Unknown type ${s.data.type}`);s.data.size>1&&(r=Math.max(r,16)*s.data.size);const n=12===r?16:r;s.size=r;const o=i%16;i+=o>0&&16-o<n?(16-o)%16:(r-o%r)%r,s.offset=i,i+=r}return i=16*Math.ceil(i/16),{uboElements:e,size:i}}const Oy=[{type:"mat3x3<f32>",test:t=>void 0!==t.value.a,ubo:"\n            var matrix = uv[name].toArray(true);\n            data[offset] = matrix[0];\n            data[offset + 1] = matrix[1];\n            data[offset + 2] = matrix[2];\n            data[offset + 4] = matrix[3];\n            data[offset + 5] = matrix[4];\n            data[offset + 6] = matrix[5];\n            data[offset + 8] = matrix[6];\n            data[offset + 9] = matrix[7];\n            data[offset + 10] = matrix[8];\n        ",uniform:"\n            gl.uniformMatrix3fv(ud[name].location, false, uv[name].toArray(true));\n        "},{type:"vec4<f32>",test:t=>"vec4<f32>"===t.type&&1===t.size&&void 0!==t.value.width,ubo:"\n            v = uv[name];\n            data[offset] = v.x;\n            data[offset + 1] = v.y;\n            data[offset + 2] = v.width;\n            data[offset + 3] = v.height;\n        ",uniform:"\n            cv = ud[name].value;\n            v = uv[name];\n            if (cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height) {\n                cv[0] = v.x;\n                cv[1] = v.y;\n                cv[2] = v.width;\n                cv[3] = v.height;\n                gl.uniform4f(ud[name].location, v.x, v.y, v.width, v.height);\n            }\n        "},{type:"vec2<f32>",test:t=>"vec2<f32>"===t.type&&1===t.size&&void 0!==t.value.x,ubo:"\n            v = uv[name];\n            data[offset] = v.x;\n            data[offset + 1] = v.y;\n        ",uniform:"\n            cv = ud[name].value;\n            v = uv[name];\n            if (cv[0] !== v.x || cv[1] !== v.y) {\n                cv[0] = v.x;\n                cv[1] = v.y;\n                gl.uniform2f(ud[name].location, v.x, v.y);\n            }\n        "},{type:"vec4<f32>",test:t=>"vec4<f32>"===t.type&&1===t.size&&void 0!==t.value.red,ubo:"\n            v = uv[name];\n            data[offset] = v.red;\n            data[offset + 1] = v.green;\n            data[offset + 2] = v.blue;\n            data[offset + 3] = v.alpha;\n        ",uniform:"\n            cv = ud[name].value;\n            v = uv[name];\n            if (cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha) {\n                cv[0] = v.red;\n                cv[1] = v.green;\n                cv[2] = v.blue;\n                cv[3] = v.alpha;\n                gl.uniform4f(ud[name].location, v.red, v.green, v.blue, v.alpha);\n            }\n        "},{type:"vec3<f32>",test:t=>"vec3<f32>"===t.type&&1===t.size&&void 0!==t.value.red,ubo:"\n            v = uv[name];\n            data[offset] = v.red;\n            data[offset + 1] = v.green;\n            data[offset + 2] = v.blue;\n        ",uniform:"\n            cv = ud[name].value;\n            v = uv[name];\n            if (cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue) {\n                cv[0] = v.red;\n                cv[1] = v.green;\n                cv[2] = v.blue;\n                gl.uniform3f(ud[name].location, v.red, v.green, v.blue);\n            }\n        "}];function Iy(t,e,r,i){const s=["\n        var v = null;\n        var v2 = null;\n        var t = 0;\n        var index = 0;\n        var name = null;\n        var arrayOffset = null;\n    "];let n=0;for(let o=0;o<t.length;o++){const a=t[o],l=a.data.name;let h=!1,u=0;for(let t=0;t<Oy.length;t++)if(Oy[t].test(a.data)){u=a.offset/4,s.push(`name = "${l}";`,`offset += ${u-n};`,Oy[t][e]||Oy[t].ubo),h=!0;break}if(!h)if(a.data.size>1)u=a.offset/4,s.push(r(a,u-n));else{const t=i[a.data.type];u=a.offset/4,s.push(`\n                    v = uv.${l};\n                    offset += ${u-n};\n                    ${t};\n                `)}n=u}const o=s.join("\n");return new Function("uv","data","dataInt32","offset",o)}var By=Object.defineProperty,ky=Object.defineProperties,Gy=Object.getOwnPropertyDescriptors,Dy=Object.getOwnPropertySymbols,Fy=Object.prototype.hasOwnProperty,Ny=Object.prototype.propertyIsEnumerable,Uy=(t,e,r)=>e in t?By(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;function Ly(t,e){return`\n        for (let i = 0; i < ${t*e}; i++) {\n            data[offset + (((i / ${t})|0) * 4) + (i % ${t})] = v[i];\n        }\n    `}const zy={f32:"\n        data[offset] = v;",i32:"\n        dataInt32[offset] = v;","vec2<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];","vec3<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];\n        data[offset + 2] = v[2];","vec4<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];\n        data[offset + 2] = v[2];\n        data[offset + 3] = v[3];","vec2<i32>":"\n        dataInt32[offset] = v[0];\n        dataInt32[offset + 1] = v[1];","vec3<i32>":"\n        dataInt32[offset] = v[0];\n        dataInt32[offset + 1] = v[1];\n        dataInt32[offset + 2] = v[2];","vec4<i32>":"\n        dataInt32[offset] = v[0];\n        dataInt32[offset + 1] = v[1];\n        dataInt32[offset + 2] = v[2];\n        dataInt32[offset + 3] = v[3];","mat2x2<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];\n        data[offset + 4] = v[2];\n        data[offset + 5] = v[3];","mat3x3<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];\n        data[offset + 2] = v[2];\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];","mat4x4<f32>":"\n        for (let i = 0; i < 16; i++) {\n            data[offset + i] = v[i];\n        }","mat3x2<f32>":Ly(3,2),"mat4x2<f32>":Ly(4,2),"mat2x3<f32>":Ly(2,3),"mat4x3<f32>":Ly(4,3),"mat2x4<f32>":Ly(2,4),"mat3x4<f32>":Ly(3,4)},Xy=((t,e)=>ky(t,Gy(e)))(((t,e)=>{for(var r in e||(e={}))Fy.call(e,r)&&Uy(t,r,e[r]);if(Dy)for(var r of Dy(e))Ny.call(e,r)&&Uy(t,r,e[r]);return t})({},zy),{"mat2x2<f32>":"\n        data[offset] = v[0];\n        data[offset + 1] = v[1];\n        data[offset + 2] = v[2];\n        data[offset + 3] = v[3];\n    "});function Hy(t,e){const r=Math.max(Ry[t.data.type]/16,1),i=t.data.value.length/t.data.size,s=(4-i%4)%4,n=t.data.type.indexOf("i32")>=0?"dataInt32":"data";return`\n        v = uv.${t.data.name};\n        offset += ${e};\n\n        arrayOffset = offset;\n\n        t = 0;\n\n        for(var i=0; i < ${t.data.size*r}; i++)\n        {\n            for(var j = 0; j < ${i}; j++)\n            {\n                ${n}[arrayOffset++] = v[t++];\n            }\n            ${0!==s?`arrayOffset += ${s};`:""}\n        }\n    `}function jy(t){return Iy(t,"uboStd40",Hy,zy)}class Vy extends My{constructor(){super({createUboElements:Cy,generateUboSync:jy})}}Vy.extension={type:[u.WebGLSystem],name:"ubo"};class Wy{constructor(){this._clearColorCache=[0,0,0,0],this._viewPortCache=new Rt}init(t,e){this._renderer=t,this._renderTargetSystem=e,t.runners.contextChange.add(this)}contextChange(){this._clearColorCache=[0,0,0,0],this._viewPortCache=new Rt}copyToTexture(t,e,r,i,s){const n=this._renderTargetSystem,o=this._renderer,a=n.getGpuRenderTarget(t),l=o.gl;return this.finishRenderPass(t),l.bindFramebuffer(l.FRAMEBUFFER,a.resolveTargetFramebuffer),o.texture.bind(e,0),l.copyTexSubImage2D(l.TEXTURE_2D,0,s.x,s.y,r.x,r.y,i.width,i.height),e}startRenderPass(t,e=!0,r,i){const s=this._renderTargetSystem,n=t.colorTexture,o=s.getGpuRenderTarget(t);let a=i.y;t.isRoot&&(a=n.pixelHeight-i.height),t.colorTextures.forEach((t=>{this._renderer.texture.unbind(t)}));const l=this._renderer.gl;l.bindFramebuffer(l.FRAMEBUFFER,o.framebuffer);const h=this._viewPortCache;(h.x!==i.x||h.y!==a||h.width!==i.width||h.height!==i.height)&&(h.x=i.x,h.y=a,h.width=i.width,h.height=i.height,l.viewport(i.x,a,i.width,i.height)),!o.depthStencilRenderBuffer&&(t.stencil||t.depth)&&this._initStencil(o),this.clear(t,e,r)}finishRenderPass(t){const e=this._renderTargetSystem.getGpuRenderTarget(t);if(!e.msaa)return;const r=this._renderer.gl;r.bindFramebuffer(r.FRAMEBUFFER,e.resolveTargetFramebuffer),r.bindFramebuffer(r.READ_FRAMEBUFFER,e.framebuffer),r.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,r.COLOR_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(r.FRAMEBUFFER,e.framebuffer)}initGpuRenderTarget(t){const e=this._renderer.gl,r=new Ey,i=t.colorTexture;return zi.test(i.resource)?(this._renderer.context.ensureCanvasSize(t.colorTexture.resource),r.framebuffer=null,r):(this._initColor(t,r),e.bindFramebuffer(e.FRAMEBUFFER,null),r)}destroyGpuRenderTarget(t){const e=this._renderer.gl;t.framebuffer&&(e.deleteFramebuffer(t.framebuffer),t.framebuffer=null),t.resolveTargetFramebuffer&&(e.deleteFramebuffer(t.resolveTargetFramebuffer),t.resolveTargetFramebuffer=null),t.depthStencilRenderBuffer&&(e.deleteRenderbuffer(t.depthStencilRenderBuffer),t.depthStencilRenderBuffer=null),t.msaaRenderBuffer.forEach((t=>{e.deleteRenderbuffer(t)})),t.msaaRenderBuffer=null}clear(t,e,r){if(!e)return;const i=this._renderTargetSystem;"boolean"==typeof e&&(e=e?Dd.ALL:Dd.NONE);const s=this._renderer.gl;if(e&Dd.COLOR){null!=r||(r=i.defaultClearColor);const t=this._clearColorCache,e=r;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3])&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],s.clearColor(e[0],e[1],e[2],e[3]))}s.clear(e)}resizeGpuRenderTarget(t){if(t.isRoot)return;const e=this._renderTargetSystem.getGpuRenderTarget(t);this._resizeColor(t,e),(t.stencil||t.depth)&&this._resizeStencil(e)}_initColor(t,e){const r=this._renderer,i=r.gl,s=i.createFramebuffer();if(e.resolveTargetFramebuffer=s,i.bindFramebuffer(i.FRAMEBUFFER,s),e.width=t.colorTexture.source.pixelWidth,e.height=t.colorTexture.source.pixelHeight,t.colorTextures.forEach(((t,s)=>{const n=t.source;n.antialias&&(r.context.supports.msaa?e.msaa=!0:_h("[RenderTexture] Antialiasing on textures is not supported in WebGL1")),r.texture.bindSource(n,0);const o=r.texture.getGlSource(n).texture;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+s,3553,o,0)})),e.msaa){const r=i.createFramebuffer();e.framebuffer=r,i.bindFramebuffer(i.FRAMEBUFFER,r),t.colorTextures.forEach(((t,r)=>{const s=i.createRenderbuffer();e.msaaRenderBuffer[r]=s}))}else e.framebuffer=s;this._resizeColor(t,e)}_resizeColor(t,e){const r=t.colorTexture.source;if(e.width=r.pixelWidth,e.height=r.pixelHeight,t.colorTextures.forEach(((t,e)=>{0!==e&&t.source.resize(r.width,r.height,r._resolution)})),e.msaa){const r=this._renderer,i=r.gl,s=e.framebuffer;i.bindFramebuffer(i.FRAMEBUFFER,s),t.colorTextures.forEach(((t,s)=>{const n=t.source;r.texture.bindSource(n,0);const o=r.texture.getGlSource(n).internalFormat,a=e.msaaRenderBuffer[s];i.bindRenderbuffer(i.RENDERBUFFER,a),i.renderbufferStorageMultisample(i.RENDERBUFFER,4,o,n.pixelWidth,n.pixelHeight),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+s,i.RENDERBUFFER,a)}))}}_initStencil(t){if(null===t.framebuffer)return;const e=this._renderer.gl,r=e.createRenderbuffer();t.depthStencilRenderBuffer=r,e.bindRenderbuffer(e.RENDERBUFFER,r),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,r),this._resizeStencil(t)}_resizeStencil(t){const e=this._renderer.gl;e.bindRenderbuffer(e.RENDERBUFFER,t.depthStencilRenderBuffer),t.msaa?e.renderbufferStorageMultisample(e.RENDERBUFFER,4,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,2===this._renderer.context.webGLVersion?e.DEPTH24_STENCIL8:e.DEPTH_STENCIL,t.width,t.height)}prerender(t){const e=t.colorTexture.resource;this._renderer.context.multiView&&zi.test(e)&&this._renderer.context.ensureCanvasSize(e)}postrender(t){if(this._renderer.context.multiView&&zi.test(t.colorTexture.resource)){const e=this._renderer.context.canvas,r=t.colorTexture;r.context2D.drawImage(e,0,r.pixelHeight-e.height)}}}function $y(t,e,r,i,s,n){const o=n?1:-1;return t.identity(),t.a=1/i*2,t.d=o*(1/s*2),t.tx=-1-e*t.a,t.ty=-o-r*t.d,t}var Yy=Object.defineProperty,qy=Object.getOwnPropertySymbols,Ky=Object.prototype.hasOwnProperty,Qy=Object.prototype.propertyIsEnumerable,Zy=(t,e,r)=>e in t?Yy(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Jy=(t,e)=>{for(var r in e||(e={}))Ky.call(e,r)&&Zy(t,r,e[r]);if(qy)for(var r of qy(e))Qy.call(e,r)&&Zy(t,r,e[r]);return t};const tb=new Map;function eb(t,e){if(!tb.has(t)){const r=new Ue({source:new zi(Jy({resource:t},e))}),i=()=>{tb.get(t)===r&&tb.delete(t)};r.once("destroy",i),r.source.once("destroy",i),tb.set(t,r)}return tb.get(t)}function rb(t){const e=t.colorTexture.source.resource;return globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement&&document.body.contains(e)}var ib=Object.defineProperty,sb=Object.getOwnPropertySymbols,nb=Object.prototype.hasOwnProperty,ob=Object.prototype.propertyIsEnumerable,ab=(t,e,r)=>e in t?ib(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lb=(t,e)=>{for(var r in e||(e={}))nb.call(e,r)&&ab(t,r,e[r]);if(sb)for(var r of sb(e))ob.call(e,r)&&ab(t,r,e[r]);return t};const hb=class t{constructor(e={}){if(this.uid=ht("renderTarget"),this.colorTextures=[],this.dirtyId=0,this.isRoot=!1,this._size=new Float32Array(2),this._managedColorTextures=!1,e=lb(lb({},t.defaultOptions),e),this.stencil=e.stencil,this.depth=e.depth,this.isRoot=e.isRoot,"number"==typeof e.colorTextures){this._managedColorTextures=!0;for(let t=0;t<e.colorTextures;t++)this.colorTextures.push(new ye({width:e.width,height:e.height,resolution:e.resolution,antialias:e.antialias}))}else{this.colorTextures=[...e.colorTextures.map((t=>t.source))];const t=this.colorTexture.source;this.resize(t.width,t.height,t._resolution)}this.colorTexture.source.on("resize",this.onSourceResize,this),(e.depthStencilTexture||this.stencil)&&(e.depthStencilTexture instanceof Ue||e.depthStencilTexture instanceof ye?this.depthStencilTexture=e.depthStencilTexture.source:this.ensureDepthStencilTexture())}get size(){const t=this._size;return t[0]=this.pixelWidth,t[1]=this.pixelHeight,t}get width(){return this.colorTexture.source.width}get height(){return this.colorTexture.source.height}get pixelWidth(){return this.colorTexture.source.pixelWidth}get pixelHeight(){return this.colorTexture.source.pixelHeight}get resolution(){return this.colorTexture.source._resolution}get colorTexture(){return this.colorTextures[0]}onSourceResize(t){this.resize(t.width,t.height,t._resolution,!0)}ensureDepthStencilTexture(){this.depthStencilTexture||(this.depthStencilTexture=new ye({width:this.width,height:this.height,resolution:this.resolution,format:"depth24plus-stencil8",autoGenerateMipmaps:!1,antialias:!1,mipLevelCount:1}))}resize(t,e,r=this.resolution,i=!1){this.dirtyId++,this.colorTextures.forEach(((s,n)=>{i&&0===n||s.source.resize(t,e,r)})),this.depthStencilTexture&&this.depthStencilTexture.source.resize(t,e,r)}destroy(){this.colorTexture.source.off("resize",this.onSourceResize,this),this._managedColorTextures&&this.colorTextures.forEach((t=>{t.destroy()})),this.depthStencilTexture&&(this.depthStencilTexture.destroy(),delete this.depthStencilTexture)}};hb.defaultOptions={width:0,height:0,resolution:1,colorTextures:1,stencil:!1,depth:!1,antialias:!1,isRoot:!1};let ub=hb;class cb{constructor(t){this.rootViewPort=new Rt,this.viewport=new Rt,this.onRenderTargetChange=new Fd("onRenderTargetChange"),this.projectionMatrix=new st,this.defaultClearColor=[0,0,0,0],this._renderSurfaceToRenderTargetHash=new Map,this._gpuRenderTargetHash=Object.create(null),this._renderTargetStack=[],this._renderer=t,t.renderableGC.addManagedHash(this,"_gpuRenderTargetHash")}finishRenderPass(){this.adaptor.finishRenderPass(this.renderTarget)}renderStart({target:t,clear:e,clearColor:r,frame:i}){var s,n;this._renderTargetStack.length=0,this.push(t,e,r,i),this.rootViewPort.copyFrom(this.viewport),this.rootRenderTarget=this.renderTarget,this.renderingToScreen=rb(this.rootRenderTarget),null==(n=(s=this.adaptor).prerender)||n.call(s,this.rootRenderTarget)}postrender(){var t,e;null==(e=(t=this.adaptor).postrender)||e.call(t,this.rootRenderTarget)}bind(t,e=!0,r,i){const s=this.getRenderTarget(t),n=this.renderTarget!==s;this.renderTarget=s,this.renderSurface=t;const o=this.getGpuRenderTarget(s);(s.pixelWidth!==o.width||s.pixelHeight!==o.height)&&(this.adaptor.resizeGpuRenderTarget(s),o.width=s.pixelWidth,o.height=s.pixelHeight);const a=s.colorTexture,l=this.viewport,h=a.pixelWidth,u=a.pixelHeight;if(!i&&t instanceof Ue&&(i=t.frame),i){const t=a._resolution;l.x=i.x*t+.5|0,l.y=i.y*t+.5|0,l.width=i.width*t+.5|0,l.height=i.height*t+.5|0}else l.x=0,l.y=0,l.width=h,l.height=u;return $y(this.projectionMatrix,0,0,l.width/a.resolution,l.height/a.resolution,!s.isRoot),this.adaptor.startRenderPass(s,e,r,l),n&&this.onRenderTargetChange.emit(s),s}clear(t,e=Dd.ALL,r){e&&(t&&(t=this.getRenderTarget(t)),this.adaptor.clear(t||this.renderTarget,e,r,this.viewport))}contextChange(){this._gpuRenderTargetHash=Object.create(null)}push(t,e=Dd.ALL,r,i){const s=this.bind(t,e,r,i);return this._renderTargetStack.push({renderTarget:s,frame:i}),s}pop(){this._renderTargetStack.pop();const t=this._renderTargetStack[this._renderTargetStack.length-1];this.bind(t.renderTarget,!1,null,t.frame)}getRenderTarget(t){var e;return t.isTexture&&(t=t.source),null!=(e=this._renderSurfaceToRenderTargetHash.get(t))?e:this._initRenderTarget(t)}copyToTexture(t,e,r,i,s){r.x<0&&(i.width+=r.x,s.x-=r.x,r.x=0),r.y<0&&(i.height+=r.y,s.y-=r.y,r.y=0);const{pixelWidth:n,pixelHeight:o}=t;return i.width=Math.min(i.width,n-r.x),i.height=Math.min(i.height,o-r.y),this.adaptor.copyToTexture(t,e,r,i,s)}ensureDepthStencil(){this.renderTarget.stencil||(this.renderTarget.stencil=!0,this.adaptor.startRenderPass(this.renderTarget,!1,null,this.viewport))}destroy(){this._renderer=null,this._renderSurfaceToRenderTargetHash.forEach(((t,e)=>{t!==e&&t.destroy()})),this._renderSurfaceToRenderTargetHash.clear(),this._gpuRenderTargetHash=Object.create(null)}_initRenderTarget(t){let e=null;return zi.test(t)&&(t=eb(t).source),t instanceof ub?e=t:t instanceof ye&&(e=new ub({colorTextures:[t]}),zi.test(t.source.resource)&&(e.isRoot=!0),t.once("destroy",(()=>{e.destroy(),this._renderSurfaceToRenderTargetHash.delete(t);const r=this._gpuRenderTargetHash[e.uid];r&&(this._gpuRenderTargetHash[e.uid]=null,this.adaptor.destroyGpuRenderTarget(r))}))),this._renderSurfaceToRenderTargetHash.set(t,e),e}getGpuRenderTarget(t){return this._gpuRenderTargetHash[t.uid]||(this._gpuRenderTargetHash[t.uid]=this.adaptor.initGpuRenderTarget(t))}resetState(){this.renderTarget=null,this.renderSurface=null}}class db extends cb{constructor(t){super(t),this.adaptor=new Wy,this.adaptor.init(t,this)}}db.extension={type:[u.WebGLSystem],name:"renderTarget"};class pb extends m{constructor({buffer:t,offset:e,size:r}){super(),this.uid=ht("buffer"),this._resourceType="bufferResource",this._touched=0,this._resourceId=ht("resource"),this._bufferResource=!0,this.destroyed=!1,this.buffer=t,this.offset=0|e,this.size=r,this.buffer.on("change",this.onBufferChange,this)}onBufferChange(){this._resourceId=ht("resource"),this.emit("change",this)}destroy(t=!1){this.destroyed=!0,t&&this.buffer.destroy(),this.emit("change",this),this.buffer=null}}function fb(t,e){const r=[],i=["\n        var g = s.groups;\n        var sS = r.shader;\n        var p = s.glProgram;\n        var ugS = r.uniformGroup;\n        var resources;\n    "];let s=!1,n=0;const o=e._getProgramData(t.glProgram);for(const a in t.groups){const l=t.groups[a];r.push(`\n            resources = g[${a}].resources;\n        `);for(const h in l.resources){const u=l.resources[h];if(u instanceof To)if(u.ubo){const e=t._uniformBindMap[a][Number(h)];r.push(`\n                        sS.bindUniformBlock(\n                            resources[${h}],\n                            '${e}',\n                            ${t.glProgram._uniformBlockData[e].index}\n                        );\n                    `)}else r.push(`\n                        ugS.updateUniformGroup(resources[${h}], p, sD);\n                    `);else if(u instanceof pb){const e=t._uniformBindMap[a][Number(h)];r.push(`\n                    sS.bindUniformBlock(\n                        resources[${h}],\n                        '${e}',\n                        ${t.glProgram._uniformBlockData[e].index}\n                    );\n                `)}else if(u instanceof ye){const l=t._uniformBindMap[a][h],u=o.uniformData[l];u&&(s||(s=!0,i.push("\n                        var tS = r.texture;\n                        ")),e._gl.uniform1i(u.location,n),r.push(`\n                        tS.bind(resources[${h}], ${n});\n                    `),n++)}}}const a=[...i,...r].join("\n");return new Function("r","s","sD",a)}class gb{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBlockBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBlockBindings=null,this.program=null}}function mb(t,e,r){const i=t.createShader(e);return t.shaderSource(i,r),t.compileShader(i),i}function _b(t){const e=new Array(t);for(let t=0;t<e.length;t++)e[t]=!1;return e}function xb(t,e){switch(t){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return _b(2*e);case"bvec3":return _b(3*e);case"bvec4":return _b(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}let yb=null;const bb={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"},vb={float:"float32",vec2:"float32x2",vec3:"float32x3",vec4:"float32x4",int:"sint32",ivec2:"sint32x2",ivec3:"sint32x3",ivec4:"sint32x4",uint:"uint32",uvec2:"uint32x2",uvec3:"uint32x3",uvec4:"uint32x4",bool:"uint32",bvec2:"uint32x2",bvec3:"uint32x3",bvec4:"uint32x4"};function Tb(t,e){if(!yb){const e=Object.keys(bb);yb={};for(let r=0;r<e.length;++r){const i=e[r];yb[t[i]]=bb[i]}}return yb[e]}function Sb(t,e){const r=Tb(t,e);return vb[r]||"float32"}function wb(t,e,r=!1){const i={},s=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<s;r++){const s=e.getActiveAttrib(t,r);if(s.name.startsWith("gl_"))continue;const n=Sb(e,s.type);i[s.name]={location:0,format:n,stride:gn(n).stride,offset:0,instance:!1,start:0}}const n=Object.keys(i);if(r){n.sort(((t,e)=>t>e?1:-1));for(let r=0;r<n.length;r++)i[n[r]].location=r,e.bindAttribLocation(t,r,n[r]);e.linkProgram(t)}else for(let r=0;r<n.length;r++)i[n[r]].location=e.getAttribLocation(t,n[r]);return i}function Eb(t,e){if(!e.ACTIVE_UNIFORM_BLOCKS)return{};const r={},i=e.getProgramParameter(t,e.ACTIVE_UNIFORM_BLOCKS);for(let s=0;s<i;s++){const i=e.getActiveUniformBlockName(t,s),n=e.getUniformBlockIndex(t,i),o=e.getActiveUniformBlockParameter(t,s,e.UNIFORM_BLOCK_DATA_SIZE);r[i]={name:i,index:n,size:o}}return r}function Ab(t,e){const r={},i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<i;s++){const i=e.getActiveUniform(t,s),n=i.name.replace(/\[.*?\]$/,""),o=!!i.name.match(/\[.*?\]$/),a=Tb(e,i.type);r[n]={name:n,index:s,type:a,size:i.size,isArray:o,value:xb(a,i.size)}}return r}function Pb(t,e){const r=t.getShaderSource(e).split("\n").map(((t,e)=>`${e}: ${t}`)),i=t.getShaderInfoLog(e),s=i.split("\n"),n={},o=s.map((t=>parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((t=>!(!t||n[t])&&(n[t]=!0,!0))),a=[""];o.forEach((t=>{r[t-1]=`%c${r[t-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const l=r.join("\n");a[0]=l,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function Mb(t,e,r,i){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(r,t.COMPILE_STATUS)||Pb(t,r),t.getShaderParameter(i,t.COMPILE_STATUS)||Pb(t,i),console.error("PixiJS Error: Could not initialize shader."),""!==t.getProgramInfoLog(e)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}function Rb(t,e){const r=mb(t,t.VERTEX_SHADER,e.vertex),i=mb(t,t.FRAGMENT_SHADER,e.fragment),s=t.createProgram();t.attachShader(s,r),t.attachShader(s,i);const n=e.transformFeedbackVaryings;n&&("function"!=typeof t.transformFeedbackVaryings||t.transformFeedbackVaryings(s,n.names,"separate"===n.bufferMode?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)||Mb(t,s,r,i),e._attributeData=wb(s,t,!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertex)),e._uniformData=Ab(s,t),e._uniformBlockData=Eb(s,t),t.deleteShader(r),t.deleteShader(i);const o={};for(const r in e._uniformData){const i=e._uniformData[r];o[r]={location:t.getUniformLocation(s,r),value:xb(i.type,i.size)}}return new gb(s,o)}const Cb={textureCount:0,blockIndex:0};class Ob{constructor(t){this._activeProgram=null,this._programDataHash=Object.create(null),this._shaderSyncFunctions=Object.create(null),this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_programDataHash")}contextChange(t){this._gl=t,this._programDataHash=Object.create(null),this._shaderSyncFunctions=Object.create(null),this._activeProgram=null,this.maxTextures=ps()}bind(t,e){if(this._setProgram(t.glProgram),e)return;Cb.textureCount=0,Cb.blockIndex=0;let r=this._shaderSyncFunctions[t.glProgram._key];r||(r=this._shaderSyncFunctions[t.glProgram._key]=this._generateShaderSync(t,this)),this._renderer.buffer.nextBindBase(!!t.glProgram.transformFeedbackVaryings),r(this._renderer,t,Cb)}updateUniformGroup(t){this._renderer.uniformGroup.updateUniformGroup(t,this._activeProgram,Cb)}bindUniformBlock(t,e,r=0){const i=this._renderer.buffer,s=this._getProgramData(this._activeProgram),n=t._bufferResource;n||this._renderer.ubo.updateUniformGroup(t);const o=t.buffer,a=i.updateBuffer(o),l=i.freeLocationForBufferBase(a);if(n){const{offset:e,size:r}=t;0===e&&r===o.data.byteLength?i.bindBufferBase(a,l):i.bindBufferRange(a,l,e)}else i.getLastBindBaseLocation(a)!==l&&i.bindBufferBase(a,l);const h=this._activeProgram._uniformBlockData[e].index;s.uniformBlockBindings[r]!==l&&(s.uniformBlockBindings[r]=l,this._renderer.gl.uniformBlockBinding(s.program,h,l))}_setProgram(t){if(this._activeProgram===t)return;this._activeProgram=t;const e=this._getProgramData(t);this._gl.useProgram(e.program)}_getProgramData(t){return this._programDataHash[t._key]||this._createProgramData(t)}_createProgramData(t){const e=t._key;return this._programDataHash[e]=Rb(this._gl,t),this._programDataHash[e]}destroy(){for(const t of Object.keys(this._programDataHash))this._programDataHash[t].destroy(),this._programDataHash[t]=null;this._programDataHash=null}_generateShaderSync(t,e){return fb(t,e)}resetState(){this._activeProgram=null}}Ob.extension={type:[u.WebGLSystem],name:"shader"};const Ib={f32:"if (cv !== v) {\n            cu.value = v;\n            gl.uniform1f(location, v);\n        }","vec2<f32>":"if (cv[0] !== v[0] || cv[1] !== v[1]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            gl.uniform2f(location, v[0], v[1]);\n        }","vec3<f32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            gl.uniform3f(location, v[0], v[1], v[2]);\n        }","vec4<f32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            cv[3] = v[3];\n            gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n        }",i32:"if (cv !== v) {\n            cu.value = v;\n            gl.uniform1i(location, v);\n        }","vec2<i32>":"if (cv[0] !== v[0] || cv[1] !== v[1]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            gl.uniform2i(location, v[0], v[1]);\n        }","vec3<i32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            gl.uniform3i(location, v[0], v[1], v[2]);\n        }","vec4<i32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            cv[3] = v[3];\n            gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n        }",u32:"if (cv !== v) {\n            cu.value = v;\n            gl.uniform1ui(location, v);\n        }","vec2<u32>":"if (cv[0] !== v[0] || cv[1] !== v[1]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            gl.uniform2ui(location, v[0], v[1]);\n        }","vec3<u32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            gl.uniform3ui(location, v[0], v[1], v[2]);\n        }","vec4<u32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            cv[3] = v[3];\n            gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n        }",bool:"if (cv !== v) {\n            cu.value = v;\n            gl.uniform1i(location, v);\n        }","vec2<bool>":"if (cv[0] !== v[0] || cv[1] !== v[1]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            gl.uniform2i(location, v[0], v[1]);\n        }","vec3<bool>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            gl.uniform3i(location, v[0], v[1], v[2]);\n        }","vec4<bool>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            cv[3] = v[3];\n            gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n        }","mat2x2<f32>":"gl.uniformMatrix2fv(location, false, v);","mat3x3<f32>":"gl.uniformMatrix3fv(location, false, v);","mat4x4<f32>":"gl.uniformMatrix4fv(location, false, v);"},Bb={f32:"gl.uniform1fv(location, v);","vec2<f32>":"gl.uniform2fv(location, v);","vec3<f32>":"gl.uniform3fv(location, v);","vec4<f32>":"gl.uniform4fv(location, v);","mat2x2<f32>":"gl.uniformMatrix2fv(location, false, v);","mat3x3<f32>":"gl.uniformMatrix3fv(location, false, v);","mat4x4<f32>":"gl.uniformMatrix4fv(location, false, v);",i32:"gl.uniform1iv(location, v);","vec2<i32>":"gl.uniform2iv(location, v);","vec3<i32>":"gl.uniform3iv(location, v);","vec4<i32>":"gl.uniform4iv(location, v);",u32:"gl.uniform1iv(location, v);","vec2<u32>":"gl.uniform2iv(location, v);","vec3<u32>":"gl.uniform3iv(location, v);","vec4<u32>":"gl.uniform4iv(location, v);",bool:"gl.uniform1iv(location, v);","vec2<bool>":"gl.uniform2iv(location, v);","vec3<bool>":"gl.uniform3iv(location, v);","vec4<bool>":"gl.uniform4iv(location, v);"};function kb(t,e){const r=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n        var name = null;\n    "];for(const i in t.uniforms){if(!e[i]){t.uniforms[i]instanceof To?t.uniforms[i].ubo?r.push(`\n                        renderer.shader.bindUniformBlock(uv.${i}, "${i}");\n                    `):r.push(`\n                        renderer.shader.updateUniformGroup(uv.${i});\n                    `):t.uniforms[i]instanceof pb&&r.push(`\n                        renderer.shader.bindBufferResource(uv.${i}, "${i}");\n                    `);continue}const s=t.uniformStructures[i];let n=!1;for(let t=0;t<Oy.length;t++){const e=Oy[t];if(s.type===e.type&&e.test(s)){r.push(`name = "${i}";`,Oy[t].uniform),n=!0;break}}if(!n){const t=(1===s.size?Ib:Bb)[s.type].replace("location",`ud["${i}"].location`);r.push(`\n            cu = ud["${i}"];\n            cv = cu.value;\n            v = uv["${i}"];\n            ${t};`)}}return new Function("ud","uv","renderer","syncData",r.join("\n"))}class Gb{constructor(t){this._cache={},this._uniformGroupSyncHash={},this._renderer=t,this.gl=null,this._cache={}}contextChange(t){this.gl=t}updateUniformGroup(t,e,r){const i=this._renderer.shader._getProgramData(e);(!t.isStatic||t._dirtyId!==i.uniformDirtyGroups[t.uid])&&(i.uniformDirtyGroups[t.uid]=t._dirtyId,this._getUniformSyncFunction(t,e)(i.uniformData,t.uniforms,this._renderer,r))}_getUniformSyncFunction(t,e){var r;return(null==(r=this._uniformGroupSyncHash[t._signature])?void 0:r[e._key])||this._createUniformSyncFunction(t,e)}_createUniformSyncFunction(t,e){const r=this._uniformGroupSyncHash[t._signature]||(this._uniformGroupSyncHash[t._signature]={}),i=this._getSignature(t,e._uniformData,"u");return this._cache[i]||(this._cache[i]=this._generateUniformsSync(t,e._uniformData)),r[e._key]=this._cache[i],r[e._key]}_generateUniformsSync(t,e){return kb(t,e)}_getSignature(t,e,r){const i=t.uniforms,s=[`${r}-`];for(const t in i)s.push(t),e[t]&&s.push(e[t].type);return s.join("-")}destroy(){this._renderer=null,this._cache=null}}Gb.extension={type:[u.WebGLSystem],name:"uniformGroup"};const Db={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Fb(t){const e={};if(e.normal=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.add=[t.ONE,t.ONE],e.multiply=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e.screen=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e.none=[0,0],e["normal-npm"]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e["add-npm"]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e["screen-npm"]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e.erase=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],t instanceof ri.get().getWebGLRenderingContext()){const r=t.getExtension("EXT_blend_minmax");r&&(e.min=[t.ONE,t.ONE,t.ONE,t.ONE,r.MIN_EXT,r.MIN_EXT],e.max=[t.ONE,t.ONE,t.ONE,t.ONE,r.MAX_EXT,r.MAX_EXT])}else e.min=[t.ONE,t.ONE,t.ONE,t.ONE,t.MIN,t.MIN],e.max=[t.ONE,t.ONE,t.ONE,t.ONE,t.MAX,t.MAX];return e}const Nb=class t{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode="none",this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=tl.for2d()}contextChange(t){this.gl=t,this.blendModesMap=Fb(t),this.resetState()}set(t){if(t||(t=this.defaultState),this.stateId!==t.data){let e=this.stateId^t.data,r=0;for(;e;)1&e&&this.map[r].call(this,!!(t.data&1<<r)),e>>=1,r++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t||(t=this.defaultState);for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(e){this._updateCheck(t._checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this._updateCheck(t._checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(this.blendModesMap[t]||(t="normal"),t===this.blendMode)return;this.blendMode=t;const e=this.blendModesMap[t],r=this.gl;2===e.length?r.blendFunc(e[0],e[1]):r.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,r.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}resetState(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode="",this.setBlendMode("normal")}_updateCheck(t,e){const r=this.checks.indexOf(t);e&&-1===r?this.checks.push(t):!e&&-1!==r&&this.checks.splice(r,1)}static _checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static _checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null,this.checks.length=0}};Nb.extension={type:[u.WebGLSystem],name:"state"};let Ub=Nb;class Lb{constructor(t){this.target=ay.TEXTURE_2D,this.texture=t,this.width=-1,this.height=-1,this.type=hy.UNSIGNED_BYTE,this.internalFormat=oy.RGBA,this.format=oy.RGBA,this.samplerType=0}}const zb={id:"buffer",upload(t,e,r){e.width===t.width||e.height===t.height?r.texSubImage2D(r.TEXTURE_2D,0,0,0,t.width,t.height,e.format,e.type,t.resource):r.texImage2D(e.target,0,e.internalFormat,t.width,t.height,0,e.format,e.type,t.resource),e.width=t.width,e.height=t.height}},Xb={"bc1-rgba-unorm":!0,"bc1-rgba-unorm-srgb":!0,"bc2-rgba-unorm":!0,"bc2-rgba-unorm-srgb":!0,"bc3-rgba-unorm":!0,"bc3-rgba-unorm-srgb":!0,"bc4-r-unorm":!0,"bc4-r-snorm":!0,"bc5-rg-unorm":!0,"bc5-rg-snorm":!0,"bc6h-rgb-ufloat":!0,"bc6h-rgb-float":!0,"bc7-rgba-unorm":!0,"bc7-rgba-unorm-srgb":!0,"etc2-rgb8unorm":!0,"etc2-rgb8unorm-srgb":!0,"etc2-rgb8a1unorm":!0,"etc2-rgb8a1unorm-srgb":!0,"etc2-rgba8unorm":!0,"etc2-rgba8unorm-srgb":!0,"eac-r11unorm":!0,"eac-r11snorm":!0,"eac-rg11unorm":!0,"eac-rg11snorm":!0,"astc-4x4-unorm":!0,"astc-4x4-unorm-srgb":!0,"astc-5x4-unorm":!0,"astc-5x4-unorm-srgb":!0,"astc-5x5-unorm":!0,"astc-5x5-unorm-srgb":!0,"astc-6x5-unorm":!0,"astc-6x5-unorm-srgb":!0,"astc-6x6-unorm":!0,"astc-6x6-unorm-srgb":!0,"astc-8x5-unorm":!0,"astc-8x5-unorm-srgb":!0,"astc-8x6-unorm":!0,"astc-8x6-unorm-srgb":!0,"astc-8x8-unorm":!0,"astc-8x8-unorm-srgb":!0,"astc-10x5-unorm":!0,"astc-10x5-unorm-srgb":!0,"astc-10x6-unorm":!0,"astc-10x6-unorm-srgb":!0,"astc-10x8-unorm":!0,"astc-10x8-unorm-srgb":!0,"astc-10x10-unorm":!0,"astc-10x10-unorm-srgb":!0,"astc-12x10-unorm":!0,"astc-12x10-unorm-srgb":!0,"astc-12x12-unorm":!0,"astc-12x12-unorm-srgb":!0},Hb={id:"compressed",upload(t,e,r){r.pixelStorei(r.UNPACK_ALIGNMENT,4);let i=t.pixelWidth,s=t.pixelHeight;const n=!!Xb[t.format];for(let o=0;o<t.resource.length;o++){const a=t.resource[o];n?r.compressedTexImage2D(r.TEXTURE_2D,o,e.internalFormat,i,s,0,a):r.texImage2D(r.TEXTURE_2D,o,e.internalFormat,i,s,0,e.format,e.type,a),i=Math.max(i>>1,1),s=Math.max(s>>1,1)}}},jb={id:"image",upload(t,e,r,i){const s=e.width,n=e.height,o=t.pixelWidth,a=t.pixelHeight,l=t.resourceWidth,h=t.resourceHeight;l<o||h<a?((s!==o||n!==a)&&r.texImage2D(e.target,0,e.internalFormat,o,a,0,e.format,e.type,null),2===i?r.texSubImage2D(r.TEXTURE_2D,0,0,0,l,h,e.format,e.type,t.resource):r.texSubImage2D(r.TEXTURE_2D,0,0,0,e.format,e.type,t.resource)):s===o&&n===a?r.texSubImage2D(r.TEXTURE_2D,0,0,0,e.format,e.type,t.resource):2===i?r.texImage2D(e.target,0,e.internalFormat,o,a,0,e.format,e.type,t.resource):r.texImage2D(e.target,0,e.internalFormat,e.format,e.type,t.resource),e.width=o,e.height=a}},Vb={id:"video",upload(t,e,r,i){t.isValid?jb.upload(t,e,r,i):r.texImage2D(e.target,0,e.internalFormat,1,1,0,e.format,e.type,null)}},Wb={linear:9729,nearest:9728},$b={linear:{linear:9987,nearest:9985},nearest:{linear:9986,nearest:9984}},Yb={"clamp-to-edge":33071,repeat:10497,"mirror-repeat":33648},qb={never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519};function Kb(t,e,r,i,s,n,o,a){const l=n;if(!a||"repeat"!==t.addressModeU||"repeat"!==t.addressModeV||"repeat"!==t.addressModeW){const r=Yb[o?"clamp-to-edge":t.addressModeU],i=Yb[o?"clamp-to-edge":t.addressModeV],n=Yb[o?"clamp-to-edge":t.addressModeW];e[s](l,e.TEXTURE_WRAP_S,r),e[s](l,e.TEXTURE_WRAP_T,i),e.TEXTURE_WRAP_R&&e[s](l,e.TEXTURE_WRAP_R,n)}if((!a||"linear"!==t.magFilter)&&e[s](l,e.TEXTURE_MAG_FILTER,Wb[t.magFilter]),r){if(!a||"linear"!==t.mipmapFilter){const r=$b[t.minFilter][t.mipmapFilter];e[s](l,e.TEXTURE_MIN_FILTER,r)}}else e[s](l,e.TEXTURE_MIN_FILTER,Wb[t.minFilter]);if(i&&t.maxAnisotropy>1){const r=Math.min(t.maxAnisotropy,e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT));e[s](l,i.TEXTURE_MAX_ANISOTROPY_EXT,r)}t.compare&&e[s](l,e.TEXTURE_COMPARE_FUNC,qb[t.compare])}function Qb(t){return{r8unorm:t.RED,r8snorm:t.RED,r8uint:t.RED,r8sint:t.RED,r16uint:t.RED,r16sint:t.RED,r16float:t.RED,rg8unorm:t.RG,rg8snorm:t.RG,rg8uint:t.RG,rg8sint:t.RG,r32uint:t.RED,r32sint:t.RED,r32float:t.RED,rg16uint:t.RG,rg16sint:t.RG,rg16float:t.RG,rgba8unorm:t.RGBA,"rgba8unorm-srgb":t.RGBA,rgba8snorm:t.RGBA,rgba8uint:t.RGBA,rgba8sint:t.RGBA,bgra8unorm:t.RGBA,"bgra8unorm-srgb":t.RGBA,rgb9e5ufloat:t.RGB,rgb10a2unorm:t.RGBA,rg11b10ufloat:t.RGB,rg32uint:t.RG,rg32sint:t.RG,rg32float:t.RG,rgba16uint:t.RGBA,rgba16sint:t.RGBA,rgba16float:t.RGBA,rgba32uint:t.RGBA,rgba32sint:t.RGBA,rgba32float:t.RGBA,stencil8:t.STENCIL_INDEX8,depth16unorm:t.DEPTH_COMPONENT,depth24plus:t.DEPTH_COMPONENT,"depth24plus-stencil8":t.DEPTH_STENCIL,depth32float:t.DEPTH_COMPONENT,"depth32float-stencil8":t.DEPTH_STENCIL}}var Zb=Object.defineProperty,Jb=Object.defineProperties,tv=Object.getOwnPropertyDescriptors,ev=Object.getOwnPropertySymbols,rv=Object.prototype.hasOwnProperty,iv=Object.prototype.propertyIsEnumerable,sv=(t,e,r)=>e in t?Zb(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,nv=(t,e)=>{for(var r in e||(e={}))rv.call(e,r)&&sv(t,r,e[r]);if(ev)for(var r of ev(e))iv.call(e,r)&&sv(t,r,e[r]);return t};function ov(t,e){let r={},i=t.RGBA;return t instanceof ri.get().getWebGLRenderingContext()?e.srgb&&(r={"rgba8unorm-srgb":e.srgb.SRGB8_ALPHA8_EXT,"bgra8unorm-srgb":e.srgb.SRGB8_ALPHA8_EXT}):(r={"rgba8unorm-srgb":t.SRGB8_ALPHA8,"bgra8unorm-srgb":t.SRGB8_ALPHA8},i=t.RGBA8),nv(nv(nv(nv(nv(nv(((t,e)=>Jb(t,tv(e)))(nv({r8unorm:t.R8,r8snorm:t.R8_SNORM,r8uint:t.R8UI,r8sint:t.R8I,r16uint:t.R16UI,r16sint:t.R16I,r16float:t.R16F,rg8unorm:t.RG8,rg8snorm:t.RG8_SNORM,rg8uint:t.RG8UI,rg8sint:t.RG8I,r32uint:t.R32UI,r32sint:t.R32I,r32float:t.R32F,rg16uint:t.RG16UI,rg16sint:t.RG16I,rg16float:t.RG16F,rgba8unorm:t.RGBA},r),{rgba8snorm:t.RGBA8_SNORM,rgba8uint:t.RGBA8UI,rgba8sint:t.RGBA8I,bgra8unorm:i,rgb9e5ufloat:t.RGB9_E5,rgb10a2unorm:t.RGB10_A2,rg11b10ufloat:t.R11F_G11F_B10F,rg32uint:t.RG32UI,rg32sint:t.RG32I,rg32float:t.RG32F,rgba16uint:t.RGBA16UI,rgba16sint:t.RGBA16I,rgba16float:t.RGBA16F,rgba32uint:t.RGBA32UI,rgba32sint:t.RGBA32I,rgba32float:t.RGBA32F,stencil8:t.STENCIL_INDEX8,depth16unorm:t.DEPTH_COMPONENT16,depth24plus:t.DEPTH_COMPONENT24,"depth24plus-stencil8":t.DEPTH24_STENCIL8,depth32float:t.DEPTH_COMPONENT32F,"depth32float-stencil8":t.DEPTH32F_STENCIL8}),e.s3tc?{"bc1-rgba-unorm":e.s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT,"bc2-rgba-unorm":e.s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT,"bc3-rgba-unorm":e.s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT}:{}),e.s3tc_sRGB?{"bc1-rgba-unorm-srgb":e.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,"bc2-rgba-unorm-srgb":e.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,"bc3-rgba-unorm-srgb":e.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}:{}),e.rgtc?{"bc4-r-unorm":e.rgtc.COMPRESSED_RED_RGTC1_EXT,"bc4-r-snorm":e.rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT,"bc5-rg-unorm":e.rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT,"bc5-rg-snorm":e.rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}:{}),e.bptc?{"bc6h-rgb-float":e.bptc.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,"bc6h-rgb-ufloat":e.bptc.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,"bc7-rgba-unorm":e.bptc.COMPRESSED_RGBA_BPTC_UNORM_EXT,"bc7-rgba-unorm-srgb":e.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT}:{}),e.etc?{"etc2-rgb8unorm":e.etc.COMPRESSED_RGB8_ETC2,"etc2-rgb8unorm-srgb":e.etc.COMPRESSED_SRGB8_ETC2,"etc2-rgb8a1unorm":e.etc.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgb8a1unorm-srgb":e.etc.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgba8unorm":e.etc.COMPRESSED_RGBA8_ETC2_EAC,"etc2-rgba8unorm-srgb":e.etc.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC,"eac-r11unorm":e.etc.COMPRESSED_R11_EAC,"eac-rg11unorm":e.etc.COMPRESSED_SIGNED_RG11_EAC}:{}),e.astc?{"astc-4x4-unorm":e.astc.COMPRESSED_RGBA_ASTC_4x4_KHR,"astc-4x4-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR,"astc-5x4-unorm":e.astc.COMPRESSED_RGBA_ASTC_5x4_KHR,"astc-5x4-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR,"astc-5x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_5x5_KHR,"astc-5x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR,"astc-6x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_6x5_KHR,"astc-6x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR,"astc-6x6-unorm":e.astc.COMPRESSED_RGBA_ASTC_6x6_KHR,"astc-6x6-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR,"astc-8x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_8x5_KHR,"astc-8x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR,"astc-8x6-unorm":e.astc.COMPRESSED_RGBA_ASTC_8x6_KHR,"astc-8x6-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR,"astc-8x8-unorm":e.astc.COMPRESSED_RGBA_ASTC_8x8_KHR,"astc-8x8-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR,"astc-10x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x5_KHR,"astc-10x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR,"astc-10x6-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x6_KHR,"astc-10x6-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR,"astc-10x8-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x8_KHR,"astc-10x8-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR,"astc-10x10-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x10_KHR,"astc-10x10-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,"astc-12x10-unorm":e.astc.COMPRESSED_RGBA_ASTC_12x10_KHR,"astc-12x10-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR,"astc-12x12-unorm":e.astc.COMPRESSED_RGBA_ASTC_12x12_KHR,"astc-12x12-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR}:{})}function av(t){return{r8unorm:t.UNSIGNED_BYTE,r8snorm:t.BYTE,r8uint:t.UNSIGNED_BYTE,r8sint:t.BYTE,r16uint:t.UNSIGNED_SHORT,r16sint:t.SHORT,r16float:t.HALF_FLOAT,rg8unorm:t.UNSIGNED_BYTE,rg8snorm:t.BYTE,rg8uint:t.UNSIGNED_BYTE,rg8sint:t.BYTE,r32uint:t.UNSIGNED_INT,r32sint:t.INT,r32float:t.FLOAT,rg16uint:t.UNSIGNED_SHORT,rg16sint:t.SHORT,rg16float:t.HALF_FLOAT,rgba8unorm:t.UNSIGNED_BYTE,"rgba8unorm-srgb":t.UNSIGNED_BYTE,rgba8snorm:t.BYTE,rgba8uint:t.UNSIGNED_BYTE,rgba8sint:t.BYTE,bgra8unorm:t.UNSIGNED_BYTE,"bgra8unorm-srgb":t.UNSIGNED_BYTE,rgb9e5ufloat:t.UNSIGNED_INT_5_9_9_9_REV,rgb10a2unorm:t.UNSIGNED_INT_2_10_10_10_REV,rg11b10ufloat:t.UNSIGNED_INT_10F_11F_11F_REV,rg32uint:t.UNSIGNED_INT,rg32sint:t.INT,rg32float:t.FLOAT,rgba16uint:t.UNSIGNED_SHORT,rgba16sint:t.SHORT,rgba16float:t.HALF_FLOAT,rgba32uint:t.UNSIGNED_INT,rgba32sint:t.INT,rgba32float:t.FLOAT,stencil8:t.UNSIGNED_BYTE,depth16unorm:t.UNSIGNED_SHORT,depth24plus:t.UNSIGNED_INT,"depth24plus-stencil8":t.UNSIGNED_INT_24_8,depth32float:t.FLOAT,"depth32float-stencil8":t.FLOAT_32_UNSIGNED_INT_24_8_REV}}class lv{constructor(t){this.managedTextures=[],this._glTextures=Object.create(null),this._glSamplers=Object.create(null),this._boundTextures=[],this._activeTextureLocation=-1,this._boundSamplers=Object.create(null),this._uploads={image:jb,buffer:zb,video:Vb,compressed:Hb},this._premultiplyAlpha=!1,this._useSeparateSamplers=!1,this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_glTextures"),this._renderer.renderableGC.addManagedHash(this,"_glSamplers")}contextChange(t){this._gl=t,this._mapFormatToInternalFormat||(this._mapFormatToInternalFormat=ov(t,this._renderer.context.extensions),this._mapFormatToType=av(t),this._mapFormatToFormat=Qb(t)),this._glTextures=Object.create(null),this._glSamplers=Object.create(null),this._boundSamplers=Object.create(null),this._premultiplyAlpha=!1;for(let t=0;t<16;t++)this.bind(Ue.EMPTY,t)}initSource(t){this.bind(t)}bind(t,e=0){const r=t.source;t?(this.bindSource(r,e),this._useSeparateSamplers&&this._bindSampler(r.style,e)):(this.bindSource(null,e),this._useSeparateSamplers&&this._bindSampler(null,e))}bindSource(t,e=0){const r=this._gl;if(t._touched=this._renderer.textureGC.count,this._boundTextures[e]!==t){this._boundTextures[e]=t,this._activateLocation(e),t||(t=Ue.EMPTY.source);const i=this.getGlSource(t);r.bindTexture(i.target,i.texture)}}_bindSampler(t,e=0){const r=this._gl;if(!t)return this._boundSamplers[e]=null,void r.bindSampler(e,null);const i=this._getGlSampler(t);this._boundSamplers[e]!==i&&(this._boundSamplers[e]=i,r.bindSampler(e,i))}unbind(t){const e=t.source,r=this._boundTextures,i=this._gl;for(let t=0;t<r.length;t++)if(r[t]===e){this._activateLocation(t);const s=this.getGlSource(e);i.bindTexture(s.target,null),r[t]=null}}_activateLocation(t){this._activeTextureLocation!==t&&(this._activeTextureLocation=t,this._gl.activeTexture(this._gl.TEXTURE0+t))}_initSource(t){const e=this._gl,r=new Lb(e.createTexture());if(r.type=this._mapFormatToType[t.format],r.internalFormat=this._mapFormatToInternalFormat[t.format],r.format=this._mapFormatToFormat[t.format],t.autoGenerateMipmaps&&(this._renderer.context.supports.nonPowOf2mipmaps||t.isPowerOfTwo)){const e=Math.max(t.width,t.height);t.mipLevelCount=Math.floor(Math.log2(e))+1}return this._glTextures[t.uid]=r,this.managedTextures.includes(t)||(t.on("update",this.onSourceUpdate,this),t.on("resize",this.onSourceUpdate,this),t.on("styleChange",this.onStyleChange,this),t.on("destroy",this.onSourceDestroy,this),t.on("unload",this.onSourceUnload,this),t.on("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.push(t)),this.onSourceUpdate(t),this.updateStyle(t,!1),r}onStyleChange(t){this.updateStyle(t,!1)}updateStyle(t,e){const r=this._gl,i=this.getGlSource(t);r.bindTexture(r.TEXTURE_2D,i.texture),this._boundTextures[this._activeTextureLocation]=t,Kb(t.style,r,t.mipLevelCount>1,this._renderer.context.extensions.anisotropicFiltering,"texParameteri",r.TEXTURE_2D,!this._renderer.context.supports.nonPowOf2wrapping&&!t.isPowerOfTwo,e)}onSourceUnload(t){const e=this._glTextures[t.uid];e&&(this.unbind(t),this._glTextures[t.uid]=null,this._gl.deleteTexture(e.texture))}onSourceUpdate(t){const e=this._gl,r=this.getGlSource(t);e.bindTexture(e.TEXTURE_2D,r.texture),this._boundTextures[this._activeTextureLocation]=t;const i="premultiply-alpha-on-upload"===t.alphaMode;this._premultiplyAlpha!==i&&(this._premultiplyAlpha=i,e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i)),this._uploads[t.uploadMethodId]?this._uploads[t.uploadMethodId].upload(t,r,e,this._renderer.context.webGLVersion):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t.pixelWidth,t.pixelHeight,0,e.RGBA,e.UNSIGNED_BYTE,null),t.autoGenerateMipmaps&&t.mipLevelCount>1&&this.onUpdateMipmaps(t,!1)}onUpdateMipmaps(t,e=!0){e&&this.bindSource(t,0);const r=this.getGlSource(t);this._gl.generateMipmap(r.target)}onSourceDestroy(t){t.off("destroy",this.onSourceDestroy,this),t.off("update",this.onSourceUpdate,this),t.off("resize",this.onSourceUpdate,this),t.off("unload",this.onSourceUnload,this),t.off("styleChange",this.onStyleChange,this),t.off("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.splice(this.managedTextures.indexOf(t),1),this.onSourceUnload(t)}_initSampler(t){const e=this._gl,r=this._gl.createSampler();return this._glSamplers[t._resourceId]=r,Kb(t,e,this._boundTextures[this._activeTextureLocation].mipLevelCount>1,this._renderer.context.extensions.anisotropicFiltering,"samplerParameteri",r,!1,!0),this._glSamplers[t._resourceId]}_getGlSampler(t){return this._glSamplers[t._resourceId]||this._initSampler(t)}getGlSource(t){return this._glTextures[t.uid]||this._initSource(t)}generateCanvas(t){const{pixels:e,width:r,height:i}=this.getPixels(t),s=ri.get().createCanvas();s.width=r,s.height=i;const n=s.getContext("2d");if(n){const t=n.createImageData(r,i);t.data.set(e),n.putImageData(t,0,0)}return s}getPixels(t){const e=t.source.resolution,r=t.frame,i=Math.max(Math.round(r.width*e),1),s=Math.max(Math.round(r.height*e),1),n=new Uint8Array(4*i*s),o=this._renderer,a=o.renderTarget.getRenderTarget(t),l=o.renderTarget.getGpuRenderTarget(a),h=o.gl;return h.bindFramebuffer(h.FRAMEBUFFER,l.resolveTargetFramebuffer),h.readPixels(Math.round(r.x*e),Math.round(r.y*e),i,s,h.RGBA,h.UNSIGNED_BYTE,n),{pixels:new Uint8ClampedArray(n.buffer),width:i,height:s}}destroy(){this.managedTextures.slice().forEach((t=>this.onSourceDestroy(t))),this.managedTextures=null,this._renderer=null}resetState(){this._activeTextureLocation=-1,this._boundTextures.fill(Ue.EMPTY.source),this._boundSamplers=Object.create(null)}}lv.extension={type:[u.WebGLSystem],name:"texture"};class hv{init(){const t=new To({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new st,type:"mat3x3<f32>"},uRound:{value:0,type:"f32"}}),e=ps(),r=Jn({name:"graphics",bits:[eo,lo(e),Zc,uo]});this.shader=new Oo({glProgram:r,resources:{localUniforms:t,batchSamplers:wo(e)}})}execute(t,e){const r=e.context,i=r.customShader||this.shader,s=t.renderer,n=s.graphicsContext,{batcher:o,instructions:a}=n.getContextRenderData(r);i.groups[0]=s.globalUniforms.bindGroup,s.state.set(t.state),s.shader.bind(i),s.geometry.bind(o.geometry,i.glProgram);const l=a.instructions;for(let t=0;t<a.instructionSize;t++){const e=l[t];if(e.size){for(let t=0;t<e.textures.count;t++)s.texture.bind(e.textures.textures[t],t);s.geometry.draw(e.topology,e.size,e.start)}}}destroy(){this.shader.destroy(!0),this.shader=null}}hv.extension={type:[u.WebGLPipesAdaptor],name:"graphics"};class uv{init(){const t=Jn({name:"mesh",bits:[Zc,Ux,uo]});this._shader=new Oo({glProgram:t,resources:{uTexture:Ue.EMPTY.source,textureUniforms:{uTextureMatrix:{type:"mat3x3<f32>",value:new st}}}})}execute(t,e){const r=t.renderer;let i=e._shader;if(i){if(!i.glProgram)return}else{i=this._shader;const t=e.texture,r=t.source;i.resources.uTexture=r,i.resources.uSampler=r.style,i.resources.textureUniforms.uniforms.uTextureMatrix=t.textureMatrix.mapCoord}i.groups[100]=r.globalUniforms.bindGroup,i.groups[101]=t.localUniformsBindGroup,r.encoder.draw({geometry:e._geometry,shader:i,state:e.state})}destroy(){this._shader.destroy(!0),this._shader=null}}uv.extension={type:[u.WebGLPipesAdaptor],name:"mesh"};class cv{constructor(t){this._renderer=t}updateRenderable(){}destroyRenderable(){}validateRenderable(){return!1}addRenderable(t,e){this._renderer.renderPipes.batch.break(e),e.add(t)}execute(t){t.isRenderable&&t.render(this._renderer)}destroy(){this._renderer=null}}function dv(t,e){const r=t.instructionSet,i=r.instructions;for(let t=0;t<r.instructionSize;t++){const r=i[t];e[r.renderPipeId].execute(r)}}cv.extension={type:[u.WebGLPipes,u.WebGPUPipes,u.CanvasPipes],name:"customRender"};const pv=new st;class fv{constructor(t){this._renderer=t}addRenderGroup(t,e){t.isCachedAsTexture?this._addRenderableCacheAsTexture(t,e):this._addRenderableDirect(t,e)}execute(t){t.isRenderable&&(t.isCachedAsTexture?this._executeCacheAsTexture(t):this._executeDirect(t))}destroy(){this._renderer=null}_addRenderableDirect(t,e){this._renderer.renderPipes.batch.break(e),t._batchableRenderGroup&&(dt.return(t._batchableRenderGroup),t._batchableRenderGroup=null),e.add(t)}_addRenderableCacheAsTexture(t,e){var r;const i=null!=(r=t._batchableRenderGroup)?r:t._batchableRenderGroup=dt.get(xl);i.renderable=t.root,i.transform=t.root.relativeGroupTransform,i.texture=t.texture,i.bounds=t._textureBounds,e.add(t),this._renderer.renderPipes.batch.addToBatch(i,e)}_executeCacheAsTexture(t){if(t.textureNeedsUpdate){t.textureNeedsUpdate=!1;const e=pv.identity().translate(-t._textureBounds.x,-t._textureBounds.y);this._renderer.renderTarget.push(t.texture,!0,null,t.texture.frame),this._renderer.globalUniforms.push({worldTransformMatrix:e,worldColor:4294967295}),dv(t,this._renderer.renderPipes),this._renderer.renderTarget.finishRenderPass(),this._renderer.renderTarget.pop(),this._renderer.globalUniforms.pop()}t._batchableRenderGroup._batcher.updateElement(t._batchableRenderGroup),t._batchableRenderGroup._batcher.geometry.buffers[0].update()}_executeDirect(t){this._renderer.globalUniforms.push({worldTransformMatrix:t.inverseParentTextureTransform,worldColor:t.worldColorAlpha}),dv(t,this._renderer.renderPipes),this._renderer.globalUniforms.pop()}}function gv(t,e){e||(e=0);for(let r=e;r<t.length&&t[r];r++)t[r]=null}fv.extension={type:[u.WebGLPipes,u.WebGPUPipes,u.CanvasPipes],name:"renderGroup"};const mv=new er;function _v(t,e=!1){xv(t);const r=t.childrenToUpdate,i=t.updateTick++;for(const e in r){const s=Number(e),n=r[e],o=n.list,a=n.index;for(let e=0;e<a;e++){const r=o[e];r.parentRenderGroup===t&&r.relativeRenderGroupDepth===s&&yv(r,i,0)}gv(o,a),n.index=0}if(e)for(let r=0;r<t.renderGroupChildren.length;r++)_v(t.renderGroupChildren[r],e)}function xv(t){const e=t.root;let r;if(t.renderGroupParent){const i=t.renderGroupParent;t.worldTransform.appendFrom(e.relativeGroupTransform,i.worldTransform),t.worldColor=zt(e.groupColor,i.worldColor),r=e.groupAlpha*i.worldAlpha}else t.worldTransform.copyFrom(e.localTransform),t.worldColor=e.localColor,r=e.localAlpha;r=r<0?0:r>1?1:r,t.worldAlpha=r,t.worldColorAlpha=t.worldColor+((255*r|0)<<24)}function yv(t,e,r){if(e===t.updateTick)return;t.updateTick=e,t.didChange=!1;const i=t.localTransform;t.updateLocalTransform();const s=t.parent;if(s&&!s.renderGroup?(r|=t._updateFlags,t.relativeGroupTransform.appendFrom(i,s.relativeGroupTransform),7&r&&bv(t,s,r)):(r=t._updateFlags,t.relativeGroupTransform.copyFrom(i),7&r&&bv(t,mv,r)),!t.renderGroup){const i=t.children,s=i.length;for(let t=0;t<s;t++)yv(i[t],e,r);const n=t.parentRenderGroup,o=t;o.renderPipeId&&!n.structureDidChange&&n.updateRenderable(o)}}function bv(t,e,r){if(1&r){t.groupColor=zt(t.localColor,e.groupColor);let r=t.localAlpha*e.groupAlpha;r=r<0?0:r>1?1:r,t.groupAlpha=r,t.groupColorAlpha=t.groupColor+((255*r|0)<<24)}2&r&&(t.groupBlendMode="inherit"===t.localBlendMode?e.groupBlendMode:t.localBlendMode),4&r&&(t.globalDisplayStatus=t.localDisplayStatus&e.globalDisplayStatus),t._updateFlags=0}function vv(t,e){const{list:r,index:i}=t.childrenRenderablesToUpdate;let s=!1;for(let t=0;t<i;t++){const i=r[t];if(s=e[i.renderPipeId].validateRenderable(i),s)break}return t.structureDidChange=s,s}const Tv=new st;class Sv{constructor(t){this._renderer=t}render({container:t,transform:e}){const r=t.parent,i=t.renderGroup.renderGroupParent;t.parent=null,t.renderGroup.renderGroupParent=null;const s=this._renderer;let n=Tv;e&&(n=n.copyFrom(t.renderGroup.localTransform),t.renderGroup.localTransform.copyFrom(e));const o=s.renderPipes;this._updateCachedRenderGroups(t.renderGroup,null),this._updateRenderGroups(t.renderGroup),s.globalUniforms.start({worldTransformMatrix:e?t.renderGroup.localTransform:t.renderGroup.worldTransform,worldColor:t.renderGroup.worldColorAlpha}),dv(t.renderGroup,o),o.uniformBatch&&o.uniformBatch.renderEnd(),e&&t.renderGroup.localTransform.copyFrom(n),t.parent=r,t.renderGroup.renderGroupParent=i}destroy(){this._renderer=null}_updateCachedRenderGroups(t,e){var r;if(t.isCachedAsTexture){if(!t.updateCacheTexture)return;e=t}t._parentCacheAsTextureRenderGroup=e;for(let r=t.renderGroupChildren.length-1;r>=0;r--)this._updateCachedRenderGroups(t.renderGroupChildren[r],e);if(t.invalidateMatrices(),t.isCachedAsTexture){if(t.textureNeedsUpdate){const e=t.root.getLocalBounds();e.ceil();const i=t.texture;t.texture&&qe.returnTexture(t.texture);const s=this._renderer,n=t.textureOptions.resolution||s.view.resolution,o=null!=(r=t.textureOptions.antialias)?r:s.view.antialias;t.texture=qe.getOptimalTexture(e.width,e.height,n,o),t._textureBounds||(t._textureBounds=new Ot),t._textureBounds.copyFrom(e),i!==t.texture&&t.renderGroupParent&&(t.renderGroupParent.structureDidChange=!0)}}else t.texture&&(qe.returnTexture(t.texture),t.texture=null)}_updateRenderGroups(t){const e=this._renderer,r=e.renderPipes;if(t.runOnRender(e),t.instructionSet.renderPipes=r,t.structureDidChange?gv(t.childrenRenderablesToUpdate.list,0):vv(t,r),_v(t),t.structureDidChange?(t.structureDidChange=!1,this._buildInstructions(t,e)):this._updateRenderables(t),t.childrenRenderablesToUpdate.index=0,e.renderPipes.batch.upload(t.instructionSet),!t.isCachedAsTexture||t.textureNeedsUpdate)for(let e=0;e<t.renderGroupChildren.length;e++)this._updateRenderGroups(t.renderGroupChildren[e])}_updateRenderables(t){const{list:e,index:r}=t.childrenRenderablesToUpdate;for(let i=0;i<r;i++){const r=e[i];r.didViewUpdate&&t.updateRenderable(r)}gv(e,r)}_buildInstructions(t,e){const r=t.root,i=t.instructionSet;i.reset();const s=e.renderPipes?e:e.batch.renderer,n=s.renderPipes;n.batch.buildStart(i),n.blendMode.buildStart(),n.colorMask.buildStart(),r.sortableChildren&&r.sortChildren(),r.collectRenderablesWithEffects(i,s,null),n.batch.buildEnd(i),n.blendMode.buildEnd(i)}}Sv.extension={type:[u.WebGLSystem,u.WebGPUSystem,u.CanvasSystem],name:"renderGroup"};class wv{constructor(t){this._gpuSpriteHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_gpuSpriteHash")}addRenderable(t,e){const r=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,r),this._renderer.renderPipes.batch.addToBatch(r,e)}updateRenderable(t){const e=this._gpuSpriteHash[t.uid];t.didViewUpdate&&this._updateBatchableSprite(t,e),e._batcher.updateElement(e)}validateRenderable(t){const e=this._getGpuSprite(t);return!e._batcher.checkAndUpdateTexture(e,t._texture)}destroyRenderable(t){const e=this._gpuSpriteHash[t.uid];dt.return(e),this._gpuSpriteHash[t.uid]=null,t.off("destroyed",this._destroyRenderableBound)}_updateBatchableSprite(t,e){e.bounds=t.visualBounds,e.texture=t._texture}_getGpuSprite(t){return this._gpuSpriteHash[t.uid]||this._initGPUSprite(t)}_initGPUSprite(t){const e=dt.get(xl);return e.renderable=t,e.transform=t.groupTransform,e.texture=t._texture,e.bounds=t.visualBounds,e.roundPixels=this._renderer._roundPixels|t._roundPixels,this._gpuSpriteHash[t.uid]=e,t.on("destroyed",this._destroyRenderableBound),e}destroy(){for(const t in this._gpuSpriteHash)dt.return(this._gpuSpriteHash[t]);this._gpuSpriteHash=null,this._renderer=null}}wv.extension={type:[u.WebGLPipes,u.WebGPUPipes,u.CanvasPipes],name:"sprite"};var Ev=Object.defineProperty,Av=Object.getOwnPropertySymbols,Pv=Object.prototype.hasOwnProperty,Mv=Object.prototype.propertyIsEnumerable,Rv=(t,e,r)=>e in t?Ev(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Cv=(t,e)=>{for(var r in e||(e={}))Pv.call(e,r)&&Rv(t,r,e[r]);if(Av)for(var r of Av(e))Mv.call(e,r)&&Rv(t,r,e[r]);return t};const Ov=class t{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Q(0),this.color=this._backgroundColor,this.alpha=1}init(e){e=Cv(Cv({},t.defaultOptions),e),this.clearBeforeRender=e.clearBeforeRender,this.color=e.background||e.backgroundColor||this._backgroundColor,this.alpha=e.backgroundAlpha,this._backgroundColor.setAlpha(e.backgroundAlpha)}get color(){return this._backgroundColor}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get colorRgba(){return this._backgroundColor.toArray()}destroy(){}};Ov.extension={type:[u.WebGLSystem,u.WebGPUSystem,u.CanvasSystem],name:"background",priority:0},Ov.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0};let Iv=Ov;const Bv={};p.handle(u.BlendMode,(t=>{if(!t.name)throw new Error("BlendMode extension must have a name property");Bv[t.name]=t.ref}),(t=>{delete Bv[t.name]}));class kv{constructor(t){this._isAdvanced=!1,this._filterHash=Object.create(null),this._renderer=t,this._renderer.runners.prerender.add(this)}prerender(){this._activeBlendMode="normal",this._isAdvanced=!1}setBlendMode(t,e,r){this._activeBlendMode!==e?(this._activeBlendMode=e,this._isAdvanced&&this._endAdvancedBlendMode(r),this._isAdvanced=!!Bv[e],this._isAdvanced&&(this._beginAdvancedBlendMode(r),this._renderableList.push(t))):this._isAdvanced&&this._renderableList.push(t)}_beginAdvancedBlendMode(t){this._renderer.renderPipes.batch.break(t);const e=this._activeBlendMode;if(!Bv[e])return;let r=this._filterHash[e];r||(r=this._filterHash[e]=new _t,r.filters=[new Bv[e]]);const i={renderPipeId:"filter",action:"pushFilter",renderables:[],filterEffect:r,canBundle:!1};this._renderableList=i.renderables,t.add(i)}_endAdvancedBlendMode(t){this._renderableList=null,this._renderer.renderPipes.batch.break(t),t.add({renderPipeId:"filter",action:"popFilter",canBundle:!1})}buildStart(){this._isAdvanced=!1}buildEnd(t){this._isAdvanced&&this._endAdvancedBlendMode(t)}destroy(){this._renderer=null,this._renderableList=null;for(const t in this._filterHash)this._filterHash[t].destroy();this._filterHash=null}}kv.extension={type:[u.WebGLPipes,u.WebGPUPipes,u.CanvasPipes],name:"blendMode"};var Gv=Object.defineProperty,Dv=Object.getOwnPropertySymbols,Fv=Object.prototype.hasOwnProperty,Nv=Object.prototype.propertyIsEnumerable,Uv=(t,e,r)=>e in t?Gv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Lv=(t,e)=>{for(var r in e||(e={}))Fv.call(e,r)&&Uv(t,r,e[r]);if(Dv)for(var r of Dv(e))Nv.call(e,r)&&Uv(t,r,e[r]);return t};const zv={png:"image/png",jpg:"image/jpeg",webp:"image/webp"},Xv=class t{constructor(t){this._renderer=t}_normalizeOptions(t,e={}){return t instanceof er||t instanceof Ue?Lv({target:t},e):Lv(Lv({},e),t)}async image(t){const e=new Image;return e.src=await this.base64(t),e}async base64(e){e=this._normalizeOptions(e,t.defaultImageOptions);const{format:r,quality:i}=e,s=this.canvas(e);if(void 0!==s.toBlob)return new Promise(((t,e)=>{s.toBlob((r=>{if(!r)return void e(new Error("ICanvas.toBlob failed!"));const i=new FileReader;i.onload=()=>t(i.result),i.onerror=e,i.readAsDataURL(r)}),zv[r],i)}));if(void 0!==s.toDataURL)return s.toDataURL(zv[r],i);if(void 0!==s.convertToBlob){const t=await s.convertToBlob({type:zv[r],quality:i});return new Promise(((e,r)=>{const i=new FileReader;i.onload=()=>e(i.result),i.onerror=r,i.readAsDataURL(t)}))}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t){const e=(t=this._normalizeOptions(t)).target,r=this._renderer;if(e instanceof Ue)return r.texture.generateCanvas(e);const i=r.textureGenerator.generateTexture(t),s=r.texture.generateCanvas(i);return i.destroy(!0),s}pixels(t){const e=(t=this._normalizeOptions(t)).target,r=this._renderer,i=e instanceof Ue?e:r.textureGenerator.generateTexture(t),s=r.texture.getPixels(i);return e instanceof er&&i.destroy(!0),s}texture(t){return(t=this._normalizeOptions(t)).target instanceof Ue?t.target:this._renderer.textureGenerator.generateTexture(t)}download(t){var e;t=this._normalizeOptions(t);const r=this.canvas(t),i=document.createElement("a");i.download=null!=(e=t.filename)?e:"image.png",i.href=r.toDataURL("image/png"),document.body.appendChild(i),i.click(),document.body.removeChild(i)}log(t){var e;const r=null!=(e=t.width)?e:200;t=this._normalizeOptions(t);const i=this.canvas(t),s=i.toDataURL();console.log(`[Pixi Texture] ${i.width}px ${i.height}px`);const n=["font-size: 1px;",`padding: ${r}px 300px;`,`background: url(${s}) no-repeat;`,"background-size: contain;"].join(" ");console.log("%c ",n)}destroy(){this._renderer=null}};Xv.extension={type:[u.WebGLSystem,u.WebGPUSystem],name:"extract"},Xv.defaultImageOptions={format:"png",quality:1};let Hv=Xv;class jv extends Ue{static create(t){return new jv({source:new ye(t)})}resize(t,e,r){return this.source.resize(t,e,r),this}}var Vv=Object.defineProperty,Wv=Object.defineProperties,$v=Object.getOwnPropertyDescriptors,Yv=Object.getOwnPropertySymbols,qv=Object.prototype.hasOwnProperty,Kv=Object.prototype.propertyIsEnumerable,Qv=(t,e,r)=>e in t?Vv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;const Zv=new Rt,Jv=new Ot,tT=[0,0,0,0];class eT{constructor(t){this._renderer=t}generateTexture(t){var e;t instanceof er&&(t={target:t,frame:void 0,textureSourceOptions:{},resolution:void 0});const r=t.resolution||this._renderer.resolution,i=t.antialias||this._renderer.view.antialias,s=t.target;let n=t.clearColor;n=n?Array.isArray(n)&&4===n.length?n:Q.shared.setValue(n).toArray():tT;const o=(null==(e=t.frame)?void 0:e.copyTo(Zv))||jt(s,Jv).rectangle;o.width=0|Math.max(o.width,1/r),o.height=0|Math.max(o.height,1/r);const a=jv.create(((t,e)=>Wv(t,$v(e)))(((t,e)=>{for(var r in e||(e={}))qv.call(e,r)&&Qv(t,r,e[r]);if(Yv)for(var r of Yv(e))Kv.call(e,r)&&Qv(t,r,e[r]);return t})({},t.textureSourceOptions),{width:o.width,height:o.height,resolution:r,antialias:i})),l=st.shared.translate(-o.x,-o.y);return this._renderer.render({container:s,transform:l,target:a,clearColor:n}),a.source.updateMipmaps(),a}destroy(){this._renderer=null}}eT.extension={type:[u.WebGLSystem,u.WebGPUSystem],name:"textureGenerator"};class rT{constructor(t){this._stackIndex=0,this._globalUniformDataStack=[],this._uniformsPool=[],this._activeUniforms=[],this._bindGroupPool=[],this._activeBindGroups=[],this._renderer=t}reset(){this._stackIndex=0;for(let t=0;t<this._activeUniforms.length;t++)this._uniformsPool.push(this._activeUniforms[t]);for(let t=0;t<this._activeBindGroups.length;t++)this._bindGroupPool.push(this._activeBindGroups[t]);this._activeUniforms.length=0,this._activeBindGroups.length=0}start(t){this.reset(),this.push(t)}bind({size:t,projectionMatrix:e,worldTransformMatrix:r,worldColor:i,offset:s}){const n=this._renderer.renderTarget.renderTarget,o=this._stackIndex?this._globalUniformDataStack[this._stackIndex-1]:{projectionData:n,worldTransformMatrix:new st,worldColor:4294967295,offset:new rt},a={projectionMatrix:e||this._renderer.renderTarget.projectionMatrix,resolution:t||n.size,worldTransformMatrix:r||o.worldTransformMatrix,worldColor:i||o.worldColor,offset:s||o.offset,bindGroup:null},l=this._uniformsPool.pop()||this._createUniforms();this._activeUniforms.push(l);const h=l.uniforms;let u;h.uProjectionMatrix=a.projectionMatrix,h.uResolution=a.resolution,h.uWorldTransformMatrix.copyFrom(a.worldTransformMatrix),h.uWorldTransformMatrix.tx-=a.offset.x,h.uWorldTransformMatrix.ty-=a.offset.y,el(a.worldColor,h.uWorldColorAlpha,0),l.update(),this._renderer.renderPipes.uniformBatch?u=this._renderer.renderPipes.uniformBatch.getUniformBindGroup(l,!1):(u=this._bindGroupPool.pop()||new os,this._activeBindGroups.push(u),u.setResource(l,0)),a.bindGroup=u,this._currentGlobalUniformData=a}push(t){this.bind(t),this._globalUniformDataStack[this._stackIndex++]=this._currentGlobalUniformData}pop(){this._currentGlobalUniformData=this._globalUniformDataStack[--this._stackIndex-1],this._renderer.type===Eo.WEBGL&&this._currentGlobalUniformData.bindGroup.resources[0].update()}get bindGroup(){return this._currentGlobalUniformData.bindGroup}get globalUniformData(){return this._currentGlobalUniformData}get uniformGroup(){return this._currentGlobalUniformData.bindGroup.resources[0]}_createUniforms(){return new To({uProjectionMatrix:{value:new st,type:"mat3x3<f32>"},uWorldTransformMatrix:{value:new st,type:"mat3x3<f32>"},uWorldColorAlpha:{value:new Float32Array(4),type:"vec4<f32>"},uResolution:{value:[0,0],type:"vec2<f32>"}},{isStatic:!0})}destroy(){this._renderer=null}}rT.extension={type:[u.WebGLSystem,u.WebGPUSystem,u.CanvasSystem],name:"globalUniforms"};let iT=1;class sT{constructor(){this._tasks=[],this._offset=0}init(){Gr.system.add(this._update,this)}repeat(t,e,r=!0){const i=iT++;let s=0;return r&&(this._offset+=1e3,s=this._offset),this._tasks.push({func:t,duration:e,start:performance.now(),offset:s,last:performance.now(),repeat:!0,id:i}),i}cancel(t){for(let e=0;e<this._tasks.length;e++)if(this._tasks[e].id===t)return void this._tasks.splice(e,1)}_update(){const t=performance.now();for(let e=0;e<this._tasks.length;e++){const r=this._tasks[e];if(t-r.offset-r.last>=r.duration){const e=t-r.start;r.func(e),r.last=t}}}destroy(){Gr.system.remove(this._update,this),this._tasks.length=0}}sT.extension={type:[u.WebGLSystem,u.WebGPUSystem,u.CanvasSystem],name:"scheduler",priority:0};let nT=!1;function oT(t){if(!nT){if(ri.get().getNavigator().userAgent.toLowerCase().indexOf("chrome")>-1){const e=[`%c  %c  %c  %c  %c PixiJS %c v8.8.0 (${t}) http://www.pixijs.com/\n\n`,"background: #E72264; padding:5px 0;","background: #6CA2EA; padding:5px 0;","background: #B5D33D; padding:5px 0;","background: #FED23F; padding:5px 0;","color: #FFFFFF; background: #E72264; padding:5px 0;","color: #E72264; background: #FFFFFF; padding:5px 0;"];globalThis.console.log(...e)}else globalThis.console&&globalThis.console.log(`PixiJS 8.8.0 - ${t} - http://www.pixijs.com/`);nT=!0}}class aT{constructor(t){this._renderer=t}init(t){if(t.hello){let t=this._renderer.name;this._renderer.type===Eo.WEBGL&&(t+=` ${this._renderer.context.webGLVersion}`),oT(t)}}}function lT(t){let e=!1;for(const r in t)if(null==t[r]){e=!0;break}if(!e)return t;const r=Object.create(null);for(const e in t){const i=t[e];i&&(r[e]=i)}return r}function hT(t){let e=0;for(let r=0;r<t.length;r++)null==t[r]?e++:t[r-e]=t[r];return t.length-=e,t}aT.extension={type:[u.WebGLSystem,u.WebGPUSystem,u.CanvasSystem],name:"hello",priority:-2},aT.defaultOptions={hello:!1};var uT=Object.defineProperty,cT=Object.getOwnPropertySymbols,dT=Object.prototype.hasOwnProperty,pT=Object.prototype.propertyIsEnumerable,fT=(t,e,r)=>e in t?uT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,gT=(t,e)=>{for(var r in e||(e={}))dT.call(e,r)&&fT(t,r,e[r]);if(cT)for(var r of cT(e))pT.call(e,r)&&fT(t,r,e[r]);return t};let mT=0;const _T=class t{constructor(t){this._managedRenderables=[],this._managedHashes=[],this._managedArrays=[],this._renderer=t}init(e){e=gT(gT({},t.defaultOptions),e),this.maxUnusedTime=e.renderableGCMaxUnusedTime,this._frequency=e.renderableGCFrequency,this.enabled=e.renderableGCActive}get enabled(){return!!this._handler}set enabled(t){this.enabled!==t&&(t?(this._handler=this._renderer.scheduler.repeat((()=>this.run()),this._frequency,!1),this._hashHandler=this._renderer.scheduler.repeat((()=>{for(const t of this._managedHashes)t.context[t.hash]=lT(t.context[t.hash])}),this._frequency),this._arrayHandler=this._renderer.scheduler.repeat((()=>{for(const t of this._managedArrays)hT(t.context[t.hash])}),this._frequency)):(this._renderer.scheduler.cancel(this._handler),this._renderer.scheduler.cancel(this._hashHandler),this._renderer.scheduler.cancel(this._arrayHandler)))}addManagedHash(t,e){this._managedHashes.push({context:t,hash:e})}addManagedArray(t,e){this._managedArrays.push({context:t,hash:e})}prerender({container:t}){this._now=performance.now(),t.renderGroup.gcTick=mT++,this._updateInstructionGCTick(t.renderGroup,t.renderGroup.gcTick)}addRenderable(t){this.enabled&&(-1===t._lastUsed&&(this._managedRenderables.push(t),t.once("destroyed",this._removeRenderable,this)),t._lastUsed=this._now)}run(){var t,e,r,i;const s=this._now,n=this._managedRenderables,o=this._renderer.renderPipes;let a=0;for(let l=0;l<n.length;l++){const h=n[l];if(null===h){a++;continue}const u=null!=(t=h.renderGroup)?t:h.parentRenderGroup,c=null!=(r=null==(e=null==u?void 0:u.instructionSet)?void 0:e.gcTick)?r:-1;if((null!=(i=null==u?void 0:u.gcTick)?i:0)===c&&(h._lastUsed=s),s-h._lastUsed>this.maxUnusedTime){if(!h.destroyed){const t=o;u&&(u.structureDidChange=!0),t[h.renderPipeId].destroyRenderable(h)}h._lastUsed=-1,a++,h.off("destroyed",this._removeRenderable,this)}else n[l-a]=h}n.length-=a}destroy(){this.enabled=!1,this._renderer=null,this._managedRenderables.length=0,this._managedHashes.length=0,this._managedArrays.length=0}_removeRenderable(t){const e=this._managedRenderables.indexOf(t);e>=0&&(t.off("destroyed",this._removeRenderable,this),this._managedRenderables[e]=null)}_updateInstructionGCTick(t,e){t.instructionSet.gcTick=e;for(const r of t.renderGroupChildren)this._updateInstructionGCTick(r,e)}};_T.extension={type:[u.WebGLSystem,u.WebGPUSystem],name:"renderableGC",priority:0},_T.defaultOptions={renderableGCActive:!0,renderableGCMaxUnusedTime:6e4,renderableGCFrequency:3e4};let xT=_T;var yT=Object.defineProperty,bT=Object.getOwnPropertySymbols,vT=Object.prototype.hasOwnProperty,TT=Object.prototype.propertyIsEnumerable,ST=(t,e,r)=>e in t?yT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,wT=(t,e)=>{for(var r in e||(e={}))vT.call(e,r)&&ST(t,r,e[r]);if(bT)for(var r of bT(e))TT.call(e,r)&&ST(t,r,e[r]);return t};const ET=class t{constructor(t){this._renderer=t,this.count=0,this.checkCount=0}init(e){var r;e=wT(wT({},t.defaultOptions),e),this.checkCountMax=e.textureGCCheckCountMax,this.maxIdle=null!=(r=e.textureGCAMaxIdle)?r:e.textureGCMaxIdle,this.active=e.textureGCActive}postrender(){this._renderer.renderingToScreen&&(this.count++,this.active&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this._renderer.texture.managedTextures;for(let e=0;e<t.length;e++){const r=t[e];r.autoGarbageCollect&&r.resource&&r._touched>-1&&this.count-r._touched>this.maxIdle&&(r._touched=-1,r.unload())}}destroy(){this._renderer=null}};ET.extension={type:[u.WebGLSystem,u.WebGPUSystem],name:"textureGC"},ET.defaultOptions={textureGCActive:!0,textureGCAMaxIdle:null,textureGCMaxIdle:3600,textureGCCheckCountMax:600};let AT=ET;var PT=Object.defineProperty,MT=Object.getOwnPropertySymbols,RT=Object.prototype.hasOwnProperty,CT=Object.prototype.propertyIsEnumerable,OT=(t,e,r)=>e in t?PT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,IT=(t,e)=>{for(var r in e||(e={}))RT.call(e,r)&&OT(t,r,e[r]);if(MT)for(var r of MT(e))CT.call(e,r)&&OT(t,r,e[r]);return t};const BT=class t{get autoDensity(){return this.texture.source.autoDensity}set autoDensity(t){this.texture.source.autoDensity=t}get resolution(){return this.texture.source._resolution}set resolution(t){this.texture.source.resize(this.texture.source.width,this.texture.source.height,t)}init(e){(e=IT(IT({},t.defaultOptions),e)).view&&(e.canvas=e.view),this.screen=new Rt(0,0,e.width,e.height),this.canvas=e.canvas||ri.get().createCanvas(),this.antialias=!!e.antialias,this.texture=eb(this.canvas,e),this.renderTarget=new ub({colorTextures:[this.texture],depth:!!e.depth,isRoot:!0}),this.texture.source.transparent=e.backgroundAlpha<1,this.resolution=e.resolution}resize(t,e,r){this.texture.source.resize(t,e,r),this.screen.width=this.texture.frame.width,this.screen.height=this.texture.frame.height}destroy(t=!1){("boolean"==typeof t?t:null!=t&&t.removeView)&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}};BT.extension={type:[u.WebGLSystem,u.WebGPUSystem,u.CanvasSystem],name:"view",priority:0},BT.defaultOptions={width:800,height:600,autoDensity:!1,antialias:!1};let kT=BT;const GT=[Iv,rT,aT,kT,Sv,AT,eT,Hv,ap,xT,sT],DT=[kv,Fx,wv,fv,Xx,jx,Hx,cv],FT=[...GT,Vy,Ty,sy,$x,lv,db,py,Gb,Ob,wy,Ub,Py,Sy],NT=[...DT],UT=[Bx,uv,hv],LT=[],zT=[],XT=[];p.handleByNamedList(u.WebGLSystem,LT),p.handleByNamedList(u.WebGLPipes,zT),p.handleByNamedList(u.WebGLPipesAdaptor,XT),p.add(...FT,...NT,...UT);class HT extends Yd{constructor(){super({name:"webgl",type:Eo.WEBGL,systems:LT,renderPipes:zT,renderPipeAdaptors:XT})}}var jT={__proto__:null,WebGLRenderer:HT};class VT{constructor(t){this._hash=Object.create(null),this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_hash")}contextChange(t){this._gpu=t}getBindGroup(t,e,r){return t._updateKey(),this._hash[t._key]||this._createBindGroup(t,e,r)}_createBindGroup(t,e,r){var i;const s=this._gpu.device,n=e.layout[r],o=[],a=this._renderer;for(const e in n){const r=null!=(i=t.resources[e])?i:t.resources[n[e]];let s;if("uniformGroup"===r._resourceType){const t=r;a.ubo.updateUniformGroup(t);const e=t.buffer;s={buffer:a.buffer.getGPUBuffer(e),offset:0,size:e.descriptor.size}}else if("buffer"===r._resourceType){const t=r;s={buffer:a.buffer.getGPUBuffer(t),offset:0,size:t.descriptor.size}}else if("bufferResource"===r._resourceType){const t=r;s={buffer:a.buffer.getGPUBuffer(t.buffer),offset:t.offset,size:t.size}}else if("textureSampler"===r._resourceType){const t=r;s=a.texture.getGpuSampler(t)}else if("textureSource"===r._resourceType){const t=r;s=a.texture.getGpuSource(t).createView({})}o.push({binding:n[e],resource:s})}const l=a.shader.getProgramData(e).bindGroups[r],h=s.createBindGroup({layout:l,entries:o});return this._hash[t._key]=h,h}destroy(){for(const t of Object.keys(this._hash))this._hash[t]=null;this._hash=null,this._renderer=null}}VT.extension={type:[u.WebGPUSystem],name:"bindGroup"};class WT{constructor(t){this._gpuBuffers=Object.create(null),this._managedBuffers=[],t.renderableGC.addManagedHash(this,"_gpuBuffers")}contextChange(t){this._gpu=t}getGPUBuffer(t){return this._gpuBuffers[t.uid]||this.createGPUBuffer(t)}updateBuffer(t){const e=this._gpuBuffers[t.uid]||this.createGPUBuffer(t),r=t.data;return t._updateID&&r&&(t._updateID=0,this._gpu.device.queue.writeBuffer(e,0,r.buffer,0,(t._updateSize||r.byteLength)+3&-4)),e}destroyAll(){for(const t in this._gpuBuffers)this._gpuBuffers[t].destroy();this._gpuBuffers={}}createGPUBuffer(t){this._gpuBuffers[t.uid]||(t.on("update",this.updateBuffer,this),t.on("change",this.onBufferChange,this),t.on("destroy",this.onBufferDestroy,this),this._managedBuffers.push(t));const e=this._gpu.device.createBuffer(t.descriptor);return t._updateID=0,t.data&&(xs(t.data.buffer,e.getMappedRange()),e.unmap()),this._gpuBuffers[t.uid]=e,e}onBufferChange(t){this._gpuBuffers[t.uid].destroy(),t._updateID=0,this._gpuBuffers[t.uid]=this.createGPUBuffer(t)}onBufferDestroy(t){this._managedBuffers.splice(this._managedBuffers.indexOf(t),1),this._destroyBuffer(t)}destroy(){this._managedBuffers.forEach((t=>this._destroyBuffer(t))),this._managedBuffers=null,this._gpuBuffers=null}_destroyBuffer(t){this._gpuBuffers[t.uid].destroy(),t.off("update",this.updateBuffer,this),t.off("change",this.onBufferChange,this),t.off("destroy",this.onBufferDestroy,this),this._gpuBuffers[t.uid]=null}}WT.extension={type:[u.WebGPUSystem],name:"buffer"};class $T{constructor({minUniformOffsetAlignment:t}){this._minUniformOffsetAlignment=256,this.byteIndex=0,this._minUniformOffsetAlignment=t,this.data=new Float32Array(65535)}clear(){this.byteIndex=0}addEmptyGroup(t){if(t>this._minUniformOffsetAlignment/4)throw new Error("UniformBufferBatch: array is too large: "+4*t);const e=this.byteIndex;let r=e+4*t;if(r=Math.ceil(r/this._minUniformOffsetAlignment)*this._minUniformOffsetAlignment,r>4*this.data.length)throw new Error("UniformBufferBatch: ubo batch got too big");return this.byteIndex=r,e}addGroup(t){const e=this.addEmptyGroup(t.length);for(let r=0;r<t.length;r++)this.data[e/4+r]=t[r];return e}destroy(){this.data=null}}class YT{constructor(t){this._colorMaskCache=15,this._renderer=t}setMask(t){this._colorMaskCache!==t&&(this._colorMaskCache=t,this._renderer.pipeline.setColorMask(t))}destroy(){this._renderer=null,this._colorMaskCache=null}}YT.extension={type:[u.WebGPUSystem],name:"colorMask"};class qT{constructor(t){this._renderer=t}async init(t){return this._initPromise||(this._initPromise=this._createDeviceAndAdaptor(t).then((t=>{this.gpu=t,this._renderer.runners.contextChange.emit(this.gpu)}))),this._initPromise}contextChange(t){this._renderer.gpu=t}async _createDeviceAndAdaptor(t){const e=await ri.get().getNavigator().gpu.requestAdapter({powerPreference:t.powerPreference,forceFallbackAdapter:t.forceFallbackAdapter}),r=["texture-compression-bc","texture-compression-astc","texture-compression-etc2"].filter((t=>e.features.has(t))),i=await e.requestDevice({requiredFeatures:r});return{adapter:e,device:i}}destroy(){this.gpu=null,this._renderer=null}}qT.extension={type:[u.WebGPUSystem],name:"device"},qT.defaultOptions={powerPreference:void 0,forceFallbackAdapter:!1};var KT=Object.defineProperty,QT=Object.getOwnPropertySymbols,ZT=Object.prototype.hasOwnProperty,JT=Object.prototype.propertyIsEnumerable,tS=(t,e,r)=>e in t?KT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,eS=(t,e)=>{for(var r in e||(e={}))ZT.call(e,r)&&tS(t,r,e[r]);if(QT)for(var r of QT(e))JT.call(e,r)&&tS(t,r,e[r]);return t};class rS{constructor(t){this._boundBindGroup=Object.create(null),this._boundVertexBuffer=Object.create(null),this._renderer=t}renderStart(){this.commandFinished=new Promise((t=>{this._resolveCommandFinished=t})),this.commandEncoder=this._renderer.gpu.device.createCommandEncoder()}beginRenderPass(t){this.endRenderPass(),this._clearCache(),this.renderPassEncoder=this.commandEncoder.beginRenderPass(t.descriptor)}endRenderPass(){this.renderPassEncoder&&this.renderPassEncoder.end(),this.renderPassEncoder=null}setViewport(t){this.renderPassEncoder.setViewport(t.x,t.y,t.width,t.height,0,1)}setPipelineFromGeometryProgramAndState(t,e,r,i){const s=this._renderer.pipeline.getPipeline(t,e,r,i);this.setPipeline(s)}setPipeline(t){this._boundPipeline!==t&&(this._boundPipeline=t,this.renderPassEncoder.setPipeline(t))}_setVertexBuffer(t,e){this._boundVertexBuffer[t]!==e&&(this._boundVertexBuffer[t]=e,this.renderPassEncoder.setVertexBuffer(t,this._renderer.buffer.updateBuffer(e)))}_setIndexBuffer(t){if(this._boundIndexBuffer===t)return;this._boundIndexBuffer=t;const e=2===t.data.BYTES_PER_ELEMENT?"uint16":"uint32";this.renderPassEncoder.setIndexBuffer(this._renderer.buffer.updateBuffer(t),e)}resetBindGroup(t){this._boundBindGroup[t]=null}setBindGroup(t,e,r){if(this._boundBindGroup[t]===e)return;this._boundBindGroup[t]=e,e._touch(this._renderer.textureGC.count);const i=this._renderer.bindGroup.getBindGroup(e,r,t);this.renderPassEncoder.setBindGroup(t,i)}setGeometry(t,e){const r=this._renderer.pipeline.getBufferNamesToBind(t,e);for(const e in r)this._setVertexBuffer(e,t.attributes[r[e]].buffer);t.indexBuffer&&this._setIndexBuffer(t.indexBuffer)}_setShaderBindGroups(t,e){for(const r in t.groups){const i=t.groups[r];e||this._syncBindGroup(i),this.setBindGroup(r,i,t.gpuProgram)}}_syncBindGroup(t){for(const e in t.resources){const r=t.resources[e];r.isUniformGroup&&this._renderer.ubo.updateUniformGroup(r)}}draw(t){const{geometry:e,shader:r,state:i,topology:s,size:n,start:o,instanceCount:a,skipSync:l}=t;this.setPipelineFromGeometryProgramAndState(e,r.gpuProgram,i,s),this.setGeometry(e,r.gpuProgram),this._setShaderBindGroups(r,l),e.indexBuffer?this.renderPassEncoder.drawIndexed(n||e.indexBuffer.data.length,null!=a?a:e.instanceCount,o||0):this.renderPassEncoder.draw(n||e.getSize(),null!=a?a:e.instanceCount,o||0)}finishRenderPass(){this.renderPassEncoder&&(this.renderPassEncoder.end(),this.renderPassEncoder=null)}postrender(){this.finishRenderPass(),this._gpu.device.queue.submit([this.commandEncoder.finish()]),this._resolveCommandFinished(),this.commandEncoder=null}restoreRenderPass(){const t=this._renderer.renderTarget.adaptor.getDescriptor(this._renderer.renderTarget.renderTarget,!1,[0,0,0,1]);this.renderPassEncoder=this.commandEncoder.beginRenderPass(t);const e=this._boundPipeline,r=eS({},this._boundVertexBuffer),i=this._boundIndexBuffer,s=eS({},this._boundBindGroup);this._clearCache();const n=this._renderer.renderTarget.viewport;this.renderPassEncoder.setViewport(n.x,n.y,n.width,n.height,0,1),this.setPipeline(e);for(const t in r)this._setVertexBuffer(t,r[t]);for(const t in s)this.setBindGroup(t,s[t],null);this._setIndexBuffer(i)}_clearCache(){for(let t=0;t<16;t++)this._boundBindGroup[t]=null,this._boundVertexBuffer[t]=null;this._boundIndexBuffer=null,this._boundPipeline=null}destroy(){this._renderer=null,this._gpu=null,this._boundBindGroup=null,this._boundVertexBuffer=null,this._boundIndexBuffer=null,this._boundPipeline=null}contextChange(t){this._gpu=t}}rS.extension={type:[u.WebGPUSystem],name:"encoder",priority:1};class iS{constructor(t){this._renderTargetStencilState=Object.create(null),this._renderer=t,t.renderTarget.onRenderTargetChange.add(this)}onRenderTargetChange(t){let e=this._renderTargetStencilState[t.uid];e||(e=this._renderTargetStencilState[t.uid]={stencilMode:bs.DISABLED,stencilReference:0}),this._activeRenderTarget=t,this.setStencilMode(e.stencilMode,e.stencilReference)}setStencilMode(t,e){const r=this._renderTargetStencilState[this._activeRenderTarget.uid];r.stencilMode=t,r.stencilReference=e;const i=this._renderer;i.pipeline.setStencilMode(t),i.encoder.renderPassEncoder.setStencilReference(e)}destroy(){this._renderer.renderTarget.onRenderTargetChange.remove(this),this._renderer=null,this._activeRenderTarget=null,this._renderTargetStencilState=null}}iS.extension={type:[u.WebGPUSystem],name:"stencil"};const sS={i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},f16:{align:2,size:2},"vec2<i32>":{align:8,size:8},"vec2<u32>":{align:8,size:8},"vec2<f32>":{align:8,size:8},"vec2<f16>":{align:4,size:4},"vec3<i32>":{align:16,size:12},"vec3<u32>":{align:16,size:12},"vec3<f32>":{align:16,size:12},"vec3<f16>":{align:8,size:6},"vec4<i32>":{align:16,size:16},"vec4<u32>":{align:16,size:16},"vec4<f32>":{align:16,size:16},"vec4<f16>":{align:8,size:8},"mat2x2<f32>":{align:8,size:16},"mat2x2<f16>":{align:4,size:8},"mat3x2<f32>":{align:8,size:24},"mat3x2<f16>":{align:4,size:12},"mat4x2<f32>":{align:8,size:32},"mat4x2<f16>":{align:4,size:16},"mat2x3<f32>":{align:16,size:32},"mat2x3<f16>":{align:8,size:16},"mat3x3<f32>":{align:16,size:48},"mat3x3<f16>":{align:8,size:24},"mat4x3<f32>":{align:16,size:64},"mat4x3<f16>":{align:8,size:32},"mat2x4<f32>":{align:16,size:32},"mat2x4<f16>":{align:8,size:16},"mat3x4<f32>":{align:16,size:48},"mat3x4<f16>":{align:8,size:24},"mat4x4<f32>":{align:16,size:64},"mat4x4<f16>":{align:8,size:32}};function nS(t){const e=t.map((t=>({data:t,offset:0,size:0})));let r=0;for(let t=0;t<e.length;t++){const i=e[t];let s=sS[i.data.type].size;const n=sS[i.data.type].align;if(!sS[i.data.type])throw new Error(`[Pixi.js] WebGPU UniformBuffer: Unknown type ${i.data.type}`);i.data.size>1&&(s=Math.max(s,n)*i.data.size),r=Math.ceil(r/n)*n,i.size=s,i.offset=r,r+=s}return r=16*Math.ceil(r/16),{uboElements:e,size:r}}function oS(t,e){const{size:r,align:i}=sS[t.data.type],s=(i-r)/4,n=t.data.type.indexOf("i32")>=0?"dataInt32":"data";return`\n         v = uv.${t.data.name};\n         ${0!==e?`offset += ${e};`:""}\n\n         arrayOffset = offset;\n\n         t = 0;\n\n         for(var i=0; i < ${t.data.size*(r/4)}; i++)\n         {\n             for(var j = 0; j < ${r/4}; j++)\n             {\n                 ${n}[arrayOffset++] = v[t++];\n             }\n             ${0!==s?`arrayOffset += ${s};`:""}\n         }\n     `}function aS(t){return Iy(t,"uboWgsl",oS,Xy)}class lS extends My{constructor(){super({createUboElements:nS,generateUboSync:aS})}}lS.extension={type:[u.WebGPUSystem],name:"ubo"};const hS=128;class uS{constructor(t){this._bindGroupHash=Object.create(null),this._buffers=[],this._bindGroups=[],this._bufferResources=[],this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_bindGroupHash"),this._batchBuffer=new $T({minUniformOffsetAlignment:hS});for(let t=0;t<2;t++){let e=Fs.UNIFORM|Fs.COPY_DST;0===t&&(e|=Fs.COPY_SRC),this._buffers.push(new Ns({data:this._batchBuffer.data,usage:e}))}}renderEnd(){this._uploadBindGroups(),this._resetBindGroups()}_resetBindGroups(){for(const t in this._bindGroupHash)this._bindGroupHash[t]=null;this._batchBuffer.clear()}getUniformBindGroup(t,e){if(!e&&this._bindGroupHash[t.uid])return this._bindGroupHash[t.uid];this._renderer.ubo.ensureUniformGroup(t);const r=t.buffer.data,i=this._batchBuffer.addEmptyGroup(r.length);return this._renderer.ubo.syncUniformGroup(t,this._batchBuffer.data,i/4),this._bindGroupHash[t.uid]=this._getBindGroup(i/hS),this._bindGroupHash[t.uid]}getUboResource(t){this._renderer.ubo.updateUniformGroup(t);const e=t.buffer.data,r=this._batchBuffer.addGroup(e);return this._getBufferResource(r/hS)}getArrayBindGroup(t){const e=this._batchBuffer.addGroup(t);return this._getBindGroup(e/hS)}getArrayBufferResource(t){const e=this._batchBuffer.addGroup(t)/hS;return this._getBufferResource(e)}_getBufferResource(t){if(!this._bufferResources[t]){const e=this._buffers[t%2];this._bufferResources[t]=new pb({buffer:e,offset:256*(t/2|0),size:hS})}return this._bufferResources[t]}_getBindGroup(t){if(!this._bindGroups[t]){const e=new os({0:this._getBufferResource(t)});this._bindGroups[t]=e}return this._bindGroups[t]}_uploadBindGroups(){const t=this._renderer.buffer,e=this._buffers[0];e.update(this._batchBuffer.byteIndex),t.updateBuffer(e);const r=this._renderer.gpu.device.createCommandEncoder();for(let i=1;i<this._buffers.length;i++){const s=this._buffers[i];r.copyBufferToBuffer(t.getGPUBuffer(e),hS,t.getGPUBuffer(s),0,this._batchBuffer.byteIndex)}this._renderer.gpu.device.queue.submit([r.finish()])}destroy(){for(let t=0;t<this._bindGroups.length;t++)this._bindGroups[t].destroy();this._bindGroups=null,this._bindGroupHash=null;for(let t=0;t<this._buffers.length;t++)this._buffers[t].destroy();this._buffers=null;for(let t=0;t<this._bufferResources.length;t++)this._bufferResources[t].destroy();this._bufferResources=null,this._batchBuffer.destroy(),this._bindGroupHash=null,this._renderer=null}}uS.extension={type:[u.WebGPUPipes],name:"uniformBatch"};var cS=Object.defineProperty,dS=Object.defineProperties,pS=Object.getOwnPropertyDescriptors,fS=Object.getOwnPropertySymbols,gS=Object.prototype.hasOwnProperty,mS=Object.prototype.propertyIsEnumerable,_S=(t,e,r)=>e in t?cS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;const xS={"point-list":0,"line-list":1,"line-strip":2,"triangle-list":3,"triangle-strip":4};class yS{constructor(t){this._moduleCache=Object.create(null),this._bufferLayoutsCache=Object.create(null),this._bindingNamesCache=Object.create(null),this._pipeCache=Object.create(null),this._pipeStateCaches=Object.create(null),this._colorMask=15,this._multisampleCount=1,this._renderer=t}contextChange(t){this._gpu=t,this.setStencilMode(bs.DISABLED),this._updatePipeHash()}setMultisampleCount(t){this._multisampleCount!==t&&(this._multisampleCount=t,this._updatePipeHash())}setRenderTarget(t){this._multisampleCount=t.msaaSamples,this._depthStencilAttachment=t.descriptor.depthStencilAttachment?1:0,this._updatePipeHash()}setColorMask(t){this._colorMask!==t&&(this._colorMask=t,this._updatePipeHash())}setStencilMode(t){this._stencilMode!==t&&(this._stencilMode=t,this._stencilState=Ay[t],this._updatePipeHash())}setPipeline(t,e,r,i){const s=this.getPipeline(t,e,r);i.setPipeline(s)}getPipeline(t,e,r,i){t._layoutKey||(ny(t,e.attributeData),this._generateBufferKey(t)),i||(i=t.topology);const s=function(t,e,r,i,s){return t<<24|e<<16|r<<10|i<<5|s}(t._layoutKey,e._layoutKey,r.data,r._blendModeId,xS[i]);return this._pipeCache[s]||(this._pipeCache[s]=this._createPipeline(t,e,r,i)),this._pipeCache[s]}_createPipeline(t,e,r,i){const s=this._gpu.device,n=this._createVertexBufferLayouts(t,e),o=this._renderer.state.getColorTargets(r);o[0].writeMask=this._stencilMode===bs.RENDERING_MASK_ADD?0:this._colorMask;const a=this._renderer.shader.getProgramData(e).pipeline,l={vertex:{module:this._getModule(e.vertex.source),entryPoint:e.vertex.entryPoint,buffers:n},fragment:{module:this._getModule(e.fragment.source),entryPoint:e.fragment.entryPoint,targets:o},primitive:{topology:i,cullMode:r.cullMode},layout:a,multisample:{count:this._multisampleCount},label:"PIXI Pipeline"};return this._depthStencilAttachment&&(l.depthStencil=((t,e)=>dS(t,pS(e)))(((t,e)=>{for(var r in e||(e={}))gS.call(e,r)&&_S(t,r,e[r]);if(fS)for(var r of fS(e))mS.call(e,r)&&_S(t,r,e[r]);return t})({},this._stencilState),{format:"depth24plus-stencil8",depthWriteEnabled:r.depthTest,depthCompare:r.depthTest?"less":"always"})),s.createRenderPipeline(l)}_getModule(t){return this._moduleCache[t]||this._createModule(t)}_createModule(t){const e=this._gpu.device;return this._moduleCache[t]=e.createShaderModule({code:t}),this._moduleCache[t]}_generateBufferKey(t){const e=[];let r=0;const i=Object.keys(t.attributes).sort();for(let s=0;s<i.length;s++){const n=t.attributes[i[s]];e[r++]=n.offset,e[r++]=n.format,e[r++]=n.stride,e[r++]=n.instance}const s=e.join("|");return t._layoutKey=$s(s,"geometry"),t._layoutKey}_generateAttributeLocationsKey(t){const e=[];let r=0;const i=Object.keys(t.attributeData).sort();for(let s=0;s<i.length;s++){const n=t.attributeData[i[s]];e[r++]=n.location}const s=e.join("|");return t._attributeLocationsKey=$s(s,"programAttributes"),t._attributeLocationsKey}getBufferNamesToBind(t,e){const r=t._layoutKey<<16|e._attributeLocationsKey;if(this._bindingNamesCache[r])return this._bindingNamesCache[r];const i=this._createVertexBufferLayouts(t,e),s=Object.create(null),n=e.attributeData;for(let t=0;t<i.length;t++){const e=Object.values(i[t].attributes)[0].shaderLocation;for(const r in n)if(n[r].location===e){s[t]=r;break}}return this._bindingNamesCache[r]=s,s}_createVertexBufferLayouts(t,e){e._attributeLocationsKey||this._generateAttributeLocationsKey(e);const r=t._layoutKey<<16|e._attributeLocationsKey;if(this._bufferLayoutsCache[r])return this._bufferLayoutsCache[r];const i=[];return t.buffers.forEach((r=>{var s;const n={arrayStride:0,stepMode:"vertex",attributes:[]},o=n.attributes;for(const i in e.attributeData){const a=t.attributes[i];1!==(null!=(s=a.divisor)?s:1)&&_h(`Attribute ${i} has an invalid divisor value of '${a.divisor}'. WebGPU only supports a divisor value of 1`),a.buffer===r&&(n.arrayStride=a.stride,n.stepMode=a.instance?"instance":"vertex",o.push({shaderLocation:e.attributeData[i].location,offset:a.offset,format:a.format}))}o.length&&i.push(n)})),this._bufferLayoutsCache[r]=i,i}_updatePipeHash(){const t=function(t,e,r,i){return r<<6|t<<3|i<<1|e}(this._stencilMode,this._multisampleCount,this._colorMask,this._depthStencilAttachment);this._pipeStateCaches[t]||(this._pipeStateCaches[t]=Object.create(null)),this._pipeCache=this._pipeStateCaches[t]}destroy(){this._renderer=null,this._bufferLayoutsCache=null}}yS.extension={type:[u.WebGPUSystem],name:"pipeline"};class bS{constructor(){this.contexts=[],this.msaaTextures=[],this.msaaSamples=1}}class vS{init(t,e){this._renderer=t,this._renderTargetSystem=e}copyToTexture(t,e,r,i,s){const n=this._renderer,o=this._getGpuColorTexture(t),a=n.texture.getGpuSource(e.source);return n.encoder.commandEncoder.copyTextureToTexture({texture:o,origin:r},{texture:a,origin:s},i),e}startRenderPass(t,e=!0,r,i){const s=this._renderTargetSystem.getGpuRenderTarget(t),n=this.getDescriptor(t,e,r);s.descriptor=n,this._renderer.pipeline.setRenderTarget(s),this._renderer.encoder.beginRenderPass(s),this._renderer.encoder.setViewport(i)}finishRenderPass(){this._renderer.encoder.endRenderPass()}_getGpuColorTexture(t){const e=this._renderTargetSystem.getGpuRenderTarget(t);return e.contexts[0]?e.contexts[0].getCurrentTexture():this._renderer.texture.getGpuSource(t.colorTextures[0].source)}getDescriptor(t,e,r){"boolean"==typeof e&&(e=e?Dd.ALL:Dd.NONE);const i=this._renderTargetSystem,s=i.getGpuRenderTarget(t),n=t.colorTextures.map(((t,n)=>{const o=s.contexts[n];let a,l;a=o?o.getCurrentTexture().createView():this._renderer.texture.getGpuSource(t).createView({mipLevelCount:1}),s.msaaTextures[n]&&(l=a,a=this._renderer.texture.getTextureView(s.msaaTextures[n]));const h=e&Dd.COLOR?"clear":"load";return null!=r||(r=i.defaultClearColor),{view:a,resolveTarget:l,clearValue:r,storeOp:"store",loadOp:h}}));let o;if((t.stencil||t.depth)&&!t.depthStencilTexture&&(t.ensureDepthStencilTexture(),t.depthStencilTexture.source.sampleCount=s.msaa?4:1),t.depthStencilTexture){const r=e&Dd.STENCIL?"clear":"load",i=e&Dd.DEPTH?"clear":"load";o={view:this._renderer.texture.getGpuSource(t.depthStencilTexture.source).createView(),stencilStoreOp:"store",stencilLoadOp:r,depthClearValue:1,depthLoadOp:i,depthStoreOp:"store"}}return{colorAttachments:n,depthStencilAttachment:o}}clear(t,e=!0,r,i){if(!e)return;const{gpu:s,encoder:n}=this._renderer,o=s.device;if(null===n.commandEncoder){const s=o.createCommandEncoder(),n=this.getDescriptor(t,e,r),a=s.beginRenderPass(n);a.setViewport(i.x,i.y,i.width,i.height,0,1),a.end();const l=s.finish();o.queue.submit([l])}else this.startRenderPass(t,e,r,i)}initGpuRenderTarget(t){t.isRoot=!0;const e=new bS;return t.colorTextures.forEach(((t,r)=>{if(zi.test(t.resource)){const i=t.resource.getContext("webgpu"),s=t.transparent?"premultiplied":"opaque";try{i.configure({device:this._renderer.gpu.device,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,format:"bgra8unorm",alphaMode:s})}catch(t){console.error(t)}e.contexts[r]=i}if(e.msaa=t.source.antialias,t.source.antialias){const t=new ye({width:0,height:0,sampleCount:4});e.msaaTextures[r]=t}})),e.msaa&&(e.msaaSamples=4,t.depthStencilTexture&&(t.depthStencilTexture.source.sampleCount=4)),e}destroyGpuRenderTarget(t){t.contexts.forEach((t=>{t.unconfigure()})),t.msaaTextures.forEach((t=>{t.destroy()})),t.msaaTextures.length=0,t.contexts.length=0}ensureDepthStencilTexture(t){const e=this._renderTargetSystem.getGpuRenderTarget(t);t.depthStencilTexture&&e.msaa&&(t.depthStencilTexture.source.sampleCount=4)}resizeGpuRenderTarget(t){const e=this._renderTargetSystem.getGpuRenderTarget(t);e.width=t.width,e.height=t.height,e.msaa&&t.colorTextures.forEach(((t,r)=>{const i=e.msaaTextures[r];null==i||i.resize(t.source.width,t.source.height,t.source._resolution)}))}}class TS extends cb{constructor(t){super(t),this.adaptor=new vS,this.adaptor.init(t,this)}}TS.extension={type:[u.WebGPUSystem],name:"renderTarget"};class SS{constructor(){this._gpuProgramData=Object.create(null)}contextChange(t){this._gpu=t,this.maxTextures=t.device.limits.maxSampledTexturesPerShaderStage}getProgramData(t){return this._gpuProgramData[t._layoutKey]||this._createGPUProgramData(t)}_createGPUProgramData(t){const e=this._gpu.device,r=t.gpuLayout.map((t=>e.createBindGroupLayout({entries:t}))),i={bindGroupLayouts:r};return this._gpuProgramData[t._layoutKey]={bindGroups:r,pipeline:e.createPipelineLayout(i)},this._gpuProgramData[t._layoutKey]}destroy(){this._gpu=null,this._gpuProgramData=null}}SS.extension={type:[u.WebGPUSystem],name:"shader"};const wS={normal:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"}},add:{alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one",operation:"add"}},multiply:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"dst",dstFactor:"one-minus-src-alpha",operation:"add"}},screen:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src",operation:"add"}},overlay:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src",operation:"add"}},none:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"zero",dstFactor:"zero",operation:"add"}},"normal-npm":{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"}},"add-npm":{alpha:{srcFactor:"one",dstFactor:"one",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one",operation:"add"}},"screen-npm":{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src",operation:"add"}},erase:{alpha:{srcFactor:"zero",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"zero",dstFactor:"one-minus-src",operation:"add"}},min:{alpha:{srcFactor:"one",dstFactor:"one",operation:"min"},color:{srcFactor:"one",dstFactor:"one",operation:"min"}},max:{alpha:{srcFactor:"one",dstFactor:"one",operation:"max"},color:{srcFactor:"one",dstFactor:"one",operation:"max"}}};class ES{constructor(){this.defaultState=new tl,this.defaultState.blend=!0}contextChange(t){this.gpu=t}getColorTargets(t){return[{format:"bgra8unorm",writeMask:0,blend:wS[t.blendMode]||wS.normal}]}destroy(){this.gpu=null}}ES.extension={type:[u.WebGPUSystem],name:"state"};const AS={type:"image",upload(t,e,r){const i=t.resource,s=(0|t.pixelWidth)*(0|t.pixelHeight),n=i.byteLength/s;r.device.queue.writeTexture({texture:e},i,{offset:0,rowsPerImage:t.pixelHeight,bytesPerRow:t.pixelHeight*n},{width:t.pixelWidth,height:t.pixelHeight,depthOrArrayLayers:1})}},PS={"bc1-rgba-unorm":{blockBytes:8,blockWidth:4,blockHeight:4},"bc2-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"bc3-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"bc7-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"etc1-rgb-unorm":{blockBytes:8,blockWidth:4,blockHeight:4},"etc2-rgba8unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"astc-4x4-unorm":{blockBytes:16,blockWidth:4,blockHeight:4}},MS={blockBytes:4,blockWidth:1,blockHeight:1},RS={type:"compressed",upload(t,e,r){let i=t.pixelWidth,s=t.pixelHeight;const n=PS[t.format]||MS;for(let o=0;o<t.resource.length;o++){const a=t.resource[o],l=Math.ceil(i/n.blockWidth)*n.blockBytes;r.device.queue.writeTexture({texture:e,mipLevel:o},a,{offset:0,bytesPerRow:l},{width:Math.ceil(i/n.blockWidth)*n.blockWidth,height:Math.ceil(s/n.blockHeight)*n.blockHeight,depthOrArrayLayers:1}),i=Math.max(i>>1,1),s=Math.max(s>>1,1)}}},CS={type:"image",upload(t,e,r){const i=t.resource;if(!i)return;const s=Math.min(e.width,t.resourceWidth||t.pixelWidth),n=Math.min(e.height,t.resourceHeight||t.pixelHeight),o="premultiply-alpha-on-upload"===t.alphaMode;r.device.queue.copyExternalImageToTexture({source:i},{texture:e,premultipliedAlpha:o},{width:s,height:n})}},OS={type:"video",upload(t,e,r){CS.upload(t,e,r)}};class IS{constructor(t){this.device=t,this.sampler=t.createSampler({minFilter:"linear"}),this.pipelines={}}_getMipmapPipeline(t){let e=this.pipelines[t];return e||(this.mipmapShaderModule||(this.mipmapShaderModule=this.device.createShaderModule({code:"\n                        var<private> pos : array<vec2<f32>, 3> = array<vec2<f32>, 3>(\n                        vec2<f32>(-1.0, -1.0), vec2<f32>(-1.0, 3.0), vec2<f32>(3.0, -1.0));\n\n                        struct VertexOutput {\n                        @builtin(position) position : vec4<f32>,\n                        @location(0) texCoord : vec2<f32>,\n                        };\n\n                        @vertex\n                        fn vertexMain(@builtin(vertex_index) vertexIndex : u32) -> VertexOutput {\n                        var output : VertexOutput;\n                        output.texCoord = pos[vertexIndex] * vec2<f32>(0.5, -0.5) + vec2<f32>(0.5);\n                        output.position = vec4<f32>(pos[vertexIndex], 0.0, 1.0);\n                        return output;\n                        }\n\n                        @group(0) @binding(0) var imgSampler : sampler;\n                        @group(0) @binding(1) var img : texture_2d<f32>;\n\n                        @fragment\n                        fn fragmentMain(@location(0) texCoord : vec2<f32>) -> @location(0) vec4<f32> {\n                        return textureSample(img, imgSampler, texCoord);\n                        }\n                    "})),e=this.device.createRenderPipeline({layout:"auto",vertex:{module:this.mipmapShaderModule,entryPoint:"vertexMain"},fragment:{module:this.mipmapShaderModule,entryPoint:"fragmentMain",targets:[{format:t}]}}),this.pipelines[t]=e),e}generateMipmap(t){const e=this._getMipmapPipeline(t.format);if("3d"===t.dimension||"1d"===t.dimension)throw new Error("Generating mipmaps for non-2d textures is currently unsupported!");let r=t;const i=t.depthOrArrayLayers||1,s=t.usage&GPUTextureUsage.RENDER_ATTACHMENT;if(!s){const e={size:{width:Math.ceil(t.width/2),height:Math.ceil(t.height/2),depthOrArrayLayers:i},format:t.format,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC|GPUTextureUsage.RENDER_ATTACHMENT,mipLevelCount:t.mipLevelCount-1};r=this.device.createTexture(e)}const n=this.device.createCommandEncoder({}),o=e.getBindGroupLayout(0);for(let a=0;a<i;++a){let i=t.createView({baseMipLevel:0,mipLevelCount:1,dimension:"2d",baseArrayLayer:a,arrayLayerCount:1}),l=s?1:0;for(let s=1;s<t.mipLevelCount;++s){const t=r.createView({baseMipLevel:l++,mipLevelCount:1,dimension:"2d",baseArrayLayer:a,arrayLayerCount:1}),s=n.beginRenderPass({colorAttachments:[{view:t,storeOp:"store",loadOp:"clear",clearValue:{r:0,g:0,b:0,a:0}}]}),h=this.device.createBindGroup({layout:o,entries:[{binding:0,resource:this.sampler},{binding:1,resource:i}]});s.setPipeline(e),s.setBindGroup(0,h),s.draw(3,1,0,0),s.end(),i=t}}if(!s){const e={width:Math.ceil(t.width/2),height:Math.ceil(t.height/2),depthOrArrayLayers:i};for(let i=1;i<t.mipLevelCount;++i)n.copyTextureToTexture({texture:r,mipLevel:i-1},{texture:t,mipLevel:i},e),e.width=Math.ceil(e.width/2),e.height=Math.ceil(e.height/2)}return this.device.queue.submit([n.finish()]),s||r.destroy(),t}}class BS{constructor(t){this.managedTextures=[],this._gpuSources=Object.create(null),this._gpuSamplers=Object.create(null),this._bindGroupHash=Object.create(null),this._textureViewHash=Object.create(null),this._uploads={image:CS,buffer:AS,video:OS,compressed:RS},this._renderer=t,t.renderableGC.addManagedHash(this,"_gpuSources"),t.renderableGC.addManagedHash(this,"_gpuSamplers"),t.renderableGC.addManagedHash(this,"_bindGroupHash"),t.renderableGC.addManagedHash(this,"_textureViewHash")}contextChange(t){this._gpu=t}initSource(t){if(t.autoGenerateMipmaps){const e=Math.max(t.pixelWidth,t.pixelHeight);t.mipLevelCount=Math.floor(Math.log2(e))+1}let e=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST;"compressed"!==t.uploadMethodId&&(e|=GPUTextureUsage.RENDER_ATTACHMENT,e|=GPUTextureUsage.COPY_SRC);const r=PS[t.format]||{blockBytes:4,blockWidth:1,blockHeight:1},i=Math.ceil(t.pixelWidth/r.blockWidth)*r.blockWidth,s=Math.ceil(t.pixelHeight/r.blockHeight)*r.blockHeight,n={label:t.label,size:{width:i,height:s},format:t.format,sampleCount:t.sampleCount,mipLevelCount:t.mipLevelCount,dimension:t.dimension,usage:e},o=this._gpu.device.createTexture(n);return this._gpuSources[t.uid]=o,this.managedTextures.includes(t)||(t.on("update",this.onSourceUpdate,this),t.on("resize",this.onSourceResize,this),t.on("destroy",this.onSourceDestroy,this),t.on("unload",this.onSourceUnload,this),t.on("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.push(t)),this.onSourceUpdate(t),o}onSourceUpdate(t){const e=this.getGpuSource(t);e&&(this._uploads[t.uploadMethodId]&&this._uploads[t.uploadMethodId].upload(t,e,this._gpu),t.autoGenerateMipmaps&&t.mipLevelCount>1&&this.onUpdateMipmaps(t))}onSourceUnload(t){const e=this._gpuSources[t.uid];e&&(this._gpuSources[t.uid]=null,e.destroy())}onUpdateMipmaps(t){this._mipmapGenerator||(this._mipmapGenerator=new IS(this._gpu.device));const e=this.getGpuSource(t);this._mipmapGenerator.generateMipmap(e)}onSourceDestroy(t){t.off("update",this.onSourceUpdate,this),t.off("unload",this.onSourceUnload,this),t.off("destroy",this.onSourceDestroy,this),t.off("resize",this.onSourceResize,this),t.off("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.splice(this.managedTextures.indexOf(t),1),this.onSourceUnload(t)}onSourceResize(t){const e=this._gpuSources[t.uid];e?(e.width!==t.pixelWidth||e.height!==t.pixelHeight)&&(this._textureViewHash[t.uid]=null,this._bindGroupHash[t.uid]=null,this.onSourceUnload(t),this.initSource(t)):this.initSource(t)}_initSampler(t){return this._gpuSamplers[t._resourceId]=this._gpu.device.createSampler(t),this._gpuSamplers[t._resourceId]}getGpuSampler(t){return this._gpuSamplers[t._resourceId]||this._initSampler(t)}getGpuSource(t){return this._gpuSources[t.uid]||this.initSource(t)}getTextureBindGroup(t){var e;return null!=(e=this._bindGroupHash[t.uid])?e:this._createTextureBindGroup(t)}_createTextureBindGroup(t){const e=t.source;return this._bindGroupHash[t.uid]=new os({0:e,1:e.style,2:new To({uTextureMatrix:{type:"mat3x3<f32>",value:t.textureMatrix.mapCoord}})}),this._bindGroupHash[t.uid]}getTextureView(t){var e;const r=t.source;return null!=(e=this._textureViewHash[r.uid])?e:this._createTextureView(r)}_createTextureView(t){return this._textureViewHash[t.uid]=this.getGpuSource(t).createView(),this._textureViewHash[t.uid]}generateCanvas(t){const e=this._renderer,r=e.gpu.device.createCommandEncoder(),i=ri.get().createCanvas();i.width=t.source.pixelWidth,i.height=t.source.pixelHeight;const s=i.getContext("webgpu");return s.configure({device:e.gpu.device,usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC,format:ri.get().getNavigator().gpu.getPreferredCanvasFormat(),alphaMode:"premultiplied"}),r.copyTextureToTexture({texture:e.texture.getGpuSource(t.source),origin:{x:0,y:0}},{texture:s.getCurrentTexture()},{width:i.width,height:i.height}),e.gpu.device.queue.submit([r.finish()]),i}getPixels(t){const e=this.generateCanvas(t),r=Tl.getOptimalCanvasAndContext(e.width,e.height),i=r.context;i.drawImage(e,0,0);const{width:s,height:n}=e,o=i.getImageData(0,0,s,n),a=new Uint8ClampedArray(o.data.buffer);return Tl.returnCanvasAndContext(r),{pixels:a,width:s,height:n}}destroy(){this.managedTextures.slice().forEach((t=>this.onSourceDestroy(t))),this.managedTextures=null;for(const t of Object.keys(this._bindGroupHash)){const e=Number(t),r=this._bindGroupHash[e];null==r||r.destroy(),this._bindGroupHash[e]=null}this._gpu=null,this._mipmapGenerator=null,this._gpuSources=null,this._bindGroupHash=null,this._textureViewHash=null,this._gpuSamplers=null}}BS.extension={type:[u.WebGPUSystem],name:"texture"};class kS{init(){const t=new To({uTransformMatrix:{value:new st,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),e=Zn({name:"graphics",bits:[to,no(ps()),Qc,ho]});this.shader=new Oo({gpuProgram:e,resources:{localUniforms:t}})}execute(t,e){const r=e.context,i=r.customShader||this.shader,s=t.renderer,n=s.graphicsContext,{batcher:o,instructions:a}=n.getContextRenderData(r),l=s.encoder;l.setGeometry(o.geometry,i.gpuProgram);const h=s.globalUniforms.bindGroup;l.setBindGroup(0,h,i.gpuProgram);const u=s.renderPipes.uniformBatch.getUniformBindGroup(i.resources.localUniforms,!0);l.setBindGroup(2,u,i.gpuProgram);const c=a.instructions;let d=null;for(let e=0;e<a.instructionSize;e++){const r=c[e];if(r.topology!==d&&(d=r.topology,l.setPipelineFromGeometryProgramAndState(o.geometry,i.gpuProgram,t.state,r.topology)),i.groups[1]=r.bindGroup,!r.gpuBindGroup){const t=r.textures;r.bindGroup=gs(t.textures,t.count),r.gpuBindGroup=s.bindGroup.getBindGroup(r.bindGroup,i.gpuProgram,1)}l.setBindGroup(1,r.bindGroup,i.gpuProgram),l.renderPassEncoder.drawIndexed(r.size,1,r.start)}}destroy(){this.shader.destroy(!0),this.shader=null}}kS.extension={type:[u.WebGPUPipesAdaptor],name:"graphics"};class GS{init(){const t=Zn({name:"mesh",bits:[Kc,Nx,ho]});this._shader=new Oo({gpuProgram:t,resources:{uTexture:Ue.EMPTY._source,uSampler:Ue.EMPTY._source.style,textureUniforms:{uTextureMatrix:{type:"mat3x3<f32>",value:new st}}}})}execute(t,e){const r=t.renderer;let i=e._shader;if(i){if(!i.gpuProgram)return}else i=this._shader,i.groups[2]=r.texture.getTextureBindGroup(e.texture);const s=i.gpuProgram;if(s.autoAssignGlobalUniforms&&(i.groups[0]=r.globalUniforms.bindGroup),s.autoAssignLocalUniforms){const e=t.localUniforms;i.groups[1]=r.renderPipes.uniformBatch.getUniformBindGroup(e,!0)}r.encoder.draw({geometry:e._geometry,shader:i,state:e.state})}destroy(){this._shader.destroy(!0),this._shader=null}}GS.extension={type:[u.WebGPUPipesAdaptor],name:"mesh"};const DS=[...GT,lS,rS,qT,WT,BS,TS,SS,ES,yS,YT,iS,VT],FS=[...DT,uS],NS=[Gx,GS,kS],US=[],LS=[],zS=[];p.handleByNamedList(u.WebGPUSystem,US),p.handleByNamedList(u.WebGPUPipes,LS),p.handleByNamedList(u.WebGPUPipesAdaptor,zS),p.add(...DS,...FS,...NS);class XS extends Yd{constructor(){super({name:"webgpu",type:Eo.WEBGPU,systems:US,renderPipes:LS,renderPipeAdaptors:zS})}}var HS={__proto__:null,WebGPURenderer:XS};const jS=new Proxy({POINTS:"point-list",LINES:"line-list",LINE_STRIP:"line-strip",TRIANGLES:"triangle-list",TRIANGLE_STRIP:"triangle-strip"},{get:(t,e)=>t[e]}),VS=new Rt(0,0,1,1);var WS=(t=>(t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH",t))(WS||{}),$S=(t=>(t.CLAMP="clamp-to-edge",t.REPEAT="repeat",t.MIRRORED_REPEAT="mirror-repeat",t))($S||{});const YS=new Proxy($S,{get:(t,e)=>t[e]});var qS=(t=>(t.NEAREST="nearest",t.LINEAR="linear",t))(qS||{});const KS=new Proxy(qS,{get:(t,e)=>t[e]});let QS=0;var ZS=Object.defineProperty,JS=Object.getOwnPropertySymbols,tw=Object.prototype.hasOwnProperty,ew=Object.prototype.propertyIsEnumerable,rw=(t,e,r)=>e in t?ZS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;const iw={rectangle:Fa,polygon:Da,triangle:Na,circle:Ko,ellipse:Ko,roundedRectangle:Ko};var sw=Object.defineProperty,nw=Object.getOwnPropertySymbols,ow=Object.prototype.hasOwnProperty,aw=Object.prototype.propertyIsEnumerable,lw=(t,e,r)=>e in t?sw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,hw=(t,e)=>{for(var r in e||(e={}))ow.call(e,r)&&lw(t,r,e[r]);if(nw)for(var r of nw(e))aw.call(e,r)&&lw(t,r,e[r]);return t};const uw=class t extends er{constructor(e={}){e=hw(hw({},t.defaultOptions),e),super(),this.renderLayerChildren=[],this.sortableChildren=e.sortableChildren,this.sortFunction=e.sortFunction}attach(...t){for(let e=0;e<t.length;e++){const r=t[e];if(r.parentRenderLayer){if(r.parentRenderLayer===this)continue;r.parentRenderLayer.detach(r)}this.renderLayerChildren.push(r),r.parentRenderLayer=this;const i=this.renderGroup||this.parentRenderGroup;i&&(i.structureDidChange=!0)}return t[0]}detach(...t){for(let e=0;e<t.length;e++){const r=t[e],i=this.renderLayerChildren.indexOf(r);-1!==i&&this.renderLayerChildren.splice(i,1),r.parentRenderLayer=null;const s=this.renderGroup||this.parentRenderGroup;s&&(s.structureDidChange=!0)}return t[0]}detachAll(){const t=this.renderLayerChildren;for(let e=0;e<t.length;e++)t[e].parentRenderLayer=null;this.renderLayerChildren.length=0}collectRenderables(t,e,r){const i=this.renderLayerChildren,s=i.length;this.sortableChildren&&this.sortRenderLayerChildren();for(let r=0;r<s;r++)i[r].parent||_h("Container must be added to both layer and scene graph. Layers only handle render order - the scene graph is required for transforms (addChild)",i[r]),i[r].collectRenderables(t,e,this)}sortRenderLayerChildren(){this.renderLayerChildren.sort(this.sortFunction)}_getGlobalBoundsRecursive(t,e,r){if(!t)return;const i=this.renderLayerChildren;for(let t=0;t<i.length;t++)i[t]._getGlobalBoundsRecursive(!0,e,this)}};uw.defaultOptions={sortableChildren:!1,sortFunction:(t,e)=>t.zIndex-e.zIndex};let cw=uw;const dw=cw;function pw(t,e,r,i){const s=r.buffers[0],n=s.data,{verticesX:o,verticesY:a}=r,l=t/(o-1),h=e/(a-1);let u=0;const c=i[0],d=i[1],p=i[2],f=i[3],g=i[4],m=i[5],_=i[6],x=i[7],y=i[8];for(let t=0;t<n.length;t+=2){const e=u%o*l,r=(u/o|0)*h,i=c*e+d*r+p,s=f*e+g*r+m,a=_*e+x*r+y;n[t]=i/a,n[t+1]=s/a,u++}s.update()}function fw(t,e){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],h=e[7],u=e[8];return t[0]=o*u-a*h,t[1]=s*h-i*u,t[2]=i*a-s*o,t[3]=a*l-n*u,t[4]=r*u-s*l,t[5]=s*n-r*a,t[6]=n*h-o*l,t[7]=i*l-r*h,t[8]=r*o-i*n,t}function gw(t,e,r){const i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],h=e[6],u=e[7],c=e[8],d=r[0],p=r[1],f=r[2],g=r[3],m=r[4],_=r[5],x=r[6],y=r[7],b=r[8];return t[0]=d*i+p*o+f*h,t[1]=d*s+p*a+f*u,t[2]=d*n+p*l+f*c,t[3]=g*i+m*o+_*h,t[4]=g*s+m*a+_*u,t[5]=g*n+m*l+_*c,t[6]=x*i+y*o+b*h,t[7]=x*s+y*a+b*u,t[8]=x*n+y*l+b*c,t}const mw=[0,0,0,0,0,0,0,0,0],_w=[0,0,0],xw=[0,0,0];function yw(t,e,r,i,s,n,o,a,l){const h=mw;h[0]=e,h[1]=i,h[2]=n,h[3]=r,h[4]=s,h[5]=o,h[6]=1,h[7]=1,h[8]=1;const u=fw(t,h);xw[0]=a,xw[1]=l,xw[2]=1;const c=function(t,e,r){const i=r[0],s=r[1],n=r[2];return t[0]=e[0]*i+e[1]*s+e[2]*n,t[1]=e[3]*i+e[4]*s+e[5]*n,t[2]=e[6]*i+e[7]*s+e[8]*n,t}(_w,u,xw),d=t;return t[0]=c[0],t[1]=0,t[2]=0,t[3]=0,t[4]=c[1],t[5]=0,t[6]=0,t[7]=0,t[8]=c[2],gw(t,d,h)}const bw=[0,0,0,0,0,0,0,0,0],vw=[0,0,0,0,0,0,0,0,0];function Tw(t,e,r,i,s,n,o,a,l,h,u,c,d,p,f,g,m){const _=yw(bw,e,r,n,o,h,u,p,f),x=yw(vw,i,s,a,l,c,d,g,m);return gw(t,fw(_,_),x)}class Sw extends _d{constructor(t){super(t),this._projectionMatrix=[0,0,0,0,0,0,0,0,0];const{width:e,height:r}=t;this.corners=[0,0,e,0,e,r,0,r]}setCorners(t,e,r,i,s,n,o,a){const l=this.corners;l[0]=t,l[1]=e,l[2]=r,l[3]=i,l[4]=s,l[5]=n,l[6]=o,l[7]=a,this.updateProjection()}updateProjection(){const{width:t,height:e}=this,r=this.corners;pw(t,e,this,Tw(this._projectionMatrix,0,0,r[0],r[1],t,0,r[2],r[3],t,e,r[4],r[5],0,e,r[6],r[7]))}}var ww=Object.defineProperty,Ew=Object.defineProperties,Aw=Object.getOwnPropertyDescriptors,Pw=Object.getOwnPropertySymbols,Mw=Object.prototype.hasOwnProperty,Rw=Object.prototype.propertyIsEnumerable,Cw=(t,e,r)=>e in t?ww(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ow=(t,e)=>{for(var r in e||(e={}))Mw.call(e,r)&&Cw(t,r,e[r]);if(Pw)for(var r of Pw(e))Rw.call(e,r)&&Cw(t,r,e[r]);return t};const Iw=class t extends rx{constructor(e){const r=e=Ow(Ow({},t.defaultOptions),e),{texture:i,verticesX:s,verticesY:n}=r,o=((t,e)=>{var r={};for(var i in t)Mw.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&Pw)for(var i of Pw(t))e.indexOf(i)<0&&Rw.call(t,i)&&(r[i]=t[i]);return r})(r,["texture","verticesX","verticesY"]),a=new Sw(re({width:i.width,height:i.height,verticesX:s,verticesY:n}));super(re(((t,e)=>Ew(t,Aw(e)))(Ow({},o),{geometry:a}))),this._texture=i,this.geometry.setCorners(e.x0,e.y0,e.x1,e.y1,e.x2,e.y2,e.x3,e.y3)}textureUpdated(){const t=this.geometry;if(!t)return;const{width:e,height:r}=this.texture;(t.width!==e||t.height!==r)&&(t.width=e,t.height=r,t.updateProjection())}set texture(t){this._texture!==t&&(super.texture=t,this.textureUpdated())}get texture(){return this._texture}setCorners(t,e,r,i,s,n,o,a){this.geometry.setCorners(t,e,r,i,s,n,o,a)}};Iw.defaultOptions={texture:Ue.WHITE,verticesX:10,verticesY:10,x0:0,y0:0,x1:100,y1:0,x2:100,y2:100,x3:0,y3:100};let Bw=Iw;var kw=Object.defineProperty,Gw=Object.defineProperties,Dw=Object.getOwnPropertyDescriptors,Fw=Object.getOwnPropertySymbols,Nw=Object.prototype.hasOwnProperty,Uw=Object.prototype.propertyIsEnumerable,Lw=(t,e,r)=>e in t?kw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var zw=Object.defineProperty,Xw=Object.getOwnPropertySymbols,Hw=Object.prototype.hasOwnProperty,jw=Object.prototype.propertyIsEnumerable,Vw=(t,e,r)=>e in t?zw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ww=(t,e)=>{for(var r in e||(e={}))Hw.call(e,r)&&Vw(t,r,e[r]);if(Xw)for(var r of Xw(e))jw.call(e,r)&&Vw(t,r,e[r]);return t};const $w=class t extends Lc{constructor(e){const{width:r,points:i,textureScale:s}=Ww(Ww({},t.defaultOptions),e);super({positions:new Float32Array(4*i.length),uvs:new Float32Array(4*i.length),indices:new Uint32Array(6*(i.length-1))}),this.points=i,this._width=r,this.textureScale=s,this._build()}get width(){return this._width}_build(){const t=this.points;if(!t)return;const e=this.getBuffer("aPosition"),r=this.getBuffer("aUV"),i=this.getIndex();if(t.length<1)return;e.data.length/4!==t.length&&(e.data=new Float32Array(4*t.length),r.data=new Float32Array(4*t.length),i.data=new Uint16Array(6*(t.length-1)));const s=r.data,n=i.data;s[0]=0,s[1]=0,s[2]=0,s[3]=1;let o=0,a=t[0];const l=this._width*this.textureScale,h=t.length;for(let e=0;e<h;e++){const r=4*e;if(this.textureScale>0){const r=a.x-t[e].x,i=a.y-t[e].y,s=Math.sqrt(r*r+i*i);a=t[e],o+=s/l}else o=e/(h-1);s[r]=o,s[r+1]=0,s[r+2]=o,s[r+3]=1}let u=0;for(let t=0;t<h-1;t++){const e=2*t;n[u++]=e,n[u++]=e+1,n[u++]=e+2,n[u++]=e+2,n[u++]=e+1,n[u++]=e+3}r.update(),i.update(),this.updateVertices()}updateVertices(){const t=this.points;if(t.length<1)return;let e,r=t[0],i=0,s=0;const n=this.buffers[0].data,o=t.length,a=this.textureScale>0?this.textureScale*this._width/2:this._width/2;for(let l=0;l<o;l++){const h=t[l],u=4*l;e=l<t.length-1?t[l+1]:h,s=-(e.x-r.x),i=e.y-r.y;let c=10*(1-l/(o-1));c>1&&(c=1);const d=Math.sqrt(i*i+s*s);d<1e-6?(i=0,s=0):(i/=d,s/=d,i*=a,s*=a),n[u]=h.x+i,n[u+1]=h.y+s,n[u+2]=h.x-i,n[u+3]=h.y-s,r=h}this.buffers[0].update()}update(){this.textureScale>0?this._build():this.updateVertices()}};$w.defaultOptions={width:200,points:[],textureScale:0};let Yw=$w;var qw=Object.defineProperty,Kw=Object.defineProperties,Qw=Object.getOwnPropertyDescriptors,Zw=Object.getOwnPropertySymbols,Jw=Object.prototype.hasOwnProperty,tE=Object.prototype.propertyIsEnumerable,eE=(t,e,r)=>e in t?qw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,rE=(t,e)=>{for(var r in e||(e={}))Jw.call(e,r)&&eE(t,r,e[r]);if(Zw)for(var r of Zw(e))tE.call(e,r)&&eE(t,r,e[r]);return t};const iE=class t extends rx{constructor(e){const r=rE(rE({},t.defaultOptions),e),{texture:i,points:s,textureScale:n}=r,o=((t,e)=>{var r={};for(var i in t)Jw.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&Zw)for(var i of Zw(t))e.indexOf(i)<0&&tE.call(t,i)&&(r[i]=t[i]);return r})(r,["texture","points","textureScale"]),a=new Yw(re({width:i.height,points:s,textureScale:n}));n>0&&(i.source.style.addressMode="repeat"),super(re(((t,e)=>Kw(t,Qw(e)))(rE({},o),{texture:i,geometry:a}))),this.autoUpdate=!0,this.onRender=this._render}_render(){const t=this.geometry;(this.autoUpdate||t._width!==this.texture.height)&&(t._width=this.texture.height,t.update())}};iE.defaultOptions={textureScale:0};let sE=iE;var nE=Object.defineProperty,oE=Object.defineProperties,aE=Object.getOwnPropertyDescriptors,lE=Object.getOwnPropertySymbols,hE=Object.prototype.hasOwnProperty,uE=Object.prototype.propertyIsEnumerable,cE=(t,e,r)=>e in t?nE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var dE=Object.defineProperty,pE=Object.getOwnPropertySymbols,fE=Object.prototype.hasOwnProperty,gE=Object.prototype.propertyIsEnumerable,mE=(t,e,r)=>e in t?dE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_E=(t,e)=>{for(var r in e||(e={}))fE.call(e,r)&&mE(t,r,e[r]);if(pE)for(var r of pE(e))gE.call(e,r)&&mE(t,r,e[r]);return t};const xE=class t{constructor(e){if(e instanceof Ue)this.texture=e,Qe(this,t.defaultOptions,{});else{Qe(this,_E(_E({},t.defaultOptions),e),{})}}get alpha(){return this._alpha}set alpha(t){this._alpha=Math.min(Math.max(t,0),1),this._updateColor()}get tint(){return Xt(this._tint)}set tint(t){this._tint="number"==typeof t?t:Q.shared.setValue(null!=t?t:16777215).toBgrNumber(),this._updateColor()}_updateColor(){this.color=this._tint+((255*this._alpha|0)<<24)}};xE.defaultOptions={anchorX:0,anchorY:0,x:0,y:0,scaleX:1,scaleY:1,rotation:0,tint:16777215,alpha:1};let yE=xE;const bE={vertex:{attributeName:"aVertex",format:"float32x2",code:"\n            const texture = p.texture;\n            const sx = p.scaleX;\n            const sy = p.scaleY;\n            const ax = p.anchorX;\n            const ay = p.anchorY;\n            const trim = texture.trim;\n            const orig = texture.orig;\n\n            if (trim)\n            {\n                w1 = trim.x - (ax * orig.width);\n                w0 = w1 + trim.width;\n\n                h1 = trim.y - (ay * orig.height);\n                h0 = h1 + trim.height;\n            }\n            else\n            {\n                w1 = -ax * (orig.width);\n                w0 = w1 + orig.width;\n\n                h1 = -ay * (orig.height);\n                h0 = h1 + orig.height;\n            }\n\n            f32v[offset] = w1 * sx;\n            f32v[offset + 1] = h1 * sy;\n\n            f32v[offset + stride] = w0 * sx;\n            f32v[offset + stride + 1] = h1 * sy;\n\n            f32v[offset + (stride * 2)] = w0 * sx;\n            f32v[offset + (stride * 2) + 1] = h0 * sy;\n\n            f32v[offset + (stride * 3)] = w1 * sx;\n            f32v[offset + (stride * 3) + 1] = h0 * sy;\n        ",dynamic:!1},position:{attributeName:"aPosition",format:"float32x2",code:"\n            var x = p.x;\n            var y = p.y;\n\n            f32v[offset] = x;\n            f32v[offset + 1] = y;\n\n            f32v[offset + stride] = x;\n            f32v[offset + stride + 1] = y;\n\n            f32v[offset + (stride * 2)] = x;\n            f32v[offset + (stride * 2) + 1] = y;\n\n            f32v[offset + (stride * 3)] = x;\n            f32v[offset + (stride * 3) + 1] = y;\n        ",dynamic:!0},rotation:{attributeName:"aRotation",format:"float32",code:"\n            var rotation = p.rotation;\n\n            f32v[offset] = rotation;\n            f32v[offset + stride] = rotation;\n            f32v[offset + (stride * 2)] = rotation;\n            f32v[offset + (stride * 3)] = rotation;\n        ",dynamic:!1},uvs:{attributeName:"aUV",format:"float32x2",code:"\n            var uvs = p.texture.uvs;\n\n            f32v[offset] = uvs.x0;\n            f32v[offset + 1] = uvs.y0;\n\n            f32v[offset + stride] = uvs.x1;\n            f32v[offset + stride + 1] = uvs.y1;\n\n            f32v[offset + (stride * 2)] = uvs.x2;\n            f32v[offset + (stride * 2) + 1] = uvs.y2;\n\n            f32v[offset + (stride * 3)] = uvs.x3;\n            f32v[offset + (stride * 3) + 1] = uvs.y3;\n        ",dynamic:!1},color:{attributeName:"aColor",format:"unorm8x4",code:"\n            const c = p.color;\n\n            u32v[offset] = c;\n            u32v[offset + stride] = c;\n            u32v[offset + (stride * 2)] = c;\n            u32v[offset + (stride * 3)] = c;\n        ",dynamic:!1}};var vE=Object.defineProperty,TE=Object.defineProperties,SE=Object.getOwnPropertyDescriptors,wE=Object.getOwnPropertySymbols,EE=Object.prototype.hasOwnProperty,AE=Object.prototype.propertyIsEnumerable,PE=(t,e,r)=>e in t?vE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ME=(t,e)=>{for(var r in e||(e={}))EE.call(e,r)&&PE(t,r,e[r]);if(wE)for(var r of wE(e))AE.call(e,r)&&PE(t,r,e[r]);return t},RE=(t,e)=>TE(t,SE(e));const CE=new Ot(0,0,0,0),OE=class t extends Pi{constructor(e={}){const r=e=RE(ME(ME({},t.defaultOptions),e),{dynamicProperties:ME(ME({},t.defaultOptions.dynamicProperties),null==e?void 0:e.dynamicProperties)}),{dynamicProperties:i,shader:s,roundPixels:n,texture:o,particles:a}=r,l=((t,e)=>{var r={};for(var i in t)EE.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&wE)for(var i of wE(t))e.indexOf(i)<0&&AE.call(t,i)&&(r[i]=t[i]);return r})(r,["dynamicProperties","shader","roundPixels","texture","particles"]);super(ME({label:"ParticleContainer"},l)),this.renderPipeId="particle",this.batched=!1,this._childrenDirty=!1,this.texture=o||null,this.shader=s,this._properties={};for(const t in bE){const e=bE[t],r=i[t];this._properties[t]=RE(ME({},e),{dynamic:r})}this.allowChildren=!0,this.roundPixels=null!=n&&n,this.particleChildren=null!=a?a:[]}addParticle(...t){for(let e=0;e<t.length;e++)this.particleChildren.push(t[e]);return this.onViewUpdate(),t[0]}removeParticle(...t){let e=!1;for(let r=0;r<t.length;r++){const i=this.particleChildren.indexOf(t[r]);i>-1&&(this.particleChildren.splice(i,1),e=!0)}return e&&this.onViewUpdate(),t[0]}update(){this._childrenDirty=!0}onViewUpdate(){this._childrenDirty=!0,super.onViewUpdate()}get bounds(){return CE}updateBounds(){}destroy(t=!1){var e,r,i;if(super.destroy(t),"boolean"==typeof t?t:null==t?void 0:t.texture){const i="boolean"==typeof t?t:null==t?void 0:t.textureSource,s=null!=(r=this.texture)?r:null==(e=this.particleChildren[0])?void 0:e.texture;s&&s.destroy(i)}this.texture=null,null==(i=this.shader)||i.destroy()}removeParticles(t,e){const r=this.particleChildren.splice(t,e);return this.onViewUpdate(),r}removeParticleAt(t){const e=this.particleChildren.splice(t,1);return this.onViewUpdate(),e[0]}addParticleAt(t,e){return this.particleChildren.splice(e,0,t),this.onViewUpdate(),t}addChild(...t){throw new Error("ParticleContainer.addChild() is not available. Please use ParticleContainer.addParticle()")}removeChild(...t){throw new Error("ParticleContainer.removeChild() is not available. Please use ParticleContainer.removeParticle()")}removeChildren(t,e){throw new Error("ParticleContainer.removeChildren() is not available. Please use ParticleContainer.removeParticles()")}removeChildAt(t){throw new Error("ParticleContainer.removeChildAt() is not available. Please use ParticleContainer.removeParticleAt()")}getChildAt(t){throw new Error("ParticleContainer.getChildAt() is not available. Please use ParticleContainer.getParticleAt()")}setChildIndex(t,e){throw new Error("ParticleContainer.setChildIndex() is not available. Please use ParticleContainer.setParticleIndex()")}getChildIndex(t){throw new Error("ParticleContainer.getChildIndex() is not available. Please use ParticleContainer.getParticleIndex()")}addChildAt(t,e){throw new Error("ParticleContainer.addChildAt() is not available. Please use ParticleContainer.addParticleAt()")}swapChildren(t,e){throw new Error("ParticleContainer.swapChildren() is not available. Please use ParticleContainer.swapParticles()")}reparentChild(...t){throw new Error("ParticleContainer.reparentChild() is not available with the particle container")}reparentChildAt(t,e){throw new Error("ParticleContainer.reparentChildAt() is not available with the particle container")}};OE.defaultOptions={dynamicProperties:{vertex:!1,position:!0,rotation:!1,uvs:!1,color:!1},roundPixels:!1};let IE=OE;var BE=Object.defineProperty,kE=Object.getOwnPropertySymbols,GE=Object.prototype.hasOwnProperty,DE=Object.prototype.propertyIsEnumerable,FE=(t,e,r)=>e in t?BE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;const NE=class t extends Pi{constructor(e){var r,i,s,n,o,a,l,h,u,c;e instanceof Ue&&(e={texture:e});const d=e,{width:p,height:f,anchor:g,leftWidth:m,rightWidth:_,topHeight:x,bottomHeight:y,texture:b,roundPixels:v}=d,T=((t,e)=>{var r={};for(var i in t)GE.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&kE)for(var i of kE(t))e.indexOf(i)<0&&DE.call(t,i)&&(r[i]=t[i]);return r})(d,["width","height","anchor","leftWidth","rightWidth","topHeight","bottomHeight","texture","roundPixels"]);super(((t,e)=>{for(var r in e||(e={}))GE.call(e,r)&&FE(t,r,e[r]);if(kE)for(var r of kE(e))DE.call(e,r)&&FE(t,r,e[r]);return t})({label:"NineSliceSprite"},T)),this.renderPipeId="nineSliceSprite",this.batched=!0,this._leftWidth=null!=(i=null!=m?m:null==(r=null==b?void 0:b.defaultBorders)?void 0:r.left)?i:Ed.defaultOptions.leftWidth,this._topHeight=null!=(n=null!=x?x:null==(s=null==b?void 0:b.defaultBorders)?void 0:s.top)?n:Ed.defaultOptions.topHeight,this._rightWidth=null!=(a=null!=_?_:null==(o=null==b?void 0:b.defaultBorders)?void 0:o.right)?a:Ed.defaultOptions.rightWidth,this._bottomHeight=null!=(h=null!=y?y:null==(l=null==b?void 0:b.defaultBorders)?void 0:l.bottom)?h:Ed.defaultOptions.bottomHeight,this._width=null!=(u=null!=p?p:b.width)?u:Ed.defaultOptions.width,this._height=null!=(c=null!=f?f:b.height)?c:Ed.defaultOptions.height,this.allowChildren=!1,this.texture=null!=b?b:t.defaultOptions.texture,this.roundPixels=null!=v&&v,this._anchor=new at({_onUpdate:()=>{this.onViewUpdate()}}),g?this.anchor=g:this.texture.defaultAnchor&&(this.anchor=this.texture.defaultAnchor)}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get width(){return this._width}set width(t){this._width=t,this.onViewUpdate()}get height(){return this._height}set height(t){this._height=t,this.onViewUpdate()}setSize(t,e){var r;"object"==typeof t&&(e=null!=(r=t.height)?r:t.width,t=t.width),this._width=t,this._height=null!=e?e:t,this.onViewUpdate()}getSize(t){return t||(t={}),t.width=this._width,t.height=this._height,t}get leftWidth(){return this._leftWidth}set leftWidth(t){this._leftWidth=t,this.onViewUpdate()}get topHeight(){return this._topHeight}set topHeight(t){this._topHeight=t,this.onViewUpdate()}get rightWidth(){return this._rightWidth}set rightWidth(t){this._rightWidth=t,this.onViewUpdate()}get bottomHeight(){return this._bottomHeight}set bottomHeight(t){this._bottomHeight=t,this.onViewUpdate()}get texture(){return this._texture}set texture(t){t||(t=Ue.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this.onViewUpdate())}get originalWidth(){return this._texture.width}get originalHeight(){return this._texture.height}destroy(t){if(super.destroy(t),"boolean"==typeof t?t:null==t?void 0:t.texture){const e="boolean"==typeof t?t:null==t?void 0:t.textureSource;this._texture.destroy(e)}this._texture=null}updateBounds(){const t=this._bounds,e=this._anchor,r=this._width,i=this._height;t.minX=-e._x*r,t.maxX=t.minX+r,t.minY=-e._y*i,t.maxY=t.minY+i}};NE.defaultOptions={texture:Ue.EMPTY};let UE=NE;const LE={};var zE=Object.defineProperty,XE=Object.defineProperties,HE=Object.getOwnPropertyDescriptors,jE=Object.getOwnPropertySymbols,VE=Object.prototype.hasOwnProperty,WE=Object.prototype.propertyIsEnumerable,$E=(t,e,r)=>e in t?zE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,YE=(t,e)=>{for(var r in e||(e={}))VE.call(e,r)&&$E(t,r,e[r]);if(jE)for(var r of jE(e))WE.call(e,r)&&$E(t,r,e[r]);return t},qE=(t,e)=>XE(t,HE(e));const KE=["#000080","#228B22","#8B0000","#4169E1","#008080","#800000","#9400D3","#FF8C00","#556B2F","#8B008B"];let QE=0;return t.AbstractBitmapFont=Nu,t.AbstractRenderer=Yd,t.AbstractText=Ex,t.AccessibilitySystem=Rr,t.AlphaFilter=km,t.AlphaMask=Ni,t.AlphaMaskPipe=Xx,t.AnimatedSprite=ux,t.Application=fp,t.ApplicationInitHook=op,t.Assets=Zf,t.AssetsClass=Qf,t.BLEND_TO_NPM=ys,t.BUFFER_TYPE=Vx,t.BackgroundLoader=Tp,t.BackgroundSystem=Iv,t.Batch=Rs,t.BatchGeometry=js,t.BatchTextureArray=Ts,t.BatchableGraphics=Lo,t.BatchableMesh=il,t.BatchableSprite=xl,t.Batcher=Ds,t.BatcherPipe=Fx,t.BigPool=dt,t.BindGroup=os,t.BindGroupSystem=VT,t.BitmapFont=gp,t.BitmapFontManager=rc,t.BitmapText=Rx,t.BitmapTextPipe=ic,t.BlendModeFilter=class extends cm{constructor(t){const e=t.gpu,r=vm(bm({source:fm},e)),i=wn.from({vertex:{source:r,entryPoint:"mainVertex"},fragment:{source:r,entryPoint:"mainFragment"}}),s=t.gl,n=vm(bm({source:dm},s));super({gpuProgram:i,glProgram:pn.from({vertex:pm,fragment:n}),blendRequired:!0,resources:{blendUniforms:new To({uBlend:{value:1,type:"f32"}}),uBackTexture:Ue.EMPTY}})}},t.BlendModePipe=kv,t.BlurFilter=s_,t.BlurFilterPass=qm,t.Bounds=Ot,t.BrowserAdapter=ti,t.Buffer=Ns,t.BufferImageSource=De,t.BufferResource=pb,t.BufferUsage=Fs,t.CLEAR=Dd,t.Cache=es,t.CanvasPool=Tl,t.CanvasPoolClass=vl,t.CanvasSource=zi,t.CanvasTextMetrics=vu,t.CanvasTextPipe=bl,t.CanvasTextSystem=wu,t.Circle=Vl,t.Color=Q,t.ColorMask=Ui,t.ColorMaskPipe=Hx,t.ColorMatrixFilter=class extends cm{constructor(t={}){const e=new To({uColorMatrix:{value:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],type:"f32",size:20},uAlpha:{value:1,type:"f32"}}),r=wn.from({vertex:{source:o_,entryPoint:"mainVertex"},fragment:{source:o_,entryPoint:"mainFragment"}}),i=pn.from({vertex:Tm,fragment:n_,name:"color-matrix-filter"});super(((t,e)=>l_(t,h_(e)))(((t,e)=>{for(var r in e||(e={}))c_.call(e,r)&&p_(t,r,e[r]);if(u_)for(var r of u_(e))d_.call(e,r)&&p_(t,r,e[r]);return t})({},t),{gpuProgram:r,glProgram:i,resources:{colorMatrixUniforms:e}})),this.alpha=1}_loadMatrix(t,e=!1){let r=t;e&&(this._multiply(r,this.matrix,t),r=this._colorMatrix(r)),this.resources.colorMatrixUniforms.uniforms.uColorMatrix=r,this.resources.colorMatrixUniforms.update()}_multiply(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}tint(t,e){const[r,i,s]=Q.shared.setValue(t).toArray(),n=[r,0,0,0,0,0,i,0,0,0,0,0,s,0,0,0,0,0,1,0];this._loadMatrix(n,e)}greyscale(t,e){const r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}grayscale(t,e){this.greyscale(t,e)}blackAndWhite(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)}hue(t,e){t=(t||0)/180*Math.PI;const r=Math.cos(t),i=Math.sin(t),s=1/3,n=(0,Math.sqrt)(s),o=[r+(1-r)*s,s*(1-r)-n*i,s*(1-r)+n*i,0,0,s*(1-r)+n*i,r+s*(1-r),s*(1-r)-n*i,0,0,s*(1-r)-n*i,s*(1-r)+n*i,r+s*(1-r),0,0,0,0,0,1,0];this._loadMatrix(o,e)}contrast(t,e){const r=(t||0)+1,i=-.5*(r-1),s=[r,0,0,0,i,0,r,0,0,i,0,0,r,0,i,0,0,0,1,0];this._loadMatrix(s,e)}saturate(t=0,e){const r=2*t/3+1,i=-.5*(r-1),s=[r,i,i,0,0,i,r,i,0,0,i,i,r,0,0,0,0,0,1,0];this._loadMatrix(s,e)}desaturate(){this.saturate(-1)}negative(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)}sepia(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)}technicolor(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)}polaroid(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)}toBGR(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)}kodachrome(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)}browni(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)}vintage(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)}colorTone(t,e,r,i,s){t||(t=.2),e||(e=.15),r||(r=16770432),i||(i=3375104);const n=Q.shared,[o,a,l]=n.setValue(r).toArray(),[h,u,c]=n.setValue(i).toArray(),d=[.3,.59,.11,0,0,o,a,l,t,0,h,u,c,e,0,o-h,a-u,l-c,0,0];this._loadMatrix(d,s)}night(t,e){t||(t=.1);const r=[-2*t,-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}predator(t,e){const r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,e)}lsd(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.resources.colorMatrixUniforms.uniforms.uColorMatrix}set matrix(t){this.resources.colorMatrixUniforms.uniforms.uColorMatrix=t}get alpha(){return this.resources.colorMatrixUniforms.uniforms.uAlpha}set alpha(t){this.resources.colorMatrixUniforms.uniforms.uAlpha=t}},t.CompressedSource=eg,t.Container=er,t.Culler=em,t.CullerPlugin=rm,t.CustomRenderPipe=cv,t.D3D10_RESOURCE_DIMENSION=bg,t.D3DFMT=Tg,t.DATA_URI=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i,t.DDS=Eg,t.DEG_TO_RAD=et,t.DEPRECATED_SCALE_MODES=qS,t.DEPRECATED_WRAP_MODES=$S,t.DOMAdapter=ri,t.DRAW_MODES=jS,t.DXGI_FORMAT=yg,t.DXGI_TO_TEXTURE_FORMAT=wg,t.DefaultBatcher=Go,t.DefaultShader=Io,t.DisplacementFilter=class extends cm{constructor(...t){let e=t[0];e instanceof Bi&&(e={sprite:e,scale:t[1]});const r=e,{sprite:i,scale:s}=r,n=((t,e)=>{var r={};for(var i in t)v_.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&b_)for(var i of b_(t))e.indexOf(i)<0&&T_.call(t,i)&&(r[i]=t[i]);return r})(r,["sprite","scale"]);let o=null!=s?s:20;"number"==typeof o&&(o=new rt(o,o));const a=new To({uFilterMatrix:{value:new st,type:"mat3x3<f32>"},uScale:{value:o,type:"vec2<f32>"},uRotation:{value:new Float32Array([0,0,0,0]),type:"mat2x2<f32>"}}),l=pn.from({vertex:g_,fragment:f_,name:"displacement-filter"}),h=wn.from({vertex:{source:m_,entryPoint:"mainVertex"},fragment:{source:m_,entryPoint:"mainFragment"}}),u=i.texture.source;super(((t,e)=>x_(t,y_(e)))(((t,e)=>{for(var r in e||(e={}))v_.call(e,r)&&S_(t,r,e[r]);if(b_)for(var r of b_(e))T_.call(e,r)&&S_(t,r,e[r]);return t})({},n),{gpuProgram:h,glProgram:l,resources:{filterUniforms:a,uMapTexture:u,uMapSampler:u.style}})),this._sprite=e.sprite,this._sprite.renderable=!1}apply(t,e,r,i){const s=this.resources.filterUniforms.uniforms;t.calculateSpriteMatrix(s.uFilterMatrix,this._sprite);const n=this._sprite.worldTransform,o=Math.sqrt(n.a*n.a+n.b*n.b),a=Math.sqrt(n.c*n.c+n.d*n.d);0!==o&&0!==a&&(s.uRotation[0]=n.a/o,s.uRotation[1]=n.b/o,s.uRotation[2]=n.c/a,s.uRotation[3]=n.d/a),this.resources.uMapTexture=this._sprite.texture.source,t.applyFilter(this,e,r,i)}get scale(){return this.resources.filterUniforms.uniforms.uScale}},t.DynamicBitmapFont=$u,t.Ellipse=Wl,t.EventBoundary=Hr,t.EventEmitter=m,t.EventSystem=Qr,t.EventsTicker=Fr,t.ExtensionType=u,t.ExtractSystem=Hv,t.FOURCC_TO_TEXTURE_FORMAT=Sg,t.FederatedContainer=Zr,t.FederatedEvent=rr,t.FederatedMouseEvent=Nr,t.FederatedPointerEvent=Ur,t.FederatedWheelEvent=Lr,t.FillGradient=kl,t.FillPattern=Nl,t.Filter=cm,t.FilterEffect=_t,t.FilterPipe=Pd,t.FilterSystem=Cd,t.FontStylePromiseCache=Ec,t.GAUSSIAN_VALUES=Gm,t.GL_FORMATS=oy,t.GL_INTERNAL_FORMAT=Rg,t.GL_TARGETS=ay,t.GL_TYPES=hy,t.GL_WRAP_MODES=ly,t.GenerateTextureSystem=eT,t.Geometry=zs,t.GlBackBufferSystem=Ty,t.GlBatchAdaptor=Bx,t.GlBuffer=Wx,t.GlBufferSystem=$x,t.GlColorMaskSystem=Sy,t.GlContextSystem=sy,t.GlEncoderSystem=wy,t.GlGeometrySystem=py,t.GlGraphicsAdaptor=hv,t.GlMeshAdaptor=uv,t.GlParticleContainerAdaptor=nl,t.GlParticleContainerPipe=gl,t.GlProgram=pn,t.GlProgramData=gb,t.GlRenderTarget=Ey,t.GlRenderTargetAdaptor=Wy,t.GlRenderTargetSystem=db,t.GlShaderSystem=Ob,t.GlStateSystem=Ub,t.GlStencilSystem=Py,t.GlTexture=Lb,t.GlTextureSystem=lv,t.GlUboSystem=Vy,t.GlUniformGroupSystem=Gb,t.GlobalUniformSystem=rT,t.GpuBatchAdaptor=Gx,t.GpuBlendModesToPixi=wS,t.GpuBufferSystem=WT,t.GpuColorMaskSystem=YT,t.GpuDeviceSystem=qT,t.GpuEncoderSystem=rS,t.GpuGraphicsAdaptor=kS,t.GpuGraphicsContext=Ya,t.GpuMeshAdapter=GS,t.GpuMipmapGenerator=IS,t.GpuParticleContainerAdaptor=ml,t.GpuParticleContainerPipe=_l,t.GpuProgram=wn,t.GpuReadBuffer=function(t,e){const r=t.descriptor.size,i=e.gpu.device,s=new Ns({data:new Float32Array(24e5),usage:Fs.MAP_READ|Fs.COPY_DST}),n=e.buffer.createGPUBuffer(s),o=i.createCommandEncoder();o.copyBufferToBuffer(e.buffer.getGPUBuffer(t),0,n,0,r),i.queue.submit([o.finish()]),n.mapAsync(GPUMapMode.READ,0,r).then((()=>{n.getMappedRange(0,r),n.unmap()}))},t.GpuRenderTarget=bS,t.GpuRenderTargetAdaptor=vS,t.GpuRenderTargetSystem=TS,t.GpuShaderSystem=SS,t.GpuStateSystem=ES,t.GpuStencilModesToPixi=Ay,t.GpuStencilSystem=iS,t.GpuTextureSystem=BS,t.GpuUboSystem=lS,t.GpuUniformBatchPipe=uS,t.Graphics=Cu,t.GraphicsContext=eu,t.GraphicsContextRenderData=qa,t.GraphicsContextSystem=Qa,t.GraphicsPath=fh,t.GraphicsPipe=rl,t.HTMLText=Cx,t.HTMLTextPipe=nc,t.HTMLTextRenderData=hc,t.HTMLTextStyle=vc,t.HTMLTextSystem=Ic,t.HelloSystem=aT,t.IGLUniformData=class{},t.ImageSource=Xi,t.InstructionSet=Jt,t.KTX=Ig,t.Loader=zp,t.LoaderParserPriority=Jr,t.MSAA_QUALITY=WS,t.MaskEffectManager=yt,t.MaskEffectManagerClass=xt,t.MaskFilter=W_,t.Matrix=st,t.Mesh=rx,t.MeshGeometry=Lc,t.MeshPipe=sl,t.MeshPlane=class extends rx{constructor(t){const e=t,{texture:r,verticesX:i,verticesY:s}=e,n=((t,e)=>{var r={};for(var i in t)Nw.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&Fw)for(var i of Fw(t))e.indexOf(i)<0&&Uw.call(t,i)&&(r[i]=t[i]);return r})(e,["texture","verticesX","verticesY"]),o=new _d(re({width:r.width,height:r.height,verticesX:i,verticesY:s}));super(re(((t,e)=>Gw(t,Dw(e)))(((t,e)=>{for(var r in e||(e={}))Nw.call(e,r)&&Lw(t,r,e[r]);if(Fw)for(var r of Fw(e))Uw.call(e,r)&&Lw(t,r,e[r]);return t})({},n),{geometry:o,texture:r}))),this.texture=r,this.autoResize=!0}textureUpdated(){const t=this.geometry,{width:e,height:r}=this.texture;this.autoResize&&(t.width!==e||t.height!==r)&&(t.width=e,t.height=r,t.build({}))}set texture(t){var e;null==(e=this._texture)||e.off("update",this.textureUpdated,this),super.texture=t,t.on("update",this.textureUpdated,this),this.textureUpdated()}get texture(){return this._texture}destroy(t){this.texture.off("update",this.textureUpdated,this),super.destroy(t)}},t.MeshRope=sE,t.MeshSimple=class extends rx{constructor(t){const e=t,{texture:r,vertices:i,uvs:s,indices:n,topology:o}=e,a=((t,e)=>{var r={};for(var i in t)hE.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&lE)for(var i of lE(t))e.indexOf(i)<0&&uE.call(t,i)&&(r[i]=t[i]);return r})(e,["texture","vertices","uvs","indices","topology"]),l=new Lc(re({positions:i,uvs:s,indices:n,topology:o}));super(re(((t,e)=>oE(t,aE(e)))(((t,e)=>{for(var r in e||(e={}))hE.call(e,r)&&cE(t,r,e[r]);if(lE)for(var r of lE(e))uE.call(e,r)&&cE(t,r,e[r]);return t})({},a),{texture:r,geometry:l}))),this.autoUpdate=!0,this.onRender=this._render}get vertices(){return this.geometry.getBuffer("aPosition").data}set vertices(t){this.geometry.getBuffer("aPosition").data=t}_render(){this.autoUpdate&&this.geometry.getBuffer("aPosition").update()}},t.NOOP=Me,t.NineSliceGeometry=Ed,t.NineSlicePlane=class extends UE{constructor(...t){let e=t[0];e instanceof Ue&&(e={texture:e,leftWidth:t[1],topHeight:t[2],rightWidth:t[3],bottomHeight:t[4]}),super(e)}},t.NineSliceSprite=UE,t.NineSliceSpritePipe=Ad,t.NoiseFilter=G_,t.ObservablePoint=at,t.PI_2=J,t.Particle=yE,t.ParticleBuffer=hl,t.ParticleContainer=IE,t.ParticleContainerPipe=fl,t.ParticleShader=pl,t.PerspectiveMesh=Bw,t.PerspectivePlaneGeometry=Sw,t.PipelineSystem=yS,t.PlaneGeometry=_d,t.Point=rt,t.Polygon=Yl,t.Pool=ut,t.PoolGroupClass=ct,t.PrepareBase=K_,t.PrepareQueue=Mx,t.PrepareSystem=Ix,t.PrepareUpload=Ox,t.QuadGeometry=sd,t.RAD_TO_DEG=tt,t.Rectangle=Rt,t.RenderContainer=class extends Pi{constructor(t){var e,r;"function"==typeof t&&(t={render:t});const i=t,{render:s}=i,n=((t,e)=>{var r={};for(var i in t)tw.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&JS)for(var i of JS(t))e.indexOf(i)<0&&ew.call(t,i)&&(r[i]=t[i]);return r})(i,["render"]);super(((t,e)=>{for(var r in e||(e={}))tw.call(e,r)&&rw(t,r,e[r]);if(JS)for(var r of JS(e))ew.call(e,r)&&rw(t,r,e[r]);return t})({label:"RenderContainer"},n)),this.renderPipeId="customRender",this.batched=!1,s&&(this.render=s),this.containsPoint=null!=(e=t.containsPoint)?e:()=>!1,this.addBounds=null!=(r=t.addBounds)?r:()=>!1}updateBounds(){this._bounds.clear(),this.addBounds(this._bounds)}render(t){}},t.RenderGroup=Ke,t.RenderGroupPipe=fv,t.RenderGroupSystem=Sv,t.RenderLayer=dw,t.RenderLayerClass=cw,t.RenderTarget=ub,t.RenderTargetSystem=cb,t.RenderTexture=jv,t.RenderableGCSystem=xT,t.RendererInitHook=ap,t.RendererType=Eo,t.ResizePlugin=Or,t.Resolver=xi,t.RopeGeometry=Yw,t.RoundedRectangle=Kl,t.SCALE_MODES=KS,t.STENCIL_MODES=bs,t.SVGParser=Ih,t.SchedulerSystem=sT,t.ScissorMask=class{constructor(t){this.priority=0,this.pipe="scissorMask",this.mask=t,this.mask.renderable=!1,this.mask.measurable=!1}addBounds(t,e){Gi(this.mask,t,e)}addLocalBounds(t,e){Di(this.mask,t,e)}containsPoint(t,e){return e(this.mask,t)}reset(){this.mask.measurable=!0,this.mask=null}destroy(){this.reset()}},t.SdfShader=Fu,t.Shader=Oo,t.ShaderStage=yn,t.ShapePath=ph,t.SharedRenderPipes=DT,t.SharedSystems=GT,t.Sprite=Bi,t.SpritePipe=wv,t.Spritesheet=Ti,t.State=tl,t.StencilMask=Li,t.StencilMaskPipe=jx,t.SystemRunner=Fd,t.TEXTURE_FORMAT_BLOCK_SIZE=Ag,t.Text=Px,t.TextStyle=fu,t.Texture=Ue,t.TextureGCSystem=AT,t.TextureMatrix=Ne,t.TexturePool=qe,t.TexturePoolClass=Ye,t.TextureSource=ye,t.TextureStyle=ce,t.TextureUvs=class{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,r){const i=e.width,s=e.height;if(r){const e=t.width/2/i,n=t.height/2/s,o=t.x/i+e,a=t.y/s+n;r=Pe.add(r,Pe.NW),this.x0=o+e*Pe.uX(r),this.y0=a+n*Pe.uY(r),r=Pe.add(r,2),this.x1=o+e*Pe.uX(r),this.y1=a+n*Pe.uY(r),r=Pe.add(r,2),this.x2=o+e*Pe.uX(r),this.y2=a+n*Pe.uY(r),r=Pe.add(r,2),this.x3=o+e*Pe.uX(r),this.y3=a+n*Pe.uY(r)}else this.x0=t.x/i,this.y0=t.y/s,this.x1=(t.x+t.width)/i,this.y1=t.y/s,this.x2=(t.x+t.width)/i,this.y2=(t.y+t.height)/s,this.x3=t.x/i,this.y3=(t.y+t.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}},t.Ticker=Gr,t.TickerListener=Br,t.TickerPlugin=Dr,t.TilingSprite=yx,t.TilingSpritePipe=hd,t.TilingSpriteShader=id,t.Transform=cx,t.Triangle=Y_,t.UNIFORM_TO_ARRAY_SETTERS=Bb,t.UNIFORM_TO_SINGLE_SETTERS=Ib,t.UNIFORM_TYPES_MAP=po,t.UNIFORM_TYPES_VALUES=co,t.UPDATE_BLEND=2,t.UPDATE_COLOR=1,t.UPDATE_PRIORITY=Ir,t.UPDATE_TRANSFORM=8,t.UPDATE_VISIBLE=4,t.UboBatch=$T,t.UboSystem=My,t.UniformGroup=To,t.VERSION=np,t.VideoSource=ts,t.ViewContainer=Pi,t.ViewSystem=kT,t.ViewableBuffer=_s,t.WGSL_ALIGN_SIZE_DATA=sS,t.WGSL_TO_STD40_SIZE=Ry,t.WRAP_MODES=YS,t.WebGLRenderer=HT,t.WebGPURenderer=XS,t.WorkerManager=wf,t._getGlobalBounds=Ft,t.accessibilityTarget=Cr,t.addBits=En,t.addMaskBounds=Gi,t.addMaskLocalBounds=Di,t.addProgramDefines=Ks,t.alphaFrag=Sm,t.alphaWgsl=wm,t.applyMatrix=od,t.applyProjectiveTransformationToPlane=pw,t.applyStyleParams=Kb,t.assignWithIgnore=Qe,t.autoDetectEnvironment=async function(t){return Bd(!t)},t.autoDetectRenderer=sp,t.autoDetectSource=function(t={}){return is(t)},t.basisTranscoderUrls=pg,t.bgr2rgb=Xt,t.bitmapFontCachePlugin=bp,t.bitmapFontTextParser=mp,t.bitmapFontXMLParser=_p,t.bitmapFontXMLStringParser=xp,t.blendTemplateFrag=dm,t.blendTemplateVert=pm,t.blendTemplateWgsl=fm,t.blockDataMap=PS,t.blurTemplateWgsl=Lm,t.boundsPool=Bt,t.browserExt=im,t.buildAdaptiveBezier=Zl,t.buildAdaptiveQuadratic=th,t.buildArc=rh,t.buildArcTo=ih,t.buildArcToSvg=hh,t.buildCircle=Ko,t.buildContextBatches=Va,t.buildEllipse=Qo,t.buildGeometryFromPath=function(t){t instanceof fh&&(t={path:t,textureMatrix:null,out:null});const e=[],r=[],i=[],s=t.path.shapePath,n=t.textureMatrix;s.shapePrimitives.forEach((({shape:t,transform:s})=>{const o=i.length,a=e.length/2,l=[],h=iw[t.type];h.build(t,l),s&&No(l,s),h.triangulate(l,e,2,a,i,o);const u=r.length/2;n?(s&&n.append(s.clone().invert()),Do(e,2,a,r,u,2,e.length/2-a,n)):Fo(r,u,2,e.length/2-a)}));const o=t.out;return o?(o.positions=new Float32Array(e),o.uvs=new Float32Array(r),o.indices=new Uint32Array(i),o):new Lc({positions:new Float32Array(e),uvs:new Float32Array(r),indices:new Uint32Array(i)})},t.buildLine=sa,t.buildPixelLine=na,t.buildPolygon=Da,t.buildRectangle=Fa,t.buildRoundedRectangle=Zo,t.buildSimpleUvs=Fo,t.buildTriangle=Na,t.buildUvs=Do,t.cacheAsTextureMixin=pt,t.cacheTextureArray=Sp,t.calculateProjection=$y,t.checkChildrenDidChange=Wt,t.checkDataUrl=Xp,t.checkExtension=Hp,t.checkMaxIfStatementsInShader=cs,t.childrenHelperMixin=gt,t.cleanArray=hT,t.cleanHash=lT,t.clearList=gv,t.closePointEps=Jo,t.collectAllRenderables=function(t,e,r){const i=r.renderPipes?r:r.batch.renderer;return t.collectRenderables(e,i,null)},t.collectRenderablesMixin=mt,t.color32BitToUniform=el,t.colorBit=to,t.colorBitGl=eo,t.colorMatrixFilterFrag=n_,t.colorMatrixFilterWgsl=o_,t.colorToUniform=function(t,e,r,i){r[i++]=(t>>16&255)/255,r[i++]=(t>>8&255)/255,r[i++]=(255&t)/255,r[i++]=e},t.compareModeToGlCompare=qb,t.compileHighShader=Dn,t.compileHighShaderGl=Fn,t.compileHighShaderGlProgram=Jn,t.compileHighShaderGpuProgram=Zn,t.compileHooks=Pn,t.compileInputs=Rn,t.compileOutputs=On,t.compileShader=mb,t.compute2DProjection=Tw,t.convertFormatIfRequired=function(t){const e=t.format;if(Xg[e]){const r=Xg[e].convertFunction,i=t.resource;for(let t=0;t<i.length;t++)i[t]=r(i[t]);t.format=Xg[e].convertedFormat}},t.convertToList=oi,t.copySearchParams=bi,t.createIdFromString=$s,t.createIndicesForQuads=ol,t.createLevelBuffers=function(t,e){const r=t.getNumImages(),i=t.getNumLevels(0);if(!t.startTranscoding())throw new Error("startTranscoding failed");const s=[];for(let n=0;n<i;++n)for(let i=0;i<r;++i){const r=t.getImageTranscodedSizeInBytes(i,n,e),o=new Uint8Array(r);if(!t.transcodeImage(o,i,n,e,1,0))throw new Error("transcodeImage failed");s.push(o)}return s},t.createLevelBuffersFromKTX=function(t){const e=[];for(let r=0;r<t.numLevels;r++){const i=t.getImageData(r,0,0),s=new Uint8Array(i.byteLength);s.set(i),e.push(s)}return e},t.createStringVariations=li,t.createTexture=cf,t.createUboElementsSTD40=Cy,t.createUboElementsWGSL=nS,t.createUboSyncFunction=Iy,t.createUboSyncFunctionSTD40=jy,t.createUboSyncFunctionWGSL=aS,t.crossOrigin=Vf,t.cullingMixin=Z,t.curveEps=ta,t.defaultFilterVert=Tm,t.defaultValue=xb,t.definedProps=re,t.deprecation=function(t,e,r=3){if(LE[e])return;let i=(new Error).stack;void 0===i?console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`):(i=i.split("\n").splice(r).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}\nDeprecated since v${t}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`),console.warn(i))),LE[e]=!0},t.detectAvif=Ep,t.detectBasis=tg,t.detectCompressed=Zg,t.detectDefaults=Pp,t.detectMp4=Cp,t.detectOgv=Op,t.detectVideoAlphaMode=ji,t.detectWebm=Ip,t.detectWebp=Bp,t.determineCrossOrigin=$f,t.displacementFrag=f_,t.displacementVert=g_,t.displacementWgsl=m_,t.earcut=Ba,t.effectsMixin=At,t.ensureAttributes=ny,t.ensureIsBuffer=Us,t.ensurePrecision=Qs,t.ensureTextOptions=Ax,t.ensureTextStyle=function(t,e){return e instanceof fu||e instanceof vc?e:"html"===t?new vc(e):new fu(e)},t.executeInstructions=dv,t.extensions=p,t.extractAttributesFromGlProgram=wb,t.extractAttributesFromGpuProgram=_n,t.extractFontFamilies=Tc,t.extractStructAndGroups=xn,t.extractSvgUrlId=Th,t.fastCopy=xs,t.findHooksRx=An,t.findMixin=Pt,t.fontStringFromTextStyle=xu,t.formatShader=function(t){const e=t.split(/([\n{}])/g).map((t=>t.trim())).filter((t=>t.length));let r="";return e.map((t=>{let e=r+t;return"{"===t?r+="    ":"}"===t&&(r=r.substr(0,r.length-4),e=r+t),e})).join("\n")},t.fragmentGPUTemplate=zn,t.fragmentGlTemplate=Hn,t.generateArraySyncSTD40=Hy,t.generateArraySyncWGSL=oS,t.generateBlurFragSource=Fm,t.generateBlurGlProgram=Um,t.generateBlurProgram=zm,t.generateBlurVertSource=Nm,t.generateGPULayout=function(t){const e=[];let r=0;for(let i=0;i<t;i++)e[r]={texture:{sampleType:"float",viewDimension:"2d",multisampled:!1},binding:r,visibility:GPUShaderStage.FRAGMENT},r++,e[r]={sampler:{type:"filtering"},binding:r,visibility:GPUShaderStage.FRAGMENT},r++;return e},t.generateGpuLayoutGroups=bn,t.generateLayout=function(t){const e={};let r=0;for(let i=0;i<t;i++)e[`textureSource${i+1}`]=r++,e[`textureSampler${i+1}`]=r++;return e},t.generateLayoutHash=vn,t.generateParticleUpdateFunction=al,t.generateProgram=Rb,t.generateShaderSyncCode=fb,t.generateTextStyleKey=iu,t.generateTextureBatchBit=no,t.generateTextureBatchBitGl=lo,t.generateTextureMatrix=za,t.generateUID=function(){return QS++},t.generateUniformsSync=kb,t.getAdjustedBlendModeBlend=vs,t.getAttributeInfoFromFormat=gn,t.getBatchSamplersUniformGroup=wo,t.getBitmapTextLayout=Yu,t.getCanvasBoundingBox=El,t.getCanvasFillStyle=Su,t.getCanvasTexture=eb,t.getDefaultUniformValue=fo,t.getFastGlobalBounds=function(t,e){return t.getFastGlobalBounds(!0,e)},t.getFastGlobalBoundsMixin=Gt,t.getFontCss=Ac,t.getFontFamilyName=of,t.getGeometryBounds=Ls,t.getGlTypeFromFormat=cy,t.getGlobalBounds=Dt,t.getGlobalMixin=Ht,t.getGlobalRenderableBounds=Md,t.getLocalBounds=jt,t.getMatrixRelativeToParent=Fi,t.getMaxFragmentPrecision=qs,t.getMaxTexturesPerBatch=ps,t.getOrientationOfPoints=ea,t.getParent=function t(e,r,i){const s=e.parent;s&&s!==r&&(t(s,r,i),s.updateLocalTransform(),i.append(s.localTransform))},t.getPo2TextureFromSource=mu,t.getResolutionOfUrl=uf,t.getSVGUrl=Pc,t.getSupportedCompressedTextureFormats=ag,t.getSupportedGPUCompressedTextureFormats=og,t.getSupportedGlCompressedTextureFormats=ng,t.getSupportedTextureFormats=ug,t.getTemporaryCanvasFromImage=Mc,t.getTestContext=ls,t.getTextureBatchBindGroup=gs,t.getTextureDefaultMatrix=function(t,e){const{width:r,height:i}=t.frame;return e.scale(1/r,1/i),e},t.getTextureFormatFromKTXTexture=function(t){return 2===t.classId?$g(t.vkFormat):Vg(t.glInternalformat)},t.getUboData=Eb,t.getUniformData=Ab,t.getUrlExtension=yi,t.glFormatToGPUFormat=Vg,t.glUploadBufferImageResource=zb,t.glUploadCompressedTextureResource=Hb,t.glUploadImageResource=jb,t.glUploadVideoResource=Vb,t.globalUniformsBit=jn,t.globalUniformsBitGl=Wn,t.globalUniformsUBOBitGl=Vn,t.gpuFormatToBasisTranscoderFormat=function(t){const e=xg[t];if(e)return e;throw new Error(`Unsupported transcoderFormat: ${t}`)},t.gpuFormatToKTXBasisTranscoderFormat=function(t){const e=Yg[t];if(e)return e;throw new Error(`Unsupported transcoderFormat: ${t}`)},t.gpuUploadBufferImageResource=AS,t.gpuUploadCompressedTextureResource=RS,t.gpuUploadImageResource=CS,t.gpuUploadVideoResource=OS,t.groupD8=Pe,t.hasCachedCanvasTexture=function(t){return tb.has(t)},t.hslWgsl="fn getLuminosity(c: vec3<f32>) -> f32 {\n  return 0.3 * c.r + 0.59 * c.g + 0.11 * c.b;\n}\n\nfn setLuminosity(c: vec3<f32>, lum: f32) -> vec3<f32> {\n  let d: f32 = lum - getLuminosity(c);\n  let newColor: vec3<f32> = c.rgb + vec3<f32>(d, d, d);\n\n  // clip back into legal range\n  let newLum: f32 = getLuminosity(newColor);\n  let cMin: f32 = min(newColor.r, min(newColor.g, newColor.b));\n  let cMax: f32 = max(newColor.r, max(newColor.g, newColor.b));\n\n  let t1: f32 = newLum / (newLum - cMin);\n  let t2: f32 = (1.0 - newLum) / (cMax - newLum);\n\n  let finalColor = mix(vec3<f32>(newLum, newLum, newLum), newColor, select(select(1.0, t2, cMax > 1.0), t1, cMin < 0.0));\n\n  return finalColor;\n}\n\nfn getSaturation(c: vec3<f32>) -> f32 {\n  return max(c.r, max(c.g, c.b)) - min(c.r, min(c.g, c.b));\n}\n\n// Set saturation if color components are sorted in ascending order.\nfn setSaturationMinMidMax(cSorted: vec3<f32>, s: f32) -> vec3<f32> {\n  var result: vec3<f32>;\n  if (cSorted.z > cSorted.x) {\n    let newY = (((cSorted.y - cSorted.x) * s) / (cSorted.z - cSorted.x));\n    result = vec3<f32>(0.0, newY, s);\n  } else {\n    result = vec3<f32>(0.0, 0.0, 0.0);\n  }\n  return vec3<f32>(result.x, result.y, result.z);\n}\n\nfn setSaturation(c: vec3<f32>, s: f32) -> vec3<f32> {\n    var result: vec3<f32> = c;\n\n    if (c.r <= c.g && c.r <= c.b) {\n        if (c.g <= c.b) {\n            result = setSaturationMinMidMax(result, s);\n        } else {\n            var temp: vec3<f32> = vec3<f32>(result.r, result.b, result.g);\n            temp = setSaturationMinMidMax(temp, s);\n            result = vec3<f32>(temp.r, temp.b, temp.g);\n        }\n    } else if (c.g <= c.r && c.g <= c.b) {\n        if (c.r <= c.b) {\n            var temp: vec3<f32> = vec3<f32>(result.g, result.r, result.b);\n            temp = setSaturationMinMidMax(temp, s);\n            result = vec3<f32>(temp.g, temp.r, temp.b);\n        } else {\n            var temp: vec3<f32> = vec3<f32>(result.g, result.b, result.r);\n            temp = setSaturationMinMidMax(temp, s);\n            result = vec3<f32>(temp.g, temp.b, temp.r);\n        }\n    } else {\n        if (c.r <= c.g) {\n            var temp: vec3<f32> = vec3<f32>(result.b, result.r, result.g);\n            temp = setSaturationMinMidMax(temp, s);\n            result = vec3<f32>(temp.b, temp.r, temp.g);\n        } else {\n            var temp: vec3<f32> = vec3<f32>(result.b, result.g, result.r);\n            temp = setSaturationMinMidMax(temp, s);\n            result = vec3<f32>(temp.b, temp.g, temp.r);\n        }\n    }\n\n    return result;\n}",t.hslgl="\n\tfloat getLuminosity(vec3 c) {\n\t\treturn 0.3 * c.r + 0.59 * c.g + 0.11 * c.b;\n\t}\n\n\tvec3 setLuminosity(vec3 c, float lum) {\n\t\tfloat modLum = lum - getLuminosity(c);\n\t\tvec3 color = c.rgb + vec3(modLum);\n\n\t\t// clip back into legal range\n\t\tmodLum = getLuminosity(color);\n\t\tvec3 modLumVec = vec3(modLum);\n\n\t\tfloat cMin = min(color.r, min(color.g, color.b));\n\t\tfloat cMax = max(color.r, max(color.g, color.b));\n\n\t\tif(cMin < 0.0) {\n\t\t\tcolor = mix(modLumVec, color, modLum / (modLum - cMin));\n\t\t}\n\n\t\tif(cMax > 1.0) {\n\t\t\tcolor = mix(modLumVec, color, (1.0 - modLum) / (cMax - modLum));\n\t\t}\n\n\t\treturn color;\n\t}\n\n\tfloat getSaturation(vec3 c) {\n\t\treturn max(c.r, max(c.g, c.b)) - min(c.r, min(c.g, c.b));\n\t}\n\n\tvec3 setSaturationMinMidMax(vec3 cSorted, float s) {\n\t\tvec3 colorSorted = cSorted;\n\n\t\tif(colorSorted.z > colorSorted.x) {\n\t\t\tcolorSorted.y = (((colorSorted.y - colorSorted.x) * s) / (colorSorted.z - colorSorted.x));\n\t\t\tcolorSorted.z = s;\n\t\t}\n\t\telse {\n\t\t\tcolorSorted.y = 0.0;\n\t\t\tcolorSorted.z = 0.0;\n\t\t}\n\n\t\tcolorSorted.x = 0.0;\n\n\t\treturn colorSorted;\n\t}\n\n\tvec3 setSaturation(vec3 c, float s) {\n\t\tvec3 color = c;\n\n\t\tif(color.r <= color.g && color.r <= color.b) {\n\t\t\tif(color.g <= color.b) {\n\t\t\t\tcolor = setSaturationMinMidMax(color.rgb, s).rgb;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcolor = setSaturationMinMidMax(color.rbg, s).rbg;\n\t\t\t}\n\t\t}\n\t\telse if(color.g <= color.r && color.g <= color.b) {\n\t\t\tif(color.r <= color.b) {\n\t\t\t\tcolor = setSaturationMinMidMax(color.grb, s).grb;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcolor = setSaturationMinMidMax(color.gbr, s).gbr;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// Using bgr for both fixes part of hue\n\t\t\tif(color.r <= color.g) {\n\t\t\t\tcolor = setSaturationMinMidMax(color.brg, s).brg;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcolor = setSaturationMinMidMax(color.bgr, s).bgr;\n\t\t\t}\n\t\t}\n\n\t\treturn color;\n\t}\n    ",t.hslgpu="\n\tfn getLuminosity(c: vec3<f32>) -> f32\n\t{\n\t\treturn 0.3*c.r + 0.59*c.g + 0.11*c.b;\n\t}\n\n\tfn setLuminosity(c: vec3<f32>, lum: f32) -> vec3<f32>\n\t{\n\t\tvar modLum: f32 = lum - getLuminosity(c);\n\t\tvar color: vec3<f32> = c.rgb + modLum;\n\n\t\t// clip back into legal range\n\t\tmodLum = getLuminosity(color);\n\t\tlet modLumVec = vec3<f32>(modLum);\n\n\t\tlet cMin: f32 = min(color.r, min(color.g, color.b));\n\t\tlet cMax: f32 = max(color.r, max(color.g, color.b));\n\n\t\tif(cMin < 0.0)\n\t\t{\n\t\t\tcolor = mix(modLumVec, color, modLum / (modLum - cMin));\n\t\t}\n\n\t\tif(cMax > 1.0)\n\t\t{\n\t\t\tcolor = mix(modLumVec, color, (1 - modLum) / (cMax - modLum));\n\t\t}\n\n\t\treturn color;\n\t}\n\n\tfn getSaturation(c: vec3<f32>) -> f32\n\t{\n\t\treturn max(c.r, max(c.g, c.b)) - min(c.r, min(c.g, c.b));\n\t}\n\n\tfn setSaturationMinMidMax(cSorted: vec3<f32>, s: f32) -> vec3<f32>\n\t{\n\t\tvar colorSorted = cSorted;\n\n\t\tif(colorSorted.z > colorSorted.x)\n\t\t{\n\t\t\tcolorSorted.y = (((colorSorted.y - colorSorted.x) * s) / (colorSorted.z - colorSorted.x));\n\t\t\tcolorSorted.z = s;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcolorSorted.y = 0;\n\t\t\tcolorSorted.z = 0;\n\t\t}\n\n\t\tcolorSorted.x = 0;\n\n\t\treturn colorSorted;\n\t}\n\n\tfn setSaturation(c: vec3<f32>, s: f32) -> vec3<f32>\n\t{\n\t\tvar color = c;\n\n\t\tif (color.r <= color.g && color.r <= color.b)\n\t\t{\n\t\t\tif (color.g <= color.b)\n\t\t\t{\n\t\t\t\tcolor = vec3<f32>(setSaturationMinMidMax(color.rgb, s)).rgb;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcolor = vec3<f32>(setSaturationMinMidMax(color.rbg, s)).rbg;\n\t\t\t}\n\t\t}\n\t\telse if (color.g <= color.r && color.g <= color.b)\n\t\t{\n\t\t\tif (color.r <= color.b)\n\t\t\t{\n\t\t\t\tcolor = vec3<f32>(setSaturationMinMidMax(color.grb, s)).grb;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcolor = vec3<f32>(setSaturationMinMidMax(color.gbr, s)).gbr;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// Using bgr for both fixes part of hue\n\t\t\tif (color.r <= color.g)\n\t\t\t{\n\t\t\t\tcolor = vec3<f32>(setSaturationMinMidMax(color.brg, s)).brg;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tcolor  = vec3<f32>(setSaturationMinMidMax(color.bgr, s)).bgr;\n\t\t\t}\n\t\t}\n\n\t\treturn color;\n\t}\n\t",t.injectBits=In,t.insertVersion=Zs,t.isMobile=vr,t.isPow2=ee,t.isRenderingToScreen=rb,t.isSafari=oc,t.isSingleItem=hi,t.isWebGLSupported=qd,t.isWebGPUSupported=Kd,t.ktxTranscoderUrls=Fg,t.loadBasis=_g,t.loadBasisOnWorker=mg,t.loadBitmapFont=vp,t.loadDDS=Mg,t.loadEnvironmentExtensions=Bd,t.loadFontAsBase64=Sc,t.loadFontCSS=wc,t.loadImageBitmap=If,t.loadJson=jp,t.loadKTX=kg,t.loadKTX2=zg,t.loadKTX2onWorker=Lg,t.loadSVGImage=Rc,t.loadSvg=_f,t.loadTextures=Bf,t.loadTxt=Vp,t.loadVideoTextures=Yf,t.loadWebFont=hf,t.localUniformBit=Kc,t.localUniformBitGl=Zc,t.localUniformBitGroup2=Qc,t.localUniformMSDFBit=Ou,t.localUniformMSDFBitGl=Iu,t.log2=function(t){let e=(t>65535?1:0)<<4,r=((t>>>=e)>255?1:0)<<3;return e|=r,r=((t>>>=r)>15?1:0)<<2,e|=r,r=((t>>>=r)>3?1:0)<<1,e|=r,e|(t>>>=r)>>1},t.logDebugTexture=async function(t,e,r=200){const i=await e.extract.base64(t);await e.encoder.commandFinished;const s=r;console.log(`logging texture ${t.source.width}px ${t.source.height}px`);const n=["font-size: 1px;",`padding: ${s}px 300px;`,`background: url(${i}) no-repeat;`,"background-size: contain;"].join(" ");console.log("%c ",n)},t.logProgramError=Mb,t.logRenderGroupScene=function t(e,r=0,i={index:0,color:"#000000"}){let s="";for(let t=0;t<r;t++)s+="    ";const n=`%c ${s}- ${i.index}: ${e.root.label} worldX:${e.worldTransform.tx}`;console.log(n,`color:${i.color}; font-weight:bold;`),r++;for(let s=0;s<e.renderGroupChildren.length;s++){t(e.renderGroupChildren[s],r,qE(YE({},i),{index:s}))}},t.logScene=function t(e,r=0,i={color:"#000000"}){e.renderGroup&&(i.color=KE[QE++]);let s="";for(let t=0;t<r;t++)s+="    ";let n=e.label;!n&&e instanceof Bi&&(n=`sprite:${e.texture.label}`);let o=`%c ${s}|- ${n} (worldX:${e.worldTransform.tx}, relativeRenderX:${e.relativeGroupTransform.tx}, renderX:${e.groupTransform.tx}, localX:${e.x})`;e.renderGroup&&(o+=" (RenderGroup)"),e.filters&&(o+="(*filters)"),console.log(o,`color:${i.color}; font-weight:bold;`),r++;for(let s=0;s<e.children.length;s++){t(e.children[s],r,YE({},i))}},t.mSDFBit=Bu,t.mSDFBitGl=ku,t.mapFormatToGlFormat=Qb,t.mapFormatToGlInternalFormat=ov,t.mapFormatToGlType=av,t.mapGlToVertexFormat=Sb,t.mapSize=function(t){return Db[t]},t.mapType=Tb,t.mapWebGLBlendModesToPixi=Fb,t.maskFrag=D_,t.maskVert=F_,t.maskWgsl=N_,t.matrixPool=It,t.measureHtmlText=Oc,t.measureMixin=Yt,t.migrateFragmentFromV7toV8=function(t){return t=`\n        out vec4 finalColor;\n    ${t=t.replaceAll("texture2D","texture").replaceAll("gl_FragColor","finalColor").replaceAll("varying","in")}\n    `},t.mipmapScaleModeToGlFilter=$b,t.mixHexColors=function(t,e,r){const i=t>>16&255,s=t>>8&255,n=255&t;return(i+((e>>16&255)-i)*r<<16)+(s+((e>>8&255)-s)*r<<8)+(n+((255&e)-n)*r)},t.multiplyColors=zt,t.multiplyHexColors=Ut,t.nextPow2=te,t.noiseFrag=w_,t.noiseWgsl=E_,t.nonCompressedFormats=lg,t.normalizeExtensionPriority=d,t.nssvg=ac,t.nsxhtml=lc,t.onRenderMixin=qt,t.parseAttribute=Eh,t.parseDDS=Pg,t.parseFunctionBody=function(t){const e=t.toString(),r=e.indexOf("{"),i=e.lastIndexOf("}");if(-1===r||-1===i)throw new Error("getFunctionBody: No body found in function definition");return e.slice(r+1,i).trim()},t.parseKTX=Bg,t.parseSVGDefinitions=yh,t.parseSVGFloatAttribute=xh,t.parseSVGPath=jl,t.parseSVGStyle=wh,t.particleData=bE,t.particlesFrag=ul,t.particlesVert=cl,t.particlesWgsl=dl,t.path=ni,t.pointInTriangle=$_,t.preloadVideo=Wf,t.removeItems=ft,t.removeStructAndGroupDuplicates=Tn,t.resetUids=function(){for(const t in lt)delete lt[t]},t.resolveCharacters=Uu,t.resolveCompressedTextureUrl=Kg,t.resolveJsonUrl=Kf,t.resolveTextureUrl=qf,t.resourceToTexture=ss,t.roundPixelsBit=ho,t.roundPixelsBitGl=uo,t.roundedShapeArc=uh,t.roundedShapeQuadraticCurve=ch,t.sayHello=oT,t.scaleModeToGlFilter=Wb,t.setBasisTranscoderPath=function(t){Object.assign(pg,t)},t.setKTXTranscoderPath=function(t){Object.assign(Fg,t)},t.setPositions=nd,t.setProgramName=en,t.setUvs=ad,t.shapeBuilders=Xa,t.sortMixin=Kt,t.spritesheetAsset=Ei,t.squaredDistanceToLineSegment=$l,t.stripVersion=rn,t.styleAttributes=Sh,t.testImageFormat=wp,t.testVideoFormat=Rp,t.textStyleToCSS=uc,t.textureBit=Nx,t.textureBitGl=Ux,t.textureFrom=ns,t.tilingBit=Jc,t.tilingBitGl=td,t.toFillStyle=jh,t.toLocalGlobalMixin=Zt,t.toStrokeStyle=Vh,t.transformVertices=No,t.triangulateWithHoles=ka,t.uboSyncFunctionsSTD40=zy,t.uboSyncFunctionsWGSL=Xy,t.uid=ht,t.uniformParsers=Oy,t.unpremultiplyAlpha=function(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let r=0;r<e;r+=4){const e=t[r+3];if(0!==e){const i=255.001/e;t[r]=t[r]*i+.5,t[r+1]=t[r+1]*i+.5,t[r+2]=t[r+2]*i+.5}}},t.unsafeEvalSupported=Gd,t.updateLocalTransform=function(t,e){const r=e._scale,i=e._pivot,s=e._position,n=r._x,o=r._y,a=i._x,l=i._y;t.a=e._cx*n,t.b=e._sx*n,t.c=e._cy*o,t.d=e._sy*o,t.tx=s._x-(a*t.a+l*t.c),t.ty=s._y-(a*t.b+l*t.d)},t.updateQuadBounds=Ai,t.updateRenderGroupTransform=xv,t.updateRenderGroupTransforms=_v,t.updateTextBounds=yl,t.updateTransformAndChildren=yv,t.updateTransformBackwards=Nt,t.updateWorldTransform=function(t,e,r){const i=t.a,s=t.b,n=t.c,o=t.d,a=t.tx,l=t.ty,h=e.a,u=e.b,c=e.c,d=e.d;r.a=i*h+s*c,r.b=i*u+s*d,r.c=n*h+o*c,r.d=n*u+o*d,r.tx=a*h+l*c+e.tx,r.ty=a*u+l*d+e.ty},t.v8_0_0="8.0.0",t.v8_3_4="8.3.4",t.validFormats=qg,t.validateRenderables=vv,t.vertexGPUTemplate=Ln,t.vertexGlTemplate=Xn,t.viewportFromFrame=function(t,e,r){r||(r=VS);const i=e.pixelWidth,s=e.pixelHeight;return t.x=r.x*i|0,t.y=r.y*s|0,t.width=r.width*i|0,t.height=r.height*s|0,t},t.vkFormatToGPUFormat=$g,t.warn=_h,t.wrapModeToGlAddress=Yb,t}({});!function(t,e,r){var i,s=256,n="random",o=r.pow(s,6),a=r.pow(2,52),l=2*a,h=255;function u(h,u,g){function m(){for(var t=y.g(6),e=o,r=0;t<a;)t=(t+r)*s,e*=s,r=y.g(1);for(;l<=t;)t/=2,e/=2,r>>>=1;return(t+r)/e}var _=[],x=p(function t(e,r){var i,s=[],n=typeof e;if(r&&"object"==n)for(i in e)try{s.push(t(e[i],r-1))}catch(t){}return s.length?s:"string"==n?e:e+"\0"}((u=1==u?{entropy:!0}:u||{}).entropy?[h,f(e)]:null==h?function(){try{var r;return i&&(r=i.randomBytes)?r=r(s):(r=new Uint8Array(s),(t.crypto||t.msCrypto).getRandomValues(r)),f(r)}catch(r){var n=t.navigator,o=n&&n.plugins;return[+new Date,t,o,t.screen,f(e)]}}():h,3),_),y=new c(_);return m.int32=function(){return 0|y.g(4)},m.quick=function(){return y.g(4)/4294967296},m.double=m,p(f(y.S),e),(u.pass||g||function(t,e,i,s){return s&&(s.S&&d(s,y),t.state=function(){return d(y,{})}),i?(r[n]=t,e):t})(m,x,"global"in u?u.global:this==r,u.state)}function c(t){var e,r=t.length,i=this,n=0,o=i.i=i.j=0,a=i.S=[];for(r||(t=[r++]);n<s;)a[n]=n++;for(n=0;n<s;n++)a[n]=a[o=h&o+t[n%r]+(e=a[n])],a[o]=e;(i.g=function(t){for(var e,r=0,n=i.i,o=i.j,a=i.S;t--;)e=a[n=h&n+1],r=r*s+a[h&(a[n]=a[o=h&o+e])+(a[o]=e)];return i.i=n,i.j=o,r})(s)}function d(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function p(t,e){for(var r,i=t+"",s=0;s<i.length;)e[h&s]=h&(r^=19*e[h&s])+i.charCodeAt(s++);return f(e)}function f(t){return String.fromCharCode.apply(0,t)}if(p(r.random(),e),"object"==typeof module&&module.exports){module.exports=u;try{i=require("crypto")}catch(u){}}else"function"==typeof define&&define.amd?define((function(){return u})):r["seed"+n]=u}("undefined"!=typeof self?self:this,[],Math),"function"!=typeof JSON.decycle&&(JSON.decycle=function(t,e){"use strict";var r=new WeakMap;return function t(i,s){var n,o;return void 0!==e&&(i=e(i)),"object"!=typeof i||null===i||i instanceof Boolean||i instanceof Date||i instanceof Number||i instanceof RegExp||i instanceof String?i:void 0!==(n=r.get(i))?{$ref:n}:(r.set(i,s),Array.isArray(i)?(o=[],i.forEach((function(e,r){o[r]=t(e,s+"["+r+"]")}))):(o={},Object.keys(i).forEach((function(e){o[e]=t(i[e],s+"["+JSON.stringify(e)+"]")}))),o)}(t,"$")}),"function"!=typeof JSON.retrocycle&&(JSON.retrocycle=function retrocycle($){"use strict";var px=/^\$(?:\[(?:\d+|"(?:[^\\"\u0000-\u001f]|\\(?:[\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*")\])*$/;return function rez(value){value&&"object"==typeof value&&(Array.isArray(value)?value.forEach((function(element,i){if("object"==typeof element&&null!==element){var path=element.$ref;"string"==typeof path&&px.test(path)?value[i]=eval(path):rez(element)}})):Object.keys(value).forEach((function(name){var item=value[name];if("object"==typeof item&&null!==item){var path=item.$ref;"string"==typeof path&&px.test(path)?value[name]=eval(path):rez(item)}})))}($),$}),function(t,e,r,i){"use strict";function s(){const r=t,s=Math.floor,n=Array.prototype.slice,o=Object.prototype.toString;function a(t){return"[object Object]"==o.call(t)}function l(t){return a(t)}function h(t){return"[object Function]"==o.call(t)}function u(t){return"[object Array]"==o.call(t)}function c(t){return"[object Map]"==o.call(t)}function d(t){return"[object Set]"==o.call(t)}function p(t){return"[object String]"==o.call(t)}function f(t){return"[object Number]"==o.call(t)}function g(t){return"[object Boolean]"==o.call(t)}function m(t){return(t<0?-t:t)%2==0}function _(t){return void 0===t}function x(t){return u(t)||c(t)||a(t)}const y=1.6180339887,b=Math.seedrandom?new Math.seedrandom:function(){return Math.random()};function v(t,e){return t.forEach((t=>{if(!t[0](t[1]))throw new TypeError(`wanted ${e}`)})),!0}function T(t,e){for(let e,r=0;r<t.length;++r)if(e=t[r],e[0](e[1]))return!0;throw new TypeError(`wanted ${e}`)}function S(t,e,r){if(!t(e))throw new TypeError(`wanted ${r}`);return!0}const w=/(\/|\\\\)([^(\/|\\\\)]+)$/g,E=/(\.[^\.\/\?\\]*)(\?.*)?$/;function A(t,e){let r=E.exec(t);return r&&r[1]?(r=r[1].toLowerCase(),e||(r=r.substring(1))):r="",r}function P(t,e,r){const i=t(e);switch(r.length){case 0:return i;case 1:return i&&t(r[0]);case 2:return i&&t(r[0])&&t(r[1]);case 3:return i&&t(r[0])&&t(r[1])&&t(r[2]);default:return i&&r.every((e=>t(e)))}}let M=0;const R={},C={fun:(t,...e)=>P(h,t,e),str:(t,...e)=>P(p,t,e),undef:(t,...e)=>P(_,t,e),map:(t,...e)=>P(c,t,e),set:(t,...e)=>P(d,t,e),num:(t,...e)=>P(f,t,e),bool:(t,...e)=>P(g,t,e),pos:t=>f(t)&&t>0,neg:t=>f(t)&&t<0,vec:(t,...e)=>P(u,t,e),vecN:(t,e,r=!1)=>u(t)&&(r?t.length==e:t.length>=e),obj:(t,...e)=>P(a,t,e),notEmpty:t=>O.size(t)>0,isEmpty:t=>0==O.size(t),own:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},O={SORT_DESC:1,SORT_ASC:-1,error(...t){console.error(...t)},warn(...t){console.warn(...t)},log(...t){console.log(...t)},ndiv:(t,e)=>Math.floor(t/e),feq0:t=>t>=-1e-10&&t<=1e-10,feq:(t,e,r=1e-10)=>t>=e-r&&t<=e+r,hexToBin(t){const e={0:"0000",1:"0001",2:"0010",3:"0011",4:"0100",5:"0101",6:"0110",7:"0111",8:"1000",9:"1001",a:"1010",b:"1011",c:"1100",d:"1101",e:"1110",f:"1111",A:"1010",B:"1011",C:"1100",D:"1101",E:"1110",F:"1111"};let r="";for(let s,n=0;n<t.length;++n){if(!(s=e[t[n]])){r=i;break}r+=s}return r},pack:t=>JSON.stringify(t),unpack:t=>JSON.parse(t),v2:(t=0,e=0)=>[t,e],p2:(t=0,e=0)=>({x:t,y:e}),numOrZero:t=>isNaN(t)?0:t,setVec:(t,...e)=>(e.forEach(((e,r)=>t[r]=e)),t),evenN:(t,e=!1)=>m(t=s(t))?t:e?t+1:t-1,nichts:t=>null==t,echt:t=>null!=t,nor:(t,e)=>null==t?e:t,or:(t,e)=>void 0===t?e:t,toNum(t,e){const r=parseFloat(t);return isNaN(r)&&f(e)?e:r},percentRemain:(t,e,r=!1)=>(t>e&&(t=r?t%e:e),Math.max(0,e-t)/e),splitVerStr(t){const e=(""+(t||"")).split(".").filter((t=>t.length>0));return[this.toNum(e[0],0),this.toNum(e[1],0),this.toNum(e[2],0)]},cmpVerStrs(t,e){let r=this.splitVerStr(""+t),i=this.splitVerStr(""+e);return r[0]>i[0]?1:r[0]<i[0]?-1:r[1]>i[1]?1:r[1]<i[1]?-1:r[2]>i[2]?1:r[2]<i[2]?-1:0},pdef:t=>(t.configurable=!0)&&(t.enumerable=!0)&&t,findFiles:(t,e)=>t.filter((t=>e.indexOf(A(t,1))>-1)),zipMap(t,e,r){let i,s=Math.min(t.length,e.length),n=r||new Map;for(i=0;i<s;++i)n.set(t[i],e[i]);return n},zip(t,e,r){return this.zipMap(t,e,r)},zipObj(t,e,r){let i,s=Math.min(t.length,e.length),n=r||{};for(i=0;i<s;++i)n[t[i]]=e[i];return n},partition(t,e){const r=[];for(let i,s,n=0;;){for(i=[],s=0;s<t;++s){if(!(n<e.length)){s=-1;break}i.push(e[n++])}if(i.length>0&&r.push(i),s<0)break}return r},keys:t=>c(t)?Array.from(t.keys()):a(t)?Object.keys(t):[],selectNotKeys(t,e){T([[c,t],[a,t]],"map/object");const r=c(t)?new Map:{};return e=this.seq(e),this.doseq(t,((t,i)=>!e.includes(i)&&this.assoc(r,i,t))),r},selectKeys(t,e){T([[c,t],[a,t]],"map/object");const r=c(t)?new Map:{};return this.seq(e).forEach((e=>{c(t)?t.has(e)&&r.set(e,t.get(e)):C.own(t,e)&&(r[e]=t[e])})),r},copyKeys(t,e,r){return T([[c,t],[a,t]],"map/object"),e instanceof Map&&O.assert(t instanceof Map,"expected Map"),this.seq(r).forEach((r=>{c(e)?e.has(r)&&t.set(r,e.get(r)):(C.own(e,r)||void 0!==e[r])&&(t[r]=e[r])})),t},setManyKeys(t,e,r){return T([[c,t],[a,t]],"map/object"),this.seq(e).forEach((e=>{c(t)?t.set(e,r):t[e]=r})),t},clearKeys(t,e){return T([[c,t],[a,t]],"map/object"),this.seq(e).forEach((e=>{c(t)?t.delete(e):delete t[e]})),t},assertNot(t,...e){return this.assert(!t,...e)},assert(t,...e){if(!t)throw 0==e.length?"Assertion!":e.join("");return!0},noSuchKeys(t,e){return!this.some(this.seq(t),(t=>this.has(e,t)?t:null))},randInt2:(t,e)=>t+s(b()*(e-t+1)),randFloat2:(t,e)=>t+b()*(e-t),randMinus1To1:()=>2*(b()-.5),randInt:t=>s(b()*t),rand:(t=!1)=>t?Math.random():b(),randGaussian(t=6){let e,r=0;for(e=0;e<t;++e)r+=this.rand();return r/t},randSign:()=>b()>.5?-1:1,toGoldenRatio(t){let e=t/y,r=e/y;return[this.rounded(e),this.rounded(r)]},inst:(t,e)=>e instanceof t,hashCode(t){let e,r=0;for(e=0;e<t.length;++e)r=Math.imul(31,r)+t.charCodeAt(e);return r},cls(t){return this.trunc(t)},trunc(t){try{t.length=0}catch(t){}return t},randSample(t,e=1){let r,i;return 1==e?i=[this.randItem(t)]:0==e?i=[]:e>0&&(r=this.shuffle(t,!1),i=e>=r.length?r:r.slice(0,e)),i},randItem(t,e=!1){let r,i=-1;if(t)switch(t.length){case 0:case 1:r=t[i=0];break;case 2:r=t[i=this.randSign()>0?1:0];break;default:r=t[i=s(b()*t.length)]}return e?[r,i]:r},randAorB:(t,e)=>b()>.5?t:e,isPerc:t=>p(t)&&t.match(/^([0-9])(\.?[0-9]+|[0-9]*)%$/),isEven:t=>m(t),jsMap(...t){S(m,t.length,"even n# of args");let e,r=new Map;for(e=0;e<t.length;)r.set(t[e],t[e+1]),e+=2;return r},jsObj(...t){S(m,t.length,"even n# of args");let e,r={};for(e=0;e<t.length;)r[t[e]]=t[e+1],e+=2;return r},jsVec:(...t)=>0==t.length?[]:t.slice(),lastIndex:t=>u(t)&&t.length>0?t.length-1:-1,first(t){if(u(t)&&t.length>0)return t[0]},last(t){if(u(t)&&t.length>0)return t[t.length-1]},head(t){return this.first(t)},tail(t){return this.last(t)},floor:t=>Math.floor(t),ceil:t=>Math.ceil(t),abs:t=>Math.abs(t),sqrt:t=>Math.sqrt(t),min:(...t)=>Math.min(...t),max:(...t)=>Math.max(...t),slice:(t,e)=>n.call(t,e),every(t,e){S(u,t,"array");for(let r=0;r<t.length;++r)if(h(e)){if(!e(t[r]))return!1}else if(t[r]!=e)return!1;return t.length>0},notAny(t,e){S(u,t,"array");for(let r=0;r<t.length;++r)if(h(e)){if(e(t[r]))return!1}else if(t[r]===e)return!1;return t.length>0},copy(t,e=[]){v([[u,t],[u,e]],"arrays");let r,i=Math.min(t.length,e.length);for(r=0;r<i;++r)t[r]=e[r];return t},append(t,e=[],r=!1){v([[u,t],[u,e]],"arrays"),r&&(t.length=0);for(let r=0;r<e.length;++r)t.push(e[r]);return t},fill(t,e,...r){if(f(t)&&(t=new Array(t)),u(t))for(let i=0;i<t.length;++i)t[i]=h(e)?e(i,...r):e;return t},size(t){return u(t)||p(t)?t.length:d(t)||c(t)?t.size:t?this.keys(t).length:0},nextId:()=>++M,now:()=>Date.now(),fileExt:t=>A(t),fileBase(t){let e,r,i=t.indexOf("?");return i>0&&(t=t.substring(0,i)),t=t.replace(/(\/|\\\\)$/,""),r=w.exec(t),e="",r&&(e=r[2],i=e.lastIndexOf("."),i>0&&(e=e.substring(0,i))),e},range(t,e,r=1){1==arguments.length&&(e=t,t=0,r=1);let i=(e-t)/r;const s=[];i=Math.ceil(i),i=Math.max(0,i),s.length=i;for(let e=0;e<i;++e)s[e]=t,t+=r;return s},shuffle(t,e=!0){S(u,t,"array");const r=n.call(t,0);switch(r.length){case 0:case 1:break;case 2:if(this.randSign()>0){let t=r[0];r[0]=r[1],r[1]=t}break;default:for(let t,e,i=r.length-1;i>0;--i)e=s(b()*(i+1)),t=r[i],r[i]=r[e],r[e]=t}return e?this.copy(t,r):r},shuffle2(t,e=!0){S(u,t,"array");const r=n.call(t,0);switch(r.length){case 0:case 1:break;case 2:if(this.randSign()>0){let t=r[0];r[0]=r[1],r[1]=t}break;default:for(let t,e,i=0,n=r.length;i<n;++i)e=i+s(b()*(n-i)),t=r[e],r[e]=r[i],r[i]=t}return e?this.copy(t,r):r},shuffle3(t,e=!0){return(e?t:n.call(t,0)).sort(((t,e)=>this.rand()>.5?-1:this.rand()>.5?1:0))},uniq:t=>(S(u,t,"array"),Array.from(new Set(t))),map(t,e,r){if(S(x,t,"array/map/object"),u(t))return t.map(e,r);{const i=c(t)?new Map:{};return this.doseq(t,((s,n)=>{this.assoc(i,n,e.call(r,s,n,t))})),i}},find(t,e,r){let i,s=!0,o=n.call(arguments,3);return this.doseq(t,((t,n)=>{s&&e.apply(r,[t,n].concat(o))&&(i=[n,t],s=!1)})),i},some(t,e,r){let i,s=!0,o=n.call(arguments,3);return this.doseq(t,((t,n)=>{s&&(i=e.apply(r,[t,n].concat(o)),i?s=!1:i=void 0)})),i},equals(t,e){if(l(t)&&l(e)){let r,i,s=Object.keys(t),n=Object.keys(e);if(s.length==n.length){for(let o=0;o<s.length;++o)if(r=s[o],i=n[o],!this.equals(r,i)||!this.equals(t[r],e[i]))return!1;return!0}return!1}if(u(t)&&u(e)){if(t.length==e.length){for(let r=0;r<t.length;++r)if(!this.equals(t[r],e[r]))return!1;return!0}return!1}if(f(t)&&f(e))return t==e;if(p(t)&&p(e))return t==e;if(g(t)&&g(e))return t==e;if(null===t&&null===e)return!0;if(void 0===t&&void 0===e)return!0;throw Error("cant call equals for these types")},invoke(t,e){let r=n.call(arguments,2);u(t)&&t.forEach((t=>t[e].apply(t,r)))},delay:(t,e)=>setTimeout(e,t),timer:(t,e=0,r=!1)=>({repeat:!!r,id:r?setInterval(t,e):setTimeout(t,e)}),clear(t){t&&t.id?(t.repeat?clearInterval(t.id):clearTimeout(t.id),t.id=0):C.pos(t)&&clearTimeout(t)},rmap:(t,e,r,i,s)=>(t-e)/(r-e)*(s-i)+i,dotimes(t,e,r,...i){for(let s=0;s<t;++s)e.call(r,s,...i)},rseq(t,e,r){if(S(u,t,"array"),t.length>0)for(let i=t.length-1;i>=0;--i)e.call(r,t[i],i,t)},doseq(t,e,r){u(t)?t.forEach(e,r):c(t)?t.forEach(((i,s)=>e.call(r,i,s,t))):a(t)&&Object.keys(t).forEach((i=>e.call(r,t[i],i,t)))},doseqEx(t,e,r){this.doseq(t,((i,s)=>null!=i&&e.call(r,i,s,t)))},dissoc(t,e){if(arguments.length>2){let e,r=1;for(;r<arguments.length;++r)e=this.dissoc(t,arguments[r]);return e}{let r;return c(t)?(r=t.get(e),t.delete(e)):a(t)&&(r=t[e],delete t[e]),r}},get(t,e){if(void 0!==e){if(c(t))return t.get(e);if(t)return t[e]}},assoc(t,e,r){if(arguments.length>3){if((arguments.length-1)%2!=0)throw"wanted even count of args";let e,r=1;for(;r<arguments.length;)e=this.assoc(t,arguments[r],arguments[r+1]),r+=2;return e}{let i;return c(t)?(i=t.get(e),t.set(e,r)):t&&(i=t[e],t[e]=r),i}},disj(t,e){const r=t?t.indexOf(e):-1;return r>-1&&t.splice(r,1),r>-1},conj:(t,...e)=>(t&&e.forEach((e=>t.push(e))),t),seq:(t,e=/[,; \t\n]+/)=>("string"==typeof t&&(t=t.split(e).map((t=>t.trim())).filter((t=>t.length>0))),u(t)||(t=[t]),t),has(t,e){return 1!=arguments.length&&(c(t)?t.has(e):u(t)?-1!=t.indexOf(e):!!a(t)&&C.own(t,e))},patch(t,e){return S(a,t=t||{},"object"),e&&Object.keys(e).forEach((r=>{this.has(t,r)||(t[r]=e[r])})),t},clone(t){return t?this.unpack(this.pack(t)):t},inject:(t,...e)=>(t=t||{},e.forEach((e=>e&&function(t,e){let r=Object.keys(e).reduce(((t,r)=>(t[r]=Object.getOwnPropertyDescriptor(e,r),t)),{});return Object.getOwnPropertySymbols(e).forEach((t=>{let i=Object.getOwnPropertyDescriptor(e,t);i.enumerable&&(r[t]=i)})),Object.defineProperties(t,r)}(t,e))),t),deepCopyArray(t){S(u,t,"array");let e,r,i=[];for(e=0,r=t.length;e<r;++e)i[e]=u(t[e])?this.deepCopyArray(t[e]):t[e];return i},mergeEx(t,e){return this.merge(this.merge({},t),e)},merge(t,e){let r;return Object.keys(e).forEach((i=>{r=e[i],"object"==typeof r&&null!==r&&t[i]?("object"!=typeof t[i]&&(t[i]=r instanceof Array?[]:{}),this.merge(t[i],r)):t[i]=r})),t},throttle(t,e,r){let i=!0,s=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return a(r)&&(i="leading"in r?!!r.leading:i,s="trailing"in r?!!r.trailing:s),this.debounce(t,e,{leading:i,trailing:s,maxWait:e})},debounce(t,e,i){let s,n,o,a,h,u,c=0,d=!1,p=!1,f=!0;const g=!e&&0!==e&&"function"==typeof r.requestAnimationFrame;if("function"!=typeof t)throw new TypeError("Expected a function");function m(e){const r=s,i=n;return s=n=void 0,c=e,a=t.apply(i,r),a}function _(t,e){return g?(r.cancelAnimationFrame(h),r.requestAnimationFrame(t)):setTimeout(t,e)}function x(t){const r=t-u;return void 0===u||r>=e||r<0||p&&t-c>=o}function y(){const t=Date.now();if(x(t))return b(t);h=_(y,function(t){const r=t-c,i=e-(t-u);return p?Math.min(i,o-r):i}(t))}function b(t){return h=void 0,f&&s?m(t):(s=n=void 0,a)}function v(...t){const r=Date.now(),i=x(r);if(s=t,n=this,u=r,i){if(void 0===h)return function(t){return c=t,h=_(y,e),d?m(t):a}(u);if(p)return h=_(y,e),m(u)}return void 0===h&&(h=_(y,e)),a}return e=+e||0,l(i)&&(d=!!i.leading,p="maxWait"in i,o=p?Math.max(+i.maxWait||0,e):o,f="trailing"in i?!!i.trailing:f),v.cancel=function(){void 0!==h&&function(t){if(g)return r.cancelAnimationFrame(t);clearTimeout(t)}(h),c=0,s=u=n=h=void 0},v.flush=function(){return void 0===h?a:b(Date.now())},v.pending=function(){return void 0!==h},v},negate:t=>(S(h,t,"function"),function(...e){return!t.apply(this,e)}),strPadRight:(t,e,r)=>(e-=t.length)>0?t+new Array(Math.ceil(e/r.length)+1).join(r).substr(0,e):t,strPadLeft:(t,e,r)=>(e-=t.length)>0?new Array(Math.ceil(e/r.length)+1).join(r).substr(0,e)+t:t,safeSplit:(t,e)=>(t||"").trim().split(e).filter((t=>t.length>0)),capitalize:t=>t.charAt(0).toUpperCase()+t.slice(1),prettyNumber(t,e=2,r="0"){return this.strPadLeft(Number(t).toString(),e,r)},prettyMillis(t){let e,r,i=s(t/1e3);r=s(i/60),t-=1e3*i,i-=60*r,e=s(r/60),r-=60*e;let n=[];return n.push(`${i}.${t} secs`),(r>0||e>0)&&n.push(`${r} mins, `),e>0&&n.push(`${e} hrs, `),n.reverse().join("")},swap(t,e,r){let i=t[e];return t[e]=t[r],t[r]=i,t},listIndexesOf(t,e){let r=O.fill(t.length,(t=>t));return e?this.shuffle(r):r},dropArgs:(t,e)=>t.length>e?n.call(t,e):[],isSSL:()=>t&&t.location&&t.location.protocol.indexOf("https")>=0,isMobile:t=>t&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t.userAgent),isSafari:t=>t&&/Safari/.test(t.userAgent)&&/Apple Computer/.test(t.vendor),isCrossOrigin(e){let r=t;if(2==arguments.length&&911==arguments[1].hack&&(r=arguments[1]),r&&r.location&&e){const t=e.indexOf("://");if(t>0){let i=e.indexOf("/",t+3);return(i<0?e:e.substring(0,i))!=r.location.origin}}},addEvent(t,e,r,i){u(t)&&1==arguments.length?t.forEach((t=>this.addEvent.apply(this,t))):e.addEventListener(t,r,i)},delEvent(t,e,r,i){u(t)&&1==arguments.length?t.forEach((t=>this.delEvent.apply(this,t))):e.removeEventListener(t,r,i)},rounded(t){return this.roundUnderOffset(t,.5)},roundUnderOffset(t,e){const r=s(t);return t-r<e?r:r+1},comparator(t,e,r){return 1==arguments.length?t<0?function(t,e){return t<e?-1:t>e?1:0}:function(t,e){return t>e?-1:t<e?1:0}:t<0?function(t,i){let s=e(t),n=r(i);return s<n?-1:s>n?1:0}:function(t,i){let s=e(t),n=r(i);return s>n?-1:s<n?1:0}}},I={qSelector:t=>e.querySelectorAll(t),qId:t=>e.getElementById(t),parent(t){if(t)return t.parentNode},conj:(t,e)=>t.appendChild(e),byTag:(t,r)=>p(r)?e.getElementsByTagNameNS(r,t):e.getElementsByTagName(id),attrs(t,e){return!a(e)&&e?(arguments.length>2&&t.setAttribute(e,arguments[2]),t.getAttribute(e)):(e&&O.doseq(e,((e,r)=>t.setAttribute(r,e))),t)},css(t,e){return!a(e)&&e?(arguments.length>2&&(t.style[e]=arguments[2]),t.style[e]):(e&&O.doseq(e,((e,r)=>t.style[r]=e)),t)},wrap(t,e){const r=t.parentNode;return e.appendChild(t),r.appendChild(e),e},newElm(t,r,i){const s=e.createElement(t);return this.attrs(s,r),this.css(s,i),s},newTxt(t,r,i){const s=e.createTextNode(t);return this.attrs(s,r),this.css(s,i),s}},B={},k=[];class G{constructor(){this._tree=new Map,this._targets=new Map}sub(t,e,r,i){let s=t[0],n=t[1];return n&&!this._targets.has(n)&&this._targets.set(n,1),O.seq(s).forEach((t=>{if(e||(e=t),p(e)&&(e=(r=r||n)[e]),!e)throw"Error: no callback for sub()";this._tree.has(t)||this._tree.set(t,O.jsMap());let s=this._tree.get(t);n=n||B,!s.has(n)&&s.set(n,[]),s.get(n).push([e,r,i])})),this}pub(t,...e){let r,i,s=t[0],n=t[1]||B;return(n===B||this._targets.has(n))&&O.seq(s).forEach((t=>{i=this._tree.get(t),r=i&&i.get(n),r&&r.forEach((t=>{t[0].apply(t[1],e.concat(t[2]||k))}))})),this}reset(){return this._targets.clear(),this._tree.clear(),this}drop(t){if(this._targets.has(t)){this._targets.delete(t);let e=this._tree.values();for(let r=e.next();!r.done;)r.value.delete(t),r=e.next()}return this}unsub(t,e,r){if(1!=arguments.length||C.vec(t)){let i=t[0],s=t[1]||B;if(s===B||this._targets.has(s)){let t,n;O.seq(i).forEach((i=>{if(t=this._tree.get(i),n=t&&t.get(s),n&&(p(e)&&(e=(r=r||s)[e]),e))for(let t=n.length-1;t>=0;--t)n[t][0]===e&&n[t][1]===r&&n.splice(t,1)}))}}else this.drop(t);return this}}return e?R.dom=I:(delete O.addEvent,delete O.delEvent),R.EventBus=function(){return new G},R.is=C,R.u=O,R}"object"==typeof module&&module.exports||(e=t.document),"object"==typeof module&&module.exports?module.exports=s():t["io/czlab/mcfud/core"]=s}(this),function(t,e){"use strict";function r(e){e||(e=t["io/czlab/mcfud/core"]());const r=360,i=2*Math.PI,s=(Math.PI,Math.floor),{is:n,u:o}=e,a=t=>t<0?- -t%r:t%r;return{lerp:(t,e,r)=>(1-r)*t+r*e,xmod:(t,e)=>t<0?t- -(e+e*s(-t/e)):t%e,ndiv:(t,e)=>s(t/e),pow:(t,e)=>0==e?1:1==e?t:2==e?t*t:3==e?t*t*t:Math.pow(t,e),pow2(t){let e=2;for(;t>e;)e*=2;return e},clamp:(t,e,r)=>r<t?t:r>e?e:r,sqr:t=>t*t,fuzzyEq:(t,e)=>o.feq(t,e),fuzzyZero:t=>o.feq0(t),radToDeg:t=>a(r*t/i),degToRad:t=>i*a(t)/r,pythag2:(t,e)=>t*t+e*e,pythag:(t,e)=>Math.sqrt(t*t+e*e),wrap:(t,e)=>(t+1)%e,biasGreater:(t,e)=>t>=.95*e+.01*t,remap(t,e,r,i,s,n){const o=(t-e)/(r-e)*(s-i)+i;return n?i<s?this.clamp(i,s,o):this.clamp(s,i,o):o},perlin1D(t,e,r,i,n){let o,a,l,h,u,c,d,p;for(let f=0;f<t;++f){o=0,a=0,l=1;for(let n=0;n<r;++n)h=t>>n,u=s(f/h)*h,c=(u+h)%t,d=(f-u)/h,p=(1-d)*e[s(u)]+d*e[s(c)],a+=l,o+=p*l,l/=i;n[f]=o/a}},perlin2D(t,e,r,i,n,o){let a,l,h,u,c,d,p,f,g,m,_,x;for(let y=0;y<t;++y)for(let b=0;b<e;++b){a=0,l=0,h=1;for(let o=0;o<i;++o)f=t>>o,g=s(y/f)*f,m=s(b/f)*f,_=(g+f)%t,x=(m+f)%e,u=(y-g)/f,c=(b-m)/f,d=(1-u)*r[s(m*t+g)]+u*r[s(m*t+_)],p=(1-u)*r[s(x*t+g)]+u*r[s(x*t+_)],l+=h,a+=(c*(p-d)+d)*h,h/=n;o[b*t+y]=a/l}}}}"object"==typeof module&&module.exports?module.exports=r(require("./core")):t["io/czlab/mcfud/math"]=r}(this),function(t,e){"use strict";function r(e){e||(e=t["io/czlab/mcfud/core"]());const{u:r,is:i}=e,s=(t,e)=>r.assert(!i.num(t)&&!i.num(e)&&t&&e,"wanted 2 vecs"),n=(t,e=0,r=0)=>t?[e,r]:{x:e,y:r},o={};class a{constructor(){this.x=0,this.y=0}unit(t){return i.bool(t)&&(t=n(t)),i.vec(t)?(t[0]=this.x,t[1]=this.y):(t.x=this.x,t.y=this.y),t}bind(t){return i.vec(t)?(this.x=t[0],this.y=t[1]):(this.x=t.x,this.y=t.y),this}op(t,e,r){let s=o.take();switch(s.x=this.x,s.y=this.y,t){case"+":i.num(e)&&(s.x+=e),i.num(r)&&(s.y+=r);break;case"-":i.num(e)&&(s.x-=e),i.num(r)&&(s.y-=r);break;case"*":i.num(e)&&(s.x*=e),i.num(r)&&(s.y*=r);break;case"/":i.num(e)&&(s.x/=e),i.num(r)&&(s.y/=r)}return s}"+"(t){return this.op("+",t.x,t.y)}"-"(t){return this.op("-",t.x,t.y)}"*"(t){return this.op("*",t.x,t.y)}"/"(t){return this.op("/",t.x,t.y)}}function l(t,e,r,s,n,o,a){const l=t-n,h=e-o,u=n+(l*r-h*s),c=o+(l*s+h*r);return i.vec(a)?(a[0]=u,a[1]=c):(a.x=u,a.y=c),a}function h(t,e,r,s){let n,a,l=o.take().bind(t);if(i.num(e))a=l.op(r,e,e);else{let t=o.take().bind(e);a=l[r](t),o.drop(t)}return n=a.unit(s?t:i.vec(t)),o.drop(l,a),n}r.inject(o,{take(){return this._pool.pop()},drop(...t){t.forEach((t=>{t.x=0,t.y=0,this._pool.push(t)}))},_pool:r.fill(16,(()=>new a))});const u={gx:t=>i.vec(t)?t[0]:t.x,sx(t,e){i.vec[t]?t[0]=e:t.x=e},gy:t=>i.vec(t)?t[1]:t.y,sy(t,e){i.vec[t]?t[1]=e:t.y=e},vec:(t=0,e=0)=>n(!0,t,e),vecXY:(t=0,e=0)=>n(!1,t,e),add(t,e){return r.assert(2==arguments.length)&&h(t,e,"+")},add$(t,e){return r.assert(2==arguments.length)&&h(t,e,"+",!0)},sub(t,e){return r.assert(2==arguments.length)&&h(t,e,"-")},sub$(t,e){return r.assert(2==arguments.length)&&h(t,e,"-",!0)},mul(t,e){return r.assert(2==arguments.length)&&h(t,e,"*")},mul$(t,e){return r.assert(2==arguments.length)&&h(t,e,"*",!0)},div(t,e){return r.assert(2==arguments.length)&&h(t,e,"/")},div$(t,e){return r.assert(2==arguments.length)&&h(t,e,"/",!0)},dot(t,e){s(t,e);let r=o.take().bind(t),i=o.take().bind(e),n=r.x*i.x+r.y*i.y;return o.drop(r,i),n},equals(t,e){let r=o.take().bind(t),i=o.take().bind(e),s=r.x==i.x&&r.y==i.y;return o.drop(r,i),s},vecAB(t,e){s(t,e);let r,n=o.take().bind(t),a=o.take().bind(e),l=o.take();return l.x=a.x-n.x,l.y=a.y-n.y,r=l.unit(i.vec(t)),o.drop(n,a,l),r},len2(t){return this.dot(t,t)},len(t){return Math.sqrt(this.len2(t))},dist2(t,e){return this.len2(this.sub(e,t))},dist(t,e){return Math.sqrt(this.dist2(t,e))},unit(t){let e,s=this.len(t),n=o.take().bind(t);return r.feq0(s)?(n.x=0,n.y=0):(n.x/=s,n.y/=s),e=n.unit(i.vec(t)),o.drop(n),e},unit$(t){let e,i=this.len(t),s=o.take().bind(t);return r.feq0(i)?(s.x=0,s.y=0):(s.x/=i,s.y/=i),e=s.unit(t),o.drop(s),e},copy(t,e){s(t,e);let r,i=o.take().bind(t),n=o.take().bind(e);return i.x=n.x,i.y=n.y,r=i.unit(t),o.drop(i,n),r},clone(t){let e=o.take().bind(t),r=e.unit(i.vec(t));return o.drop(e),r},set(t,e,r){let s,n=o.take().bind(t);return i.num(e)&&(n.x=e),i.num(r)&&(n.y=r),s=n.unit(t),o.drop(n),s},setX(t,e){return this.set(t,e)},setY(t,e){return this.set(t,null,e)},rot(t,e,r=null){let s,a,h=0,u=0,c=o.take().bind(t);return r&&(a=o.take().bind(r),h=a.x,u=a.y,o.drop(a)),s=l(c.x,c.y,Math.cos(e),Math.sin(e),h,u,n(i.vec(t))),o.drop(c),s},rot$(t,e,r){let i,s,n=0,a=0,h=o.take().bind(t);return r&&(s=o.take().bind(r),n=s.x,a=s.y,o.drop(s)),i=l(h.x,h.y,Math.cos(e),Math.sin(e),n,a,t),o.drop(h),i},cross(t,e){let r;if(i.num(t)){let s=o.take(),n=o.take().bind(e);s.x=-t*n.y,s.y=t*n.x,r=s.unit(i.vec(e)),o.drop(n,s)}else if(i.num(e)){let s=o.take(),n=o.take().bind(t);s.x=e*n.y,s.y=-e*n.x,r=s.unit(i.vec(t)),o.drop(n,s)}else{s(t,e);let i=o.take().bind(t),n=o.take().bind(e);r=i.x*n.y-i.y*n.x,o.drop(i,n)}return r},angle(t,e){return Math.acos(this.dot(t,e)/(this.len(t)*this.len(e)))},normal(t,e=!1){let r,s=o.take(),n=o.take().bind(t);return e?(s.x=-n.y,s.y=n.x):(s.x=n.y,s.y=-n.x),r=s.unit(i.vec(t)),o.drop(n,s),r},normal$(t,e=!1){let r,i=o.take(),s=o.take().bind(t);return e?(i.x=-s.y,i.y=s.x):(i.x=s.y,i.y=-s.x),r=i.unit(t),o.drop(s,i),r},proj_scalar(t,e){return this.dot(t,e)/this.len(e)},proj(t,e){const r=this.unit(e);this.mul$(r,this.dot(t,r));let s=o.take().bind(r),n=s.unit(i.vec(t));return o.drop(s),n},perp(t,e){return this.sub(t,this.proj(t,e))},reflect(t,e){const r=2*this.dot(t,e);return this.sub(t,this.mul(e,r))},flip(t){return this.mul(t,-1)},flip$(t){return this.mul$(t,-1)},translate(t,...e){let r,s,n,a,l=o.take().bind(t);return 1==e.length&&i.vec(e[0])&&!i.num(e[0][0])&&(e=e[0]),n=e.map((t=>(s=o.take().bind(t),r=s["+"](l),a=r.unit(i.vec(t)),o.drop(s,r),a))),o.drop(l),n},clamp$(t,e,r){const i=this.len(t),s=Math.max(e,Math.min(r,i));return i==s?t:this.mul$(this.div$(t,i||1),s)},clamp(t,e,r){const i=this.len(t),s=Math.max(e,Math.min(r,i));return i==s?t:this.mul(this.div(t,i||1),s)}};return u}"object"==typeof module&&module.exports?module.exports=r(require("./core")):t["io/czlab/mcfud/vec2"]=r}(this),function(t,e){"use strict";function r(e){e||(e=t["io/czlab/mcfud/core"]()),Math.atan2;const r=Math.cos,i=Math.sin,s=(Math.tan,Math.floor),{u:n,is:o}=e,a=t=>t%2!=0,l=(t,e,r,i)=>i-1+(r-1)*e,h=(t,e,r)=>({cells:r,dim:[t,e]}),u=(t,e)=>h(t,e,n.fill(t*e,0));return{v4:(t=0,e=0,r=0,i=0)=>[t,e,r,i],v3:(t=0,e=0,r=0)=>[t,e,r],dot:(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2],cross(t,e){return this.v3(t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0])},len2(t){return this.dot(t,t)},len(t){return Math.sqrt(this.len2(t))},unit(t){let e=this.len(t);if(!n.feq0(e))return[t[0]/e,t[1]/e,t[2]/e]},sub(t,e){return o.num(e)?this.v3(t[0]-e,t[1]-e,t[2]-e):this.v3(t[0]-e[0],t[1]-e[1],t[2]-e[2])},add(t,e){return o.num(e)?this.v3(t[0]+e,t[1]+e,t[2]+e):this.v3(t[0]+e[0],t[1]+e[1],t[2]+e[2])},mul(t,e){return o.num(e)?this.v3(t[0]*e,t[1]*e,t[2]*e):this.v3(t[0]*e[0],t[1]*e[1],t[2]*e[2])},div(t,e){return o.num(e)?this.v3(t[0]/e,t[1]/e,t[2]/e):this.v3(t[0]/e[0],t[1]/e[1],t[2]/e[2])},matrix([t,e],...r){const i=t*e;return 0==r.length?u(t,e):n.assert(i==r.length)&&h(t,e,r)},matCell(t,e,r,i){const s=l(t.dim[0],t.dim[1],e,r);if(s>=0&&s<t.cells.length)return o.num(i)?(t.cells[s]=i,t):t.cells[s]},matIdentity(t){const e=n.assert(t>0)&&n.fill(t*t,0);for(let r=0;r<t;++r)e[l(0,t,r+1,r+1)]=1;return h(t,t,e)},matZero:t=>n.assert(t>0)&&h(t,t,n.fill(t*t,0)),matRowMajors(t){const[e,r]=t.dim;return n.partition(r,t.cells)},matColMajors(t){const[e,r]=t.dim,i=[];for(let s,n=0;n<r;++n){s=[];for(let i=0;i<e;++i)s.push(t.cells[i*r+n]);i.push(s)}return i},mat2(t,e,r,i){return this.matrix([2,2],t,e,r,i)},mat3(t,e,r,i,s,n,o,a,l){return this.matrix([3,3],t,e,r,i,s,n,o,a,l)},mat4(t,e,r,i,s,n,o,a,l,h,u,c,d,p,f,g){return this.matrix([4,4],t,e,r,i,s,n,o,a,l,h,u,c,d,p,f,g)},matEq(t,e){return t.dim[0]==e.dim[0]&&t.dim[1]==e.dim[1]&&(r=t.cells,i=e.cells,r.length==i.length&&r.every(((t,e)=>t==i[e]||n.feq(t,i[e]))));var r,i},matXpose(t){const[e,r]=t.dim,i=e*r,n=[];for(let o=0;o<i;++o)n.push(t.cells[s(o/e)+r*(o%e)]);return h(r,e,n)},matScale:(t,e)=>h(t.dim[0],t.dim[1],t.cells.map((t=>t*e))),matMult(t,e){let[r,i]=t.dim,[s,o]=e.dim,a=t.cells,l=e.cells;n.assert(i==s,"mismatch matrices");let u=new Array(r*o);for(let t=0;t<r;++t)for(let e=0;e<o;++e)u[e+t*o]=n.range(s).reduce(((r,s)=>r+a[s+t*i]*l[e+s*o]),0);return h(r,o,u)},matDet(t){let[e,r]=t.dim,i=[];if(2==r)return this._matDet2x2(t);for(let e=0;e<r;++e)n.conj(i,this.matDet(this.matCut(t,1,e+1)));return n.range(r).reduce(((e,r)=>{let s=i[r];return e+t.cells[r]*(a(r)?-s:s)}),0)},_matDet2x2:t=>(n.assert(4===t.cells.length),t.cells[0]*t.cells[3]-t.cells[1]*t.cells[2]),matCut(t,e,r){const[i,s]=t.dim;let o=e-1,a=r-1,l=[];for(let e=0;e<i;++e)for(let r=0;r<s;++r)e!=o&&r!=a&&n.conj(l,t.cells[r+e*s]);return h(i-1,s-1,l)},matMinor(t){const[e,r]=t.dim;let i=[];if(n.assert(e==r),2==r)return this._matMinor2x2(t);for(let s=0;s<e;++s)for(let e=0;e<r;++e)n.conj(i,this.matDet(this.matCut(t,s+1,e+1)));return h(e,r,i)},_matMinor2x2(t){return n.assert(4==t.cells.length)&&this.mat2(t.cells[3],t.cells[2],t.cells[1],t.cells[0])},matCofactor(t){const e=this.matMinor(t),[r,i]=e.dim;let s=e.cells.slice();for(let t=0;t<r;++t)for(let e,r=0;r<i;++r)e=t*i+r,a(t+r)&&(s[e]=-s[e]);return h(r,i,s)},matAdjugate(t){return this.matXpose(this.matCofactor(t))},_minv2x2(t){const[e,r]=t.dim;n.assert(4==t.cells.length&&2==e&&2==r);let i,s=t.cells,o=s[0]*s[3]-s[1]*s[2];if(n.feq0(o))i=this.matIdentity(e);else{let t=1/o;i=this.mat2(s[3]*t,-s[1]*t,-s[2]*t,s[0]*t)}return i},matInv(t){const[e,r]=t.dim;if(2==r)return this._minv2x2(t);let i=this.matDet(t);return n.feq0(i)?this.matIdentity(e):this.matScale(this.matAdjugate(t),1/i)},matFromColMajor(t){let e=t.length,r=t[0].length,i=u(r,e);for(let r,s=0;s<t.length;++s){r=t[s];for(let t=0;t<r.length;++t)i.cells[t*e+s]=r[t]}return i},matToColMajor(t){const[e,r]=t.dim,i=[];t.cells.slice();for(let s,n=0;n<r;++n){s=[];for(let i=0;i<e;++i)s.push(t.cells[i*r+n]);i.push(s)}return i},scale3D(t){const e=this.matIdentity(4);return e.cells[l(0,4,1,1)]=t[0],e.cells[l(0,4,2,2)]=t[1],e.cells[l(0,4,3,3)]=t[2],e},translate3D(t){const e=this.matIdentity(4);return e.cells[l(0,4,4,1)]=t[0],e.cells[l(0,4,4,2)]=t[1],e.cells[l(0,4,4,3)]=t[2],e},rot3D(t,e,r){return this.matMult(this.zRot3D(r),this.matMult(this.yRot3D(e),this.xRot3D(t)))},matVMult(t,e){let r=t.dim[1],i=e.length;n.assert(r==i);let s=this.matMult(t,h(i,1,e)),o=s.cells;return s.cells=null,o},rot2D(t){return this.mat2(r(t),-i(t),i(t),r(t))},xRot3D(t){return this.mat4(1,0,0,0,0,r(t),-i(t),0,0,i(t),r(t),0,0,0,0,1)},yRot3D(t){return this.mat4(r(t),0,i(t),0,0,1,0,0,-i(t),0,r(t),0,0,0,0,1)},zRot3D(t){return this.mat4(r(t),-i(t),0,0,i(t),r(t),0,0,0,0,1,0,0,0,0,1)},isIdentity(t){const[e,r]=t.dim;if(e==r){for(let i,s=0;s<e;++s)for(let e=0;e<r;++e)if(i=t.cells[s*r+e],s+1==e+1){if(1!=i)return!1}else if(0!=i)return!1;return!0}return!1},isOrthogonal(t){let e=this.matDet(t);return 1==Math.abs(e)&&this.isIdentity(this.matMult(this.matXpose(t),this.matInv(t)))}}}"object"==typeof module&&module.exports?module.exports=r(require("./core")):t["io/czlab/mcfud/matrix"]=r}(this),function(t,e){"use strict";const r=" @N/\\Ri2}aP`(xeT4F3mt;8~%r0v:L5$+Z{'V)\"CKIc>z.*fJEwSU7juYg<klO&1?[h9=n,yoQGsW]BMHpXb6A|D#q^_d!-".split(""),i=r.length;function s(e){e||(e=t["io/czlab/mcfud/core"]());const{u:s}=e,n=t=>Math.abs(t)%i,o=t=>r[t],a=t=>r.findIndex((e=>e==t));function l(t,e){let r=e+t;return o(r>=i?r-i:r)}function h(t,e){let r=e-t;return o(r<0?i+r:r)}return{encrypt(t,e){if(0!=e){let r,i=n(e);r=t.split("").map((t=>(r=a(t),r<0?t:((t,e,r)=>t<0?l(e,r):h(e,r))(e,i,r)))),t=r.join("")}return t},decrypt(t,e){if(0!=e){let r,i=n(e);r=t.split("").map((t=>(r=a(t),r<0?t:((t,e,r)=>t<0?h(e,r):l(e,r))(e,i,r)))),t=r.join("")}return t}}}"object"==typeof module&&module.exports?module.exports=s(require("./core")):t["io/czlab/mcfud/crypt"]=s}(this),function(t,e){"use strict";function r(e){return e||(e=t["io/czlab/mcfud/core"]()),{fsm(t){let e=t.initState();return{state:()=>e,process(){const r=t[e];r&&r.run&&r.run()},trigger(r="change",i){const s=t[e],n=s&&s.transitions[r];if(n){const r=n.target,o=t[r];if(o)return s.exit&&s.exit(),o.enter&&o.enter(),i&&i.action?i.action():n.action&&n.action(i),e=r}}}}}}"object"==typeof module&&module.exports?module.exports=r(require("./core")):t["io/czlab/mcfud/fsm"]=r}(this),function(t,e){"use strict";function r(e,r,i,s){e||(e=t["io/czlab/mcfud/core"]()),r||(r=t["io/czlab/mcfud/vec2"]()),i||(i=t["io/czlab/mcfud/math"]()),s||(s=t["io/czlab/mcfud/matrix"]());const n=2*Math.PI,{u:o}=e;return{setContextTransform:(t,e,r=!1)=>(t[r?"setTransform":"transform"](e.cells[0],e.cells[3],e.cells[1],e.cells[4],e.cells[2],e.cells[5]),t),textStyle:(t,e,r,i,s,n)=>(e&&(t.font=e),i&&(t.fillStyle=i),s&&(t.textAlign=s),n&&(t.textBaseline=n),r&&(t.strokeStyle=r),t),drawShape:(t,e,...r)=>(e&&e.draw&&e.draw(t,...r),t),cfgStyle:(t,e,r,i,s)=>(r&&(t.fillStyle=r),e&&(t.strokeStyle=e),s&&(t.lineCap=s),i&&(t.lineWidth=i),t),drawPoints(t,e){t.beginPath();for(let i,s,n,o=e.length,a=0;a<o;++a)n=(a+1)%o,i=e[a],s=e[n],t.moveTo(r.gx(i),r.gy(i)),t.lineTo(r.gx(s),r.gy(s));return t.closePath(),t.stroke(),t},fillPoints(t,e){t.beginPath();for(let i,s,n,o=e.length,a=0;a<o;++a)n=(a+1)%o,i=e[a],s=e[n],0==a?t.moveTo(r.gx(i),r.gy(i)):t.lineTo(r.gx(i),r.gy(i)),t.lineTo(r.gx(s),r.gy(s));return t.closePath(),t.fill(),t},drawCircle:(t,e,r,i)=>(t.beginPath(),t.arc(e,r,i,0,n,!0),t.closePath(),t.stroke(),t),fillCircle:(t,e,r,i)=>(t.beginPath(),t.arc(e,r,i,0,n,!0),t.closePath(),t.fill(),t),drawRect:(t,e,r,i,s,n=0,o=0,a=0)=>(t.save(),t.translate(o,a),t.rotate(n),t.translate(-o,-a),t.strokeRect(e,r,i,s),t.restore(),t),fillRect:(t,e,r,i,s,n=0,o=0,a=0)=>(t.save(),t.translate(o,a),t.rotate(n),t.translate(-o,-a),t.fillRect(e,r,i,s),t.restore(),t),drawLine:(t,e,r,i,s)=>(t.beginPath(),t.moveTo(e,r),t.lineTo(i,s),t.stroke(),t),drawText:(t,e,r,i)=>(t.strokeText(e,r,i),t),fillText:(t,e,r,i)=>(t.fillText(e,r,i),t),clearCanvas(t){return this.clearRect(t,0,0,t.canvas.width,t.canvas.height)},fillCanvas(t){return this.fillRect(t,0,0,t.canvas.width,t.canvas.height)},clearRect:(t,e,r,i,s)=>(t.clearRect(e,r,i,s),t)}}"object"==typeof module&&module.exports?module.exports=r(require("./core"),require("./vec2"),require("./math"),require("./matrix")):t["io/czlab/mcfud/gfx"]=r}(this),function(t,e){"use strict";const[r,i,s]=[1,0,-1];function n(e,n,o,a,l){e||(e=t["io/czlab/mcfud/core"]()),n||(n=t["io/czlab/mcfud/math"]()),o||(o=t["io/czlab/mcfud/vec2"]()),a||(a=t["io/czlab/mcfud/matrix"]()),l||(l=t["io/czlab/mcfud/algo/basic"]());const{Stack:h,StdCompare:u}=l,{is:c,u:d}=(Math.floor,e),p=d.fill(36,void 0);function f(t){d.assert(t.length>2&&t.length<=36,"too little/many vertices");let e=0,r=t[0][0];for(let i,s=1;s<t.length;++s)i=t[s][0],i>r?(r=i,e=s):d.feq(i,r)&&t[s][1]<t[e][1]&&(e=s);let i=0,s=e;for(;;){p[i]=s;let r=0,n=p[i];for(let e,i,a,l=1;l<t.length;++l)r!=s?(e=o.sub(t[r],t[n]),i=o.sub(t[l],t[n]),a=o.cross(e,i),a<0&&(r=l),d.feq0(a)&&o.len2(i)>o.len2(e)&&(r=l)):r=l;if(s=r,++i,r==e)break}const n=[];for(let e=0;e<i;++e)n.push(o.clone(t[p[e]]));return n}class g{constructor(t,e,r,i){switch(arguments.length){case 2:this.pos=o.vec(),this.width=t,this.height=e;break;case 4:this.pos=o.vec(t,e),this.width=r,this.height=i;break;default:throw"Error: bad input to Rect()"}}}class m{constructor(t,e){this.width=t,this.height=e}half(){return new m(n.ndiv(this.width,2),n.ndiv(this.height,2))}}class _{constructor(t,e,r,i){this.p=o.vec(t,e),this.q=o.vec(r,i)}}class b{constructor(t,e=0,r=0){this.pos=o.vec(e,r),this.shape=t}}class v{constructor(){this.orient=0}setOrient(t){throw Error("no implementation")}}class T{constructor(t,e){this.overlapN=o.vec(),this.overlapV=o.vec(),this.A=t,this.B=e,this.clear()}swap(){let t=new T,e=this.AInB,r=this.BInA,i=this.A;return t.overlap=this.overlap,t.A=this.B,t.B=i,t.AInB=r,t.BInA=e,t.overlapN=o.flip(this.overlapN),t.overlapV=o.flip(this.overlapV),t}clear(){return this.overlap=1/0,this.AInB=!0,this.BInA=!0,this}}function S(t,e){let r=1/0,i=-1/0;for(let s,n=0;n<t.length;++n)s=o.dot(t[n],e),s<r&&(r=s),s>i&&(i=s);return[r,i]}function w(t,e){let n=o.len2(t),a=o.dot(e,t);return a<0?r:a>n?s:i}function E(t,e,r,i,s,n){let[a,l]=S(e,s),[h,u]=S(i,s),c=o.vecAB(t,r),d=o.dot(c,s);if(h+=d,u+=d,a>u||h>l)return!0;if(n){let t=0;if(a<h)if(n.AInB=!1,l<u)t=l-h,n.BInA=!1;else{let[e,r]=[l-h,u-a];t=e<r?e:-r}else if(n.BInA=!1,l>u)t=a-u,n.AInB=!1;else{let[e,r]=[l-h,u-a];t=e<r?e:-r}let e=Math.abs(t);e<n.overlap&&(n.overlap=e,o.copy(n.overlapN,s),t<0&&o.flip$(n.overlapN))}}function A(t,e,r){let i,s=t.shape.radius+e.shape.radius,n=o.vecAB(t.pos,e.pos),a=o.len2(n),l=!(a>s*s);return l&&r&&(i=Math.sqrt(a),r.A=t,r.B=e,r.overlap=s-i,o.copy(r.overlapN,o.unit$(n)),o.copy(r.overlapV,o.mul(n,r.overlap)),r.AInB=t.shape.radius<=e.shape.radius&&i<=e.shape.radius-t.shape.radius,r.BInA=e.shape.radius<=t.shape.radius&&i<=t.shape.radius-e.shape.radius),l}function P(t,e,i){let n,a=e.shape.radius*e.shape.radius,l=o.vecAB(t.pos,e.pos),h=t.shape.calcPoints,u=o.vec();for(let c,d,p,f,g=h.length,m=0;m<g;++m){c=m==g-1?0:m+1,d=0==m?g-1:m-1,p=0,f=null,o.copy(u,t.shape.edges[m]),n=o.vecAB(h[m],l),i&&o.len2(n)>a&&(i.AInB=!1);let _=w(u,n);if(_===r){if(o.copy(u,t.shape.edges[d]),_=w(u,o.vecAB(h[d],l)),_===s){let t=o.len(n);if(t>e.shape.radius)return!1;i&&(i.BInA=!1,f=o.unit(n),p=e.shape.radius-t)}}else if(_===s){if(o.copy(u,t.shape.edges[c]),o.sub$(o.copy(n,l),h[c]),_=w(u,n),_===r){let t=o.len(n);if(t>e.shape.radius)return!1;i&&(i.BInA=!1,f=o.unit(n),p=e.shape.radius-t)}}else{let t=o.unit$(o.normal(u)),r=o.dot(n,t),s=Math.abs(r);if(r>0&&s>e.shape.radius)return!1;i&&(f=t,p=e.shape.radius-r,(r>=0||p<2*e.shape.radius)&&(i.BInA=!1))}f&&i&&Math.abs(p)<Math.abs(i.overlap)&&(i.overlap=p,o.copy(i.overlapN,f))}return i&&(i.A=t,i.B=e,o.mul$(o.copy(i.overlapV,i.overlapN),i.overlap)),!0}function M(t,e,r){let i=P(e,t,r);if(i&&r){let t=r.A,e=r.AInB;o.flip$(r.overlapN),o.flip$(r.overlapV),r.A=r.B,r.B=t,r.AInB=r.BInA,r.BInA=e}return i}function R(t,e,r){let i=t.shape.calcPoints,s=e.shape.calcPoints;for(let n=0;n<i.length;++n)if(E(t.pos,i,e.pos,s,t.shape.normals[n],r))return!1;for(let n=0;n<s.length;++n)if(E(t.pos,i,e.pos,s,e.shape.normals[n],r))return!1;if(r){if(0==r.overlap||d.feq0(r.overlap))return!1;r.A=t,r.B=e,o.copy(r.overlapV,r.overlapN),o.mul$(r.overlapV,r.overlap)}return!0}class C{static create(){return new C}constructor(){this.identity()}identity(){return this.m=a.matIdentity(3),this}translate(t,e){return this.m=a.matMult(this.m,a.mat3(1,0,t,0,1,e,0,0,1)),this}scale(t,e){return this.m=a.matMult(this.m,a.mat3(t,0,0,0,e,0,0,0,1)),this}shear(t,e){return this.m=a.matMult(this.m,a.mat3(1,t,0,e,1,0,0,0,1)),this}rotateCCW(t,e,r){let i=Math.sin(t),s=Math.cos(t);return void 0!==e&&void 0!==r?(this.translate(-e,-r),this.rotateCCW(t),this.translate(e,r)):this.m=a.matMult(this.m,a.mat3(s,-i,0,i,s,0,0,0,1)),this}rotateCW(t,e,r){let i=Math.sin(t),s=Math.cos(t);return void 0!==e&&void 0!==r?(this.translate(-e,-r),this.rotateCW(t),this.translate(e,r)):this.m=a.matMult(this.m,a.mat3(s,i,0,-i,s,0,0,0,1)),this}transformXY(t,e){let r=[t,e,1];return a.matVMult(this.m,r).length=2,2}transformPoints(t){let e,r=[0,0,1];t.forEach((t=>{c.vec(t)?(r[0]=t[0],r[1]=t[1]):(r[0]=t.x,r[1]=t.y),e=a.matVMult(this.m,r),c.vec(t)?(t[0]=e[0],t[1]=e[1]):(t.x=e[0],t.y=e[1])}))}}class O{constructor(t,e){if(e<t){let r=t;t=e,e=r}d.feq0(t)&&(t=0),d.feq0(e)&&(e=0),this.min=t,this.max=e}min(){return this.min}max(){return this.max}intersects(t){return!(this.max<t.min||t.max<this.min)}contains(t){return this.min<=t&&t<=this.max}length(){return this.max-this.min}static MinEndPtCmp(t,e){return t.min<e.min?-1:t.min>e.min?1:t.max<e.max?-1:t.max>e.max?1:0}static MaxEndPtCmp(t,e){return t.max<e.max?-1:t.max>e.max?1:t.min<e.min?-1:t.min>e.min?1:0}static LenCmp(t,e){let r=t.length(),i=e.length();return r<i?-1:r>i?1:0}static test(){let t=[new O(15,33),new O(45,60),new O(20,70),new O(46,55)];console.log("Unsorted"),t.forEach((t=>console.log(`min=${t.min}, max=${t.max}`))),console.log("Sort by min endpoint"),t.sort(O.MinEndPtCmp),t.forEach((t=>console.log(`min=${t.min}, max=${t.max}`))),console.log("Sort by max endpoint"),t.sort(O.MaxEndPtCmp),t.forEach((t=>console.log(`min=${t.min}, max=${t.max}`))),console.log("Sort by length"),t.sort(O.LenCmp),t.forEach((t=>console.log(`min=${t.min}, max=${t.max}`)))}}class I{static theta(t){return Math.atan2(t[1],t[0])}static angleBetween(t,e){return Math.atan2(e[1]-t[1],e[0]-t[0])}static ccw(t,e,r){let i=(e[0]-t[0])*(r[1]-t[1])-(e[1]-t[1])*(r[0]-t[0]);return i<0?-1:i>0?1:0}static area2(t,e,r){return(e[0]-t[0])*(r[1]-t[1])-(e[1]-t[1])*(r[0]-t[0])}static distTo(t,e){let r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}static distSqTo(t,e){let r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}static compareTo(t,e){return t[1]<e[1]?-1:t[1]>e[1]?1:t[0]<e[0]?-1:t[0]>e[0]?1:0}static XOrderCmp(t,e){return t[0]<e[0]?-1:t[0]>e[0]?1:0}static YOrderCmp(t,e){return t[1]<e[1]?-1:t[1]>e[1]?1:0}static ROrderCmp(t,e){let r=t[0]*t[0]+t[1]*t[1]-(e[0]*e[0]+e[1]*e[1]);return r<0?-1:r>0?1:0}static PolarOrderCmp(t){return(e,r)=>{let i=e[0]-t[0],s=e[1]-t[1],n=r[0]-t[0],o=r[1]-t[1];return s>=0&&o<0?-1:o>=0&&s<0?1:d.feq0(s)&&d.feq0(o)?i>=0&&n<0?-1:n>=0&&i<0?1:0:-I.ccw(t,e,r)}}static DistToOrderCmp(t,e){let r=I.distSqTo(t),i=I.distSqTo(e);return r<i?-1:r>i?1:0}static equals(t,e){return e===t||!!e&&t[0]==e[0]&&t[1]==e[1]}static farthestPair(t){let e,r=[0,0],i=[0,0],s=0,n=-1/0,a=I.calcConvexHull(t);if(!1===a||t.length<=1)return!1;if(e=a.length,a.unshift(null),2==e)r=a[1],i=a[2],I.distTo(r,i);else{let t,s=2;for(;I.area2(a[e],a[1],a[s+1])>I.area2(a[e],a[1],a[s]);)++s;t=s;for(let l,h=1;h<=s&&t<=e;++h)for(I.distSqTo(a[h],a[t])>n&&(n=I.distSqTo(a[h],a[t]),o.copy(r,a[h]),o.copy(i,a[t]));t<e&&I.area2(a[h],a[h+1],a[t+1])>I.area2(a[h],a[h+1],a[t]);)++t,l=I.distSqTo(a[h],a[t]),l>n&&(n=I.distSqTo(a[h],a[t]),o.copy(r,a[h]),o.copy(i,a[t]))}return{best1:r,best2:i,bestDistance:Math.sqrt(n)}}static closestPair(t){let e=[0,0],r=[0,0],i=1/0,s=t.slice();const a=t.length;s.sort(I.YOrderCmp),s.sort(I.XOrderCmp);for(let t=0;t<a-1;++t)if(I.equals(s[t],s[t+1]))return o.copy(e,s[t]),o.copy(r,s[t+1]),{bestDistance:0,best1:e,best2:r};let l=s.slice();return function t(s,a,l,h,u){if(u<=h)return 1/0;let c=h+n.ndiv(u-h,2),d=s[c],p=t(s,a,l,h,c),f=t(s,a,l,c+1,u),g=Math.min(p,f);!function(t,e,r,i,s){for(let i=r;i<=s;++i)o.copy(e[i],t[i]);let n=r,a=i+1;for(let l=r;l<=s;++l)n>i?o.copy(t[l],e[a++]):a>s?o.copy(t[l],e[n++]):I.compareTo(e[a],e[n])<0?o.copy(t[l],e[a++]):o.copy(t[l],e[n++])}(a,l,h,c,u);let m=0;for(let t=h;t<=u;++t)Math.abs(a[t][0]-d[0])<g&&o.copy(l[m++],a[t]);for(let t=0;t<m;++t)for(let s,n=t+1;n<m&&l[n][1]-l[t][1]<g;++n)s=I.distTo(l[t],l[n]),s<g&&(g=s,s<i&&(i=g,o.copy(e,l[t]),o.copy(r,l[n])));return g}(s,l,d.fill(a,(()=>[0,0])),0,a-1),{bestDistance:i,best1:e,best2:r}}static calcConvexHull(t){d.assert(t&&t.length>0,"invalid points");let e,r,i,s=t.length,n=d.deepCopyArray(t),a=new h;for(n.sort(I.compareTo),e=n[0],n.shift(),n.sort(I.PolarOrderCmp(e)),n.unshift(e),a.push(n[0]),r=1;r<s&&I.equals(n[0],n[r]);++r);if(r==s)return!1;for(i=r+1;i<s&&0==I.ccw(n[0],n[r],n[i]);++i);a.push(n[i-1]);for(let t,e=i;e<s;++e){for(t=a.pop();I.ccw(a.peek(),t,n[e])<=0;)t=a.pop();a.push(t),a.push(n[e])}let l=new h;for(let t=a.iterator();t.hasNext();)l.push(t.next());s=l.size(),t=[];for(let e=l.iterator();e.hasNext();)t.push(o.clone(e.next()));if(s>2)for(let e=0;e<s;++e)if(I.ccw(t[e],t[(e+1)%s],t[(e+2)%s])<=0)return!1;return t}static test_convexHull(){let t="9230 13137 4096 24064 8192 26112 22016  9344 4440  8028 6505 31422 28462 32343 17152 19200 9561 11599\n               4096 20992 21538  2430 21903 23677 17152 16128 7168 25088 10162 18638 822 32301 16128 12032 18989  3797\n               8192 28160 16128 20224 14080 20224 26112  7296 20367 20436 7486   422 17835  2689 22016  3200 22016  5248\n               24650 16886 15104 20224 25866  4204 13056 15104 13662 10301 17152 20224 15104 12032 6144 20992 26112  3200\n               6144 29184 13056 12032 8128 20992 5076 19172 17152 17152 823 15895 25216  3200 6071 29161 5120 20992\n               10324 22176 29900  9390 27424  7945 4096 23040 12831 27971 29860 12437 28668  2061 1429 12561 29413   596\n               17152 18176 8192 27136 5120 29184 22016 11392 1444 10362 32011  3140 15731 32661 26112  4224 13120 20224\n               30950  2616 4096 22016 4096 25088 24064  3200 26112  5248 4862 30650 5570  8885 21784 18853 23164 32371\n               4160 29184 13056 13056 8192 29184 23040  7296 5120 25088 22016  7296 7168 29184 25216  7296 23040  3200\n               4718  4451 14080 16128 7168 20992 19546 17728 13056 16128 17947 17017 26112  6272 20658  1204 23553 13965\n               13056 14080 14080 12032 24064  7296 21377 26361 17088\n               12032 16128 16128 30875 28560 2542 26201 8192 25088 11444 16973".split(/\s+/).map((t=>+t)),e=[];for(let r=0;r<t.length;r+=2)e.push([t[r],t[r+1]]);e=[[5,15],[5,-20],[-60,10],[70,-10],[-60,-10],[70,10]];let r=I.calcConvexHull(e);!1===r||r.length!=e.length?console.log("not convex!"):r.forEach((t=>{console.log(`${t[0]}, ${t[1]}`)}))}static test_closestPair(){let t="954 11163 1125 11331 1296 11499 1467 11667 1657 11796 1847 11925 2037 12054 2238 12207 2439 12360\n               2640 12513 2878 12523 3116 12533 3354 12543 3518 12493 3682 12443 3846 12393\n               8463 7794 8022 7527 7581 7260 7140 6993 6731 6624 6322 6255 5913 5886\n               5521 5494 5129 5102 4737 4710 4599 5158".split(/\s+/).map((t=>+t)),e=[];for(let r=0;r<t.length;r+=2)e.push([t[r],t[r+1]]);let{bestDistance:r,best1:i,best2:s}=I.closestPair(e);console.log(`bestDist=${r}, p1=${i}, p2=${s}`)}static test_farthestPair(){let t="9230 13137 4096 24064 8192 26112 22016  9344 4440  8028 6505 31422 28462 32343 17152 19200 9561 11599 4096 20992 21538  2430\n               21903 23677 17152 16128 7168 25088 10162 18638 822 32301 16128 12032 18989  3797 8192 28160 16128 20224 14080 20224 26112  7296\n               20367 20436 7486   422 17835  2689 22016  3200 22016  5248 24650 16886 15104 20224 25866  4204 13056 15104 13662 10301 17152 20224\n               15104 12032 6144 20992 26112  3200 6144 29184 13056 12032 8128 20992 5076 19172 17152 17152 823 15895 25216  3200 6071 29161\n               5120 20992 10324 22176 29900  9390 27424  7945 4096 23040 12831 27971 29860 12437 28668  2061 1429 12561 29413   596 17152 18176\n               8192 27136 5120 29184 22016 11392 1444 10362 32011  3140 15731 32661 26112  4224 13120 20224 30950  2616 4096 22016\n               4096 25088 24064  3200 26112  5248 4862 30650 5570  8885 21784 18853 23164 32371 4160 29184 13056 13056 8192 29184 23040  7296\n               5120 25088 22016  7296 7168 29184 25216  7296 23040  3200 4718  4451 14080 16128 7168 20992 19546 17728 13056 16128 17947 17017\n               26112  6272 20658  1204 23553 13965 13056 14080 14080 12032 24064  7296 21377 26361 17088 12032 16128 16128\n               30875 28560 2542 26201 8192 25088 11444 16973".split(/\s+/).map((t=>+t)),e=[];for(let r=0;r<t.length;r+=2)e.push([t[r],t[r+1]]);let{bestDistance:r,best1:i,best2:s}=I.farthestPair(e);console.log(`bestDist=${r}, p1=${i}, p2=${s}`)}}return{Rect:g,Area:m,Line:_,Body:b,Circle:class extends v{constructor(t){super(),this.radius=t}setOrient(t){return this.orient=t,this}},Polygon:class extends v{constructor(t){super(),this.calcPoints=[],this.normals=[],this.edges=[],this.set(t||[])}set(t){return this.calcPoints.length=0,this.normals.length=0,this.edges.length=0,this.points=f(t),this.points.forEach((t=>{this.calcPoints.push(o.vec()),this.edges.push(o.vec()),this.normals.push(o.vec())})),this._recalc()}setOrient(t){return this.orient=t,this._recalc()}moveBy(t,e){return this.points.forEach((r=>{r[0]+=t,r[1]+=e})),this._recalc()}_recalc(){let t=this.points.length;return this.points.forEach(((t,e)=>{o.copy(this.calcPoints[e],t),d.feq0(this.orient)||o.rot$(this.calcPoints[e],this.orient)})),this.points.forEach(((e,r)=>{this.edges[r]=o.sub(this.calcPoints[(r+1)%t],this.calcPoints[r]),this.normals[r]=o.unit(o.normal(this.edges[r]))})),this}},Manifold:T,C2DMatrix:C,Point2D:I,Interval1D:O,Interval2D:class{constructor(t,e){this.x=t,this.y=e}intersects(t){return!!this.x.intersects(t.x)&&!!this.y.intersects(t.y)}contains(t){return x.contains(t[0])&&y.contains(t[1])}area(){return x.length()*y.length()}},bodyWrap:(t,e,r)=>new b(t,e,r),orderVertices:t=>f(t),polyArea(t,e=!1){let r=e?this.orderVertices(t):t,i=0;for(let t,e,s,n=r.length,o=0;o<n;++o)s=(o+1)%n,t=r[o],e=r[s],i+=t[0]*e[1]-e[0]*t[1];return n.ndiv(Math.abs(i),2)},calcPolygonCenter(t,e=!1){const r=e?this.orderVertices(t):t,i=6*this.polyArea(r);let s=0,a=0;for(let t,e,i,n=0,o=r.length;n<o;++n)i=(n+1)%o,t=r[n],e=r[i],s+=(t[0]+e[0])*(t[0]*e[1]-e[0]*t[1]),a+=(t[1]+e[1])*(t[0]*e[1]-e[0]*t[1]);return o.vec(n.ndiv(s,i),n.ndiv(a,i))},getAABB(t){if(d.assert(t instanceof b,"wanted a body"),d.has(t.shape,"radius"))return new g(t.pos[0]-t.shape.radius,t.pos[1]-t.shape.radius,2*t.shape.radius,2*t.shape.radius);{let e=o.translate(t.pos,t.shape.calcPoints),r=e[0][0],i=e[0][1],s=r,n=i;for(let t,o=1;o<e.length;++o)t=e[o],t[0]<r&&(r=t[0]),t[0]>s&&(s=t[0]),t[1]<i&&(i=t[1]),t[1]>n&&(n=t[1]);return new g(r,i,s-r,n-i)}},shiftPoints:(t,e)=>t.map((t=>o.add(t,e))),rotPoints:(t,e,r)=>t.map((t=>o.rot(t,e,r))),calcRectPoints(t,e){const r=t/2,i=e/2;return[o.vec(r,-i),o.vec(r,i),o.vec(-r,i),o.vec(-r,-i)]},line:(t,e,r,i)=>new _(t,e,r,i),rectEqRect:(t,e)=>t.width==e.width&&t.height==e.height&&t.pos[0]==e.pos[0]&&t.pos[1]==e.pos[1],rectContainsRect:(t,e)=>!(t.pos[0]>=e.pos[0]||t.pos[1]>=e.pos[1]||t.pos[0]+t.width<=e.pos[0]+e.width||t.pos[1]+t.height<=e.pos[1]+e.height),rectGetMaxX:t=>t.pos[0]+t.width,rectGetMidX:t=>t.pos[0]+t.width/2,rectGetMinX:t=>t.pos[0],rectGetMaxY:t=>t.pos[1]+t.height,rectGetMidY:t=>t.pos[1]+t.height/2,rectGetMinY:t=>t.pos[1],rectContainsPoint(t,e,r){return e>=this.rectGetMinX(t)&&e<=this.rectGetMaxX(t)&&r>=this.rectGetMinY(t)&&r<=this.rectGetMaxY(t)},rectOverlayRect:(t,e)=>!(t.pos[0]+t.width<e.pos[0]||e.pos[0]+e.width<t.pos[0]||t.pos[1]+t.height<e.pos[1]||e.pos[1]+e.height<t.pos[1]),rectUnion(t,e){const r=Math.min(t.pos[0],e.pos[0]),i=Math.min(t.pos[1],e.pos[1]);return new g(r,i,Math.max(t.pos[0]+t.width,e.pos[0]+e.width)-r,Math.max(t.pos[1]+t.height,e.pos[1]+e.height)-i)},rectIntersection(t,e){if(this.rectOverlayRect(t,e)){const r=Math.max(t.pos[0],e.pos[0]),i=Math.max(t.pos[1],e.pos[1]);return new g(r,i,Math.min(t.pos[0]+t.width,e.pos[0]+e.width)-r,Math.min(t.pos[1]+t.height,e.pos[1]+e.height)-i)}},hitTestPointCircle(t,e,r){d.assert(r instanceof b,"wanted a body");let i=t-r.pos[0],s=e-r.pos[1];return i*i+s*s<=r.shape.radius*r.shape.radius},hitCircleCircle(t,e){d.assert(t instanceof b&&e instanceof b,"need bodies");let r=new T;if(A(t,e,r))return r},hitTestCircleCircle:(t,e)=>(d.assert(t instanceof b&&e instanceof b,"need bodies"),A(t,e,new T)),hitPolygonCircle(t,e){d.assert(t instanceof b&&e instanceof b,"need bodies");let r=new T;if(P(t,e,r))return r},hitTestPolygonCircle:(t,e)=>(d.assert(t instanceof b&&e instanceof b,"need bodies"),P(t,e,new T)),hitCirclePolygon(t,e){d.assert(e instanceof b&&t instanceof b,"need bodies");let r=new T;if(M(t,e,r))return r},hitTestCirclePolygon:(t,e)=>(d.assert(e instanceof b&&t instanceof b,"need bodies"),M(t,e,new T)),hitPolygonPolygon(t,e){d.assert(t instanceof b&&e instanceof b,"need bodies");let r=new T;if(R(t,e,r))return r},hitTestPolygonPolygon:(t,e)=>(d.assert(t instanceof b&&e instanceof b,"need bodies"),R(t,e,new T)),hitTestPointInPolygon(t,e,r){let i;for(let s,n,o=r.length,a=0,l=o-1;a<o;)s=r[a],n=r[l],s[1]>e!=n[1]>e&&t<(n[0]-s[0])*(e-s[1])/(n[1]-s[1])+s[0]&&(i=!i),l=a,++a;return i},hitTestPointPolygon(t,e,r){return d.assert(r instanceof b,"wanted a body"),this.hitTestPointInPolygon(t,e,o.translate(r.pos,r.shape.calcPoints))},hitTestLineCircle(t,e,r,i,s){let n,a=o.sub(e,t),l=[r,i],h=o.sub(l,t),u=o.sub(l,e),c=o.len2(h),d=o.dot(h,a)/o.dot(a,a);return n=d>=0&&d<=1?c-d*d*o.len2(a):d<0?c:o.len2(u),[n<s*s]},hitTestLinePolygon(t,e,r){d.assert(r instanceof b,"wanted a body");let i=o.translate(r.pos,r.shape.calcPoints);for(let r=0,s=0;r<i.length;++r){s=r+1,s==i.length&&(s=0);let[n,o]=this.lineIntersect2D(t,e,i[r],i[s]);if(n)return[n,o]}return[!1]},lineIntersect2D(t,e,r,i){let s,n,o=t[0],a=t[1],l=e[0],h=e[1],u=r[0],c=r[1],p=i[0],f=i[1],g=(o-l)*(c-f)-(a-h)*(u-p);return d.feq0(g)?[!1]:(s=(o-u)*(c-f)-(a-c)*(u-p),s/=g,n=(o-u)*(a-h)-(a-c)*(o-l),n/=g,0<=s&&s<=1&&0<=n&&n<=1?[!0,s,[o+s*(l-o),a+s*(h-a)]]:[!1])},lineIntersection2D(t,e,r,i){if(t[1]>i[1]&&e[1]>i[1]&&t[1]>r[1]&&e[1]>r[1]||e[1]<r[1]&&t[1]<r[1]&&e[1]<i[1]&&t[1]<i[1]||t[0]>i[0]&&e[0]>i[0]&&t[0]>r[0]&&e[0]>r[0]||e[0]<r[0]&&t[0]<r[0]&&e[0]<i[0]&&t[0]<i[0])return[!1,0];let s=(t[1]-r[1])*(i[0]-r[0])-(t[0]-r[0])*(i[1]-r[1]),n=(e[0]-t[0])*(i[1]-r[1])-(e[1]-t[1])*(i[0]-r[0]),o=(t[1]-r[1])*(e[0]-t[0])-(t[0]-r[0])*(e[1]-t[1]),a=(e[0]-t[0])*(i[1]-r[1])-(e[1]-t[1])*(i[0]-r[0]),l=s*n,h=o*a;return l>0&&l<n*n&&h>0&&h<a*a?[!0,s/n]:[!1,0]}}}"object"==typeof module&&module.exports?module.exports=n(require("./core"),require("./math"),require("./vec2"),require("./matrix"),require("../algo/basic")):t["io/czlab/mcfud/geo2d"]=n}(this),function(t,e){"use strict";function r(r,i){r||(r=t["io/czlab/mcfud/core"]()),i||(i=t["io/czlab/mcfud/math"]()),Math.floor;const{u:s,is:n}=r;return{spatialGrid:(t=320,r=320)=>function(t,r){const o=new Map;return{searchAndExec(t,e){let r,i=t.getSpatial();for(let s,n,a=i.y1;a<=i.y2;++a)if(n=o.get(a))for(let o,l,h=i.x1;h<=i.x2;++h)if(s=n.get(h))for(o=s.values(),l=o.next();!l.done;){if(t!==l.value&&(r=e(t,l.value))){h=a=1/0;break}r=null,l=o.next()}return r},search(t,e=!1){let r,i,s=[],n=t.getSpatial();for(let a=n.y1;a<=n.y2;++a)if(i=o.get(a))for(let o=n.x1;o<=n.x2;++o)(r=i.get(o))&&r.forEach((r=>{(r!==t||e)&&s.push(r)}));return s},engrid(e,s){if(!e)return;let n=e.getBBox(),o=e.getSpatial(),a=i.ndiv(n.x1,t),l=i.ndiv(n.y1,r),h=i.ndiv(n.x2,t),u=i.ndiv(n.y2,r);return o.x1==a&&o.x2==h&&o.y1==l&&o.y2==u||(this.degrid(e),o.x1=a,o.x2=h,o.y1=l,o.y2=u,s||this._register(e)),e},reset(){o.clear()},_register(t){let e=t.getSpatial();if(n.num(e.x1))for(let r,i,n=e.y1;n<=e.y2;++n){o.has(n)||o.set(n,new Map),i=o.get(n);for(let n=e.x1;n<=e.x2;++n)i.has(n)||i.set(n,new Map),r=i.get(n),s.assoc(r,t.getGuid(),t)}},degrid(t){if(t){let r=t.getSpatial();if(n.num(r.x1))for(let e,i,n=r.y1;n<=r.y2;++n)if(i=o.get(n))for(let n=r.x1;n<=r.x2;++n)(e=i.get(n))&&s.dissoc(e,t.getGuid());r.x1=e,r.x2=e,r.y1=e,r.y2=e}}}}(t,r)}}"object"==typeof module&&module.exports?module.exports=r(require("./core"),require("./math")):t["io/czlab/mcfud/spatial"]=r}(this),function(t,e){"use strict";function r(e,r){e||(e=t["io/czlab/mcfud/core"]()),r||(r=t["io/czlab/mcfud/math"]()),Math.floor;const{u:i}=e;function s(t,e,o,a,l,h,u){let c=null,d=[],p=r.ndiv(t+e,2),f=r.ndiv(o+a,2);function g(t){function e({x1:t,x2:e,y1:r,y2:i}){let s=[],n=t<p,o=e>p;return r<f&&(n&&s.push(3),o&&s.push(0)),i>f&&(n&&s.push(2),o&&s.push(1)),s}return t.getBBox?e(t.getBBox()):(i.assert(void 0!==t.x1&&void 0!==t.y1&&void 0!==t.x2&&void 0!==t.y2,"wanted bbox for quadtree"),e(t))}const m={x1:t,x2:e,y1:o,y2:a};return{boundingBox:()=>m,subTrees:()=>c,dbg:t=>t(d,c,l,h,u),insert(...r){r.forEach((r=>{c?g(r).forEach((t=>c[t].insert(r))):(d.push(r),d.length>l&&u<h&&(i.assert(null===c),c=[s(p,e,o,f,l,h,u+1),s(p,e,f,a,l,h,u+1),s(t,p,f,a,l,h,u+1),s(t,p,o,f,l,h,u+1)],d.forEach((t=>g(t).forEach((e=>c[e].insert(t))))),d.length=0))}))},remove(t){c?c.forEach((e=>e.remove(t))):i.disj(d,t)},isLeaf:()=>null===c?-1:d.length,prune(){if(c){let t=0,e=0;for(let r,i=0;i<c.length;++i)r=c[i],r.prune(),n=r.isLeaf(),n>=0&&(++t,e+=n);t==c.length&&e<l&&(i.assert(0==d.length,"quadtree wanted zero items"),c.forEach((t=>t._swap(d))),c=null)}},_swap(t){d.forEach((e=>t.push(e))),d.length=0},reset(){d.length=0,c&&c.forEach((t=>t.reset())),c=null},searchAndExec(t,e,r){let i;if(c){let s=g(t);for(let n=0;n<s.length&&(i=c[s[n]].searchAndExec(t,e,r),!i);++n);}else for(let s,n=0;n<d.length&&(s=d[n],r&&s===t||!(i=e(s,t)));++n);return i},search(t,e){const r=new Map,i=[];return e&&r.set(t,null),c&&g(t).forEach((e=>{c[e].search(t).forEach((t=>{r.has(t)||(r.set(t,null),i.push(t))}))})),d.forEach((t=>{r.has(t)||(r.set(t,null),i.push(t))})),r.clear(),i}}}return{quadtree(t,e=12,r=5){const{x1:i,x2:n,y1:o,y2:a}=t;return s(i,n,o,a,e,r,0)}}}"object"==typeof module&&module.exports?module.exports=r(require("./core"),require("./math")):t["io/czlab/mcfud/qtree"]=r}(this),function(t,e){"use strict";function r(r){r||(r=t["io/czlab/mcfud/core"]());const{u:i}=r;class s{constructor(t,r){this.lastBestMove=e,this.state=e,this.other=r,this.cur=t}clone(t){const e=new s;return e.state=t(this.state),e.lastBestMove=this.lastBestMove,e.other=this.other,e.cur=this.cur,e}}function n(t,e,r,i){return t.evalScore(e,r,i)*(1+.001*r)}function o(t,e,r,s,a,l){if(0==r||t.isOver(e))return{depth:r,value:n(t,e,r,s)};let h=e,u=t.getStateCopier(),c=i.shuffle(t.getNextMoves(e));for(let n,d,p=0;p<c.length;++p)if(d=c[p],t.undoMove||(i.assert(u,"Missing state copier!"),e=h.clone(u)),t.makeMove(e,d),n=o(t,e,r-1,s,{value:-l.value,move:l.move},{value:-a.value,move:a.move}),t.undoMove&&t.unmakeMove(e,d),n.value=-n.value,n.move=d,n.value>a.value&&(a={value:n.value,move:d,depth:n.depth}),a.value>=l.value)return l;return JSON.parse(JSON.stringify(a))}function a(t,e,r,s,o,l){if(0==r||t.isOver(e))return[n(t,e,r,s),null];let h=i.shuffle(t.getNextMoves(e)),u=t.getStateCopier(),c=e,d=-1/0,p=h[0];r==s&&(c.lastBestMove=p);for(let n,f,g=0;g<h.length&&(t.undoMove||(i.assert(u,"Missing state copier!"),e=c.clone(u)),f=h[g],t.makeMove(e,f),n=-a(t,e,r-1,s,-l,-o)[0],t.undoMove&&t.unmakeMove(e,f),d<n&&(d=n,p=f),!(o<n&&(o=n,r==s&&(c.lastBestMove=f),o>=l)));++g);return[d,c.lastBestMove]}const l={algo:"negamax",GFrame:s,GameBoard:class{constructor(){}getStateCopier(){}getFirstMove(t){}getNextMoves(t){}evalScore(t){}isStalemate(t){}isOver(t){}unmakeMove(t,e){if(!this.undoMove)throw Error("Need Implementation");this.switchPlayer(t),this.undoMove(t,e)}makeMove(t,e){if(!this.doMove)throw Error("Need Implementation!");this.doMove(t,e),this.switchPlayer(t)}switchPlayer(t){let e=t.cur;t.cur=t.other,t.other=e}getOtherPlayer(t){return t===this.actors[1]?this.actors[2]:t===this.actors[2]?this.actors[1]:void 0}getPlayer(){return this.actors[0]}takeGFrame(){}run(t,e){this.getAlgoActor=()=>e,this.syncState(t,e);let r=this.getFirstMove();return i.nichts(r)&&(r=l.evalNegaMax(this)),r}},XXevalNegaMax(t){const e=t.takeGFrame(),r=t.depth;let[s,n]=a(t,e,r,r,-1/0,1/0);return i.nichts(n)&&console.log(`evalNegaMax: score=${s}, pos= ${n}, lastBestMove=${n}`),n},evalNegaMax(t){const e=t.takeGFrame(),r=t.depth;let{value:s,move:n}=o(t,e,r,r,{value:-1/0},{value:1/0});return i.nichts(n)&&console.log(`evalNegaMax: score= ${s}, pos= ${n}`),n}};return l}"object"==typeof module&&module.exports?module.exports=r(require("./core")):t["io/czlab/mcfud/negamax"]=r}(this),function(t,e){"use strict";function r(r){r||(r=t["io/czlab/mcfud/core"]());const{u:i}=r;class s{constructor(t,r){this.state=e,this.other=r,this.cur=t}clone(t){const e=new s;return e.state=t(this.state),e.other=this.other,e.cur=this.cur,e}}const n=(t,e,r,i)=>t.evalScore(e,r,i);function o(t,r,s,a,l,h,u){if(0==s||t.isOver(r))return[n(t,r,s,a),e];let c=r,d=t.getStateCopier(),p=i.shuffle(t.getNextMoves(r));if(u){let e,n,f=p[0],g=-1/0;for(let m=0;m<p.length&&(t.undoMove||(i.assert(d,"Missing state copier!"),r=c.clone(d)),n=p[m],t.makeMove(r,n),e=o(t,r,s-1,a,l,h,!u)[0],t.undoMove&&t.unmakeMove(r,n),e>g&&(g=e,f=n),!(h<=(l=Math.max(e,l))));++m);return[g,f]}{let e,n,f=p[0],g=1/0;for(let m=0;m<p.length&&(t.undoMove||(i.assert(d,"Missing state copier!"),r=c.clone(d)),n=p[m],t.makeMove(r,n),e=o(t,r,s-1,a,l,h,!u)[0],t.undoMove&&t.unmakeMove(r,n),e<g&&(g=e,f=n),!((h=Math.min(e,h))<=l));++m);return[g,f]}}const a={algo:"minimax",GFrame:s,GameBoard:class{constructor(){this.aiActor=e}getStateCopier(){}getFirstMove(t){}getNextMoves(t){}evalScore(t,e,r){}isStalemate(t){}isOver(t,e){}unmakeMove(t,e){if(!this.undoMove)throw Error("Need Implementation");this.switchPlayer(t),this.undoMove(t,e)}makeMove(t,e){if(!this.doMove)throw Error("Need Implementation!");this.doMove(t,e),this.switchPlayer(t)}takeGFrame(){}switchPlayer(t){let e=t.cur;t.cur=t.other,t.other=e}getOtherPlayer(t){return t===this.actors[1]?this.actors[2]:t===this.actors[2]?this.actors[1]:void 0}getPlayer(){return this.actors[0]}run(t,e){this.getAlgoActor=()=>e,this.syncState(t,e);let r=this.getFirstMove();return i.nichts(r)&&(r=a.evalMiniMax(this)),r}},evalMiniMax(t){const e=t.takeGFrame(),r=t.depth;let[s,n]=o(t,e,r,r,-1/0,1/0,!0);return i.nichts(n)&&console.log(`evalMiniMax: score=${s}, pos= ${n}`),n}};return a}"object"==typeof module&&module.exports?module.exports=r(require("./core")):t["io/czlab/mcfud/minimax"]=r}(this),function(t,e){"use strict";function r(r){r||(r=t["io/czlab/mcfud/core"]());const i=(t,e)=>t<e?-1:t>e?1:0,s=Math.floor,{is:n,u:o}=r,a=t=>o.assert(n.num(t)||n.str(t),"expected number or string");function l(t,e=" ",r=""){for(;t.hasNext();)r+=`${t.next()}${e}`;return r}class h{constructor(t){this.current=t}hasNext(){return o.echt(this.current)}remove(){throw Error("Unsupported")}next(){if(!this.hasNext())throw Error("NoSuchElementException");let t=this.current.item;return this.current=this.current.next,t}}function u(t,e){return{item:t,next:e}}class c{constructor(){this.first=e,this.n=0}clone(){let t,e=new c,r=this.first;for(;r;)t?(t.next=u(r.item),t=t.next):e.first=t=u(r.item),e.n+=1,r=r.next;return e}isEmpty(){return o.nichts(this.first)}size(){return this.n}add(t){this.first=u(t,this.first),this.n+=1}iter(){return new h(this.first)}static test(){let t=new c;"to be or not to - be - - that - - - is".split(" ").forEach((e=>t.add(e))),console.log("size of bag = "+t.size()),console.log(l(t.iter()));let e=t.clone();console.log("size of cloned = "+e.size()),console.log(l(e.iter()))}}class d{constructor(){this.first=e,this.n=0}clone(){let t,e=new d,r=this.first;for(;r;)t?(t.next=u(r.item),t=t.next):e.first=t=u(r.item),e.n+=1,r=r.next;return e}isEmpty(){return o.nichts(this.first)}size(){return this.n}push(t){this.first=u(t,this.first),this.n+=1}pop(){if(this.isEmpty())throw Error("Stack underflow");let t=this.first.item;return this.first=this.first.next,this.n-=1,t}peek(){if(this.isEmpty())throw Error("Stack underflow");return this.first.item}toString(){return l(this.iter())}iter(){return new h(this.first)}static test(){let t=new d;"to be or not to - be - - that - - - is".split(" ").forEach((e=>{"-"!=e?t.push(e):t.isEmpty()||console.log("(-)"+t.pop()+" ")})),console.log("("+t.size()+" left on stack)");let e=t.clone();console.log("cloned= "+l(e.iter())),console.log("("+e.size()+" left on stack)")}}class p{constructor(){this.first=e,this.last=e,this.n=0}clone(){let t=new p,e=this.first;for(;e;)t.enqueue(e.item),e=e.next;return t}isEmpty(){return o.nichts(this.first)}size(){return this.n}peek(){if(this.isEmpty())throw Error("Queue underflow");return this.first.item}enqueue(t){let e=this.last;this.last=u(t),this.isEmpty()?this.first=this.last:e.next=this.last,this.n+=1}dequeue(){if(this.isEmpty())throw Error("Queue underflow");let t=this.first.item;return this.first=this.first.next,this.n-=1,this.isEmpty()&&(this.last=e),t}toString(){return l(this.iter())}iter(){return new h(this.first)}static test(){let t=new p;"to be or not to - be - - that - - - is".split(/\s+/).forEach((e=>{"-"!=e?t.enqueue(e):t.isEmpty()||console.log(t.dequeue()+" ")})),console.log("("+t.size()+" left on queue)");let e=t.clone();console.log("cloned= "+l(e.iter())),console.log("("+e.size()+" left on queue)")}}class f{constructor(t){this.compare=t||i,this.root=e,this.n=0}size(){return this.n}contains(t){return void 0!==this.get(t)}get(t){const e=(t,r,i)=>{if(r){let s=this.compare(t,r.key);i=s<0?e(t,r.left):s>0?e(t,r.right):r.value}return i};if(a(t)&&this.n>0)return e(t,this.root)}set(t,e){const r=(t,e,i)=>{if(!i)return this.n+=1,{key:t,value:e};let s=this.compare(t,i.key);return s<0?i.left=r(t,e,i.left):s>0?i.right=r(t,e,i.right):i.value=e,i};a(t)&&void 0!==e&&(this.root=r(t,e,this.root))}_getMaxNode(t){for(;t&&t.right;)t=t.right;return t}_getMaxKey(){let t=this._getMaxNode(this.root);if(t)return t.key}_getMinNode(t){for(;t&&t.left;)t=t.left;return t}_getMinKey(){let t=this._getMinNode(this.root);if(t)return t.key}remove(t){const r=(t,i)=>{if(i){let s,n,o,a=this.compare(t,i.key);a<0?i.left=r(t,i.left):a>0?i.right=r(t,i.right):i.left&&i.right?(o=this._getMaxNode(i.left),s=o.key,n=o.value,o.value=i.value,o.key=i.key,i.key=s,i.value=n,i.left=r(t,i.left)):i.left?(i=i.left,this.n-=1):i.right?(i=i.right,this.n-=1):(i=e,this.n-=1)}return i};a(t)&&(this.root=r(t,this.root))}keys(){let t=new p;return this.forEach(((e,r)=>t.enqueue(r))),t.iter()}firstKey(){let t;try{this.forEach(((e,r)=>{throw t=r,Error("????")}))}catch(t){}return t}lastKey(){let t;return this.forEach(((e,r)=>{t=r})),t}forEach(t,e){function r(t,e){return e&&e.apply(t,Array.prototype.slice.call(arguments,2))}!function t(e,i,s,n){if(!e)return r(s,n);t(e.left,i,s,(function(){r(s,i,e.value,e.key),t(e.right,i,s,(function(){r(s,n)}))}))}(this.root,t,e)}static test(){let t=new f;t.set(3,"3"),t.set(2,"2"),t.set(7,"7"),t.set(1,"1"),console.log(`firstKey= ${t.firstKey()}`),console.log(`lastKey= ${t.lastKey()}`),console.log(l(t.keys())),console.log(`k= ${t.get(3)}`),console.log(`has 2 = ${t.contains(2)}`),console.log(`has size = ${t.size()}`),t.remove(1),console.log(`has size = ${t.size()}`),console.log(l(t.keys())),console.log(`k= ${t.get(2)}`)}}class g{constructor(){this.st=new f}get(t){if(o.nichts(t))throw Error("calls get() with null key");return this.st.get(t)}put(t,e){if(o.nichts(t))throw Error("calls put() with null key");void 0===e?this.st.remove(t):this.st.set(t,e)}remove(t){if(o.nichts(t))throw Error("calls remove() with null key");this.st.remove(t)}contains(t){if(o.nichts(t))throw Error("calls contains() with null key");return this.st.contains(t)}size(){return this.st.size()}isEmpty(){return 0==this.size()}keys(){return this.st.keys()}min(){if(this.isEmpty())throw Error("calls min() with empty symbol table");return this.st.firstKey()}max(){if(this.isEmpty())throw Error("calls max() with empty symbol table");return this.st.lastKey()}ceiling(t){if(o.nichts(t))throw Error("argument to ceiling() is null");let e,r,i=this.st.keys();for(;i.hasNext();)if(r=i.next(),r==t||r>t){e=r;break}if(void 0===e)throw Error("argument to ceiling() is too large");return e}floor(t){if(o.nichts(t))throw Error("argument to floor() is null");let e,r,i=this.st.keys();for(;i.hasNext();)r=i.next(),(r==t||r<t)&&(e=r);if(void 0===e)throw Error("argument to floor() is too small");return e}static test(){let t=new g;t.put("a",1),t.put("g",9),t.put("c",3),t.put("j",10),t.put("z",26),t.put("x",24),console.log(`isEmpty= ${t.isEmpty()}`),console.log(`size= ${t.size()}`),console.log(`get-c= ${t.get("c")}`),console.log(`contains z= ${t.contains("z")}`),console.log(`contains m= ${t.contains("m")}`),console.log(l(t.keys())),console.log(`ceil w= ${t.ceiling("w")}`),console.log(`floor k= ${t.floor("k")}`),console.log(`min = ${t.min()}`),console.log(`max = ${t.max()}`),t.remove("x"),console.log(l(t.keys()))}}class m{static M=4;Node(t){return{m:t,children:new Array(m.M)}}Entry(t,e,r){return{key:t,val:e,next:r}}constructor(t){this.root=this.Node(0),this.compare=t,this._height=0,this.n=0}isEmpty(){return 0==this.size()}size(){return this.n}height(){return this._height}get(t){if(o.nichts(t))throw Error("argument to get() is null");return this._search(this.root,t,this._height)}_search(t,e,r){let i=t.children;if(0==r){for(let r=0;r<t.m;++r)if(0==this.compare(e,i[r].key))return i[r].val}else for(let s=0;s<t.m;++s)if(s+1==t.m||this.compare(e,i[s+1].key)<0)return this._search(i[s].next,e,r-1)}put(t,e){if(o.nichts(t))throw Error("argument key to put() is null");let r,i=this._insert(this.root,t,e,this._height);this.n+=1,i&&(r=this.Node(2),r.children[0]=this.Entry(this.root.children[0].key,null,this.root),r.children[1]=this.Entry(i.children[0].key,null,i),this.root=r,this._height+=1)}_insert(t,e,r,i){let s,n=this.Entry(e,r);if(0==i)for(s=0;s<t.m&&!(this.compare(e,t.children[s].key)<0);++s);else for(s=0;s<t.m;++s)if(s+1==t.m||this.compare(e,t.children[s+1].key)<0){let o=this._insert(t.children[s++].next,e,r,i-1);if(!o)return null;n.key=o.children[0].key,n.val=null,n.next=o;break}for(let e=t.m;e>s;--e)t.children[e]=t.children[e-1];if(t.children[s]=n,t.m++,t.m>=m.M)return this._split(t)}_split(t){let e=s(m.M/2),r=this.Node(e);t.m=e;for(let i=0;i<e;++i)r.children[i]=t.children[e+i];return r}toString(){return function t(e,r,i){let s="",n=e.children;if(0==r)for(let t=0;t<e.m;++t)s+=`${i}${n[t].key} ${n[t].val}\n`;else for(let o=0;o<e.m;++o)o>0&&(s+=`${i}(${n[o].key})\n`),s+=t(n[o].next,r-1,i+"     ");return s}(this.root,this._height,"")+"\n"}static test(){let t=new m(i);t.put("www.cs.princeton.edu","128.112.136.12"),t.put("www.cs.princeton.edu","128.112.136.11"),t.put("www.princeton.edu","128.112.128.15"),t.put("www.yale.edu","130.132.143.21"),t.put("www.simpsons.com","209.052.165.60"),t.put("www.apple.com","17.112.152.32"),t.put("www.amazon.com","207.171.182.16"),t.put("www.ebay.com","66.135.192.87"),t.put("www.cnn.com","64.236.16.20"),t.put("www.google.com","216.239.41.99"),t.put("www.nytimes.com","199.239.136.200"),t.put("www.microsoft.com","207.126.99.140"),t.put("www.dell.com","143.166.224.230"),t.put("www.slashdot.org","66.35.250.151"),t.put("www.espn.com","199.181.135.201"),t.put("www.weather.com","63.111.66.11"),t.put("www.yahoo.com","216.109.118.65"),console.log("cs.princeton.edu:  "+t.get("www.cs.princeton.edu")),console.log("hardvardsucks.com: "+t.get("www.harvardsucks.com")),console.log("simpsons.com:      "+t.get("www.simpsons.com")),console.log("apple.com:         "+t.get("www.apple.com")),console.log("ebay.com:          "+t.get("www.ebay.com")),console.log("dell.com:          "+t.get("www.dell.com")),console.log(""),console.log("size:    "+t.size()),console.log("height:  "+t.height()),console.log(t.toString()),console.log("")}}class _{constructor(t){this.d=t,this.st=new g}put(t,e){if(t<0||t>=this.d)throw Error("Illegal index");o.feq0(e)?this.st.remove(t):this.st.put(t,e)}get(t){if(t<0||t>=this.d)throw Error("Illegal index");return this.st.contains(t)?this.st.get(t):0}nnz(){return this.st.size()}dimension(){return this.d}dot(t){if(o.assert(t instanceof _,"expected SparseVector data"),this.d!=t.d)throw Error("Vector lengths disagree");let e,r=0,i=(this.st.size()<=t.st.size()?this:t).st.keys();for(;i.hasNext();)e=i.next(),t.st.contains(e)&&(r+=this.get(e)*t.get(e));return r}dotWith(t){let e=0;for(let r,i=this.st.keys();i.hasNext();)r=i.next(),e+=t[r]*this.get(r);return e}magnitude(){return Math.sqrt(this.dot(this))}scale(t){let e=new _(this.d);for(let r,i=this.st.keys();i.hasNext();)r=i.next(),e.put(r,t*this.get(r));return e}plus(t){if(o.assert(t instanceof _,"expected SparseVector data"),this.d!=t.d)throw Error("Vector lengths disagree");let e=new _(this.d);for(let t,r=this.st.keys();r.hasNext();)t=r.next(),e.put(t,this.get(t));for(let r,i=t.st.keys();i.hasNext();)r=i.next(),e.put(r,t.get(r)+e.get(r));return e}toString(){let t="";for(let e,r=this.st.keys();r.hasNext();)e=r.next(),t+=`(${e}, ${this.st.get(e)}) `;return t}static test(){let t=new _(10),e=new _(10);t.put(3,.5),t.put(9,.75),t.put(6,.11),t.put(6,0),e.put(3,.6),e.put(4,.9),console.log("a = "+t.toString()),console.log("b = "+e.toString()),console.log("a dot b = "+t.dot(e)),console.log("a + b   = "+t.plus(e).toString())}}return{prnIter:l,StdCompare:i,BTree:m,Bag:c,Stack:d,Queue:p,ST:g,TreeMap:f,SparseVector:_,Iterator:h}}"object"==typeof module&&module.exports?module.exports=r(require("../main/core")):t["io/czlab/mcfud/algo/basic"]=r}(this),function(t,e){"use strict";function r(r,i){r||(r=t["io/czlab/mcfud/core"]()),i||(i=t["io/czlab/mcfud/algo/basic"]());const{prnIter:s,Bag:n,Stack:o,Iterator:a,StdCompare:l}=i,h=Math.floor,{is:u,u:c}=r;function d(t,e,r,i,s){c.assert(t>e,"bad resize capacity");let n,o=new Array(t);for(n=r;n<i;++n)o[n]=s[n];return o}const p=(t,e,r)=>r(t,e)<0;function f(t,e,r){const i=t[e];t[e]=t[r],t[r]=i}function g(t){let e,r="";for(e=0;e<t.length;++e)r+=`${t[e]} `;console.log(r)}class m{static sort(t,e){const r=t.length;for(let i=1;i<r;++i)for(let r=i;r>0&&p(t[r],t[r-1],e);--r)f(t,r,r-1);return t}static sortRange(t,e,r,i){for(let s=e+1;s<r;++s)for(let r=s;r>e&&p(t[r],t[r-1],i);--r)f(t,r,r-1);return t}static indexSort(t,e){const r=t.length,i=c.fill(r,(t=>t));for(let s=1;s<r;++s)for(let r=s;r>0&&p(t[i[r]],t[i[r-1]],e);--r)f(i,r,r-1);return i}static test(){let t="SORTEXAMPLE".split("");g(m.sort(t,l)),t="bed bug dad yes zoo all bad yet".split(" "),g(m.sortRange(t,0,t.length,l)),t="SORTEXAMPLE".split(""),g(m.indexSort(t,l))}}class _{static sort(t,e){let r,i,s,n=t.length;for(let o,a=1;a<n;++a){for(i=0,s=a,o=t[a];i<s;)r=i+c.ndiv(s-i,2),p(o,t[r],e)?s=r:i=r+1;for(let e=a;e>i;--e)t[e]=t[e-1];t[i]=o}return t}static test(){let t="SORTEXAMPLE".split("");g(_.sort(t,l)),t="bed bug dad yes zoo all bad yet".split(" "),g(_.sort(t,l))}}class x{static sort(t,e){let r,i=t.length;for(let s=0;s<i;++s){r=s;for(let n=s+1;n<i;++n)p(t[n],t[r],e)&&(r=n);f(t,s,r)}return t}static test(){let t="SORTEXAMPLE".split("");g(x.sort(t,l)),t="bed bug dad yes zoo all bad yet".split(" "),g(x.sort(t,l))}}class y{static sort(t,e){let r=t.length,i=1,s=c.ndiv(r,3);for(;i<s;)i=3*i+1;for(;i>=1;){for(let s=i;s<r;++s)for(let r=s;r>=i&&p(t[r],t[r-i],e);r-=i)f(t,r,r-i);i=c.ndiv(i,3)}return t}static test(){let t="SORTEXAMPLE".split("");g(y.sort(t,l)),t="bed bug dad yes zoo all bad yet".split(" "),g(y.sort(t,l))}}function b(t,e,r,i,s,n){if(s<=i);else{let o=i+c.ndiv(s-i,2);b(t,e,r,i,o,n),b(t,e,r,o+1,s,n),function(t,e,r,i,s,n,o){for(let t=i;t<=n;++t)r[t]=e[t];let a=i,l=s+1;for(let h=i;h<=n;++h)a>s?e[h]=r[l++]:l>n?e[h]=r[a++]:p(t[r[l]],t[r[a]],o)?e[h]=r[l++]:e[h]=r[a++]}(t,e,r,i,o,s,n)}return t}class v{static sort(t,e){return function t(e,r,i,s,n){if(s<=i);else{let o=i+c.ndiv(s-i,2);t(e,r,i,o,n),t(e,r,o+1,s,n),function(t,e,r,i,s,n){for(let i=r;i<=s;++i)e[i]=t[i];let o=r,a=i+1;for(let l=r;l<=s;++l)o>i?t[l]=e[a++]:a>s?t[l]=e[o++]:p(e[a],e[o],n)?t[l]=e[a++]:t[l]=e[o++]}(e,r,i,o,s,n)}return e}(t,new Array(t.length),0,t.length-1,e),t}static indexSort(t,e){let r=t.length,i=c.fill(r,(t=>t));return b(t,i,new Array(r),0,r-1,e),i}static test(){let t="SORTEXAMPLE".split("");g(v.sort(t,l)),t="bed bug dad yes zoo all bad yet".split(" "),g(v.sort(t,l)),t="SORTEXAMPLE".split(""),g(v.indexSort(t,l))}}class T{static sort(t,e){const r=t.length;for(let i,s=0;s<r;++s){i=0;for(let n=r-1;n>s;--n)p(t[n],t[n-1],e)&&(f(t,n,n-1),++i);if(0==i)break}return t}static test(){let t="bed bug dad yes zoo all bad yet".split(" ");T.sort(t,l),g(t)}}function S(t,e,r,i){let s=e,n=t[e],o=r+1;for(;;){for(;p(t[++s],n,i)&&s!=r;);for(;p(n,t[--o],i)&&o!=e;);if(s>=o)break;f(t,s,o)}return f(t,e,o),o}class w{static sort(t,e){return function t(e,r,i,s){if(i<=r);else{let n=S(e,r,i,s);t(e,r,n-1,s),t(e,n+1,i,s)}return e}(t,0,t.length-1,e),t}static select(t,e,r){if(e<0||e>=t.length)throw Error(`index is not between 0 and ${t.length}: ${e}`);let i=0,s=t.length-1;for(;s>i;){let n=S(t,i,s,r);if(n>e)s=n-1;else{if(!(n<e))return t[n];i=n+1}}return t[i]}static test(){let t="bed bug dad yes zoo all bad yet".split(" ");g(w.sort(t,l)),t="SORTEXAMPLE".split(""),g(w.sort(t,l)),c.shuffle(t),t.forEach(((e,r)=>console.log(w.select(t,r,l))))}}const E=(t,e,r,i)=>p(t[e],t[r],i);class A{Node(t){return{key:t,order:0}}constructor(t,r){this.compare=t,this.table=new Map,this.head=e,this._min=e,this.n=0,u.vec(r)&&r.forEach((t=>this.insert(t)))}isEmpty(){return 0==this.n}size(){return this.n}insert(t){let e=this.Node(t);this.n+=1,this.head=this._insertNode(e,this.head),this._min=this._min?this._greater(this._min.key,t)?this.head:this._min:this.head}min(){if(this.isEmpty())throw Error("Priority queue is empty");return this._min.key}delMin(){if(this.isEmpty())throw Error("Priority queue is empty");this.head=this._cut(this._min,this.head);let t=this._min.child,r=this._min.key;return this._min.key=e,t&&(this.head=this._meld(this.head,t),this._min.child=e),this.n-=1,this.isEmpty()?this._min=e:this._consolidate(),r}union(t){return this.head=this._meld(this.head,t.head),this._min=this._greater(this._min.key,t._min.key)?t._min:this._min,this.n=this.n+t.n,this}_greater(t,e){return!c.nichts(t)&&(!!c.nichts(e)||this.compare(t,e)>0)}_link(t,e){e.child=this._insertNode(t,e.child),e.order+=1}_consolidate(){this.table.clear();let t=this.head,r=e,i=e,s=0;this._min=this.head;do{for(r=t,t=t.next,i=this.table.get(r.order);i;)this.table.delete(r.order),this._greater(r.key,i.key)?(this._link(r,i),r=i):this._link(i,r),i=this.table.get(r.order);this.table.set(r.order,r),r.order>s&&(s=r.order)}while(t!==this.head);this.head=null,this.table.forEach((t=>{t&&(this._min=this._greater(this._min.key,t.key)?t:this._min,this.head=this._insertNode(t,this.head))}))}_insertNode(t,e){return e?(e.prev.next=t,t.next=e,t.prev=e.prev,e.prev=t):(t.prev=t,t.next=t),t}_cut(t,r){if(t.next===t)return t.next=e,t.prev=e,e;{t.next.prev=t.prev,t.prev.next=t.next;let i=t.next;return t.next=e,t.prev=e,r===t?i:r}}_meld(t,e){return t?e?(t.prev.next=e.next,e.next.prev=t.prev,t.prev=e,e.next=t,t):t:e}iter(){let t=new A(this.compare),e=r=>{if(!r)return;let i=r;do{t.insert(i.key),e(i.child),i=i.next}while(i!==r)};return e(this.head),{remove(){throw Error("UnsupportedOperationException")},hasNext:()=>!t.isEmpty(),next(){if(!this.hasNext())throw Error("NoSuchElementException");return t.delMin()}}}static test(){let t="",e=new A(l);"PQE".split("").forEach((t=>e.insert(t))),t+=e.delMin()+" ","XAM".split("").forEach((t=>e.insert(t))),t+=e.delMin()+" ","PLE".split("").forEach((t=>e.insert(t))),t+=e.delMin()+" ",e.isEmpty(),console.log(t),console.log("min= "+e.min()),console.log(s(e.iter())),console.log("("+e.size()+" left on pq)");let r=new A(l);"ZTAK".split("").forEach((t=>r.insert(t))),r=r.union(e),console.log(s(r.iter()))}}class P{Node(t){return{key:t,order:0,index:0}}constructor(t,r){if(t<0)throw Error("Cannot create a priority queue of negative size");this.maxN=t,this.n=0,this.head=e,this._min=e,this.compare=r,this.table=new Map,this.nodes=new Array(t)}isEmpty(){return 0==this.n}contains(t){if(t<0||t>=this.maxN)throw Error("IllegalArgumentException");return c.echt(this.nodes[t])}size(){return this.n}insert(t,e){if(t<0||t>=this.maxN)throw Error("IllegalArgumentException");if(this.contains(t))throw Error("Specified index is already in the queue");let r=this.Node(e);r.index=t,this.nodes[t]=r,this.n+=1,this.head=this._insertNode(r,this.head),this._min=this._min?this._greater(this._min.key,e)?this.head:this._min:this.head}minIndex(){if(this.isEmpty())throw Error("Priority queue is empty");return this._min.index}min(){if(this.isEmpty())throw Error("Priority queue is empty");return this._min.key}delMin(){if(this.isEmpty())throw Error("Priority queue is empty");this.head=this._cutNode(this._min,this.head);let t=this._min.child,r=this._min.index;if(this._min.key=e,t){do{t.parent=e,t=t.next}while(t!==this._min.child);this.head=this._meld(this.head,t),this._min.child=e}return this.n-=1,this.isEmpty()?this._min=e:this._consolidate(),this.nodes[r]=e,r}keyOf(t){if(t<0||t>=this.maxN)throw Error("IllegalArgumentException");if(!this.contains(t))throw Error("Specified index is not in the queue");return this.nodes[t].key}changeKey(t,e){if(t<0||t>=this.maxN)throw Error("IllegalArgumentException");if(!this.contains(t))throw Error("Specified index is not in the queue");this._greater(e,this.nodes[t].key)?this.increaseKey(t,e):this.decreaseKey(t,e)}decreaseKey(t,e){if(t<0||t>=this.maxN)throw Error("IllegalArgumentException");if(!this.contains(t))throw Error("Specified index is not in the queue");if(this._greater(e,this.nodes[t].key))throw Error("Calling with this argument would not decrease the key");let r=this.nodes[t];r.key=e,this._greater(this._min.key,e)&&(this._min=r),r.parent&&this._greater(r.parent.key,e)&&this._cut(t)}increaseKey(t,e){if(t<0||t>=this.maxN)throw Error("IllegalArgumentException");if(!this.contains(t))throw Error("Specified index is not in the queue");if(this._greater(this.nodes[t].key,e))throw Error("Calling with this argument would not increase the key");this.delete(t),this.insert(t,e)}delete(t){if(t<0||t>=this.maxN)throw Error("IllegalArgumentException");if(!this.contains(t))throw Error("Specified index is not in the queue");let r=this.nodes[t];if(r.key=null,r.parent&&this._cut(t),this.head=this._cutNode(r,this.head),r.child){let t=r.child;r.child=e,r=t;do{t.parent=e,t=t.next}while(t!==r);this.head=this._meld(this.head,t)}this.isEmpty()?this._min=e:this._consolidate(),this.nodes[t]=e,this.n-=1}_greater(t,e){return!c.nichts(t)&&(!!c.nichts(e)||this.compare(t,e)>0)}_link(t,e){t.parent=e,e.child=this._insertNode(t,e.child),e.order+=1}_cut(t){let r=this.nodes[t],i=r.parent;i.child=this._cutNode(r,i.child),r.parent=e,i.order-=1,this.head=this._insertNode(r,this.head),i.mark=!i.mark,!i.mark&&i.parent&&this._cut(i.index)}_consolidate(){let t=e,r=e,i=0,s=this.head;this.table.clear(),this._min=this.head;do{for(t=s,s=s.next,r=this.table.get(t.order);r;)this.table.delete(t.order),this._greater(t.key,r.key)?(this._link(t,r),t=r):this._link(r,t),r=this.table.get(t.order);this.table.set(t.order,t),t.order>i&&(i=t.order)}while(s!==this.head);this.head=e,this.table.forEach((t=>{this._min=this._greater(this._min.key,t.key)?t:this._min,this.head=this._insertNode(t,this.head)}))}_insertNode(t,e){return e?(e.prev.next=t,t.next=e,t.prev=e.prev,e.prev=t):(t.prev=t,t.next=t),t}_cutNode(t,r){if(t.next===t)return t.next=e,t.prev=e,e;{t.next.prev=t.prev,t.prev.next=t.next;let i=t.next;return t.next=e,t.prev=e,r===t?i:r}}_meld(t,e){return t?e?(t.prev.next=e.next,e.next.prev=t.prev,t.prev=e,e.next=t,t):t:e}iter(){let t=new P(this.maxN,this.compare);return this.nodes.forEach((e=>{e&&t.insert(e.index,e.key)})),{remove(){throw Error("UnsupportedOperationException")},hasNext:()=>!t.isEmpty(),next(){if(!this.hasNext())throw Error("NoSuchElementException");return t.delMin()}}}static test(){let t=["it","was","the","best","of","times","it","was","the","worst"],e=new P(t.length,l);for(let r=0;r<t.length;++r)e.insert(r,t[r]);for(console.log("min= "+e.min()),console.log("minindex= "+e.minIndex()),console.log("size= "+e.size()),console.log("contains(3)="+e.contains(3)),console.log("keyOf(3)="+e.keyOf(3)),e.changeKey(3,"bbbb");!e.isEmpty();){let t=e.minIndex();console.log(t+" "+e.keyOf(t)),e.delMin()}console.log("");for(let r=0;r<t.length;++r)e.insert(r,t[r]);for(let r,i=e.iter();i.hasNext();)r=i.next(),console.log(r+" "+t[r]);for(;!e.isEmpty();)e.delMin()}}class M{constructor(t,e){if(this.comparator=t,this.n=0,u.vec(e)){this.pq=new Array(e.length+1),this.n=e.length;for(let t=0;t<this.n;++t)this.pq[t+1]=e[t];for(let t=h(this.n/2);t>=1;--t)this._sink(t,this)}else this.pq=new Array(u.num(e)?e:2);c.assert(this._isMinHeap(),"not min heap")}isEmpty(){return 0==this.n}size(){return this.n}min(){if(this.isEmpty())throw Error("Priority queue underflow");return this.pq[1]}insert(t){this.n==this.pq.length-1&&(this.pq=d(2*this.pq.length,this.n,1,this.n+1,this.pq)),this.pq[++this.n]=t,this._swim(this.n),c.assert(this._isMinHeap(),"not min heap-insert")}delMin(){if(this.isEmpty())throw Error("Priority queue underflow");let t=this.pq[1];return f(this.pq,1,this.n--),this._sink(1),this.pq[this.n+1]=e,this.n>0&&this.n==c.ndiv(this.pq.length-1,4)&&(this.pq=d(c.ndiv(this.pq.length,2),this.n,1,this.n+1,this.pq)),t}_swim(t){for(;t>1&&this._greater(c.ndiv(t,2),t);)f(this.pq,t,c.ndiv(t,2)),t=c.ndiv(t,2)}_sink(t){for(;2*t<=this.n;){let e=2*t;if(e<this.n&&this._greater(e,e+1)&&e++,!this._greater(t,e))break;f(this.pq,t,e),t=e}}_greater(t,e){return this.comparator(this.pq[t],this.pq[e])>0}_isMinHeap(){for(let t=1;t<=this.n;++t)if(c.nichts(this.pq[t]))return!1;for(let t=this.n+1;t<this.pq.length;++t)if(!c.nichts(this.pq[t]))return!1;return!c.echt(this.pq[0])&&this._isMinHeapOrdered(1)}_isMinHeapOrdered(t){if(t>this.n)return!0;let e=2*t,r=2*t+1;return!(e<=this.n&&this._greater(t,e))&&!(r<=this.n&&this._greater(t,r))&&this._isMinHeapOrdered(e)&&this._isMinHeapOrdered(r)}iter(){let t=new M(this.comparator,this.size());for(let e=1;e<=this.n;++e)t.insert(this.pq[e]);return{remove(){throw Error("UnsupportedOperationException")},hasNext:()=>!t.isEmpty(),next(){if(!this.hasNext())throw Error("NoSuchElementException");return t.delMin()}}}static test(){let t="",e=new M(l);"PQE".split("").forEach((t=>e.insert(t))),t+=e.delMin()+" ","XAM".split("").forEach((t=>e.insert(t))),t+=e.delMin()+" ","PLE".split("").forEach((t=>e.insert(t))),t+=e.delMin()+" ",console.log(t),console.log("("+e.size()+" left on pq)")}}class R{constructor(t,e){if(this.comparator=t,this.n=0,u.vec(e)){this.pq=new Array(e.length+1),this.n=e.length;for(let t=0;t<this.n;++t)this.pq[t+1]=e[t];for(let t=h(this.n/2);t>=1;--t)this._sink(t)}else this.pq=new Array(u.num(e)?e:2);c.assert(this._isMaxHeap(),"not max heap")}isEmpty(){return 0==this.n}size(){return this.n}max(){if(this.isEmpty())throw Error("Priority queue underflow");return this.pq[1]}insert(t){this.n==this.pq.length-1&&(this.pq=d(2*this.pq.length,this.n,1,this.n+1,this.pq)),this.n+=1,this.pq[this.n]=t,this._swim(this.n),c.assert(this._isMaxHeap(),"not max heap-insert")}delMax(){if(this.isEmpty())throw Error("Priority queue underflow");let t=this.pq[1];return f(this.pq,1,this.n),this.n-=1,this._sink(1),this.pq[this.n+1]=null,this.n>0&&this.n==c.ndiv(this.pq.length-1,4)&&(this.pq=d(c.ndiv(this.pq.length,2),this.n,1,this.n+1,this.pq)),t}_isMaxHeap(){for(let t=1;t<=this.n;++t)if(c.nichts(this.pq[t]))return!1;for(let t=this.n+1;t<this.pq.length;++t)if(c.echt(this.pq[t]))return!1;return!c.echt(this.pq[0])&&this._isMaxHeapOrdered(1)}_isMaxHeapOrdered(t){if(t>this.n)return!0;let e=2*t,r=2*t+1;return!(e<=this.n&&E(this.pq,t,e,this.comparator))&&!(r<=this.n&&E(this.pq,t,r,this.comparator))&&this._isMaxHeapOrdered(e)&&this._isMaxHeapOrdered(r)}_swim(t){for(;t>1&&E(this.pq,c.ndiv(t,2),t,this.comparator);)f(this.pq,t,c.ndiv(t,2)),t=c.ndiv(t,2)}_sink(t){let e;for(;2*t<=this.n&&(e=2*t,e<this.n&&E(this.pq,e,e+1,this.comparator)&&++e,E(this.pq,t,e,this.comparator));)f(this.pq,t,e),t=e}iter(){const t=new R(this.comparator,this.size());for(let e=1;e<=this.n;++e)t.insert(this.pq[e]);return{remove(){throw Error("UnsupportedOperationException")},hasNext:()=>!t.isEmpty(),next(){if(!this.hasNext())throw Error("NoSuchElementException");return t.delMax()}}}static test(){let t="",e=new R(l);"PQE".split("").forEach((t=>e.insert(t))),t+=e.delMax()+" ","XAM".split("").forEach((t=>e.insert(t))),t+=e.delMax()+" ","PLE".split("").forEach((t=>e.insert(t))),t+=e.delMax()+" ",console.log(t),console.log("("+e.size()+" left on pq)")}}function C(t,e,r,i){return i(t[e-1],t[r-1])<0}function O(t,e,r){const i=t[e-1];t[e-1]=t[r-1],t[r-1]=i}class I{static sort(t,e){function r(t,e,r,i){for(;2*e<=r;){let s=2*e;if(s<r&&C(t,s,s+1,i)&&++s,!C(t,e,s,i))break;O(t,e,s),e=s}}let i,s=t.length;for(i=c.ndiv(s,2);i>=1;--i)r(t,i,s,e);for(i=s;i>1;)O(t,1,i--),r(t,1,i,e);return t}static test(){let t="SORTEXAMPLE".split("");g(I.sort(t,l)),t="bed bug dad yes zoo all bad yet".split(" "),g(I.sort(t,l))}}class B{constructor(t,e){if(t<0)throw Error("IllegalArgumentException");this.compare=e,this.maxN=t,this.n=0,this.mKeys=new Array(t+1),this.pq=new Array(t+1),this.qp=new Array(t+1);for(let e=0;e<=t;++e)this.qp[e]=-1}isEmpty(){return 0==this.n}contains(t){return this._validateIndex(t),-1!=this.qp[t]}size(){return this.n}insert(t,e){if(this._validateIndex(t),this.contains(t))throw Error("index is already in the priority queue");++this.n,this.qp[t]=this.n,this.pq[this.n]=t,this.mKeys[t]=e,this._swim(this.n)}minIndex(){if(0==this.n)throw Error("Priority queue underflow");return this.pq[1]}minKey(){if(0==this.n)throw Error("Priority queue underflow");return this.mKeys[this.pq[1]]}delMin(){if(0==this.n)throw Error("Priority queue underflow");let t=this.pq[1];return this._exch(1,this.n--),this._sink(1),c.assert(t==this.pq[this.n+1],"No good"),this.qp[t]=-1,this.mKeys[t]=null,this.pq[this.n+1]=-1,t}keyOf(t){if(this._validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");return this.mKeys[t]}changeKey(t,e){if(this._validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");this.mKeys[t]=e,this._swim(this.qp[t]),this._sink(this.qp[t])}decreaseKey(t,e){if(this._validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");let r=this.compare(this.mKeys[t],e);if(0==r)throw Error("Calling decreaseKey() with a key equal to the key in the priority queue");if(r<0)throw Error("Calling decreaseKey() with a key strictly greater than the key in the priority queue");this.mKeys[t]=e,this._swim(this.qp[t])}increaseKey(t,e){if(this._validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");let r=this.compare(this.mKeys[t],e);if(0==r)throw Error("Calling increaseKey() with a key equal to the key in the priority queue");if(r>0)throw Error("Calling increaseKey() with a key strictly less than the key in the priority queue");this.mKeys[t]=e,this._sink(this.qp[t])}delete(t){if(this._validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");let r=this.qp[t];this._exch(r,this.n--),this._swim(r),this._sink(r),this.mKeys[t]=e,this.qp[t]=-1}_validateIndex(t){if(t<0)throw Error("index is negative: "+t);if(t>=this.maxN)throw Error("index >= capacity: "+t)}_greater(t,e){return this.compare(this.mKeys[this.pq[t]],this.mKeys[this.pq[e]])>0}_exch(t,e){let r=this.pq[t];this.pq[t]=this.pq[e],this.pq[e]=r,this.qp[this.pq[t]]=t,this.qp[this.pq[e]]=e}_swim(t){for(;t>1&&this._greater(c.ndiv(t,2),t);)this._exch(t,c.ndiv(t,2)),t=c.ndiv(t,2)}_sink(t){for(;2*t<=this.n;){let e=2*t;if(e<this.n&&this._greater(e,e+1)&&++e,!this._greater(t,e))break;this._exch(t,e),t=e}}iter(){let t=new B(this.pq.length-1,this.compare);for(let e=1;e<=this.n;++e)t.insert(this.pq[e],this.mKeys[this.pq[e]]);return{remove(){throw Error("UnsupportedOperationException")},hasNext:()=>!t.isEmpty(),next(){if(!this.hasNext())throw Error("NoSuchElementException");return t.delMin()}}}static test(){let t=["it","was","the","best","of","times","it","was","the","worst"],e=new B(t.length,l);for(let r=0;r<t.length;++r)e.insert(r,t[r]);for(;!e.isEmpty();){let r=e.delMin();console.log(r+" "+t[r])}console.log("");for(let r=0;r<t.length;++r)e.insert(r,t[r]);for(let r,i=e.iter();i.hasNext();)r=i.next(),console.log(r+" "+t[r]);for(;!e.isEmpty();)e.delMin()}}class k{constructor(t,e){if(t<0)throw Error("IllegalArgumentException");this.compare=e,this.maxN=t,this.n=0,this.mKeys=new Array(t+1),this.pq=new Array(t+1),this.qp=new Array(t+1);for(let e=0;e<=t;++e)this.qp[e]=-1}isEmpty(){return 0==this.n}contains(t){return this._validateIndex(t),-1!=this.qp[t]}size(){return this.n}insert(t,e){if(this._validateIndex(t),this.contains(t))throw Error("index is already in the priority queue");++this.n,this.qp[t]=this.n,this.pq[this.n]=t,this.mKeys[t]=e,this._swim(this.n)}maxIndex(){if(0==this.n)throw Error("Priority queue underflow");return this.pq[1]}maxKey(){if(0==this.n)throw Error("Priority queue underflow");return this.mKeys[this.pq[1]]}delMax(){if(0==this.n)throw Error("Priority queue underflow");let t=this.pq[1];return this._exch(1,this.n--),this._sink(1),c.assert(this.pq[this.n+1]==t,"bad delMax"),this.qp[t]=-1,this.mKeys[t]=e,this.pq[this.n+1]=-1,t}keyOf(t){if(this._validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");return this.mKeys[t]}changeKey(t,e){if(this._validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");this.mKeys[t]=e,this._swim(this.qp[t]),this._sink(this.qp[t])}increaseKey(t,e){if(this._validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");if(0==this.compare(this.mKeys[t],e))throw Error("Calling increaseKey() with a key equal to the key in the priority queue");if(this.compare(this.mKeys[t],e)>0)throw Error("Calling increaseKey() with a key that is strictly less than the key in the priority queue");this.mKeys[t]=e,this._swim(this.qp[t])}decreaseKey(t,e){if(this._validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");if(0==this.compare(this.mKeys[t],e))throw Error("Calling decreaseKey() with a key equal to the key in the priority queue");if(this.compare(this.mKeys[t],e)<0)throw Error("Calling decreaseKey() with a key that is strictly greater than the key in the priority queue");this.mKeys[t]=e,this._sink(this.qp[t])}delete(t){if(this._validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");let r=this.qp[t];this._exch(r,this.n--),this._swim(r),this._sink(r),this.mKeys[t]=e,this.qp[t]=-1}_validateIndex(t){if(t<0)throw Error("index is negative: "+t);if(t>=this.maxN)throw Error("index >= capacity: "+t)}_less(t,e){return p(this.mKeys[this.pq[t]],this.mKeys[this.pq[e]],this.compare)}_exch(t,e){let r=this.pq[t];this.pq[t]=this.pq[e],this.pq[e]=r,this.qp[this.pq[t]]=t,this.qp[this.pq[e]]=e}_swim(t){for(;t>1&&this._less(c.ndiv(t,2),t);)this._exch(t,c.ndiv(t,2)),t=c.ndiv(t,2)}_sink(t){for(;2*t<=this.n;){let e=2*t;if(e<this.n&&this._less(e,e+1)&&++e,!this._less(t,e))break;this._exch(t,e),t=e}}iter(){let t=new k(this.pq.length-1,this.compare);for(let e=1;e<=this.n;++e)t.insert(this.pq[e],this.mKeys[this.pq[e]]);return{remove(){throw Error("UnsupportedOperationException")},hasNext:()=>!t.isEmpty(),next(){if(!this.hasNext())throw Error("NoSuchElementException");return t.delMax()}}}static test(){let t=["it","was","the","best","of","times","it","was","the","worst"],e=new k(t.length,l);for(let r=0;r<t.length;++r)e.insert(r,t[r]);for(let r,i=e.iter();i.hasNext();)r=i.next(),console.log(r+" "+t[r]);console.log("");for(let r=0;r<t.length;++r)c.rand()<.5?e.increaseKey(r,t[r]+t[r]):e.decreaseKey(r,t[r].substring(0,1));for(;!e.isEmpty();){let t=e.maxKey(),r=e.delMax();console.log(r+" "+t)}console.log("");for(let r=0;r<t.length;++r)e.insert(r,t[r]);let r=new Array(t.length);for(let e=0;e<t.length;++e)r[e]=e;c.shuffle(r);for(let t=0;t<r.length;++t){let i=e.keyOf(r[t]);e.delete(r[t]),console.log(r[t]+" "+i)}}}return{FibonacciMinPQ:A,IndexFibonacciMinPQ:P,Insertion:m,BinaryInsertion:_,Selection:x,Shell:y,Merge:v,Bubble:T,Quick:w,MinPQ:M,MaxPQ:R,Heap:I,IndexMinPQ:B,IndexMaxPQ:k}}"object"==typeof module&&module.exports?module.exports=r(require("../main/core"),require("./basic")):t["io/czlab/mcfud/algo/sort"]=r}(this),function(t,e){"use strict";function r(r,i,s,n){r||(r=t["io/czlab/mcfud/core"]()),i||(i=t["io/czlab/mcfud/math"]()),s||(s=t["io/czlab/mcfud/algo/basic"]()),n||(n=t["io/czlab/mcfud/algo/sort"]());const{Bag:o,Stack:a,Queue:l,StdCompare:h,prnIter:u}=s,{MinPQ:c}=n,{is:d,u:p}=(Math.floor,r);class f{static count(t,e){let r=new Map,i=0,s="",n=0;for(let s,o=0;o<t.length;++o)s=t[o],s.length<e||(++i,r.has(s)?r.set(s,r.get(s)+1):(r.set(s,1),++n));return r.set(s,0),Array.from(r.keys()).forEach((t=>{r.get(t)>r.get(s)&&(s=t)})),[s,r.get(s),[n,i]]}static test(){let t="it was the best of times it was the worst of times\n        it was the age of wisdom it was the age of foolishness\n        it was the epoch of belief it was the epoch of incredulity\n        it was the season of light it was the season of darkness\n        it was the spring of hope it was the winter of despair".split(" "),[e,r,i]=f.count(t,1);console.log(e+" "+r),console.log("distinct = "+i[0]),console.log("words= "+i[1])}}class g{constructor(){this.first=e,this.n=0}size(){return this.n}isEmpty(){return 0==this.size()}contains(t){if(p.nichts(t))throw Error("argument to contains is null");return void 0!==this.get(t)}get(t){if(p.nichts(t))throw Error("argument to get is null");for(let e=this.first;e;e=e.next)if(t==e.key)return e.val}put(t,e){if(p.nichts(t))throw Error("first argument to put is null");if(void 0===e)this.delete(t);else{let r,i;for(i=this.first;i&&!r;i=i.next)t==i.key&&(i.val=e,r=!0);r||(this.first=((t,e,r)=>({key:t,val:e,next:this.first}))(t,e),this.n+=1)}}delete(t){const r=(t,i)=>t?i==t.key?(this.n-=1,t.next):(t.next=r(t.next,i),t):e;if(p.nichts(t))throw Error("argument to delete is null");this.first=r(this.first,t)}keys(){let t=new l;for(let e=this.first;e;e=e.next)t.enqueue(e.key);return t.iter()}static load(t){let e=new g;return t.forEach(((t,r)=>e.put(t,r))),e}static test(){let t=g.load("SEARCHEXAMPLE".split(""));console.log(((e="",r=0,i=0)=>{for(i=t.keys();i.hasNext();)e+=`${r=i.next()}=${t.get(r)} `;return e})()),console.log("size= "+t.size()),console.log("contains R= "+t.contains("R")),console.log("get R= "+t.get("R")),t.delete("R"),t.isEmpty(),console.log("contains R= "+t.contains("R")),console.log("get R= "+t.get("R")),console.log("size= "+t.size())}}class m{constructor(t,e=2){this.mKeys=new Array(e),this.vals=new Array(e),this.compare=t,this.n=0,this._resize=t=>{let e=new Array(t),r=new Array(t);for(let t=0;t<this.n;++t)e[t]=this.mKeys[t],r[t]=this.vals[t];this.vals=r,this.mKeys=e},this._argOk=t=>p.echt(t,"Invalid argument"),this._check=()=>(()=>{for(let t=1;t<this.size();++t)if(this.compare(this.mKeys[t],this.mKeys[t-1])<0)return!1;return!0})()&&(()=>{for(let t=0;t<this.size();++t)if(t!=this.rank(this.select(t)))return!1;for(let t=0;t<this.size();++t)if(0!=this.compare(this.mKeys[t],this.select(this.rank(this.mKeys[t]))))return!1;return!0})()}isEmpty(){return 0==this.size()}contains(t){return this._argOk(t)&&void 0!==this.get(t)}get(t){if(this._argOk(t)&&!this.isEmpty()){let e=this.rank(t);if(e<this.n&&0==this.compare(this.mKeys[e],t))return this.vals[e]}}rank(t){let e,r,s=0,n=this.n-1;for(this._argOk(t);s<=n;)if(e=s+i.ndiv(n-s,2),r=this.compare(t,this.mKeys[e]),r<0)n=e-1;else{if(!(r>0))return e;s=e+1}return s}put(t,e){if(this._argOk(t)&&void 0===e)this.delete(t);else{let r=this.rank(t);if(r<this.n&&0==this.compare(this.mKeys[r],t))this.vals[r]=e;else{this.n==this.mKeys.length&&this._resize(2*this.mKeys.length);for(let t=this.n;t>r;--t)this.mKeys[t]=this.mKeys[t-1],this.vals[t]=this.vals[t-1];this.n+=1,this.mKeys[r]=t,this.vals[r]=e}}}delete(t){if(this._argOk(t)&&this.isEmpty());else{let r=this.rank(t);if(r==this.n||0!=this.compare(this.mKeys[r],t));else{for(let t=r;t<this.n-1;++t)this.mKeys[t]=this.mKeys[t+1],this.vals[t]=this.vals[t+1];this.n-=1,this.mKeys[this.n]=e,this.vals[this.n]=e,this.n>0&&this.n==i.ndiv(this.mKeys.length,4)&&this._resize(i.ndiv(this.mKeys.length,2)),this._check()}}}deleteMin(){if(this.isEmpty())throw Error("Symbol table underflow error");this.delete(this.min())}deleteMax(){if(this.isEmpty())throw Error("Symbol table underflow error");this.delete(this.max())}min(){if(this.isEmpty())throw Error("called min with empty symbol table");return this.mKeys[0]}max(){if(this.isEmpty())throw Error("called max with empty symbol table");return this.mKeys[this.n-1]}select(t){if(t<0||t>=this.size())throw Error(`called select with invalid argument: ${t}`);return this.mKeys[t]}floor(t){let e=this._argOk(t)&&this.rank(t);if(e<this.n&&0==this.compare(t,this.mKeys[e]))return this.mKeys[e];if(0==e)throw Error("argument to floor is too small");return this.mKeys[e-1]}ceiling(t){let e=this._argOk(t)&&this.rank(t);if(e==this.n)throw Error("argument to ceiling is too large");return this.mKeys[e]}size(t,e){return 0==arguments.length?this.n:(this._argOk(t)&&this._argOk(e),this.compare(t,e)>0?0:this.contains(e)?this.rank(e)-this.rank(t)+1:this.rank(e)-this.rank(t))}keys(t,e){0==arguments.length&&(t=this.min(),e=this.max()),this._argOk(t)&&this._argOk(e);let r=new l;if(this.compare(t,e)>0);else{for(let i=this.rank(t);i<this.rank(e);++i)r.enqueue(this.mKeys[i]);this.contains(e)&&r.enqueue(this.mKeys[this.rank(e)])}return r.iter()}static load(t,e){let r=new m(e);return t.forEach(((t,e)=>r.put(t,e))),r}static test(){let t=m.load("SEARCHEXAMPLE".split(""),h),e=e=>{e="";for(let r,i=t.keys();i.hasNext();)r=i.next(),e+=`${r}=${t.get(r)} `;return e};console.log(e()),t.deleteMin(),console.log(e()),t.deleteMax(),t.isEmpty(),console.log(e()),console.log("floor of Q= "+t.floor("Q")),console.log("ceil of Q= "+t.ceiling("Q")),console.log("size= "+t.size()),console.log("size= "+t.size("E","P")),console.log("keys E->P = "+u(t.keys("E","P")))}}class _{constructor(t){this.compare=t,this.root=e,this._argOk=t=>p.assert(t,"Invalid argument"),this._check=()=>(this.isBST(this.root,null,null)||console.log("Not in symmetric order"),this.isSizeConsistent(this.root)||console.log("Subtree counts not consistent"),this.isRankConsistent()||console.log("Ranks not consistent"),this.isBST(this.root,null,null)&&this.isSizeConsistent(this.root)&&this.isRankConsistent()),this.isBST=(t,e,r)=>!!p.nichts(t)||!(p.echt(e)&&this.compare(t.key,e)<=0)&&!(p.echt(r)&&this.compare(t.key,r)>=0)&&this.isBST(t.left,e,t.key)&&this.isBST(t.right,t.key,r),this.isSizeConsistent=t=>!!p.nichts(t)||t.size==this._sizeNode(t.left)+this._sizeNode(t.right)+1&&this.isSizeConsistent(t.left)&&this.isSizeConsistent(t.right),this.isRankConsistent=()=>{for(let t=0;t<this.size();++t)if(t!=this.rank(this.select(t)))return!1;for(let t,e=this.keys();e.hasNext();)if(t=e.next(),0!=this.compare(t,this.select(this.rank(t))))return!1;return!0}}Node(t,e,r){return{key:t,val:e,size:r}}isEmpty(){return 0==this.size()}contains(t){return this._argOk(t)&&void 0!==this.get(t)}get(t){return this._getNode(this.root,t)}_getNode(t,e){if(!this._argOk(e)||!p.nichts(t)){let r=this.compare(e,t.key);return r<0?this._getNode(t.left,e):r>0?this._getNode(t.right,e):t.val}}put(t,e){this._argOk(t)&&p.nichts(e)?this.delete(t):(this.root=this._putNode(this.root,t,e),this._check())}_putNode(t,e,r){if(p.nichts(t))t=this.Node(e,r,1);else{let i=this.compare(e,t.key);i<0?t.left=this._putNode(t.left,e,r):i>0?t.right=this._putNode(t.right,e,r):t.val=r,t.size=1+this._sizeNode(t.left)+this._sizeNode(t.right)}return t}deleteMin(){if(this.isEmpty())throw Error("Symbol table underflow");this.root=this._deleteMinNode(this.root),this._check()}_deleteMinNode(t){return p.nichts(t.left)?t=t.right:(t.left=this._deleteMinNode(t.left),t.size=this._sizeNode(t.left)+this._sizeNode(t.right)+1),t}deleteMax(){if(this.isEmpty())throw Error("Symbol table underflow");this.root=this._deleteMaxNode(this.root),this._check()}_deleteMaxNode(t){return p.nichts(t.right)?t=t.left:(t.right=this._deleteMaxNode(t.right),t.size=this._sizeNode(t.left)+this._sizeNode(t.right)+1),t}delete(t){this.root=this._argOk(t)&&this._deleteNode(this.root,t),this._check()}_deleteNode(t,e){if(p.echt(t)){let r=this.compare(e,t.key);if(r<0)t.left=this._deleteNode(t.left,e);else if(r>0)t.right=this._deleteNode(t.right,e);else{if(p.nichts(t.right))return t.left;if(p.nichts(t.left))return t.right;let e=t;(t=this._minNode(e.right)).right=this._deleteMinNode(e.right),t.left=e.left}t.size=this._sizeNode(t.left)+this._sizeNode(t.right)+1}return t}min(){if(this.isEmpty())throw Error("calls min with empty symbol table");return this._minNode(this.root).key}_minNode(t){return p.nichts(t.left)?t:this._minNode(t.left)}max(){if(this.isEmpty())throw Error("calls max with empty symbol table");return this._maxNode(this.root).key}_maxNode(t){return p.nichts(t.right)?t:this._maxNode(t.right)}floor(t){if(this._argOk(t)&&this.isEmpty())throw Error("calls floor with empty symbol table");let e=this._floorNode(this.root,t);if(p.nichts(e))throw Error("argument to floor is too small");return e.key}_floorNode(t,e){if(p.nichts(t))return null;let r=this.compare(e,t.key);if(0==r)return t;if(r<0)return this._floorNode(t.left,e);let i=this._floorNode(t.right,e);return p.nichts(i)?t:i}ceiling(t){if(this._argOk(t)&&this.isEmpty())throw Error("calls ceiling with empty symbol table");let e=this._ceilingNode(this.root,t);if(p.nichts(e))throw Error("argument to floor is too large");return e.key}_ceilingNode(t,r){if(p.nichts(t))return e;let i=this.compare(r,t.key);if(0==i)return t;if(i<0){return this._ceilingNode(t.left,r)||t}return this._ceilingNode(t.right,r)}select(t){if(t<0||t>=this.size())throw Error(`argument to select is invalid: ${t}`);return this._selectNode(this.root,t)}_selectNode(t,r){if(p.nichts(t))return e;let i=this._sizeNode(t.left);return i>r?this._selectNode(t.left,r):i<r?this._selectNode(t.right,r-i-1):t.key}rank(t){return this._argOk(t)&&this._rankNode(t,this.root)}_rankNode(t,e){if(p.nichts(e))return 0;let r=this.compare(t,e.key);return r<0?this._rankNode(t,e.left):r>0?1+this._sizeNode(e.left)+this._rankNode(t,e.right):this._sizeNode(e.left)}keys(t,e){let r=new l;return 0==arguments.length&&(this.isEmpty()||(t=this.min(),e=this.max())),!this.isEmpty()&&this._argOk(t)&&this._argOk(e)&&this._keysNode(this.root,r,t,e),r.iter()}_keysNode(t,e,r,i){if(p.nichts(t));else{let s=this.compare(r,t.key),n=this.compare(i,t.key);s<0&&this._keysNode(t.left,e,r,i),s<=0&&n>=0&&e.enqueue(t.key),n>0&&this._keysNode(t.right,e,r,i)}return e}_sizeNode(t){return p.nichts(t)?0:t.size}size(t,e){return 0==arguments.length?this._sizeNode(this.root):this._argOk(t)&&this._argOk(e)&&this.compare(t,e)>0?0:this.contains(e)?this.rank(e)-this.rank(t)+1:this.rank(e)-this.rank(t)}height(){return this._heightNode(this.root)}_heightNode(t){return p.nichts(t)?-1:1+Math.max(this._heightNode(t.left),this._heightNode(t.right))}levelOrder(){let t,e=[],r=new l;for(e.push(this.root);e.length>0;)t=e.pop(),p.echt(t)&&(r.enqueue(t.key),e.push(t.left,t.right));return r.iter()}static load(t,e){let r=new _(e);return t.forEach(((t,e)=>r.put(t,e))),r}static test(){let t,e=_.load("SEARCHEXAMPLE".split(""),h);t="";for(let r,i=e.levelOrder();i.hasNext();)r=i.next(),t+=`${r}=${e.get(r)} `;console.log("level-order:\n"+t),t="";for(let r,i=e.keys();i.hasNext();)r=i.next(),t+=`${r}=${e.get(r)} `;e.isEmpty(),console.log("keys=\n"+t),console.log("size="+e.size()),console.log("size E->Q = ",e.size("E","Q")),t="";for(let r,i=e.keys("E","Q");i.hasNext();)r=i.next(),t+=`${r}=${e.get(r)} `;console.log("keys[E->Q]= "+t),console.log("min= "+e.min()),console.log("max= "+e.max()),console.log("rank P= "+e.rank("P")),console.log("contains X= "+e.contains("X")),console.log("contains Z= "+e.contains("Z")),e.delete("X"),console.log("get C="+e.get("C")),console.log("max= "+e.max()),e.deleteMin(),e.deleteMax(),console.log("height= "+e.height()),console.log("min= "+e.min()),console.log("max= "+e.max()),console.log("rank E= "+e.rank("E")),console.log("floor G= "+e.floor("G")),console.log("ceiling G= "+e.ceiling("G"))}}class x{static BLACK=!1;static RED=!0;constructor(t){this.compare=t,this.root=e,this._argOk=t=>p.assert(t,"Invalid argument"),this._check=()=>{let t=(e,r,i)=>!!p.nichts(e)||!(r&&this.compare(e.key,r)<=0)&&!(i&&this.compare(e.key,i)>=0)&&t(e.left,r,e.key)&&t(e.right,e.key,i),e=t=>!!p.nichts(t)||t.size==this._sizeNode(t.left)+this._sizeNode(t.right)+1&&e(t.left)&&e(t.right),r=t=>!!p.nichts(t)||!this._isRed(t.right)&&(t===this.root||!this._isRed(t)||!this._isRed(t.left))&&r(t.left)&&r(t.right),i=(t,e)=>p.nichts(t)?0==e:(this._isRed(t)||--e,i(t.left,e)&&i(t.right,e));return t(this.root,null,null)&&e(this.root)&&(()=>{for(let t=0;t<this.size();++t)if(t!=this._rankNode(this.select(t)))return!1;for(let t,e=this.keys();e.hasNext();)if(t=e.next(),0!=this.compare(t,this.select(this._rankNode(t))))return!1;return!0})()&&r(this.root)&&(()=>{let t=0,e=this.root;for(;e;)this._isRed(e)||++t,e=e.left;return i(this.root,t)})()}}Node(t,e,r,i){return{key:t,val:e,color:r,size:i}}_isRed(t){return!p.nichts(t)&&t.color===x.RED}_sizeNode(t){return p.nichts(t)?0:t.size}isEmpty(){return p.nichts(this.root)}get(t){return this._argOk(t)&&this._getNode(this.root,t)}_getNode(t,e){for(;t;){let r=this.compare(e,t.key);if(r<0)t=t.left;else{if(!(r>0))return t.val;t=t.right}}}contains(t){return void 0!==this.get(t)}put(t,e){this._argOk(t)&&p.nichts(e)?this.delete(t):(this.root=this._putNode(this.root,t,e),this.root.color=x.BLACK)}_putNode(t,e,r){if(p.nichts(t))return this.Node(e,r,x.RED,1);let i=this.compare(e,t.key);return i<0?t.left=this._putNode(t.left,e,r):i>0?t.right=this._putNode(t.right,e,r):t.val=r,this._isRed(t.right)&&!this._isRed(t.left)&&(t=this._rotateLeft(t)),this._isRed(t.left)&&this._isRed(t.left.left)&&(t=this._rotateRight(t)),this._isRed(t.left)&&this._isRed(t.right)&&this._flipColors(t),t.size=this._sizeNode(t.left)+this._sizeNode(t.right)+1,t}deleteMin(){if(this.isEmpty())throw Error("BST underflow");this._isRed(this.root.left)||this._isRed(this.root.right)||(this.root.color=x.RED),this.root=this._deleteMinNode(this.root),this.isEmpty()||(this.root.color=x.BLACK)}_deleteMinNode(t){return p.nichts(t.left)?null:(this._isRed(t.left)||this._isRed(t.left.left)||(t=this._moveRedLeft(t)),t.left=this._deleteMinNode(t.left),this._balance(t))}deleteMax(){if(this.isEmpty())throw Error("BST underflow");this._isRed(this.root.left)||this._isRed(this.root.right)||(this.root.color=x.RED),this.root=this._deleteMaxNode(this.root),this.isEmpty()||(this.root.color=x.BLACK)}_deleteMaxNode(t){return this._isRed(t.left)&&(t=this._rotateRight(t)),p.nichts(t.right)?null:(this._isRed(t.right)||this._isRed(t.right.left)||(t=this._moveRedRight(t)),t.right=this._deleteMaxNode(t.right),this._balance(t))}delete(t){this._argOk(t)&&!this.contains(t)||(this._isRed(this.root.left)||this._isRed(this.root.right)||(this.root.color=x.RED),this.root=this._deleteNode(this.root,t),this.isEmpty()||(this.root.color=x.BLACK))}_deleteNode(t,e){if(this.compare(e,t.key)<0)this._isRed(t.left)||this._isRed(t.left.left)||(t=this._moveRedLeft(t)),t.left=this._deleteNode(t.left,e);else{if(this._isRed(t.left)&&(t=this._rotateRight(t)),0==this.compare(e,t.key)&&p.nichts(t.right))return null;if(this._isRed(t.right)||this._isRed(t.right.left)||(t=this._moveRedRight(t)),0==this.compare(e,t.key)){let e=this._minNode(t.right);t.key=e.key,t.val=e.val,t.right=this._deleteMinNode(t.right)}else t.right=this._deleteNode(t.right,e)}return this._balance(t)}_rotateRight(t){if(p.nichts(t)||!this._isRed(t.left))throw Error("bad input to rotateRight");let e=t.left;return t.left=e.right,e.right=t,e.color=e.right.color,e.right.color=x.RED,e.size=t.size,t.size=this._sizeNode(t.left)+this._sizeNode(t.right)+1,e}_rotateLeft(t){if(p.nichts(t)||!this._isRed(t.right))throw Error("bad input to rotateLeft");let e=t.right;return t.right=e.left,e.left=t,e.color=e.left.color,e.left.color=x.RED,e.size=t.size,t.size=this._sizeNode(t.left)+this._sizeNode(t.right)+1,e}_flipColors(t){t.color=!t.color,t.left.color=!t.left.color,t.right.color=!t.right.color}_moveRedLeft(t){return this._flipColors(t),this._isRed(t.right.left)&&(t.right=this._rotateRight(t.right),t=this._rotateLeft(t),this._flipColors(t)),t}_moveRedRight(t){return this._flipColors(t),this._isRed(t.left.left)&&(t=this._rotateRight(t),this._flipColors(t)),t}_balance(t){return this._isRed(t.right)&&!this._isRed(t.left)&&(t=this._rotateLeft(t)),this._isRed(t.left)&&this._isRed(t.left.left)&&(t=this._rotateRight(t)),this._isRed(t.left)&&this._isRed(t.right)&&this._flipColors(t),t.size=this._sizeNode(t.left)+this._sizeNode(t.right)+1,t}height(){return this._height(this.root)}_height(t){return p.nichts(t)?-1:1+Math.max(this._height(t.left),this._height(t.right))}min(){if(this.isEmpty())throw Error("calls min with empty symbol table");return this._minNode(this.root).key}_minNode(t){return p.nichts(t.left)?t:this._minNode(t.left)}max(){if(this.isEmpty())throw Error("calls max with empty symbol table");return this._maxNode(this.root).key}_maxNode(t){return p.nichts(t.right)?t:this._maxNode(t.right)}floor(t){if(this._argOk(t)&&this.isEmpty())throw Error("calls floor with empty symbol table");let e=this._floorNode(this.root,t);if(p.nichts(e))throw Error("argument to floor is too small");return e.key}_floorNode(t,r){if(p.nichts(t))return e;let i=this.compare(r,t.key);return 0==i?t:i<0?this._floorNode(t.left,r):this._floorNode(t.right,r)||t}ceiling(t){if(this._argOk(t)&&this.isEmpty())throw Error("calls ceiling with empty symbol table");let e=this._ceilingNode(this.root,t);if(p.nichts(e))throw Error("argument to ceiling is too small");return e.key}_ceilingNode(t,r){if(p.nichts(t))return e;let i=this.compare(r,t.key);return 0==i?t:i>0?this._ceilingNode(t.right,r):this._ceilingNode(t.left,r)||t}select(t){if(t<0||t>=this.size())throw Error(`argument to select is invalid: ${t}`);return this._selectNode(this.root,t)}_selectNode(t,r){if(p.nichts(t))return e;let i=this._sizeNode(t.left);return i>r?this._selectNode(t.left,r):i<r?this._selectNode(t.right,r-i-1):t.key}rank(t){return this._argOk(t)&&this._rankNode(t,this.root)}_rankNode(t,e){if(p.nichts(e))return 0;let r=this.compare(t,e.key);return r<0?this._rankNode(t,e.left):r>0?1+this._sizeNode(e.left)+this._rankNode(t,e.right):this._sizeNode(e.left)}keys(t,e){let r=new l;return 0==arguments.length&&(this.isEmpty()||(t=this.min(),e=this.max())),!this.isEmpty()&&this._argOk(t)&&this._argOk(e)&&this._keysNode(this.root,r,t,e),r.iter()}_keysNode(t,e,r,i){if(t){let s=this.compare(r,t.key),n=this.compare(i,t.key);s<0&&this._keysNode(t.left,e,r,i),s<=0&&n>=0&&e.enqueue(t.key),n>0&&this._keysNode(t.right,e,r,i)}return e}size(t,e){return 0==arguments.length?this._sizeNode(this.root):this._argOk(t)&&this._argOk(e)&&this.compare(t,e)>0?0:this.contains(e)?this.rank(e)-this.rank(t)+1:this.rank(e)-this.rank(t)}static load(t,e){let r=new x(e);return t.forEach(((t,e)=>r.put(t,e))),r}static test(){let t,e=x.load("SEARCHEXAMPLE".split(""),h);t="";for(let r,i=e.keys();i.hasNext();)r=i.next(),t+=`${r}=${e.get(r)} `;console.log(t),e.isEmpty(),console.log("height= "+e.height()+", size= "+e.size()),console.log("get X= "+e.get("X")),console.log("contains X= "+e.contains("X")),console.log("min= "+e.min()+",max= "+e.max()),e.deleteMin(),e.deleteMax(),console.log("min= "+e.min()+",max= "+e.max()),e.delete("R"),console.log("contains R= "+e.contains("R")),console.log("floor J= "+e.floor("J")),console.log("ceiling J= "+e.ceiling("J")),console.log("rank M= "+e.rank("M")),t="";for(let r,i=e.keys("D","Q");i.hasNext();)r=i.next(),t+=`${r}=${e.get(r)} `;console.log("keys[D-Q]= "+t),console.log("size[E-P]= "+e.size("E","P"))}}class y{static indexOf(t,e){let r=0,s=t.length-1;for(;r<=s;){let n=r+i.ndiv(s-r,2);if(e<t[n])s=n-1;else{if(!(e>t[n]))return n;r=n+1}}return-1}static test(){let t="84 48 68 10 18 98 12 23 54 57 33 16 77 11 29".split(" ").map((t=>+t)).sort();"23 50 10 99 18 23 98 84 11 10 48 77 13 54 98 77 77 68".split(" ").map((t=>+t)).forEach((e=>{y.indexOf(t,e)<0&&console.log(e)}))}}class b{Node(t,e,r,i){return{key:t,val:e,height:r,size:i}}constructor(t){this.compare=t,this.root=e}isEmpty(){return p.nichts(this.root)}_sizeNode(t){return p.nichts(t)?0:t.size}height(){return this._heightNode(this.root)}_heightNode(t){return p.nichts(t)?-1:t.height}get(t){if(p.nichts(t))throw Error("argument to get() is null");let e=this._getNode(this.root,t);if(e)return e.val}_getNode(t,r){if(!t)return e;let i=this.compare(r,t.key);return i<0?this._getNode(t.left,r):i>0?this._getNode(t.right,r):t}contains(t){return void 0!==this.get(t)}put(t,e){if(p.nichts(t))throw Error("first argument to put() is null");void 0===e?this.delete(t):this.root=this._putNode(this.root,t,e)}_putNode(t,e,r){if(!t)return this.Node(e,r,0,1);let i=this.compare(e,t.key);if(i<0)t.left=this._putNode(t.left,e,r);else{if(!(i>0))return t.val=r,t;t.right=this._putNode(t.right,e,r)}return t.size=1+this._sizeNode(t.left)+this._sizeNode(t.right),t.height=1+Math.max(this._heightNode(t.left),this._heightNode(t.right)),this._balanceNode(t)}_balanceNode(t){return this._balanceFactor(t)<-1?(this._balanceFactor(t.right)>0&&(t.right=this._rotateRight(t.right)),t=this._rotateLeft(t)):this._balanceFactor(t)>1&&(this._balanceFactor(t.left)<0&&(t.left=this._rotateLeft(t.left)),t=this._rotateRight(t)),t}_balanceFactor(t){return this._heightNode(t.left)-this._heightNode(t.right)}_rotateRight(t){let e=t.left;return t.left=e.right,e.right=t,e.size=t.size,t.size=1+this._sizeNode(t.left)+this._sizeNode(t.right),t.height=1+Math.max(this._heightNode(t.left),this._heightNode(t.right)),e.height=1+Math.max(this._heightNode(e.left),this._heightNode(e.right)),e}_rotateLeft(t){let e=t.right;return t.right=e.left,e.left=t,e.size=t.size,t.size=1+this._sizeNode(t.left)+this._sizeNode(t.right),t.height=1+Math.max(this._heightNode(t.left),this._heightNode(t.right)),e.height=1+Math.max(this._heightNode(e.left),this._heightNode(e.right)),e}delete(t){if(p.nichts(t))throw Error("argument to delete() is null");this.contains(t)&&(this.root=this._deleteNode(this.root,t))}_deleteNode(t,e){let r=this.compare(e,t.key);if(r<0)t.left=this._deleteNode(t.left,e);else if(r>0)t.right=this._deleteNode(t.right,e);else{if(!t.left)return t.right;if(!t.right)return t.left;let e=t;(t=this.min(e.right)).right=this.deleteMin(e.right),t.left=e.left}return t.size=1+this._sizeNode(t.left)+this._sizeNode(t.right),t.height=1+Math.max(this._heightNode(t.left),this._heightNode(t.right)),this._balance(t)}deleteMin(){if(this.isEmpty())throw Error("called deleteMin() with empty symbol table");this.root=this._deleteMinNode(this.root)}_deleteMinNode(t){return t.left?(t.left=this._deleteMinNode(t.left),t.size=1+this._sizeNode(t.left)+this._sizeNode(t.right),t.height=1+Math.max(this._heightNode(t.left),this._heightNode(t.right)),this._balance(t)):t.right}deleteMax(){if(this.isEmpty())throw Error("called deleteMax() with empty symbol table");this.root=this._deleteMaxNode(this.root)}_deleteMaxNode(t){return t.right?(t.right=this._deleteMaxNode(t.right),t.size=1+this._sizeNode(t.left)+this._sizeNode(t.right),t.height=1+Math.max(this._heightNode(t.left),this._heightNode(t.right)),this._balance(t)):t.left}min(){if(this.isEmpty())throw Error("called min() with empty symbol table");return this._minNode(this.root).key}_minNode(t){return t.left?this._minNode(t.left):t}max(){if(this.isEmpty())throw Error("called max() with empty symbol table");return this._maxNode(this.root).key}_maxNode(t){return t.right?this._maxNode(t.right):t}floor(t){if(p.nichts(t))throw Error("argument to floor() is null");if(this.isEmpty())throw Error("called floor() with empty symbol table");let e=this._floorNode(this.root,t);if(e)return e.key}_floorNode(t,r){if(p.nichts(t))return e;let i=this.compare(r,t.key);return 0==i?t:i<0?this._floorNode(t.left,r):this._floorNode(t.right,r)||t}ceiling(t){if(p.nichts(t))throw Error("argument to ceiling() is null");if(this.isEmpty())throw Error("called ceiling() with empty symbol table");let e=this._ceilingNode(this.root,t);if(e)return e.key}_ceilingNode(t,r){if(p.nichts(t))return e;let i=this.compare(r,t.key);return 0==i?t:i>0?this._ceilingNode(t.right,r):this._ceilingNode(t.left,r)||t}select(t){if(t<0||t>=this.size())throw Error("k is not in range 0-"+(this.size()-1));let e=this._selectNode(this.root,t);if(e)return e.key}_selectNode(t,r){if(p.nichts(t))return e;let i=this._sizeNode(t.left);return i>r?this._selectNode(t.left,r):i<r?this._selectNode(t.right,r-i-1):t}rank(t){if(p.nichts(t))throw Error("argument to rank() is null");return this._rankNode(t,this.root)}_rankNode(t,e){if(p.nichts(e))return 0;let r=this.compare(t,e.key);return r<0?this._rankNode(t,e.left):r>0?1+this._sizeNode(e.left)+this._rankNode(t,e.right):this._sizeNode(e.left)}keysInOrder(){let t=new l;return this._keysInOrderNode(this.root,t),t.iter()}_keysInOrderNode(t,e){p.nichts(t)||(this._keysInOrderNode(t.left,e),e.enqueue(t.key),this._keysInOrderNode(t.right,e))}keysLevelOrder(){let t=new l;if(!this.isEmpty()){let e=new l;for(e.enqueue(this.root);!e.isEmpty();){let r=e.dequeue();t.enqueue(r.key),r.left||e.enqueue(r.left),r.right&&e.enqueue(r.right)}}return t}keys(t,e){if(0==arguments.length)return this.keysInOrder();if(p.nichts(t))throw Error("first argument to keys() is null");if(p.nichts(e))throw Error("second argument to keys() is null");let r=new l;return this._keysNode(this.root,r,t,e),r.iter()}_keysNode(t,e,r,i){if(t){let s=this.compare(r,t.key),n=this.compare(i,t.key);s<0&&this._keysNode(t.left,e,r,i),s<=0&&n>=0&&e.enqueue(t.key),n>0&&this._keysNode(t.right,e,r,i)}}size(t,e){if(0==arguments.length)return this._sizeNode(this.root);if(p.nichts(t))throw Error("first argument to size() is null");if(p.nichts(e))throw Error("second argument to size() is null");return this.compare(t,e)>0?0:this.contains(e)?this.rank(e)-this.rank(t)+1:this.rank(e)-this.rank(t)}_check(){let t=this;return function e(r,i,s){return!r||!(!i&&t.compare(r.key,i)<=0)&&!(!s&&t.compare(r.key,s)>=0)&&e(r.left,i,r.key)&&e(r.right,r.key,s)}(this.root,null,null)&&function e(r){if(!r)return!0;let i=t._balanceFactor(r);return!(i>1||i<-1)&&e(r.left)&&e(r.right)}(this.root)&&function e(r){return!r||r.size==t._sizeNode(r.left)+t._sizeNode(r.right)+1&&e(r.left)&&e(r.right)}(this.root)&&function(){for(let e=0;e<t.size();e++)if(e!=t.rank(t.select(e)))return!1;for(let e,r=t.keys().iterator();r.hasNext();)if(e=r.next(),0!=this.compare(e,t.select(t.rank(key))))return!1;return!0}()}static test(){let t=new b(h);"SEARCHEXAMPLE".split("").forEach(((e,r)=>t.put(e,r)));for(let e,r=t.keys();r.hasNext();)e=r.next(),console.log(e+" "+t.get(e))}}const v=Math.sqrt(2);function T(t,e){return{parent:e,pos:t,f:0,g:0,h:0,pid:`${t[0]},${t[1]}`,equals(t){return this.pos[0]==t.pos[0]&&this.pos[1]==t.pos[1]}}}class S{static manhattan(t,e,r=1){return r*Math.abs(t[1]-e[1])+r*Math.abs(t[0]-e[0])}static euclidean(t,e,r=1){let i=e[0]-t[0],s=e[1]-t[1];return r*(i*i+s*s)}static diagonal(t,e,r=1,i=v){let s=Math.abs(e[0]-t[0]),n=Math.abs(e[1]-t[1]);return r*(s+n)+(i-2*r)*Math.min(s,n)}constructor(t){this.grid=t}pathTo(t,e,r){return this._search(this.grid,t,e,r)}_search(t,e,r,i){const s=i.compare,n=t.length,o=t[0].length,a=new Map,l=new Map,h=new c(s,10),u=T(r),d=T(e),p=[[1,0],[-1,0],[0,1],[0,-1]],f=(t,e)=>{for(;t;t=t.parent)e.unshift(t.pos);return e};i.wantDiagonal&&p.push([1,1],[1,-1],[-1,1],[-1,-1]),l.set(d.pid,d.g),h.insert(d);let g,m=[];for(;!h.isEmpty();){if(g=h.delMin(),l.delete(g.pid),a.set(g.pid,0),g.equals(u))return f(g,[]);m.length=0;for(let t,e=0;e<p.length;++e)t=[g.pos[0]+p[e][0],g.pos[1]+p[e][1]],t[0]>o-1||t[0]<0||t[1]>n-1||t[1]<0||i.blocked(t)||m.push(T(t,g));m.forEach((t=>{a.has(t.pid)||(t.g=g.g+i.cost(),t.h=i.calcHeuristic(t.pos,u.pos),t.f=t.g+t.h,l.has(t.pid)&&t.g>l.get(t.pid)||(h.insert(t),l.set(t.pid,t.g)))}))}}static test(){let t,e,r,i=[[0,1,0,0,0,0],[0,0,0,0,0,0],[0,1,0,1,0,0],[0,1,0,0,1,0],[0,0,0,0,1,0]],s=i.length,n=i[0].length,o={wantDiagonal:!1,compare:(t,e)=>t.f-e.f,cost:()=>1,blocked:t=>0!=i[t[1]][t[0]],calcHeuristic:(t,e)=>S.euclidean(t,e)},a=new S(i).pathTo([0,0],[5,4],o);a?(r="",a.forEach((t=>{r+=`[${t[0]},${t[1]}] `})),console.log(r),e=p.fill(s,(()=>p.fill(n,"#"))),t=0,a.forEach((r=>{e[r[1]][r[0]]=""+t,++t})),e.forEach((t=>{console.log(t.toString())}))):console.log("no path")}}return{AStarGrid:S,AVLTreeST:b,RedBlackBST:x,BST:_,BinarySearch:y,BinarySearchST:m,FrequencyCounter:f,SequentialSearchST:g}}"object"==typeof module&&module.exports?module.exports=r(require("../main/core"),require("../main/math"),require("./basic"),require("./sort")):t["io/czlab/mcfud/algo/search"]=r}(this),function(t,e){"use strict";function r(r,i,s,n){s||(s=t["io/czlab/mcfud/algo/basic"]()),n||(n=t["io/czlab/mcfud/algo/sort"]()),r||(r=t["io/czlab/mcfud/core"]()),i||(i=t["io/czlab/mcfud/math"]());const{prnIter:o,TreeMap:a,Bag:l,Stack:h,Queue:u,ST:c,StdCompare:d}=s,{IndexMinPQ:p,MinPQ:f}=n,{is:g,u:m}=(Math.floor,r);function _(t,e){if(t<0||t>=e)throw Error(`vertex ${t} is not between 0 and ${e-1}`);return!0}class x{constructor(t){m.assert(t>=0,"Number of vertices must be non-negative"),this.verts=t,this.edges=0,this.adjls=m.fill(t,(()=>new l))}clone(){let t=new x(this.V());t.edges=this.E(),t.adjls=[];for(let e=0,r=this.V();e<r;++e)t.adjls.push(this.adjls[e].clone());return t}V(){return this.verts}E(){return this.edges}addEdge(t,e){_(t,this.verts),_(e,this.verts),this.edges+=1,this.adjls[t].add(e),this.adjls[e].add(t)}adj(t){return _(t,this.verts)&&this.adjls[t]}degree(t){return _(t,this.verts)&&this.adjls[t].size()}toString(){let t=`${this.verts} vertices, ${this.edges} edges\n`;for(let e=0;e<this.verts;++e)t+=`${e}: `+o(this.adjls[e].iter()),t+="\n";return t}static load(t,e){let r=new x(t);m.assert(e.length%2==0,"wanted even n# of data points");for(let t=0;t<e.length;t+=2)r.addEdge(e[t],e[t+1]);return r}static test(){let t=x.load(13,[0,5,4,3,0,1,9,12,6,4,5,4,0,2,11,12,9,10,0,6,7,8,9,11,5,3]);t.degree(1),console.log(t.toString());let e=t.clone();console.log("cloned=\n"+e.toString())}}class y{constructor(t,e){this.bMarked=new Array(t.V()),this.nCount=0,_(e,this.bMarked.length)&&this._dfs(t,e)}_dfs(t,e){this.nCount+=1,this.bMarked[e]=!0;for(let r,i=t.adj(e).iter();i.hasNext();)r=i.next(),this.bMarked[r]||this._dfs(t,r)}marked(t){return _(t,this.bMarked.length)&&this.bMarked[t]}count(){return this.nCount}static test(){let t,e,r=x.load(13,[0,5,4,3,0,1,9,12,6,4,5,4,0,2,11,12,9,10,0,6,7,8,9,11,5,3]);[0,9].forEach((i=>{e=new y(r,i),t="";for(let i=0;i<r.V();++i)e.marked(i)&&(t+=`${i} `);console.log(t),console.log(e.count()!=r.V()?"NOT connected":"connected")}))}}class b{constructor(t,e){this.bMarked=new Array(t.V()),_(e,this.bMarked.length);let r,i,s=m.fill(t.V(),(e=>t.adj(e).iter())),n=new h;for(this.bMarked[e]=!0,n.push(e);!n.isEmpty();)r=n.peek(),s[r].hasNext()?(i=s[r].next(),this.bMarked[i]||(this.bMarked[i]=!0,n.push(i))):n.pop()}marked(t){return _(t,this.bMarked.length)&&this.bMarked[t]}static test(){let t,e,r=x.load(13,[0,5,4,3,0,1,9,12,6,4,5,4,0,2,11,12,9,10,0,6,7,8,9,11,5,3]);[0,9].forEach((i=>{e=new b(r,i),t="";for(let i=0;i<r.V();++i)e.marked(i)&&(t+=`${i} `);console.log(t)}))}}class v{constructor(t,e){this.bMarked=new Array(t.V()),this.edgeTo=new Array(t.V()),this.s=e,_(e,this.bMarked.length)&&this._dfs(t,e)}_dfs(t,e){this.bMarked[e]=!0;for(let r,i=t.adj(e).iter();i.hasNext();)r=i.next(),this.bMarked[r]||(this.edgeTo[r]=e,this._dfs(t,r))}hasPathTo(t){return _(t,this.bMarked.length)&&this.bMarked[t]}pathTo(t){if(_(t,this.bMarked.length)&&this.hasPathTo(t)){let e=new h;for(let r=t;r!=this.s;r=this.edgeTo[r])e.push(r);return e.push(this.s),e.iter()}}static test(){let t=x.load(6,[0,5,2,4,2,3,1,2,0,1,3,4,3,5,0,2]),e=new v(t,0);for(let r,i,s=0;s<t.V();++s)if(e.hasPathTo(s)){r=`0 to ${s}:  `;for(let t=e.pathTo(s);t.hasNext();)i=t.next(),r+=0==i?i:`-${i}`;console.log(r)}else console.log(`0 to ${s}:  not connected\n`)}}function T(t,e){if(!t||0==t.length)throw Error("argument is null or empty");return t.forEach((t=>_(t,e))),!0}class S{constructor(t,e){this.bMarked=new Array(t.V()),this.mDistTo=new Array(t.V()),this.edgeTo=new Array(t.V()),g.vec(e)||(e=[e]),T(e,t.V()),function(t,e,r){let i,s=[];for(i=0;i<t.V();++i)r.mDistTo[i]=1/0;for(e.forEach((t=>{r.bMarked[t]=!0,r.mDistTo[t]=0,s.push(t)}));s.length>0;){i=s.shift();for(let e,n=t.adj(i).iter();n.hasNext();)e=n.next(),r.bMarked[e]||(r.edgeTo[e]=i,r.mDistTo[e]=r.mDistTo[i]+1,r.bMarked[e]=!0,s.push(e))}}(t,e,this),function(t,e,r){if(0!=r.mDistTo[e])throw Error(`dist of source ${e} to itself = ${r.mDistTo[e]}`);for(let e=0;e<t.V();++e)for(let i,s=t.adj(e).iter();s.hasNext();){if(i=s.next(),r.hasPathTo(e)!==r.hasPathTo(i))throw Error(`edge ${e}-${i}hasPathTo(${e})=${r.hasPathTo(e)}hasPathTo(${i})=${r.hasPathTo(i)}`);if(r.hasPathTo(e)&&r.mDistTo[i]>r.mDistTo[e]+1)throw Error(`edge ${e}-${i}distTo[${e}]=${r.mDistTo[e]}distTo[${i}]=${r.mDistTo[i]}`)}for(let i,s=0;s<t.V();++s)if(r.hasPathTo(s)&&s!=e&&(i=r.edgeTo[s],r.mDistTo[s]!=r.mDistTo[i]+1))throw Error(`shortest path edge ${i}-${s} distTo[${i}]= ${r.mDistTo[i]}distTo[${s}]= ${r.mDistTo[s]}`)}(t,e,this)}hasPathTo(t){return _(t,this.bMarked.length)&&this.bMarked[t]}distTo(t){return _(t,this.bMarked.length)&&this.mDistTo[t]}pathTo(t){if(_(t,this.bMarked.length)&&this.hasPathTo(t)){let e,r=new h;for(e=t;0!=this.mDistTo[e];e=this.edgeTo[e])r.push(e);return r.push(e),r.iter()}}static test(){let t=x.load(6,[0,5,2,4,2,3,1,2,0,1,3,4,3,5,0,2]),e=new S(t,0);for(let r,i=0;i<t.V();++i)if(e.hasPathTo(i)){r=`0 to ${i}(${e.distTo(i)}): `;for(let t,s=e.pathTo(i);s.hasNext();)t=s.next(),r+=0==t?`${t}`:`-${t}`;console.log(r)}else console.log(`0 to ${i} (-):  not connected\n`)}}class w{constructor(t,e,r){if(t<0)throw Error("vertex index must be a non-negative integer");if(e<0)throw Error("vertex index must be a non-negative integer");this.v=t,this.w=e,this._weight=r}weight(){return this._weight}either(){return this.v}other(t){if(t==this.v)return this.w;if(t==this.w)return this.v;throw Error("Illegal endpoint")}static comparator(t,e){return t._weight<e._weight?-1:t._weight>e._weight?1:0}toString(){return`${this.v}-${this.w} ${this._weight}`}static test(){console.log(new w(12,34,5.67).toString())}}class E{constructor(t){if(t<0)throw Error("Number of vertices must be non-negative");this._V=t,this._E=0,this.adjls=m.fill(t,(()=>new l))}static randGraph(t,e){let r=new E(t);if(e<0)throw Error("Number of edges must be non-negative");for(let i,s,n,o=0;o<e;++o)s=m.randInt(t),n=m.randInt(t),i=Math.round(100*m.rand())/100,r.addEdge(new w(s,n,i));return r}clone(){let t=new E(this.V());t._E=this.E();for(let e=0;e<this.V();++e)t.adjls[e]=this.adjls[e].clone();return t}V(){return this._V}E(){return this._E}addEdge(t){let e=t.either(),r=t.other(e);_(e,this._V),_(r,this._V),this.adjls[e].add(t),this.adjls[r].add(t),this._E+=1}adj(t){return _(t,this._V)&&this.adjls[t]}degree(t){return _(t,this._V)&&this.adjls[t].size()}edges(){const t=new l;for(let e,r,i,s=0;s<this._V;++s)for(r=0,e=this.adjls[s].iter();e.hasNext();)i=e.next(),i.other(s)>s?t.add(i):i.other(s)==s&&(r%2==0&&t.add(i),++r);return t.iter()}toString(){let t=`${this._V} ${this._E}\n`;for(let e,r=0;r<this._V;++r){for(t+=`${r}: `,e=this.adjls[r].iter();e.hasNext();)t+=`${e.next()}, `;t+="\n"}return t}static load(t,e){let r=new E(t);m.assert(e.length%3==0,"Invalid data size");for(let i=0;i<e.length;i+=3)_(e[i],t)&&_(e[i+1],t)&&r.addEdge(new w(e[i],e[i+1],e[i+2]));return r}static test(){let t="4 5 0.35 4 7 0.37 5 7 0.28 0 7 0.16 1 5 0.32 0 4 0.38 2 3 0.17 1 7 0.19 0 2 0.26 1 2 0.36 1 3 0.29 2 7 0.34 6 2 0.40 3 6 0.52 6 0 0.58 6 4 0.93".split(" ").map((t=>+t)),e=E.load(8,t);console.log(e.toString())}}class A{constructor(t){this.bMarked=new Array(t.V()),this._id=new Array(t.V()),this._size=new Array(t.V()),this.nCount=0;for(let e=0;e<t.V();++e)this.bMarked[e]||(this._dfs(t,e),++this.nCount)}_dfs(t,e){this.bMarked[e]=!0,this._id[e]=this.nCount,this._size[this.nCount]+=1;for(let r,i,s=t.adj(e).iter();s.hasNext();)r=s.next(),t instanceof E?(i=r.other(e),this.bMarked[i]||this._dfs(t,i)):this.bMarked[r]||this._dfs(t,r)}id(t){return _(t,this.bMarked.length)&&this._id[t]}size(t){return _(t,this.bMarked.length)&&this._size[this._id[t]]}count(){return this.nCount}connected(t,e){return _(t,this.bMarked.length)&&_(e,this.bMarked.length)&&this.id(t)==this.id(e)}static test(){let t=x.load(13,[0,5,4,3,0,1,9,12,6,4,5,4,0,2,11,12,9,10,0,6,7,8,9,11,5,3]),e=new A(t),r=e.count();console.log(r+" components");let i=m.fill(r,(()=>[]));for(let r=0;r<t.V();++r)i[e.id(r)].push(r);for(let t,e=0;e<r;++e)t="",i[e].forEach((e=>t+=e.toString()+" ")),console.log(t)}}class P{static load(t,e){if(t<0)throw Error("verts in a Digraph must be non-negative");m.assert(e.length%2==0,"expected even n# of data-length");let r=new P(t);for(let t=0;t<e.length;t+=2)r.addEdge(e[t],e[t+1]);return r}constructor(t){if(t<0)throw Error("verts in a Digraph must be non-negative");this._V=t,this._E=0,this._indegree=m.fill(t,0),this.adjls=m.fill(t,(()=>new l))}clone(){let t=this,e=new P(this.V());e._E=this.E(),e._indegree=m.fill(e.V(),(e=>t._indegree[e]));for(let t=0;t<e.V();++t)e.adjls[t]=this.adjls[t].clone();return e}V(){return this._V}E(){return this._E}addEdge(t,e){_(t,this._V)&&_(e,this._V),this.adjls[t].add(e),this._indegree[e]+=1,++this._E}adj(t){return _(t,this._V)&&this.adjls[t]}outdegree(t){return _(t,this._V)&&this.adjls[t].size()}indegree(t){return _(t,this._V)&&this._indegree[t]}reverse(){let t=new P(this._V);for(let e,r=0;r<this._V;++r)for(e=this.adjls[r].iter();e.hasNext();)t.addEdge(e.next(),r);return t}toString(){let t=`${this._V} vertices, ${this._E} edges\n`;for(let e,r=0;r<this._V;++r){for(t+=`${r}: `,e=this.adjls[r].iter();e.hasNext();)t+=`${e.next()} `;t+="\n"}return t}static test(){let t=P.load(13,"4  2 2  3 3  2 6  0 0  1 2  0 11 12 12  9 9 10 9 11 7  9 10 12 11  4 4  3 3  5 6  8 8  6 5  4 0  5 6  4 6  9 7  6".split(/\s+/).map((t=>+t))),e="",r="";for(let i=0;i<t.V();++i)e+=`${i}=${t.indegree(i)}, `,r+=`${i}=${t.outdegree(i)},`;console.log("indegreee= "+e),console.log("outdegreee= "+r),console.log(t.toString());let i=t.clone();console.log("cloned=\n"+i.toString());let s=t.reverse();console.log("rev'ed=\n"+s.toString())}}class M{constructor(t,e){this.bMarked=new Array(t.V()),g.vec(e)||(e=[e]),T(e,t.V()),e.forEach((e=>{this.bMarked[e]||this._dfs(t,e)}))}_dfs(t,e){this.mCount+=1,this.bMarked[e]=!0;for(let r,i=t.adj(e).iter();i.hasNext();)r=i.next(),this.bMarked[r]||this._dfs(t,r)}marked(t){return _(t,this.bMarked.length)&&this.bMarked[t]}count(){return this.mCount}static test(){let t=P.load(13,"4  2 2  3 3  2 6  0 0  1 2  0 11 12 12  9 9 10 9 11 7  9 10 12 11  4 4  3 3  5 6  8 8  6 5  4 0  5 6  4 6  9 7  6".split(/\s+/).map((t=>+t))),e="",r=new M(t,[1,2,6]);for(let i=0;i<t.V();++i)r.marked(i)&&(e+=`${i} `);r.count(),console.log(e)}}class R{constructor(t){this.bMarked=new Array(t.V()),this.onStack=new Array(t.V()),this.edgeTo=new Array(t.V()),this.mCycle=e;for(let e=0;e<t.V();++e)this.bMarked[e]||this.mCycle||this._dfs(t,e)}_dfs(t,e){this.onStack[e]=!0,this.bMarked[e]=!0;for(let r,i=t.adj(e).iter();i.hasNext();){if(r=i.next(),this.mCycle)return;if(this.bMarked[r]){if(this.onStack[r]){this.mCycle=new h;for(let t=e;t!=r;t=this.edgeTo[t])this.mCycle.push(t);this.mCycle.push(r),this.mCycle.push(e),this._check()}}else this.edgeTo[r]=e,this._dfs(t,r)}this.onStack[e]=!1}hasCycle(){return!!this.mCycle}cycle(){return this.mCycle&&this.mCycle.iter()}_check(){if(this.hasCycle()){let t=-1,e=-1;for(let r,i=this.cycle();i.hasNext();)r=i.next(),-1==t&&(t=r),e=r;if(t!=e)throw Error(`cycle begins with ${t} and ends with ${e}\n`)}return!0}static test(){let t="2 3 0 6 0 1 2 0 11 12  9 12  9 10  9 11 3 5 8 7 5 4 0 5 6 4 6 9 7 6".split(/\s+/).map((t=>+t)),e="4  2 2  3 3  2 6  0 0  1 2  0 11 12 12  9 9\n               10 9 11 7  9 10 12 11  4 4  3 3  5 6  8 8\n               6 5  4 0  5 6  4 6  9 7  6".split(/\s+/).map((t=>+t));[new R(P.load(13,e)),new R(P.load(13,t))].forEach((t=>{t.hasCycle()?(console.log("Directed cycle: "),console.log(o(t.cycle()))):console.log("No directed cycle")}))}}class C{constructor(t,e,r){if(t<0)throw Error("Vertex names must be non-negative integers");if(e<0)throw Error("Vertex names must be non-negative integers");this.v=t,this.w=e,this._weight=r}from(){return this.v}to(){return this.w}weight(){return this._weight}toString(){return`${this.v}->${this.w} ${Number(this._weight).toFixed(2)}`}static test(){console.log(new C(12,34,5.67).toString())}}class O{constructor(t){if(t<0)throw Error("Number of vertices in a Digraph must be non-negative");this._V=t,this._E=0,this._indegree=new Array(t),this.adjls=m.fill(t,(()=>new l))}static randGraph(t,e){if(e<0)throw Error("n# edges in a Digraph must be non-negative");let r=new O(t);for(let i=0;i<e;++i)r.addEdge(new C(m.randInt(t),m.randInt(t),.01*_randInt(100)));return r}static load(t,e){if(t<0)throw Error("n# vertices in a Digraph must be non-negative");m.assert(e.length%3==0,"bad data length");let r=new O(t);for(let i=0;i<e.length;i+=3)_(e[i],t)&&_(e[i+1],t)&&r.addEdge(new C(e[i],e[i+1],e[i+2]));return r}clone(){let t=new O(this.V());t._E=this.E();for(let e=0;e<this.V();++e)t._indegree[e]=this._indegree(e);for(let e=0;e<this.V();++e)t.adjls[e]=this.adjls[e].clone();return t}V(){return this._V}E(){return this._E}addEdge(t){m.assert(t instanceof C,"Expected DirectedEdge");let e=t.to(),r=t.from();_(r,this._V),_(e,this._V),this.adjls[r].add(t),this._indegree[e]+=1,this._E++}adj(t){return _(t,this._V)&&this.adjls[t]}outdegree(t){return _(t,this._V)&&this.adjls[t].size()}indegree(t){return _(t,this._V)&&this._indegree[t]}edges(){const t=new l;for(let e=0;e<this._V;++e)for(let r=this.adj(e).iter();r.hasNext();)t.add(r.next());return t.iter()}toString(){let t=`${this._V} ${this._E}\n`;for(let e=0;e<this._V;++e)t+=`${e}: `+o(this.adjls[e].iter())+"\n";return t}static test(){let t="4 5 0.35\n        5 4 0.35\n        4 7 0.37\n        5 7 0.28\n        7 5 0.28\n        5 1 0.32\n        0 4 0.38\n        0 2 0.26\n        7 3 0.39\n        1 3 0.29\n        2 7 0.34\n        6 2 0.40\n        3 6 0.52\n        6 0 0.58\n        6 4 0.93".split(/\s+/).map((t=>+t)),e=O.load(8,t);console.log(e.toString())}}class I{constructor(t){this._pre=new Array(t.V()),this._post=new Array(t.V()),this.preCounter=0,this.postCounter=0,this.postorder=new u,this.preorder=new u,this.bMarked=new Array(t.V());for(let e=0;e<t.V();e++)this.bMarked[e]||this._dfs(t,e);this._check()}_dfs(t,e){this.bMarked[e]=!0,this._pre[e]=this.preCounter++,this.preorder.enqueue(e);for(let r,i=t.adj(e).iter();i.hasNext();)r=t instanceof O?i.next().to():i.next(),this.bMarked[r]||this._dfs(t,r);this.postorder.enqueue(e),this._post[e]=this.postCounter++}pre(t){return _(t,this.bMarked.length)&&this._pre[t]}post(t){return _(t,this.bMarked.length)&&this._post[t]}postOrder(){return this.postorder.iter()}preOrder(){return this.preorder.iter()}reversePost(){let t=new h;for(let e=this.postorder.iter();e.hasNext();)t.push(e.next());return t.iter()}_check(){let t,e=0;for(t=this.postOrder();t.hasNext();){if(this.post(t.next())!=e)throw Error("post(v) and post() inconsistent");++e}for(e=0,t=this.preOrder();t.hasNext();){if(this.pre(t.next())!=e)throw Error("pre(v) and pre() inconsistent");++e}return!0}static test(){let t=P.load(13,"2 3 0 6 0 1 2 0 11 12  9 12  9 10  9 11 3 5 8 7 5 4 0 5 6 4 6 9 7 6".split(/\s+/).map((t=>+t)));console.log(t.toString());let e=new I(t);console.log("   v  pre  post"),console.log("--------------");for(let r=0;r<t.V();++r)console.log(`    ${r}  ${e.pre(r)}  ${e.post(r)}\n`);console.log("Preorder:  "),console.log(o(e.preOrder())),console.log("Postorder:  "),console.log(o(e.postOrder())),console.log(""),console.log("Reverse postorder: "),console.log(o(e.reversePost()))}}class B{constructor(t){m.assert(t instanceof O,"Expected EdgeWeightedDigraph"),this.bMarked=new Array(t.V()),this.onStack=new Array(t.V()),this.edgeTo=new Array(t.V());for(let e=0;e<t.V();++e)this.bMarked[e]||this._dfs(t,e);this._check()}_dfs(t,e){this.onStack[e]=!0,this.bMarked[e]=!0;for(let r,i,s=t.adj(e).iter();s.hasNext();){if(i=s.next(),r=i.to(),this.mCycle)return;if(this.bMarked[r]){if(this.onStack[r]){this.mCycle=new h;let t=i;for(;t.from()!=r;)this.mCycle.push(t),t=this.edgeTo[t.from()];return void this.mCycle.push(t)}}else this.edgeTo[r]=i,this._dfs(t,r)}this.onStack[e]=!1}hasCycle(){return m.echt(this.mCycle)}cycle(){return this.mCycle&&this.mCycle.iter()}_check(){if(this.hasCycle()){let t=e,r=e;for(let e,i=this.cycle();i.hasNext();){if(e=i.next(),t||(t=e),r&&r.to()!=e.from())throw Error(`cycle edges ${r} and ${e} not incident\n`);r=e}if(r.to()!=t.from())throw Error(`cycle edges ${r} and ${t} not incident\n`)}return!0}static test(){let t=13,e=new O(t);m.shuffle(m.fill(t,(t=>t)));for(let r,i,s,n=0;n<8;++n){do{i=m.randInt(t),s=m.randInt(t)}while(i>=s);r=m.rand(),e.addEdge(new C(i,s,r))}for(let r=0;r<6;++r)e.addEdge(new C(m.randInt(t),m.randInt(t),m.rand()));console.log(e.toString());let r=new B(e);r.hasCycle()?console.log("Cycle: "+o(r.cycle())):console.log("No directed cycle")}}class k{constructor(t){this.st=new c,t.forEach((t=>t.forEach(((t,e)=>{this.st.contains(t)||this.st.put(t,this.st.size())})))),this.keys=new Array(this.st.size());for(let t,e=this.st.keys();e.hasNext();)t=e.next(),this.keys[this.st.get(t)]=t;this._graph=new x(this.st.size()),t.forEach((t=>{let e=this.st.get(t[0]);for(let r,i=1;i<t.length;++i)r=this.st.get(t[i]),this._graph.addEdge(e,r)}))}contains(t){return this.st.contains(t)}indexOf(t){return this.st.get(t)}nameOf(t){return _(t,this._graph.V())&&this.keys[t]}graph(){return this._graph}static test(){let t="JFK MCO\n                  ORD DEN\n                  ORD HOU\n                  DFW PHX\n                  JFK ATL\n                  ORD DFW\n                  ORD PHX\n                  ATL HOU\n                  DEN PHX\n                  PHX LAX\n                  JFK ORD\n                  DEN LAS\n                  DFW HOU\n                  ORD ATL\n                  LAS LAX\n                  ATL MCO\n                  HOU MCO\n                  LAS PHX".split(/\s+/),e=new k(m.partition(2,t)),r=e.graph();["JFK","LAX"].forEach((t=>{if(e.contains(t)){let i=e.indexOf(t);console.log(t);for(let t=r.adj(i).iter();t.hasNext();)console.log("   "+e.nameOf(t.next()))}else console.log("input not contain '"+t+"'")}))}}class G{constructor(t){this.st=new c,t.forEach((t=>t.forEach((t=>{this.st.contains(t)||this.st.put(t,this.st.size())})))),this.keys=new Array(this.st.size());for(let t,e=this.st.keys();e.hasNext();)t=e.next(),this.keys[this.st.get(t)]=t;this.graph=new P(this.st.size()),t.forEach((t=>{let e=this.st.get(t[0]);for(let r=1;r<t.length;++r)this.graph.addEdge(e,this.st.get(t[r]))}))}contains(t){return this.st.contains(t)}indexOf(t){return this.st.get(t)}nameOf(t){return _(t,this.graph.V())&&this.keys[t]}digraph(){return this.graph}static test(){let t="JFK MCO\n              ORD DEN\n              ORD HOU\n              DFW PHX\n              JFK ATL\n              ORD DFW\n              ORD PHX\n              ATL HOU\n              DEN PHX\n              PHX LAX\n              JFK ORD\n              DEN LAS\n              DFW HOU\n              ORD ATL\n              LAS LAX\n              ATL MCO\n              HOU MCO\n              LAS PHX".split(/\s+/),e=new G(m.partition(2,t)),r=e.digraph();["JFK","ATL","LAX"].forEach((t=>{console.log(`${t}`);let i=r.adj(e.indexOf(t)).iter();for(;i.hasNext();)console.log("   "+e.nameOf(i.next()))}))}}class D{constructor(t){let r;if(this._order=e,this.rank=e,t instanceof O?r=new B(t):t instanceof P?(r=new R(t),r.hasCycle()||(this.rank=new Array(t.V()))):m.assert(!1,"bad arg for Topological"),r&&!r.hasCycle()){this._order=new u;for(let e,r=0,i=new I(t).reversePost();i.hasNext();)e=i.next(),this.rank&&(this.rank[e]=r++),this._order.enqueue(e)}}order(){return this._order.iter()}hasOrder(){return m.echt(this._order)}rank(t){return this.rank&&_(t,this.rank.length)&&this.hasOrder()?this.rank[t]:-1}static test(){let t=new G([["Algorithms","Theoretical CS","Databases","Scientific Computing"],["Introduction to CS","Advanced Programming","Algorithms"],["Advanced Programming","Scientific Computing"],["Scientific Computing","Computational Biology"],["Theoretical CS","Computational Biology","Artificial Intelligence"],["Linear Algebra","Theoretical CS"],["Calculus","Linear Algebra"],["Artificial Intelligence","Neural Networks","Robotics","Machine Learning"],["Machine Learning","Neural Networks"]]);for(let e=new D(t.digraph()).order();e.hasNext();)console.log(t.nameOf(e.next()))}}class F{constructor(t,e){this.bMarked=new Array(t.V()),this.edgeTo=new Array(t.V()),this.s=e,_(e,this.bMarked.length)&&this._dfs(t,e)}_dfs(t,e){this.bMarked[e]=!0;for(let r,i=t.adj(e).iter();i.hasNext();)r=i.next(),this.bMarked[r]||(this.edgeTo[r]=e,this._dfs(t,r))}hasPathTo(t){return _(t,this.bMarked.length)&&this.bMarked[t]}pathTo(t){if(_(t,this.bMarked.length)&&this.hasPathTo(t)){let e=new h;for(let r=t;r!=this.s;r=this.edgeTo[r])e.push(r);return e.push(this.s),e.iter()}}static test(){let t,e="4  2 2  3 3  2 6  0 0  1 2  0 11 12 12  9 9 10\n              9 11 7  9 10 12 11  4 4  3 3  5 6\n              8 8  6 5  4 0  5 6  4 6  9 7  6".split(/\s+/).map((t=>+t)),r=P.load(13,e),i=new F(r,3);for(let e=0;e<r.V();++e)if(i.hasPathTo(e)){t=`3 to ${e}:  `;for(let r,s=i.pathTo(e);s.hasNext();)r=s.next(),t+=3==r?`${r}`:`-${r}`;console.log(t)}else console.log(`3 to ${e}:  not connected`)}}class N{constructor(t,e){g.vec(e)||(e=[e]),this.bMarked=new Array(t.V()),this.mDistTo=new Array(t.V()),this.edgeTo=new Array(t.V());for(let e=0;e<t.V();++e)this.mDistTo[e]=1/0;T(e,t.V())&&this._bfs(t,e)}_bfs(t,e){let r=new u;for(e.forEach((t=>{this.bMarked[t]=!0,this.mDistTo[t]=0,r.enqueue(t)}));!r.isEmpty();){let e=r.dequeue();for(let i,s=t.adj(e).iter();s.hasNext();)i=s.next(),this.bMarked[i]||(this.edgeTo[i]=e,this.mDistTo[i]=this.mDistTo[e]+1,this.bMarked[i]=!0,r.enqueue(i))}}hasPathTo(t){return _(t,this.bMarked.length)&&this.bMarked[t]}distTo(t){return _(t,this.bMarked.length)&&this.mDistTo[t]}pathTo(t){if(_(t,this.bMarked.length)&&this.hasPathTo(t)){let e,r=new h;for(e=t;0!=this.mDistTo[e];e=this.edgeTo[e])r.push(e);return r.push(e),r.iter()}}static test(){let t,e="4  2 2  3 3  2 6  0 0  1 2  0 11 12 12  9 9 10\n              9 11 7  9 10 12 11  4 4  3 3  5 6\n              8 8  6 5  4 0  5 6  4 6  9 7  6".split(/\s+/).map((t=>+t)),r=P.load(13,e),i=new N(r,3);for(let e=0;e<r.V();++e)if(t="",i.hasPathTo(e)){t=`3 to ${e} (${i.distTo(e)}):  `;for(let r,s=i.pathTo(e);s.hasNext();)r=s.next(),t+=3==r?`${r}`:`->${r}`;console.log(t)}else console.log(`3 to ${e} (-):  not connected`)}}class U{constructor(t,e,r){m.assert(t instanceof O,"Expected EdgeWeightedDigraph");for(let e,r=t.edges();r.hasNext();)if(e=r.next(),e.weight()<0)throw Error(`edge ${e} has negative weight`);this._distTo=new Array(t.V()),this.edgeTo=m.fill(t.V(),null),_(e,t.V());for(let e=0;e<t.V();++e)this._distTo[e]=1/0;for(this._distTo[e]=0,this.pq=new p(t.V(),r),this.pq.insert(e,this._distTo[e]);!this.pq.isEmpty();){let e=this.pq.delMin();for(let r=t.adj(e).iter();r.hasNext();)this._relax(r.next())}this._check(t,e)}_relax(t){let e=t.from(),r=t.to();this._distTo[r]>this._distTo[e]+t.weight()&&(this._distTo[r]=this._distTo[e]+t.weight(),this.edgeTo[r]=t,this.pq.contains(r)?this.pq.decreaseKey(r,this._distTo[r]):this.pq.insert(r,this._distTo[r]))}distTo(t){return _(t,this._distTo.length)&&this._distTo[t]}hasPathTo(t){return _(t,this._distTo.length)&&this._distTo[t]<1/0}pathTo(t){if(_(t,this._distTo.length)&&this.hasPathTo(t)){let e=new h;for(let r=this.edgeTo[t];r;r=this.edgeTo[r.from()])e.push(r);return e.iter()}}_check(t,e){for(let e=t.edges();e.hasNext();)if(e.next().weight()<0)throw Error("negative edge weight detected");if(0!=this._distTo[e]||this.edgeTo[e])throw Error("distTo[s] and edgeTo[s] inconsistent");for(let r=0;r<t.V();++r)if(r!=e&&!this.edgeTo[r]&&this._distTo[r]!=1/0)throw Error("distTo[] and edgeTo[] inconsistent");for(let e=0;e<t.V();++e)for(let r,i,s=t.adj(e).iter();s.hasNext();)if(i=s.next(),r=i.to(),this._distTo[e]+i.weight()<this._distTo[r])throw Error(`edge ${i} not relaxed`);for(let e,r,i=0;i<t.V();++i)if(this.edgeTo[i]){if(r=this.edgeTo[i],e=r.from(),i!=r.to())throw Error("bad edge");if(this._distTo[e]+r.weight()!=this._distTo[i])throw Error(`edge ${r} on shortest path not tight`)}return!0}static test(){let t="4 5 0.35\n                  5 4 0.35\n                  4 7 0.37\n                  5 7 0.28\n                  7 5 0.28\n                  5 1 0.32\n                  0 4 0.38\n                  0 2 0.26\n                  7 3 0.39\n                  1 3 0.29\n                  2 7 0.34\n                  6 2 0.40\n                  3 6 0.52\n                  6 0 0.58\n                  6 4 0.93".split(/\s+/).map((t=>+t)),e=O.load(8,t),r=new U(e,0,d);for(let t=0;t<e.V();++t)r.hasPathTo(t)?console.log(`0 to ${t} (${Number(r.distTo(t)).toFixed(2)})  ${o(r.pathTo(t))}`):console.log(`0 to ${t}         no path\n`)}}class L{constructor(t,e,r){m.assert(t instanceof E,"Expected EdgeWeightedGraph");for(let e,r=t.edges();r.hasNext();)if(e=r.next(),e.weight()<0)throw new Error(`edge ${e} has negative weight`);for(this._distTo=m.fill(t.V(),(()=>1/0)),this._distTo[e]=0,this.compare=r,this.edgeTo=m.fill(t.V(),(()=>null)),_(e,t.V()),this.pq=new p(t.V(),this.compare),this.pq.insert(e,this._distTo[e]);!this.pq.isEmpty();){let e=this.pq.delMin();for(let r=t.adj(e).iter();r.hasNext();)this._relax(r.next(),e)}this._check(t,e)}_relax(t,e){let r=t.other(e);this._distTo[r]>this._distTo[e]+t.weight()&&(this._distTo[r]=this._distTo[e]+t.weight(),this.edgeTo[r]=t,this.pq.contains(r)?this.pq.decreaseKey(r,this._distTo[r]):this.pq.insert(r,this._distTo[r]))}distTo(t){return _(t,this._distTo.length)&&this._distTo[t]}hasPathTo(t){return _(t,this._distTo.length)&&this._distTo[t]<1/0}pathTo(t){if(_(t,this._distTo.length)&&this.hasPathTo(t)){let e=t,r=new h;for(let i=this.edgeTo[t];i;i=this.edgeTo[e])r.push(i),e=i.other(e);return r.iter()}}_check(t,e){for(let e=t.edges();e.hasNext();)if(e.next().weight()<0)throw Error("negative edge weight detected");if(0!=this._distTo[e]||this.edgeTo[e])throw Error("distTo[s] and edgeTo[s] inconsistent");for(let r=0;r<t.V();++r)if(r!=e&&!this.edgeTo[r]&&this._distTo[r]!=1/0)throw Error("distTo[] and edgeTo[] inconsistent");for(let e=0;e<t.V();++e)for(let r,i,s=t.adj(e).iter();s.hasNext();)if(i=s.next(),r=i.other(e),this._distTo[e]+i.weight()<this._distTo[r])throw Error(`edge ${i} not relaxed`);for(let e,r,i=0;i<t.V();++i)if(this.edgeTo[i]){if(r=this.edgeTo[i],i!=r.either()&&i!=r.other(r.either()))return!1;if(e=r.other(i),this._distTo[e]+r.weight()!=this._distTo[i])throw Error(`edge ${r} on shortest path not tight`)}return!0}static test(){let t="4 5 0.35 4 7 0.37 5 7 0.28 0 7 0.16 1 5 0.32 0 4 0.38\n                  2 3 0.17 1 7 0.19 0 2 0.26 1 2 0.36 1 3 0.29 2 7 0.34\n                  6 2 0.40 3 6 0.52 6 0 0.58 6 4 0.93".split(/\s+/).map((t=>+t)),e=E.load(8,t),r=new L(e,6,d);for(let t,i=0;i<e.V();++i)if(r.hasPathTo(i)){t=`6 to ${i} (${Number(r.distTo(i)).toFixed(2)})  `;for(let e=r.pathTo(i);e.hasNext();)t+=`${e.next()}   `;console.log(t)}else console.log(`6 to ${i}         no path`)}}return{DepthFirstDirectedPaths:F,BreadthFirstDirectedPaths:N,SymbolGraph:k,DijkstraUndirectedSP:L,DijkstraSP:U,Topological:D,SymbolDigraph:G,EdgeWeightedDirectedCycle:B,DepthFirstOrder:I,EdgeWeightedDigraph:O,DirectedEdge:C,DirectedCycle:R,DirectedDFS:M,Digraph:P,CC:A,EdgeWeightedGraph:E,Edge:w,BreadthFirstPaths:S,DepthFirstPaths:v,NonrecursiveDFS:b,DepthFirstSearch:y,Graph:x}}"object"==typeof module&&module.exports?module.exports=r(require("../main/core"),require("../main/math"),require("./basic"),require("./sort")):t["io/czlab/mcfud/algo/graph"]=r}(this),function(t,e){"use strict";function r(e){e||(e=t["io/czlab/mcfud/core"]()),Math.floor;const{u:r,is:i}=e,s={mutationRate:.1,crossOverRate:.7,probTournament:.75,NUM_HIDDEN:1,BIAS:-1,NUM_ELITE:4,TOURNAMENT_SIZE:5,MAX_PERTURBATION:.3,ACTIVATION_RESPONSE:1,NEURONS_PER_HIDDEN:10};class n{constructor(){}gt(t){}lt(t){}eq(t){}clone(){}score(){}update(t){}}class o extends n{constructor(t,e){super(),this.value=t,this.flip=e}gt(t){return this.flip?this.value<t.value:this.value>t.value}eq(t){return this.value==t.value}lt(t){return this.flip?this.value>t.value:this.value<t.value}score(){return this.value}update(t){this.value=t}clone(){return new o(this.value,this.flip)}}class a{constructor(){this.averageScore=0,this.totalScore=0,this.bestScore=0,this.worstScore=0,this.best=void 0}}class l{constructor(t){const e=r.fill(t+1,(()=>r.randMinus1To1()));this.numInputs=e.length,this.activation=0,this.weights=e,this.error=0}}class h{constructor(t,e){this.numNeurons=t,this.neurons=r.fill(t,(()=>new l(e)))}}class u{constructor(t,e){this.fitness=e,this.genes=t,this.age=0}clone(){return new u(this.genes.slice(),this.fitness.clone())}}function c(t){let e=r.randInt(t.length),i=r.randInt(t.length);return e<i?[e,i]:[i,e]}function d(t,e){let i,s=0,n=r.rand(),o=t.map((t=>s+=t.fitness.score()/e));for(i=0;i<o.length-1;++i)if(n>=o[i]&&n<=o[i+1])return t[i];return t[0]}function p(t){let e=r.randInt(t.length),i=r.randInt(t.length);for(;e==i;)i=r.randInt2(0,t.length-1);return r.rand()<s.probTournament?t[e].fitness.gt(t[i].fitness)?t[e]:t[i]:t[e].fitness.lt(t[i].fitness)?t[e]:t[i]}function f(t,e){let r=0,i=1/0,s=new a;function n(t){r=t.fitness.score(),s.bestScore=r,s.best=t}function o(t){i=t.fitness.score(),s.worstScore=i}return e&&(i=0,r=1/0),t.forEach((t=>{e?t.fitness.score()<r?n(t):t.fitness.score()>i&&o(t):t.fitness.score()>r?n(t):t.fitness.score()<i&&o(t),s.totalScore+=t.fitness.score()})),s.averageScore=s.totalScore/t.length,s}function g(t,e="cycles"){let i=t.startTime=r.now();return t[e]=0,i}function m(t){return t.endTime=r.now()}function _(t,e,i,s,n){let o=r.randInt(e.length);for(;e.length>1&&o==t;)o=r.randInt(e.length);let a,l,h=e[t].genes,c=e[o].genes;i?[a,l]=i(h,c):(a=h.slice(),l=c.slice()),s&&(s(a),s(l));let d=n(a,e[t].fitness),p=n(l,e[o].fitness);return d.gt(p)?new u(a,d):new u(l,p)}function x(t,e){let r,i=0;for(;i<t.length&&(r=t[i],!r.fitness.eq(e.fitness)&&!e.fitness.lt(r.fitness));++i);return i}function y(t,{calcFit:e,crossOver:n,create:o,mutate:a}){if(i.num(t))return r.fill(t,(()=>o()));let l,h,c,g,m=[],_=f(t);t.sort(((t,e)=>t.fitness.lt(e.fitness)?-1:t.fitness.gt(e.fitness)?1:0));for(let e=s.NUM_ELITES,r=t.length-1;r>=0&&e>0;--r)m.push(t[r]),--e;for(;m.length<t.length;)void 0!==s.TOURNAMENT_SIZE?(c=p(t),g=p(t)):(c=d(t,_),g=d(t,_)),n?[l,h]=n(c.genes,g.genes):(l=c.genes.slice(),h=g.genes.slice()),a&&(a(l),a(h)),m.push(new u(l,e(l,c.fitness)),new u(h,e(h,g.fitness)));for(;m.length>t.length;)m.pop();return m}return{NeuronLayer:h,Neuron:l,NeuralNet:class{constructor(t,e,i,s){this.layers=function(n){if(i>0){n.push(new h(s,t));for(let t=0;t<i-1;++t)n.push(new h(s,s))}return r.conj(n,new h(e,i>0?s:t))}([]),this.numOfWeights=this.layers.reduce(((t,e)=>t+e.neurons.reduce(((t,e)=>t+e.weights.length),0)),0),this.numOutputs=e,this.numInputs=t,this.numHidden=i,this.neuronsPerHidden=s}putWeights(t){r.assert(t.length>=this.numOfWeights,"bad input to putWeights");let e=0;this.layers.forEach((r=>r.neurons.forEach((r=>r.weights.forEach(((i,s)=>r.weights[s]=t[e++]))))))}getWeights(){const t=[];for(let e=0;e<this.numHidden+1;++e)for(let r=0;r<this.layers[e].numNeurons;++r)for(let i=0;i<this.layers[e].neurons[r].numInputs;++i)t.push(this.layers[e].neurons[r].weights[i]);return t}getNumberOfWeights(){return this.numOfWeights}feedForward(t){return this.update(t)}update(t){r.assert(t.length>=this.numInputs,"invalid input size");let e,i,n,o=[];return this.layers.forEach(((r,a)=>{a>0&&(t=o),o=[],r.neurons.forEach((r=>{n=0,e=0,i=r.numInputs;for(let s=0;s<i-1;++s)e+=r.weights[s]*t[n++];e+=r.weights[i-1]*s.BIAS,o.push(r.activation=this.sigmoid(e,s.ACTIVATION_RESPONSE))}))})),r.assert(o.length==this.numOutputs,"out length incorrect")?o:[]}sigmoid(t,e){return 1/(1+Math.exp(-t/e))}calcSplitPoints(){let t=[],e=0;return this.layers.forEach((r=>r.neurons.forEach((r=>{e+=r.numInputs,t.push(e-1)})))),t}},runGASearch:function(t,e){let i,s,n=g(e),o=e.maxCycles||100,a=1e3*(e.maxSeconds||30),l=function*([t,e],{mutate:i,create:s,maxAge:n,calcFit:o,poolSize:a,crossOver:l}){let h,u=s();yield u;let c,d,p,f,g,m=[u],y=[u];a=a||1,n=n||50;for(let t=0;t<a-1;++t)h=s(),h.fitness.gt(u.fitness)&&(yield u=h,y.push(h)),m.push(h);for(g=a-1,f=1;;)if(r.now()-t>e&&(yield u),f=f>0?f-1:g,h=m[f],d=_(f,m,l,i,o),h.fitness.gt(d.fitness)){if(void 0===n)continue;if(h.age+=1,n>h.age)continue;if(p=x(y,d,y.length),c=p/y.length,r.rand()<Math.exp(-c)){m[f]=d;continue}u.age=0,m[f]=u}else d.fitness.gt(h.fitness)?(d.age=0,m[f]=d,d.fitness.gt(u.fitness)&&(yield u=d,y.push(u))):(d.age=h.age+1,m[f]=d)}([n,a],e);for(;;){if(i=l.next().value,s=m(e),s-n>a){s=null;break}if(!t.gt(i.fitness))break;if(e.cycles>=o)break;e.cycles+=1}return[null==s,i]},runGACycle:function(t,e){let i,s,{maxCycles:n,targetScore:o,maxSeconds:a}=e,l=g(e),h=1e3*(a||30);for(n=n||100;;){if(t=y(t,e),s=m(e),s-l>h){s=null;break}if(i=f(t),r.echt(o)&&i.bestScore>=o)break;if(e.cycles>=n)break;e.cycles+=1}return e.gen++,[null==s,t]},calcStats:f,NumFitness:o,Fitness:n,Chromosome:u,mutateSM:function(t){if(r.rand()<s.mutationRate){let e,[i,s]=c(t),n=s-i-1;if(2==n)e=t[i+1],t[i+1]=t[i+2],t[i+2]=e;else if(n>2){e=r.shuffle(t.slice(i+1,s));for(let r=0,n=i+1;n<s;++n)t[n]=e[r++]}}},mutateDM:function(t){if(r.rand()<s.mutationRate){let e,i,s,[n,o]=c(t),a=t.length;o-n-1>0&&(i=t.slice(n+1,o),s=t.slice(0,n+1).concat(t.slice(o)),e=r.randInt(s.length),i=s.slice(0,e).concat(i).concat(s.slice(e)),t.length=0,i.forEach((e=>t.push(e))),r.assert(t.length==a,"mutateDM error"))}},mutateIVM:function(t){if(r.rand()<s.mutationRate){let e,[i,s]=c(t),n=t.length;if(s-i-1>1){e=t.slice(i+1,s).reverse();for(let r=0,n=i+1;n<s;++n)t[n]=e[r++]}r.assert(n==t.length,"mutateIVM error")}},mutateDIVM:function(t){if(r.rand()<s.mutationRate){let e,i,s,[n,o]=c(t),a=t.length;o-n-1>0&&(i=t.slice(n+1,o).reverse(),s=t.slice(0,n+1).concat(t.slice(o)),e=r.randInt(s.length),i=s.slice(0,e).concat(i).concat(s.slice(e)),t.length=0,i.forEach((e=>t.push(e))),r.assert(t.length==a,"mutateDIVM error"))}},crossOverOBX:function(t,e){let i,n,o,a,l;if(r.randInt2(0,t.length-2),o=t.slice(),a=e.slice(),r.rand()>s.crossOverRate||t===e);else{n=r.listIndexesOf(t,!0).slice(0,r.toGoldenRatio(t.length)[1]).sort(),i=n.map((e=>t[e])),l=0;for(let t=0;t<a.length;++t)for(let e=0;e<i.length;++e)if(a[t]==i[e]){a[t]=i[l++];break}i.length=0,l=0;for(let t=0;t<n.length;++t)i.push(e[n[t]]);for(let t=0;t<o.length;++t)for(let e=0;e<i.length;++e)if(o[t]==i[e]){o[t]=i[l++];break}}return[o,a]},crossOverPBX:function(t,e){let i,n;if(r.rand()>s.crossOverRate||t===e)i=t.slice(),n=e.slice();else{i=r.fill(t.length,null),n=r.fill(t.length,null),r.listIndexesOf(t,!0).slice(0,r.toGoldenRatio(t.length)[1]).sort().forEach((r=>{i[r]=t[r],n[r]=e[r]}));let s=0,o=0;for(let r=0;r<t.length;++r){for(;null!==n[o]&&o<t.length;)++o;for(n.indexOf(t[r])<0&&(n[o]=t[r]);null!==i[s]&&s<t.length;)++s;i.indexOf(e[r])<0&&(i[s]=e[r])}r.assert(!i.some((t=>null===t)),"crossOverPBX null error"),r.assert(!n.some((t=>null===t)),"crossOverPBX null error")}return[i,n]},crossOverRND:function(t,e){let i,n;if(r.rand()>s.crossOverRate||t===e)i=t.slice(),n=e.slice();else{let s=r.randInt(t.length);i=[],n=[];for(let r=0;r<s;++r)i.push(t[r]),n.push(e[r]);for(let r=s;r<t.length;++r)i.push(e[r]),n.push(t[r])}return[i,n]},crossOverPMX:function(t,e){let i=t.slice(),n=e.slice();if(r.rand()>s.crossOverRate||t===e);else{let s=r.randInt2(0,t.length-2),o=s;for(;o<=s;)o=r.randInt2(0,t.length-1);for(let a,l,h,u,c=s;c<o+1;++c)h=t[c],u=e[c],h!=u&&(a=i.indexOf(h),l=i.indexOf(u),r.swap(i,a,l),a=n.indexOf(h),l=n.indexOf(u),r.swap(n,a,l))}return[i,n]},crossOverAtSplits:function(t,e,i){let n,o;if(r.rand()>s.crossOverRate||t===e)n=t.slice(),o=e.slice();else{let s=i[r.randInt2(0,i.length-2)],a=i[r.randInt2(s,i.length-1)];n=[],o=[];for(let r=0;r<t.length;++r)r<s||r>=a?(n.push(t[r]),o.push(e[r])):(n.push(e[r]),o.push(t[r]))}return[n,o]},hillClimb:function(t,e,i,s,n,o){o.startTime=r.now();let a,l=t(n);for(;!i(l);)a=t(s(l)),e(l,a)&&(l=a);return o.endTime=r.now(),l},showBest(t,e,i){console.log(r.fill(80,"-").join("")),console.log("total time: "+r.prettyMillis(e.endTime-e.startTime)),i&&console.log("time expired"),console.log("total generations= "+e.gen),console.log("total cycles= "+e.cycles),console.log("fitness= "+t.fitness.score()),console.log(r.fill(80,"-").join(""))},config:t=>r.inject(s,t)}}"object"==typeof module&&module.exports?module.exports=r(require("../main/core")):t["io/czlab/mcfud/algo/NNetGA"]=r}(this),function(t,e){"use strict";function r(r,i){r||(r=t["io/czlab/mcfud/core"]()),i||(r=t["io/czlab/mcfud/math"]());const s=Math.floor,{u:n,is:o}=r,a={INPUT:1,BIAS:2,HIDDEN:3,OUTPUT:4,NONE:911},l={NEURON:0,LINK:1},h={SNAPSHOT:7770,ACTIVE:8881},u={numInputs:0,numOutputs:0,BIAS:1,sigmoidResponse:1,addLinkAttempts:5,findLoopedLink:5,findOldLink:5,chanceAddLink:.07,chanceAddNode:.03,chanceRecurrent:-1,mutationRate:.8,maxWeightJiggle:.5,chanceSetWeight:.1,activationMutation:.1,maxActivationJiggle:.1,compatThreshold:.26,youngFitnessBonus:1.3,youngBonusAge:10,survivalRate:0,oldAgeThreshold:50,oldAgePenalty:.7,crossOverRate:.7,noImprovements:15,maxNNetNeurons:100,numBestElites:4,fitFunc:function(t=0){return new f(t)},sigmoid:function(t,e){return 1/(1+Math.exp(-t/e))},sigmoid2:function(t){return 1/(1+Math.pow(Math.E,-4.9*t))}};function c(t){return t.neuronType==a.OUTPUT}function d(t){return t.neuronType==a.BIAS}function p(t,e=!1){return t.neuronType==a.INPUT||e&&t.neuronType==a.BIAS}class f{#t;constructor(t){this.#t=t}update(t){return this.#t=t,this}score(){return this.#t}clone(){return new f(this.#t)}}class g{#e;#r;get x(){return this.#e}get y(){return this.#r}constructor(t=0,e=0){this.#e=t,this.#r=e}clone(){return new g(this.#e,this.#r)}static dft(){return new g(0,0)}}function m(t){switch(t){case a.INPUT:return"input";case a.BIAS:return"bias";case a.HIDDEN:return"hidden";case a.OUTPUT:return"output"}n.assert(!1,`bad node type ${t}`)}class _{#i;#s;#n;#o;#a;get activation(){return this.#i}get neuronType(){return this.#n}get recur(){return this.#s}get id(){return this.#a}get posY(){return this.#o.y}get posX(){return this.#o.x}set activation(t){this.#i=t}constructor(t,e,r=null,i=!1){n.assert(t>0,`creating a neuron with a bad id ${t}`),this.#o=r?r.clone():g.dft(),this.#s=!0===i,this.#i=1,this.#a=t,this.#n=e}prn(){return`${m(this.#n)}#[${this.#a}]`}setRecur(t){return this.#s=t,this}clone(){const t=new _(this.#a,this.#n,this.#o,this.#s);return t.activation=this.#i,t}}class x{#l;#h;#s;#u;#c;get fromNeuron(){return this.#l}get toNeuron(){return this.#h}get enabled(){return this.#u}get weight(){return this.#c}get recur(){return this.#s}set weight(t){this.#c=t}constructor(t,e,r=!0,i=null,s=!1){this.#l=t,this.#h=e,this.#s=!0===s,this.#u=!1!==r,this.#c=null===i||isNaN(i)?n.randMinus1To1():i}clone(){return new x(this.#l,this.#h,this.#u,this.#c,this.#s)}setRecur(t){return this.#s=t,this}setEnabled(t){return this.#u=t,this}}class y{#d;#p;#f;#o;#g;#m;#_;get innovType(){return this.#d}get neuronID(){return this.#f}get IID(){return this.#p}get pos(){return this.#o}get neuronIn(){return this.#m}get neuronOut(){return this.#_}get neuronType(){return this.#g}constructor(t,e,r,i,s=null,n=null){this.#o=n?n.clone():g.dft(),this.#p=t.nextIID(),this.#d=i,this.#m=e,this.#_=r,o.vecN(s,2,!0)?(this.#f=s[0],this.#g=s[1]):(this.#f=-31,this.#g=a.NONE),t.add(this)}static from(t,e,r,i){return new y(t,-71,-99,l.NEURON,[e,r],i)}}class b{#x;#y;#b;#v;#T;#S;constructor(t,e){let r,[i,s]=function(t,e){return[1/(t+2),1/(e+1)]}(t,e),o=0;this.#x=0,this.#y=0,this.#v=e,this.#b=t,this.#S=[],this.#T=[];for(let e=0;e<t;++e)r={t:a.INPUT,id:++o,co:new g((e+2)*i,0)},this.#T.push(r),y.from(this,r.id,r.t,r.co);r={t:a.BIAS,id:++o,co:new g(i,0)},this.#T.push(r),y.from(this,r.id,r.t,r.co);for(let t=0;t<e;++t)r={t:a.OUTPUT,id:++o,co:new g((t+1)*s,1)},this.#T.push(r),y.from(this,r.id,r.t,r.co);n.assert(o==t+e+1,"bad history db ctor - mismatched neuron ids"),n.assert(o==this.#T.at(-1).id,"bad history db ctor - erroneous last neuron id"),this.#x=o,e=this.#T.filter((t=>t.t==a.OUTPUT)),(t=this.#T.filter((t=>t.t!=a.OUTPUT))).forEach((t=>e.forEach((e=>new y(this,t.id,e.id,l.LINK)))))}sample(t,e){let r=this.#T.filter((t=>t.t!=a.OUTPUT)),i=this.#T.filter((t=>t.t==a.OUTPUT));return this.#T.forEach((e=>t.push(new _(e.id,e.t,e.co)))),r.forEach((t=>i.forEach((r=>e.push(new x(t.id,r.id)))))),this}#w(){return++this.#x}nextIID(){return++this.#y}check(t,e,r){n.assert(t>0&&e>0,`checking innov with bad neuron ids: from: ${t}, to: ${e}`);const i=this.#S.find((i=>i.innovType==r&&i.neuronIn==t&&i.neuronOut==e));return i?i.IID:-51}add(t){this.#S.push(t)}create(t,e,r,i=a.NONE,s=null){let o;return r==l.NEURON?(n.assert(i!=a.NONE,"create-innov: unexpected bad neuron type"),n.assert(t>0&&e>0,`create-innov: bad neuron ids: from: ${t} to: ${e}`),o=new y(this,t,e,r,[this.#w(),i],s)):o=new y(this,t,e,r,null,s),o}createNeuronFromID(t){const e=this.#S.find((e=>e.neuronID==t));return e?new _(t,e.neuronType,e.pos):n.assert(!1,"unknown neuron id not found in history.")}getNeuronID(t){const e=this.#S.find((e=>e.IID==t));return e?e.neuronID:-41}getIID(t,e=l.LINK){return this.check(t.fromNeuron,t.toNeuron,e)}getInnov(t,e=l.LINK){return this.#S.find((r=>r.innovType==e&&r.neuronIn==t.fromNeuron&&r.neuronOut==t.toNeuron))}countInputs(){return this.#b}countOutputs(){return this.#v}}class v{#c;#E;#A;#s;get weight(){return this.#c}get from(){return this.#E}constructor(t,e,r,i=!1){this.#c=t,this.#E=e,this.#A=r,this.#s=!0===i}clone(){return new v(this.#c,this.#E,this.#A,this.#s)}static from(t,e,r){const i=new v(t.weight,e,r,t.recur);return e.addLinkOut(i),r.addLinkIn(i),i}}class T{#P;#i;#M;#g;#f;#R;#o;get activation(){return this.#i}get neuronType(){return this.#g}get id(){return this.#f}get output(){return this.#R}set output(t){this.#R=t}constructor(t,e,r,i){this.#o=r?r.clone():g.dft(),this.#i=i,this.#g=e,this.#f=t,this.#R=0,this.#M=[],this.#P=[]}_cpy(t,e,r){return this.#P=r.map((t=>t.clone())),this.#M=e.map((t=>t.clone())),this.#R=t,this}prn(){return`node(${m(this.#g)})#[${this.#f}]`}flush(){return this.#R=0,this}clone(){return new T(this.#f,this.#g,this.#o,this.#i)._cpy(this.#R,this.#M,this.#P)}funcOverInLinks(t){return t(this.#M)}addLinkIn(t){return this.#M.push(t),this}addLinkOut(t){return this.#P.push(t),this}static from(t){return new T(t.id,t.neuronType,t.pos,t.activation)}}class S{#C;#O;constructor(t,e){n.append(this.#C=[],t,!0),this.#O=e,t.length=0}clone(){return new S(this.#C.map((t=>t.clone())),this.#O)}compute(t,e=h.ACTIVE){return this.update(t,e)}update(t,e=h.ACTIVE){let r,i,s=[],o=e==h.SNAPSHOT?this.#O:1;function a(t){return t.reduce(((t,e)=>t+e.weight*e.from.output),0)}for(;o--;){s.length=0,i=0,r=0;for(let e,s=0;s<this.#C.length&&(e=this.#C[s],p(e)?(n.assert(r<t.length,`NeuralNet: update with mismatched input size ${t.length}`),e.output=t[r++],r==t.length&&++i):d(e)&&(e.output=u.BIAS,++i),2!=i);++s);this.#C.forEach((t=>{p(t,!0)||(t.output=u.sigmoid(t.funcOverInLinks(a),t.activation),c(t)&&s.push(t.output))}))}return e==h.SNAPSHOT&&this.#C.forEach((t=>t.flush())),s}}class w{#C;#I;#B;#k;#G;#D;#F;#N;#U;#b;#v;#L;get spawnCnt(){return this.#U}get adjScore(){return this.#N}get id(){return this.#D}set spawnCnt(t){this.#U=t}constructor(t,e){this.#F=u.fitFunc(0),this.#C=[],this.#I=[],this.#D=e,this.#L=0,this.#G=t,this.#N=0,this.#U=0,this.#b=t.countInputs(),this.#v=t.countOutputs(),e>0&&t.sample(this.#C,this.#I),this.#z()}#z(){this.#X(),this.#B=[],this.#k=[],this.#H(),this.#C.forEach((t=>p(t,!0)?this.#k.push(t):this.#B.push(t)))}#j(){return this.#C.reduce(((t,e,r)=>t+(0==r?"":", ")+e.prn()),"")}#X(){}dbgState(){return`{nodes=${this.#j()},links=${this.#I.length}}`}adjustScore(t){return this.#N=t,this}numNeurons(){return this.#C.length}numGenes(){return this.#I.length}setScore(t){return this.#F.update(t),this}getScore(){return this.#F.score()}geneAt(t){return this.#I[t]}neuronAt(t){return this.#C[t]}mutateGID(t){return n.assert(t>0,"bad genome id, must be positive"),this.#D=t,this}_specialClone(t,e,r){return this.#B=[],this.#k=[],e.forEach((t=>p(t,!0)?this.#k.push(t):this.#B.push(t))),n.append(this.#C,e,!0),n.append(this.#I,r,!0),this.#D=t,e.length=0,r.length=0,this}createPhenotype(t){const e=this.#C.map((t=>T.from(t)));return this.#I.forEach((t=>t.enabled?v.from(t,e.find((e=>e.id==t.fromNeuron)),e.find((e=>e.id==t.toNeuron))):0)),new S(e,t)}history(){return this.#G}#V(){return n.randItem(this.#C)}#W(){return n.randItem(this.#B)}addLink(t,r,i,s){if(n.assert(i>=0,"bad param: triesToFindLoop"),n.assert(s>=0,"bad param: triesToAddLink"),n.rand()>t)return;let o,a,h,u=!1;if(n.rand()<r){for(;i--;)if(h=this.#W(),!h.recur){h.setRecur(u=!0),o=a=h;break}}else for(;s--&&(a=this.#W(),o=this.#V(),o.id==a.id||this.#$(o.id,a.id));)o=a=e;o&&a&&(o.posY>a.posY&&(u=!0),this.#G.check(o.id,a.id,l.LINK)<0&&this.#G.create(o.id,a.id,l.LINK),this.#I.push(new x(o.id,a.id,!0,n.randMinus1To1(),u)),this.#H())}addNeuron(t,e){if(n.assert(e>=0,"bad param: triesToFindOldLink"),n.rand()>t)return;let r,i,o,h=-1,u=this.numGenes(),c=u-1-s(Math.sqrt(u)),p=t=>!t.enabled||t.recur||d(this.#Y(t.fromNeuron))?-1:t.fromNeuron;if(u<this.#b+this.#v+5)for(;h<0&&e--;)i=this.#I[n.randInt2(0,c)],h=p(i);else for(;h<0;)i=n.randItem(this.#I),h=p(i);if(h<0)return;n.assert(i,"addNeuron: unexpected null link gene!"),i.setEnabled(!1),r=i.toNeuron,n.assert(h>0&&r>0,`addNeuron: bad neuron ids: fromID: ${h}, toID: ${r}`);let f=i.weight,m=this.#Y(r),y=(v=this.#Y(h),T=m,n.assert(v&&T,`splitBetween: unexpected null params: from: ${v}, to: ${T}`),new g((v.posX+T.posX)/2,(v.posY+T.posY)/2)),b=this.#G.check(h,r,l.NEURON);var v,T;b>0&&this.#q(this.#G.getNeuronID(b))&&(b=-1),b<0?(o=this.#G.create(h,r,l.NEURON,a.HIDDEN,y).neuronID,n.assert(o>0,`addNeuron: (+) unexpected -ve neuron id ${o}`),this.#G.create(h,o,l.LINK),this.#G.create(o,r,l.LINK)):(o=this.#G.getNeuronID(b),n.assert(o>0,`addNeuron: (x) unexpected -ve neuron id ${o}`)),n.assert(this.#G.check(h,o,l.LINK)>0&&this.#G.check(o,r,l.LINK)>0,"addNeuron: expected innovations"),this.#C.push(new _(o,a.HIDDEN,y)),this.#B.push(this.#C.at(-1)),this.#I.push(new x(h,o,!0,1),new x(o,r,!0,f)),this.#H()}#Y(t){return this.#C.find((e=>e.id==t))||n.assert(!1,"Error in Genome::findNeuron")}#$(t,e){return this.#I.some((r=>r.fromNeuron==t&&r.toNeuron==e))}#q(t){return t>0&&this.#C.some((e=>e.id==t))}mutateWeights(t,e,r){this.#I.forEach((i=>{n.rand()<t&&(i.weight=n.rand()<e?n.randMinus1To1():i.weight+n.randMinus1To1()*r)}))}mutateActivation(t,e){this.#C.forEach((r=>{n.rand()<t&&(r.activation+=n.randMinus1To1()*e)}))}calcCompat(t){let e,r,i,s,n=0,o=0,a=0,l=0,h=0,u=0,c=this.numGenes(),d=t.numGenes();for(;n<c||o<d;)n>=c?(++o,++l):o>=d?(++n,++l):(s=t.geneAt(o),i=this.geneAt(n),r=this.#G.getIID(s),e=this.#G.getIID(i),e==r?(++n,++o,++h,u+=Math.abs(i.weight-s.weight)):(++a,e<r?++n:e>r&&++o));let p=Math.max(this.numGenes(),t.numGenes()),f=1*l/p+1*a/p;return h>0?f+.4*u/h:f}#H(){return this.#I.sort(n.comparator(n.SORT_ASC,(t=>this.#G.getIID(t)),(t=>this.#G.getIID(t)))),this}_cpy(t,e,r,i,s,n,o){return this.#F=u.fitFunc(t.score()),this.#C=n.map((t=>t.clone())),this.#I=o.map((t=>t.clone())),this.#U=i,this.#N=r,this.#L=s,this.#D=e,this.#z(),this}clone(){return new w(this.#G,-1)._cpy(this.#F,this.#D,this.#N,this.#U,this.#L,this.#C,this.#I)}morph(t){return this.#D=t,this.numNeurons()<u.maxNNetNeurons&&this.addNeuron(u.chanceAddNode,u.findOldLink),this.addLink(u.chanceAddLink,u.chanceRecurrent,u.findLoopedLink,u.addLinkAttempts),this.mutateWeights(u.mutationRate,u.chanceSetWeight,u.maxWeightJiggle),this.mutateActivation(u.activationMutation,u.maxActivationJiggle),this}}class E{#K;#Q;#Z;#J;#tt;#et;#rt;get bestScore(){return this.#rt}get id(){return this.#K}get leader(){return this.#et}get stale(){return this.#Q}get age(){return this.#Z}constructor(t,e){this.#rt=e.getScore(),this.#et=e.clone(),this.#tt=[e],this.#K=t,this.#J=0,this.#Z=0,this.#Q=0}adjustScores(){return this.#tt.forEach(((t,e,r)=>{e=t.getScore(),this.#Z<u.youngBonusAge&&(e*=u.youngFitnessBonus),this.#Z>u.oldAgeThreshold&&(e*=u.oldAgePenalty),t.adjustScore(e/r.length)})),this}addMember(t){return t.getScore()>this.#rt&&(this.#rt=t.getScore(),this.#et=t.clone(),this.#Q=0),t.species=this.#K,this.#tt.push(t),this}purge(){return this.#tt.length=0,this.#J=0,++this.#Q,++this.#Z,this}calcSpawnAmount(){return this.#J=this.#tt.reduce(((t,e)=>t+e.spawnCnt),0)}spawn(){let t,e,r=this.#tt.length;return 1==r?e=this.#tt[0]:(t=s(u.survivalRate*r)-1,t<0&&(t=1),t>=r&&(t=r-1),e=this.#tt[n.randInt2(0,t)]),e.clone()}randPair(t=5){n.assert(t>=0,"bad param: tries must be positive");let r,i,o,a=this.#tt.length;if(1==a)r=this.#tt[0];else for(o=s(u.survivalRate*a)-1,o<0&&(o=1),o>=a&&(o=a-1),r=this.#tt[n.randInt2(0,o)];t--&&(i=this.#tt[n.randInt2(0,o)],r.id==i.id);)i=e;return i?[r,i]:[r,null]}numToSpawn(){return this.#J}size(){return this.#tt.length}}function A(t,e,r,i){const s=e-t;return i.push({val:t+s/2,depth:r+1}),r>6||(A(t,t+s/2,r+1,i),A(t+s/2,e,r+1,i)),i}return{NeatGA:class{#it;#st;#nt;#ot;#at;#lt;#ht;#ut;#ct;#dt;#pt;#ft;constructor(t,e,r){this.#ot=A(0,1,0,[]),this.#at=[],this.#nt=[],this.#it=0,this.#st=0,this.#lt=0,this.#pt=t,this.#ut=0,this.#ct=0,this.#dt=0,this.#ft=new b(e,r),this.#ht=n.fill(t,(()=>new w(this.#ft,this.#gt())))}curGen(){return this.#lt}#mt(t,e){let r,i,s,o,a,l=t.numGenes(),h=e.numGenes(),u=t.getScore()>=e.getScore(),c=[],d=[],p=0,f=0;for(;p!=l||f!=h;)p==l?(u||(r=e.geneAt(f)),++f):f==h?(u&&(r=t.geneAt(p)),++p):(i=t.geneAt(p),s=e.geneAt(f),o=this.#ft.getIID(i),a=this.#ft.getIID(s),o<a?(u&&(r=i),++p):a<o?(u||(r=s),++f):(r=n.randAorB(i,s),++p,++f)),n.assert(r,"crossOver: unexpected null as chosen"),0!=c.length&&this.#ft.getIID(c.at(-1))==this.#ft.getIID(r)||c.push(r.clone()),[r.fromNeuron,r.toNeuron].forEach((t=>d.indexOf(t)<0?d.push(t):0));return r=new w(this.#ft,-1)._specialClone(this.#gt(),d.sort().map((t=>this.#ft.createNeuronFromID(t))),c),r}#_t(){return++this.#it}#gt(){return++this.#st}tournamentSelection(t){let e,r,i=0;for(n.assert(t>=0,`tournamentSelection: bad arg value: ${t}`);t--;)r=n.randItem(this.#ht),r.getScore()>i&&(e=r,i=r.getScore());return e}calcNetDepth(t){let e=0;for(let r=0;r<t.numNeurons();++r)for(let i=0;i<this.#ot.length;++i)t.neuronAt(r).posY==this.#ot[i].val&&this.#ot[i].depth>e&&(e=this.#ot[i].depth);return e+2}#xt(){this.#ht.forEach(((t,e)=>{(e=this.#nt.find((e=>t.calcCompat(e.leader)<=u.compatThreshold)))?e.addMember(t):this.#nt.push(new E(this.#_t(),t))})),this.#nt.forEach((t=>t.adjustScores())),this.#ht.forEach((t=>this.#ut+=t.adjScore)),this.#ct=this.#ut/this.#ht.length,this.#ht.forEach((t=>t.spawnCnt=t.adjScore/this.#ct)),this.#nt.forEach((t=>t.calcSpawnAmount())),this.#nt.sort(n.comparator(n.SORT_DESC,(t=>t.bestScore),(t=>t.bestScore)))}#yt(t){this.#ht.forEach(((e,r)=>e.setScore(t[r]))),this.#ht.sort(n.comparator(n.SORT_DESC,(t=>t.getScore()),(t=>t.getScore()))),this.#dt=Math.max(this.#dt,this.#ht[0].getScore()),this.#at.length=0;for(let t=0;t<u.numBestElites;++t)this.#at.push(this.#ht[t]);return this}#bt(){this.#ut=0,this.#ct=0;let t=[];return this.#nt.forEach((e=>{e.stale>u.noImprovements&&e.bestScore<this.#dt||t.push(e.purge())})),n.append(this.#nt,t,!0),this}epoch(t){n.assert(t.length==this.#ht.length,"NeatGA::Epoch(scores/ genomes mismatch)!"),this.#bt()&&this.#yt(t)&&this.#xt();let e,r=[],i=0;if(this.#nt.forEach((t=>{if(i<this.#pt){let s=!1,o=n.rounded(t.numToSpawn());for(;o--;){if(s)if(1==t.size()||n.rand()>u.crossOverRate)e=t.spawn();else{let[r,i]=t.randPair(5);e=i?this.#mt(r,i):r.clone()}else s=!0,e=t.leader.clone();if(r.push(e.morph(this.#gt())),++i==this.#pt)break}}})),i<this.#pt){let t=this.#pt-i;for(;t--;)r.push(this.tournamentSelection(s(this.#pt/5)).clone())}return n.append(this.#ht,r,!0),++this.#lt,this.createPhenotypes()}createPhenotypes(){return this.#ht.map((t=>t.createPhenotype(this.calcNetDepth(t))))}numSpecies(){return this.#nt.length}bestFromPrevGen(){return this.#at.map((t=>t.createPhenotype(this.calcNetDepth(t))))}},NeuralNet:S,Genome:w,NeuronGene:_,LinkGene:x,NLink:v,NNeuron:T,Species:E,FitFunc:f,InnovHistory:b,NeuronType:a,InnovType:l,RunType:h,configParams:t=>n.inject(u,t)}}"object"==typeof module&&module.exports?module.exports=r(require("../main/core"),require("../main/math")):t["io/czlab/mcfud/algo/NEAT_Buckland"]=r}(this),function(t,e){"use strict";function r(e,r){e||(e=t["io/czlab/mcfud/core"]()),r||(r=t["io/czlab/mcfud/math"]());const i=Math.floor,{u:s,is:n}=e,o={nextInnov:42,BIAS:1,probMutateWeight:.1,probMutateLink:.8,probAddLink:.05,probAddNode:.01,probCancelLink:.75,maxPerturbation:50,crossOverRate:.25,staleLimit:15,excessCoeff:1,weightDiffCoeff:.5,compatibilityThreshold:3};class a{#vt;#Tt;#St;#c;#u;get from(){return this.#vt}get to(){return this.#Tt}get weight(){return this.#c}get innovID(){return this.#St}set weight(t){this.#c=t}get enabled(){return this.#u}turnOff(){return this.#u=!1,this}turnOn(){return this.#u=!0,this}toggle(t){return this.#u=t,this}constructor(t,e,r,i,s=!0){this.#vt=t,this.#Tt=e,this.#c=r,this.#St=i,this.#u=!1!==s}mutate(){return this.#c=s.rand()<o.probMutateWeight?s.randMinus1To1():r.clamp(-1,1,this.#c+s.randGaussian()/o.maxPerturbation),this}clone(t,e){return new a(t,e,this.#c,this.#St,this.#u)}}class l{#wt;#Et;#At;#St;constructor(t,e,r,i){this.#wt=t,this.#Et=e,this.#St=r,s.append(this.#At=[],i,!0)}size(){return this.#At.length}matches(t,e,r){return t.size()==this.size()&&e.id==this.#wt&&r.id==this.#Et&&t.match(this.#At)}}class h{#G;constructor(){this.#G=[]}getAt(t){return this.#G[t]}find(t){return this.#G.find(t)}append(t){return this.#G.push(t),this}}class u{#Pt;#Mt;#Rt;#Ct;#n;#a;get output(){return this.#Pt}set output(t){this.#Pt=t}get inputSum(){return this.#Rt}get id(){return this.#a}get type(){return this.#n}get layer(){return this.#Ct}static checkSibling(t,e){return t.layer<e.layer?-1:t.layer>e.layer?1:0}static isSibling(t,e){return t.layer==e.layer}constructor(t,e,r){this.#Mt=[],this.#Rt=0,this.#Pt=0,this.#Ct=r,this.#n=e,this.#a=t}moveTo(t){return this.#Ct=t,this}flush(){return s.trunc(this.#Mt),this.#Pt=0,this.#Rt=0,this}resetInput(t){return this.#Rt=t,this}addInput(t){return this.#Rt+=t,this}addOutLink(t){return this.#Mt.push(t),this}activate(){return 0!=this.#Ct&&(this.#Pt=this.#Ot(this.#Rt)),this.#Mt.forEach((t=>t.enabled?t.to.addInput(t.weight*this.#Pt):0)),this}#Ot(t){return 1/(1+Math.pow(Math.E,-4.9*t))}_olinks(){return this.#Mt}isLinked(t){let e=u.checkSibling(t,this);return e<0?t._olinks().find((t=>t.to.id==this.id)):e>0&&this.#Mt.find((e=>e.to.id==t.id))}clone(){return new u(this.#a,this.#n,this.#Ct)}}class c{#v;#It;#Bt;#kt;#b;constructor(t){this.#Bt=t.copyNodes(),this.#kt=[],this.#b=this.#Bt.reduce(((t,e)=>0==e.type?t+1:t),0),this.#v=this.#Bt.reduce(((t,e)=>1==e.type?t+1:t),0);for(let e=0;e<t.depth;++e)this.#Bt.forEach((t=>{2==t.type&&(this.#It=t),t.layer==e&&this.#kt.push(t)}));s.assert(this.#It,`no bias? with depth= ${t.depth}`)}compute(t){return this.update(t)}update(t){s.assert(t.length==this.#b,`update: expecting ${this.#b} inputs but got ${t.length}`),this.#Bt.forEach(((e,r)=>0==e.type?e.output=t[r]:0)),this.#It.output=o.BIAS,this.#kt.forEach((t=>t.activate()));let e=this.#Bt.reduce(((t,e)=>1==e.type?t.push(e.output)&&t:t),[]);return this.#Bt.forEach((t=>t.resetInput(0))),e}}class d{#Gt;#v;#b;#Dt;#Bt;#Ft;#Nt;#F;get depth(){return this.#Ft}constructor(t,e){this.#v=e,this.#b=t,this.#Ut()}#Ut(){this.#Dt=[],this.#Bt=[],this.#Ft=0,this.#Gt=1,this.#F=0}build(){this.#Ut();for(let t=0;t<this.#b;++t)this.#Bt.push(new u(this.#w(),0,0));this.#Ft+=1;for(let t=0;t<this.#v;++t)this.#Bt.push(new u(this.#w(),1,1));return this.#Ft+=1,this.#Bt.push(new u(this.#w(),2,0)),this}geneAt(t){return this.#Dt[t]}nodeAt(t){return this.#Bt[t]}biasNode(){return this.#Bt.find((t=>2==t.type))}copyNodes(){return this.#Bt.map((t=>t))}isEmpty(){return 0==this.#Dt.length}size(){return this.#Dt.length}getScore(){return this.#F}setScore(t){return this.#F=t,this}getNode(t){return this.#Bt.find((e=>e.id==t))}#Lt(){return this.#Bt.forEach((t=>t.flush())),this.#Dt.forEach((t=>t.from.addOutLink(t))),this}reify(){return this.#Lt(),new c(this)}addLink(t){if(!this.#zt()){let e,r=s.randItem(this.#Bt),i=s.randItem(this.#Bt),n=(t,e)=>t.layer==e.layer||t.isLinked(e);for(;n(r,i);)r=s.randItem(this.#Bt),i=s.randItem(this.#Bt);r.layer>i.layer&&(e=i,i=r,r=e),this.#Dt.push(new a(r,i,s.randMinus1To1(),this.getInnov(t,r,i))),this.#Lt()}return this}addNode(t){if(this.isEmpty())return this.addLink(t);let e,r=this.biasNode(),i=s.randItem(this.#Dt);for(;i.from.id==r.id&&this.size()>1;)i=s.randItem(this.#Dt);if(i.turnOff(),this.#Bt.push(e=new u(this.#w(),3,2)),this.#Dt.push(new a(i.from,e,1,this.getInnov(t,i.from,e))),this.#Dt.push(new a(e,i.to,i.weight,this.getInnov(t,e,i.to))),e.moveTo(i.from.layer+1),this.#Dt.push(new a(r,e,0,this.getInnov(t,r,e))),u.isSibling(e,i.to)){for(let t,r=0;r<this.#Bt.length-1;++r)t=this.#Bt[r],u.checkSibling(t,e)>=0&&t.moveTo(t.layer+1);++this.#Ft}return this.#Lt()}getInnov(t,e,r){let i=o.nextInnov,s=t.find((t=>t.matches(this,e,r)));return s||(t.append(new l(e.id,r.id,i,this.#Dt.map((t=>t.innovID)))),++o.nextInnov),s?s.innovID:i}#zt(){let t=0,e=[];for(let t=0;t<this.#Ft;++t)e[t]=0;this.#Bt.forEach((t=>e[t.layer]+=1));for(let r,i=0;i<this.#Ft-1;++i){r=0;for(let t=i+1;t<this.#Ft;++t)r+=e[t];t+=e[i]*r}return t<=this.size()}mutate(t){return this.isEmpty()&&this.addLink(t),s.rand<o.probMutateLink&&this.#Dt.forEach((t=>t.mutate())),s.rand()<o.probAddLink&&this.addLink(t),s.rand()<o.probAddNode&&this.addNode(t),this}_introspect(){let t=0,e=0;return this.#Bt.forEach((r=>{r.layer>t&&(t=r.layer),r.id>e&&(e=r.id)})),this.#Gt=e+1,this.#Ft=t+1,this}cloneNode(t){return this.#Bt.push(t.clone()),this}cloneGene(t,e){return this.#Dt.push(t.clone(this.getNode(t.from.id),this.getNode(t.to.id)).toggle(e)),this}crossOver(t){let e=[],r=[],i=new d(this.#b,this.#v);return this.#Dt.forEach((i=>{let n=!0,a=t.findGene(i.innovID);a?(i.enabled&&a.enabled||s.rand()<o.probCancelLink&&(n=!1),r.push(s.randAorB(i,a))):(n=i.enabled,r.push(i)),e.push(n)})),this.#Bt.forEach((t=>i.cloneNode(t))),r.forEach(((t,r)=>i.cloneGene(t,e[r]))),i._introspect().#Lt()}findGene(t){return this.#Dt.find((e=>e.innovID==t))}clone(){let t=new d(this.#b,this.#v);return this.#Bt.forEach((e=>t.cloneNode(e))),this.#Dt.forEach((e=>t.cloneGene(e,e.enabled))),t._introspect().#Lt()}match(t){return this.#Dt.every((e=>t.includes(e.innovID)))}countMatching(t){let e=0;return this.#Dt.forEach((r=>t.findGene(r.innovID)?++e:0)),e}#w(){return this.#Gt++}}class p{#rt;#Xt;#Ht;#jt;#Q;get avgScore(){return this.#Xt}get alpha(){return this.#jt}get bestScore(){return this.#rt}constructor(t){this.#rt=t.getScore(),this.#jt=t.clone(),this.#Ht=[],this.#Xt=0,this.#Q=0,this.#Ht.push(t)}compatible(t){let e=this.#Vt(t,this.#jt),r=this.#Wt(t,this.#jt),i=t.size()-20;return i<1&&(i=1),o.compatibilityThreshold>o.excessCoeff*e/i+o.weightDiffCoeff*r}add(t){this.#Ht.push(t)}#Vt(t,e){return t.size()+e.size()-2*t.countMatching(e)}#Wt(t,e){let r=0,i=0;for(let s=0;s<t.size();++s)for(let n=0;n<e.size();++n)if(t.geneAt(s).innovID==e.geneAt(n).innovID){++i,r+=Math.abs(t.geneAt(s).weight-e.geneAt(n).weight);break}return 0==i?t.isEmpty()||e.isEmpty()?0:100:r/i}sort(){return this.#Ht.sort(s.comparator(s.SORT_DESC,(t=>t.getScore()),(t=>t.getScore()))),0==this.#Ht.length?this.#Q=200:this.#Ht[0].getScore()>this.#rt?(this.#rt=this.#Ht[0].getScore(),this.#jt=this.#Ht[0].clone(),this.#Q=0):++this.stale,this}isEmpty(){return 0==this.#Ht.length}size(){return this.#Ht.length}setAverage(){return this.#Xt=this.#Ht.reduce(((t,e)=>t+e.getScore()),0)/this.size(),this}spawn(t){let e;if(s.rand()<o.crossOverRate)e=this.#V().clone();else{let t=this.#V(),r=this.#V();e=t.getScore()<r.getScore()?r.crossOver(t):t.crossOver(r)}return e.mutate(t)}#V(){let t=this.#Ht.reduce(((t,e)=>t+e.getScore()),0)*s.rand(),e=0;return this.#Ht.find((r=>{if(e+=r.getScore(),e>t)return!0}))||this.#Ht[0]}cull(){if(this.#Ht.length>2)for(let t=this.#Ht.length/2;t<this.#Ht.length;++t)this.#Ht.splice(t,1),--t;return this}flush(){return s.trunc(this.#Ht),this}normalize(){return this.#Ht.forEach((t=>t.setScore(t.getScore()/this.size()))),this.#Xt=this.#Ht.reduce(((t,e)=>t+e.getScore()),0)/this.size(),this}}return{NeatGA:class{#$t;#Yt;#G;#qt;#L;#Kt;#Qt;get popSize(){return this.#Kt}constructor(t,e,r){this.#$t=r,this.#Yt=e,this.#Kt=t,this.#G=new h,this.#Qt=1,this.#qt=[],this.#L=[];for(let i=0;i<t;++i)this.#qt=s.fill(t,(()=>new d(e,r).build().mutate(this.#G)))}curGen(){return this.#Qt}createPhenotypes(){return this.#qt.map((t=>t.reify()))}epoch(t){1==this.#Qt||this.#qt[0],this.#xt(),this.#Zt(t),this.#Jt(),this.#te(),this.#ee(),this.#re();let e=[],r=this.#ie();for(this.#L.forEach((t=>{e.push(t.alpha.clone());let s=i(t.avgScore/r*this.popSize)-1;for(let r=0;r<s;++r)e.push(t.spawn(this.#G))})),e.length<this.popSize&&e.push(this.#L[0].alpha.clone());e.length<this.popSize;)e.push(this.#L[0].spawn(this.#G));return s.append(this.#qt,e,!0),this.#Qt+=1,this.createPhenotypes()}#xt(){this.#L.forEach((t=>t.flush())),this.#qt.forEach(((t,e)=>{(e=this.#L.find((e=>e.compatible(t))))?e.add(t):this.#L.push(new p(t))}))}#Zt(t){return this.#qt.forEach(((e,r)=>e.setScore(t[r]))),this}#Jt(){this.#L.forEach((t=>t.sort())),this.#L.sort(s.comparator(s.SORT_DESC,(t=>t.bestScore),(t=>t.bestScore)))}#ee(){for(let t=2;t<this.#L.length;++t)this.#L[t].stale>=o.staleLimit&&(this.#L.splice(t,1),--t)}#re(){let t=this.popSize,e=this.#ie();for(let r=1;r<this.#L.length;++r)this.#L[r].avgScore/e*t<1&&(this.#L.splice(r,1),--r)}#ie(){return this.#L.reduce(((t,e)=>t+e.avgScore),0)}#te(){return this.#L.forEach((t=>t.cull().normalize())),this}},Genome:d,Link:a,Node:u,Species:p,Innovation:l,InnovHistory:h,configParams:t=>s.inject(o,t)}}"object"==typeof module&&module.exports?module.exports=r(require("../main/core"),require("../main/math")):t["io/czlab/mcfud/algo/NEAT_CBullet"]=r}(this),function(t,e){"use strict";function r(e,r){e||(e=t["io/czlab/mcfud/core"]()),r||(r=t["io/czlab/mcfud/math"]());const{is:i,u:s}=e;function n(t,e,r){return e>t.length-1?t:`${t.substr(0,e)}${r}${t.substr(e+1)}`}function o(t,e){return+t.charAt(e)}class a{static DV={n:1,s:2,e:4,w:8};static DX={e:1,w:-1,n:0,s:0};static DY={e:0,w:0,n:-1,s:1};static OPPOSITE={e:"w",w:"e",n:"s",s:"n"};constructor(t,e){this.COLS=t,this.ROWS=e,this._getEntryNodes()}_getEntryNodes(){let t={},e=2*this.ROWS+1-2,r=2*this.COLS+1-2;t.start={x:1,y:1,gate:{x:0,y:1}},t.end={x:r,y:e,gate:{x:r+1,y:e}},this.entryNodes=t}getIO(){let t=this.entryNodes.end.gate,e=this.entryNodes.start.gate;return{start:[e.x,e.y],end:[t.x,t.y]}}generate(){this.grid=this._walk(0,0,s.fill(this.ROWS,(()=>s.fill(this.COLS,0))))}canSouth(t){return!!(t&a.DV.s)}canEast(t){return!!(t&a.DV.e)}toAscii(){let t=this.grid,e=t.length,r=[],i=t[0].length;for(let s,n=0;n<e;++n){s="|";for(let e=0;e<i;++e)s+=this.canSouth(t[n][e])?" ":"_",this.canEast(t[n][e])?s+=this.canSouth(t[n][e]|t[n][e+1])?" ":"_":s+="|";r.push(s)}return r.unshift("_".repeat(r[0].length)),r.join("\n")}_walk(t,e,r){let i,n;return s.shuffle(["n","s","e","w"]).forEach((s=>{i=t+a.DX[s],n=e+a.DY[s],n>=0&&n<r.length&&i>=0&&i<r[n].length&&0==r[n][i]&&(r[e][t]|=a.DV[s],r[n][i]|=a.DV[a.OPPOSITE[s]],this._walk(i,n,r))})),r}toGrid(){let t,e,r=this.grid,i=r.length,n=[],o=r[0].length;for(let s,a=0;a<i;++a){t=[],e=[],s=0,t[s]=1,e[s]=1;for(let i=0;i<o;++i)++s,this.canSouth(r[a][i])?(t[s]=0,e[s]=0):(t[s]=0,e[s]=1),++s,this.canEast(r[a][i])?(t[s]=0,e[s]=1):(t[s]=1,e[s]=1);n.push(t,e)}return n.unshift(s.fill(n[0].length,1)),n}}return{Maze1:class{constructor(t,e,r="D",i={}){let{bias:s,removeWalls:n,maxWallsRemove:o}=i;this.bias=s||"",this.removeWalls=n||0,this.maxWallsRemove=o||300,this.ROWS=t,this.COLS=e,this.matrix=[],this.entryNodes=this.getEntryNodes(r)}generate(){this.getMatrix(this.parseMaze(s.fill(this.COLS*this.ROWS,(()=>"01111")))),this.removeMazeWalls()}toAscii(){return""}getIO(){let t=this.entryNodes.end.gate,e=this.entryNodes.start.gate;return{start:[e.x,e.y],end:[t.x,t.y]}}toGrid(){let t,e=[];return this.matrix.forEach(((r,i)=>{t=[];for(let e=0;e<r.length;++e)t[e]="1"==r.charAt(e)?1:0;e.push(t)})),e}parseMaze(t){const e={n:1,s:2,w:3,e:4},i={n:2,s:1,w:4,e:3};let a,l,h,u=0,c=[],d=0,p=3,f=t.length-1,g=s.randInt(t.length);for(this.bias&&("H"==this.bias?p=this.COLS/100>=1?r.ndiv(this.COLS,100)+2:3:"V"==this.bias&&(p=this.ROWS/100>=1?r.ndiv(this.ROWS,100)+2:3)),t[g]=n(t[g],0,1);u<f;)if(++d,a=this.getNeighbours(g),h=Object.keys(a).filter((e=>-1!=a[e]&&!o(t[a[e]],0))),this.bias&&d!=p?h=this.biasDirections(h):d=0,h.length)++u,h.length>1&&c.push(g),l=h[s.randInt(h.length)],t[g]=n(t[g],e[l],0),g=a[l],t[g]=n(t[g],i[l],0),t[g]=n(t[g],0,1);else{if(0==c.length)break;g=c.pop()}return t}getMatrix(t){let e="",r="",i=this.COLS*this.ROWS;s.assert(t.length==i,"invalid nodes");for(let s=0;s<i;++s){if(e+=0==e.length?"1":"",r+=0==r.length?"1":"",o(t[s],1))e+="11",r+=o(t[s],4)?"01":"00";else{let i=t.hasOwnProperty(s-this.COLS)&&o(t[s-this.COLS],4),n=t.hasOwnProperty(s+1)&&o(t[s+1],1);o(t[s],4)?(e+="01",r+="01"):n||i?(e+="01",r+="00"):(e+="00",r+="00")}(s+1)%this.COLS==0&&(this.matrix.push(e,r),e="",r="")}this.matrix.push("1".repeat(2*this.COLS+1))}getEntryNodes(t){let e={},r=2*this.ROWS+1-2,i=2*this.COLS+1-2;if("D"==t&&(e.start={x:1,y:1,gate:{x:0,y:1}},e.end={x:i,y:r,gate:{x:i+1,y:r}}),"H"==t||"V"==t){let s="H"==t?r:i;s=(s-1)/2;let n=s%2==0;s=n?s+1:s;let o="H"==t?1:s,a="H"==t?s:1,l="H"==t?i:n?o:o+2,h="H"==t?n?a:a+2:r,u="H"==t?{x:0,y:a}:{x:o,y:0},c="H"==t?{x:i+1,y:h}:{x:l,y:r+1};e.start={x:o,y:a,gate:u},e.end={x:l,y:h,gate:c}}return e}biasDirections(t){let e=-1!=t.indexOf("w")||-1!=t.indexOf("e"),r=-1!=t.indexOf("n")||-1!=t.indexOf("s");return"H"==this.bias&&e?t.filter((t=>"w"==t||"e"==t)):"V"==this.bias&&r?t.filter((t=>"n"==t||"s"==t)):t}getNeighbours(t){return{w:t>0&&t%this.COLS!=0?t-1:-1,e:(t+1)%this.COLS!=0?t+1:-1,n:t-this.COLS>=0?t-this.COLS:-1,s:this.COLS*this.ROWS>t+this.COLS?t+this.COLS:-1}}removeWall(t,e){const r=t%2==0,i=e%2==0;if(!o(this.matrix[t],e))return!1;if(!r&&i){const r=t-2>0&&1==o(this.matrix[t-2],e),i=t+2<this.matrix.length&&1==o(this.matrix[t+2],e);if(r&&i)return this.matrix[t]=n(this.matrix[t],e,"0"),!0;if(!r&&i){const r=1==o(this.matrix[t-1],e-1),i=1==o(this.matrix[t-1],e+1);if(r||i)return this.matrix[t]=n(this.matrix[t],e,"0"),!0}else if(!i&&r){const r=1==o(this.matrix[t+1],e-1),i=1==o(this.matrix[t+1],e+1);if(r||i)return this.matrix[t]=n(this.matrix[t],e,"0"),!0}}else if(r&&!i){const r=1==o(this.matrix[t],e-2),i=1==o(this.matrix[t],e+2);if(r&&i)return this.matrix[t]=n(this.matrix[t],e,"0"),!0;if(!r&&i){const r=1==o(this.matrix[t-1],e-1),i=1==o(this.matrix[t+1],e-1);if(r||i)return this.matrix[t]=n(this.matrix[t],e,"0"),!0}else if(!i&&r){const r=1==o(this.matrix[t-1],e+1),i=1==o(this.matrix[t+1],e+1);if(r||i)return this.matrix[t]=n(this.matrix[t],e,"0"),!0}}}removeMazeWalls(){if(0==this.removeWalls||0==this.matrix.length)return;let t,e,r=0,i=this.matrix.length-1,n=this.maxWallsRemove;for(;r<n&&(++r,!(this.wallsRemoved>=this.removeWalls));){let r=s.randInt2(1,i);r=r==i?r-1:r,e=[],t=this.matrix[r];for(let r=0;r<t.length;r++)0!=r&&r!=t.length-1&&o(t,r)&&e.push(r);s.shuffle(e);for(let t=0;t<e.length;t++)if(this.removeWall(r,e[t])){++this.wallsRemoved;break}}}},Maze2:a}}"object"==typeof module&&module.exports?module.exports=r(require("../main/core"),require("../main/math")):t["io/czlab/mcfud/algo/maze"]=r}(this),function(t,e){"object"==typeof exports?module.exports=exports=e():"function"==typeof define&&define.amd?define([],e):t.CryptoJS=e()}(this,(function(){var t,e,r,i,s,n,o,a,l,h,u,c,d,p,f,g,m,_,x,y,b,v,T,S,w,E,A,P,M,R,C,O,I,B,k,G,D,F,N,U=U||function(t){var e;if("undefined"!=typeof window&&window.crypto&&(e=window.crypto),"undefined"!=typeof self&&self.crypto&&(e=self.crypto),!(e=!(e=!(e="undefined"!=typeof globalThis&&globalThis.crypto?globalThis.crypto:e)&&"undefined"!=typeof window&&window.msCrypto?window.msCrypto:e)&&"undefined"!=typeof global&&global.crypto?global.crypto:e)&&"function"==typeof require)try{e=require("crypto")}catch(s){}var r=Object.create||function(t){return i.prototype=t,t=new i,i.prototype=null,t};function i(){}var s={},n=s.lib={},o=n.Base={extend:function(t){var e=r(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),(e.init.prototype=e).$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},a=n.WordArray=o.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||h).stringify(this)},concat:function(t){var e=this.words,r=t.words,i=this.sigBytes,s=t.sigBytes;if(this.clamp(),i%4)for(var n=0;n<s;n++){var o=r[n>>>2]>>>24-n%4*8&255;e[i+n>>>2]|=o<<24-(i+n)%4*8}else for(var a=0;a<s;a+=4)e[i+a>>>2]=r[a>>>2];return this.sigBytes+=s,this},clamp:function(){var e=this.words,r=this.sigBytes;e[r>>>2]&=4294967295<<32-r%4*8,e.length=t.ceil(r/4)},clone:function(){var t=o.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var r=[],i=0;i<t;i+=4)r.push(function(){if(e){if("function"==typeof e.getRandomValues)try{return e.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof e.randomBytes)try{return e.randomBytes(4).readInt32LE()}catch(t){}}throw new Error("Native crypto module could not be used to get secure random number.")}());return new a.init(r,t)}}),l=s.enc={},h=l.Hex={stringify:function(t){for(var e=t.words,r=t.sigBytes,i=[],s=0;s<r;s++){var n=e[s>>>2]>>>24-s%4*8&255;i.push((n>>>4).toString(16)),i.push((15&n).toString(16))}return i.join("")},parse:function(t){for(var e=t.length,r=[],i=0;i<e;i+=2)r[i>>>3]|=parseInt(t.substr(i,2),16)<<24-i%8*4;return new a.init(r,e/2)}},u=l.Latin1={stringify:function(t){for(var e=t.words,r=t.sigBytes,i=[],s=0;s<r;s++){var n=e[s>>>2]>>>24-s%4*8&255;i.push(String.fromCharCode(n))}return i.join("")},parse:function(t){for(var e=t.length,r=[],i=0;i<e;i++)r[i>>>2]|=(255&t.charCodeAt(i))<<24-i%4*8;return new a.init(r,e)}},c=l.Utf8={stringify:function(t){try{return decodeURIComponent(escape(u.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return u.parse(unescape(encodeURIComponent(t)))}},d=n.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=c.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var r,i=this._data,s=i.words,n=i.sigBytes,o=this.blockSize,l=n/(4*o),h=(l=e?t.ceil(l):t.max((0|l)-this._minBufferSize,0))*o;if(n=t.min(4*h,n),h){for(var u=0;u<h;u+=o)this._doProcessBlock(s,u);r=s.splice(0,h),i.sigBytes-=n}return new a.init(r,n)},clone:function(){var t=o.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),p=(n.Hasher=d.extend({cfg:o.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,r){return new t.init(r).finalize(e)}},_createHmacHelper:function(t){return function(e,r){return new p.HMAC.init(t,r).finalize(e)}}}),s.algo={});return s}(Math);function L(t,e,r){return t&e|~t&r}function z(t,e,r){return t&r|e&~r}function X(t,e){return t<<e|t>>>32-e}function H(t,e,r,i){var s,n=this._iv;n?(s=n.slice(0),this._iv=void 0):s=this._prevBlock,i.encryptBlock(s,0);for(var o=0;o<r;o++)t[e+o]^=s[o]}function j(t){var e,r,i;return 255&~(t>>24)?t+=1<<24:(r=t>>8&255,i=255&t,255==(e=t>>16&255)?(e=0,255===r?(r=0,255===i?i=0:++i):++r):++e,t=0,t+=e<<16,t+=r<<8,t+=i),t}function V(){for(var t=this._X,e=this._C,r=0;r<8;r++)O[r]=e[r];for(e[0]=e[0]+1295307597+this._b|0,e[1]=e[1]+3545052371+(e[0]>>>0<O[0]>>>0?1:0)|0,e[2]=e[2]+886263092+(e[1]>>>0<O[1]>>>0?1:0)|0,e[3]=e[3]+1295307597+(e[2]>>>0<O[2]>>>0?1:0)|0,e[4]=e[4]+3545052371+(e[3]>>>0<O[3]>>>0?1:0)|0,e[5]=e[5]+886263092+(e[4]>>>0<O[4]>>>0?1:0)|0,e[6]=e[6]+1295307597+(e[5]>>>0<O[5]>>>0?1:0)|0,e[7]=e[7]+3545052371+(e[6]>>>0<O[6]>>>0?1:0)|0,this._b=e[7]>>>0<O[7]>>>0?1:0,r=0;r<8;r++){var i=t[r]+e[r],s=65535&i,n=i>>>16;I[r]=((s*s>>>17)+s*n>>>15)+n*n^((4294901760&i)*i|0)+((65535&i)*i|0)}t[0]=I[0]+(I[7]<<16|I[7]>>>16)+(I[6]<<16|I[6]>>>16)|0,t[1]=I[1]+(I[0]<<8|I[0]>>>24)+I[7]|0,t[2]=I[2]+(I[1]<<16|I[1]>>>16)+(I[0]<<16|I[0]>>>16)|0,t[3]=I[3]+(I[2]<<8|I[2]>>>24)+I[1]|0,t[4]=I[4]+(I[3]<<16|I[3]>>>16)+(I[2]<<16|I[2]>>>16)|0,t[5]=I[5]+(I[4]<<8|I[4]>>>24)+I[3]|0,t[6]=I[6]+(I[5]<<16|I[5]>>>16)+(I[4]<<16|I[4]>>>16)|0,t[7]=I[7]+(I[6]<<8|I[6]>>>24)+I[5]|0}function W(){for(var t=this._X,e=this._C,r=0;r<8;r++)F[r]=e[r];for(e[0]=e[0]+1295307597+this._b|0,e[1]=e[1]+3545052371+(e[0]>>>0<F[0]>>>0?1:0)|0,e[2]=e[2]+886263092+(e[1]>>>0<F[1]>>>0?1:0)|0,e[3]=e[3]+1295307597+(e[2]>>>0<F[2]>>>0?1:0)|0,e[4]=e[4]+3545052371+(e[3]>>>0<F[3]>>>0?1:0)|0,e[5]=e[5]+886263092+(e[4]>>>0<F[4]>>>0?1:0)|0,e[6]=e[6]+1295307597+(e[5]>>>0<F[5]>>>0?1:0)|0,e[7]=e[7]+3545052371+(e[6]>>>0<F[6]>>>0?1:0)|0,this._b=e[7]>>>0<F[7]>>>0?1:0,r=0;r<8;r++){var i=t[r]+e[r],s=65535&i,n=i>>>16;N[r]=((s*s>>>17)+s*n>>>15)+n*n^((4294901760&i)*i|0)+((65535&i)*i|0)}t[0]=N[0]+(N[7]<<16|N[7]>>>16)+(N[6]<<16|N[6]>>>16)|0,t[1]=N[1]+(N[0]<<8|N[0]>>>24)+N[7]|0,t[2]=N[2]+(N[1]<<16|N[1]>>>16)+(N[0]<<16|N[0]>>>16)|0,t[3]=N[3]+(N[2]<<8|N[2]>>>24)+N[1]|0,t[4]=N[4]+(N[3]<<16|N[3]>>>16)+(N[2]<<16|N[2]>>>16)|0,t[5]=N[5]+(N[4]<<8|N[4]>>>24)+N[3]|0,t[6]=N[6]+(N[5]<<16|N[5]>>>16)+(N[4]<<16|N[4]>>>16)|0,t[7]=N[7]+(N[6]<<8|N[6]>>>24)+N[5]|0}return k=(B=U).lib,t=k.Base,e=k.WordArray,(B=B.x64={}).Word=t.extend({init:function(t,e){this.high=t,this.low=e}}),B.WordArray=t.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:8*t.length},toX32:function(){for(var t=this.words,r=t.length,i=[],s=0;s<r;s++){var n=t[s];i.push(n.high),i.push(n.low)}return e.create(i,this.sigBytes)},clone:function(){for(var e=t.clone.call(this),r=e.words=this.words.slice(0),i=r.length,s=0;s<i;s++)r[s]=r[s].clone();return e}}),"function"==typeof ArrayBuffer&&(G=U.lib.WordArray,r=G.init,(G.init=function(t){if((t=(t=t instanceof ArrayBuffer?new Uint8Array(t):t)instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t)instanceof Uint8Array){for(var e=t.byteLength,i=[],s=0;s<e;s++)i[s>>>2]|=t[s]<<24-s%4*8;r.call(this,i,e)}else r.apply(this,arguments)}).prototype=G),function(){var t,e=(t=U).lib.WordArray;function r(t){return t<<8&4278255360|t>>>8&16711935}(t=t.enc).Utf16=t.Utf16BE={stringify:function(t){for(var e=t.words,r=t.sigBytes,i=[],s=0;s<r;s+=2){var n=e[s>>>2]>>>16-s%4*8&65535;i.push(String.fromCharCode(n))}return i.join("")},parse:function(t){for(var r=t.length,i=[],s=0;s<r;s++)i[s>>>1]|=t.charCodeAt(s)<<16-s%2*16;return e.create(i,2*r)}},t.Utf16LE={stringify:function(t){for(var e=t.words,i=t.sigBytes,s=[],n=0;n<i;n+=2){var o=r(e[n>>>2]>>>16-n%4*8&65535);s.push(String.fromCharCode(o))}return s.join("")},parse:function(t){for(var i=t.length,s=[],n=0;n<i;n++)s[n>>>1]|=r(t.charCodeAt(n)<<16-n%2*16);return e.create(s,2*i)}}}(),i=(A=U).lib.WordArray,A.enc.Base64={stringify:function(t){var e=t.words,r=t.sigBytes,i=this._map;t.clamp();for(var s=[],n=0;n<r;n+=3)for(var o=(e[n>>>2]>>>24-n%4*8&255)<<16|(e[n+1>>>2]>>>24-(n+1)%4*8&255)<<8|e[n+2>>>2]>>>24-(n+2)%4*8&255,a=0;a<4&&n+.75*a<r;a++)s.push(i.charAt(o>>>6*(3-a)&63));var l=i.charAt(64);if(l)for(;s.length%4;)s.push(l);return s.join("")},parse:function(t){var e=t.length,r=this._map;if(!(s=this._reverseMap))for(var s=this._reverseMap=[],n=0;n<r.length;n++)s[r.charCodeAt(n)]=n;var o=r.charAt(64);return!o||-1!==(o=t.indexOf(o))&&(e=o),function(t,e,r){for(var s=[],n=0,o=0;o<e;o++){var a,l;o%4&&(a=r[t.charCodeAt(o-1)]<<o%4*2,l=r[t.charCodeAt(o)]>>>6-o%4*2,l|=a,s[n>>>2]|=l<<24-n%4*8,n++)}return i.create(s,n)}(t,e,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},s=(k=U).lib.WordArray,k.enc.Base64url={stringify:function(t,e=!0){var r=t.words,i=t.sigBytes,s=e?this._safe_map:this._map;t.clamp();for(var n=[],o=0;o<i;o+=3)for(var a=(r[o>>>2]>>>24-o%4*8&255)<<16|(r[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|r[o+2>>>2]>>>24-(o+2)%4*8&255,l=0;l<4&&o+.75*l<i;l++)n.push(s.charAt(a>>>6*(3-l)&63));var h=s.charAt(64);if(h)for(;n.length%4;)n.push(h);return n.join("")},parse:function(t,e=!0){var r=t.length,i=e?this._safe_map:this._map;if(!(n=this._reverseMap))for(var n=this._reverseMap=[],o=0;o<i.length;o++)n[i.charCodeAt(o)]=o;return!(e=i.charAt(64))||-1!==(e=t.indexOf(e))&&(r=e),function(t,e,r){for(var i=[],n=0,o=0;o<e;o++){var a,l;o%4&&(a=r[t.charCodeAt(o-1)]<<o%4*2,l=r[t.charCodeAt(o)]>>>6-o%4*2,l|=a,i[n>>>2]|=l<<24-n%4*8,n++)}return s.create(i,n)}(t,r,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"},function(t){var e=U,r=(s=e.lib).WordArray,i=s.Hasher,s=e.algo,n=[];function o(t,e,r,i,s,n,o){return((o=t+(e&r|~e&i)+s+o)<<n|o>>>32-n)+e}function a(t,e,r,i,s,n,o){return((o=t+(e&i|r&~i)+s+o)<<n|o>>>32-n)+e}function l(t,e,r,i,s,n,o){return((o=t+(e^r^i)+s+o)<<n|o>>>32-n)+e}function h(t,e,r,i,s,n,o){return((o=t+(r^(e|~i))+s+o)<<n|o>>>32-n)+e}!function(){for(var e=0;e<64;e++)n[e]=4294967296*t.abs(t.sin(e+1))|0}(),s=s.MD5=i.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,e){for(var r=0;r<16;r++){var i=e+r,s=t[i];t[i]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}var u=this._hash.words,c=t[e+0],d=t[e+1],p=t[e+2],f=t[e+3],g=t[e+4],m=t[e+5],_=t[e+6],x=t[e+7],y=t[e+8],b=t[e+9],v=t[e+10],T=t[e+11],S=t[e+12],w=t[e+13],E=t[e+14],A=t[e+15],P=o(P=u[0],C=u[1],R=u[2],M=u[3],c,7,n[0]),M=o(M,P,C,R,d,12,n[1]),R=o(R,M,P,C,p,17,n[2]),C=o(C,R,M,P,f,22,n[3]);P=o(P,C,R,M,g,7,n[4]),M=o(M,P,C,R,m,12,n[5]),R=o(R,M,P,C,_,17,n[6]),C=o(C,R,M,P,x,22,n[7]),P=o(P,C,R,M,y,7,n[8]),M=o(M,P,C,R,b,12,n[9]),R=o(R,M,P,C,v,17,n[10]),C=o(C,R,M,P,T,22,n[11]),P=o(P,C,R,M,S,7,n[12]),M=o(M,P,C,R,w,12,n[13]),R=o(R,M,P,C,E,17,n[14]),P=a(P,C=o(C,R,M,P,A,22,n[15]),R,M,d,5,n[16]),M=a(M,P,C,R,_,9,n[17]),R=a(R,M,P,C,T,14,n[18]),C=a(C,R,M,P,c,20,n[19]),P=a(P,C,R,M,m,5,n[20]),M=a(M,P,C,R,v,9,n[21]),R=a(R,M,P,C,A,14,n[22]),C=a(C,R,M,P,g,20,n[23]),P=a(P,C,R,M,b,5,n[24]),M=a(M,P,C,R,E,9,n[25]),R=a(R,M,P,C,f,14,n[26]),C=a(C,R,M,P,y,20,n[27]),P=a(P,C,R,M,w,5,n[28]),M=a(M,P,C,R,p,9,n[29]),R=a(R,M,P,C,x,14,n[30]),P=l(P,C=a(C,R,M,P,S,20,n[31]),R,M,m,4,n[32]),M=l(M,P,C,R,y,11,n[33]),R=l(R,M,P,C,T,16,n[34]),C=l(C,R,M,P,E,23,n[35]),P=l(P,C,R,M,d,4,n[36]),M=l(M,P,C,R,g,11,n[37]),R=l(R,M,P,C,x,16,n[38]),C=l(C,R,M,P,v,23,n[39]),P=l(P,C,R,M,w,4,n[40]),M=l(M,P,C,R,c,11,n[41]),R=l(R,M,P,C,f,16,n[42]),C=l(C,R,M,P,_,23,n[43]),P=l(P,C,R,M,b,4,n[44]),M=l(M,P,C,R,S,11,n[45]),R=l(R,M,P,C,A,16,n[46]),P=h(P,C=l(C,R,M,P,p,23,n[47]),R,M,c,6,n[48]),M=h(M,P,C,R,x,10,n[49]),R=h(R,M,P,C,E,15,n[50]),C=h(C,R,M,P,m,21,n[51]),P=h(P,C,R,M,S,6,n[52]),M=h(M,P,C,R,f,10,n[53]),R=h(R,M,P,C,v,15,n[54]),C=h(C,R,M,P,d,21,n[55]),P=h(P,C,R,M,y,6,n[56]),M=h(M,P,C,R,A,10,n[57]),R=h(R,M,P,C,_,15,n[58]),C=h(C,R,M,P,w,21,n[59]),P=h(P,C,R,M,g,6,n[60]),M=h(M,P,C,R,T,10,n[61]),R=h(R,M,P,C,p,15,n[62]),C=h(C,R,M,P,b,21,n[63]),u[0]=u[0]+P|0,u[1]=u[1]+C|0,u[2]=u[2]+R|0,u[3]=u[3]+M|0},_doFinalize:function(){var e=this._data,r=e.words,i=8*this._nDataBytes,s=8*e.sigBytes;r[s>>>5]|=128<<24-s%32;var n=t.floor(i/4294967296);r[15+(64+s>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),r[14+(64+s>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),e.sigBytes=4*(r.length+1),this._process();for(var o=(r=this._hash).words,a=0;a<4;a++){var l=o[a];o[a]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return r},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}}),e.MD5=i._createHelper(s),e.HmacMD5=i._createHmacHelper(s)}(Math),G=(B=U).lib,n=G.WordArray,o=G.Hasher,G=B.algo,a=[],G=G.SHA1=o.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var r=this._hash.words,i=r[0],s=r[1],n=r[2],o=r[3],l=r[4],h=0;h<80;h++){h<16?a[h]=0|t[e+h]:(u=a[h-3]^a[h-8]^a[h-14]^a[h-16],a[h]=u<<1|u>>>31);var u=(i<<5|i>>>27)+l+a[h];u+=h<20?1518500249+(s&n|~s&o):h<40?1859775393+(s^n^o):h<60?(s&n|s&o|n&o)-1894007588:(s^n^o)-899497514,l=o,o=n,n=s<<30|s>>>2,s=i,i=u}r[0]=r[0]+i|0,r[1]=r[1]+s|0,r[2]=r[2]+n|0,r[3]=r[3]+o|0,r[4]=r[4]+l|0},_doFinalize:function(){var t=this._data,e=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return e[i>>>5]|=128<<24-i%32,e[14+(64+i>>>9<<4)]=Math.floor(r/4294967296),e[15+(64+i>>>9<<4)]=r,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}}),B.SHA1=o._createHelper(G),B.HmacSHA1=o._createHmacHelper(G),function(t){var e=U,r=(s=e.lib).WordArray,i=s.Hasher,s=e.algo,n=[],o=[];!function(){function e(t){return 4294967296*(t-(0|t))|0}for(var r=2,i=0;i<64;)!function(e){for(var r=t.sqrt(e),i=2;i<=r;i++)if(!(e%i))return;return 1}(r)||(i<8&&(n[i]=e(t.pow(r,.5))),o[i]=e(t.pow(r,1/3)),i++),r++}();var a=[];s=s.SHA256=i.extend({_doReset:function(){this._hash=new r.init(n.slice(0))},_doProcessBlock:function(t,e){for(var r=this._hash.words,i=r[0],s=r[1],n=r[2],l=r[3],h=r[4],u=r[5],c=r[6],d=r[7],p=0;p<64;p++){p<16?a[p]=0|t[e+p]:(f=a[p-15],g=a[p-2],a[p]=((f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3)+a[p-7]+((g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10)+a[p-16]);var f=i&s^i&n^s&n,g=d+((h<<26|h>>>6)^(h<<21|h>>>11)^(h<<7|h>>>25))+(h&u^~h&c)+o[p]+a[p];d=c,c=u,u=h,h=l+g|0,l=n,n=s,s=i,i=g+(((i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22))+f)|0}r[0]=r[0]+i|0,r[1]=r[1]+s|0,r[2]=r[2]+n|0,r[3]=r[3]+l|0,r[4]=r[4]+h|0,r[5]=r[5]+u|0,r[6]=r[6]+c|0,r[7]=r[7]+d|0},_doFinalize:function(){var e=this._data,r=e.words,i=8*this._nDataBytes,s=8*e.sigBytes;return r[s>>>5]|=128<<24-s%32,r[14+(64+s>>>9<<4)]=t.floor(i/4294967296),r[15+(64+s>>>9<<4)]=i,e.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}}),e.SHA256=i._createHelper(s),e.HmacSHA256=i._createHmacHelper(s)}(Math),l=(A=U).lib.WordArray,k=A.algo,h=k.SHA256,k=k.SHA224=h.extend({_doReset:function(){this._hash=new l.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var t=h._doFinalize.call(this);return t.sigBytes-=4,t}}),A.SHA224=h._createHelper(k),A.HmacSHA224=h._createHmacHelper(k),function(){var t=U,e=t.lib.Hasher,r=(s=t.x64).Word,i=s.WordArray,s=t.algo;function n(){return r.create.apply(r,arguments)}var o=[n(1116352408,3609767458),n(1899447441,602891725),n(3049323471,3964484399),n(3921009573,2173295548),n(961987163,4081628472),n(1508970993,3053834265),n(2453635748,2937671579),n(2870763221,3664609560),n(3624381080,2734883394),n(310598401,1164996542),n(607225278,1323610764),n(1426881987,3590304994),n(1925078388,4068182383),n(2162078206,991336113),n(2614888103,633803317),n(3248222580,3479774868),n(3835390401,2666613458),n(4022224774,944711139),n(264347078,2341262773),n(604807628,2007800933),n(770255983,1495990901),n(1249150122,1856431235),n(1555081692,3175218132),n(1996064986,2198950837),n(2554220882,3999719339),n(2821834349,766784016),n(2952996808,2566594879),n(3210313671,3203337956),n(3336571891,1034457026),n(3584528711,2466948901),n(113926993,3758326383),n(338241895,168717936),n(666307205,1188179964),n(773529912,1546045734),n(1294757372,1522805485),n(1396182291,2643833823),n(1695183700,2343527390),n(1986661051,1014477480),n(2177026350,1206759142),n(2456956037,344077627),n(2730485921,1290863460),n(2820302411,3158454273),n(3259730800,3505952657),n(3345764771,106217008),n(3516065817,3606008344),n(3600352804,1432725776),n(4094571909,1467031594),n(275423344,851169720),n(430227734,3100823752),n(506948616,1363258195),n(659060556,3750685593),n(883997877,3785050280),n(958139571,3318307427),n(1322822218,3812723403),n(1537002063,2003034995),n(1747873779,3602036899),n(1955562222,1575990012),n(2024104815,1125592928),n(2227730452,2716904306),n(2361852424,442776044),n(2428436474,593698344),n(2756734187,3733110249),n(3204031479,2999351573),n(3329325298,3815920427),n(3391569614,3928383900),n(3515267271,566280711),n(3940187606,3454069534),n(4118630271,4000239992),n(116418474,1914138554),n(174292421,2731055270),n(289380356,3203993006),n(460393269,320620315),n(685471733,587496836),n(852142971,1086792851),n(1017036298,365543100),n(1126000580,2618297676),n(1288033470,3409855158),n(1501505948,4234509866),n(1607167915,987167468),n(1816402316,1246189591)],a=[];!function(){for(var t=0;t<80;t++)a[t]=n()}(),s=s.SHA512=e.extend({_doReset:function(){this._hash=new i.init([new r.init(1779033703,4089235720),new r.init(3144134277,2227873595),new r.init(1013904242,4271175723),new r.init(2773480762,1595750129),new r.init(1359893119,2917565137),new r.init(2600822924,725511199),new r.init(528734635,4215389547),new r.init(1541459225,327033209)])},_doProcessBlock:function(t,e){for(var r,i=(r=this._hash.words)[0],s=r[1],n=r[2],l=r[3],h=r[4],u=r[5],c=r[6],d=r[7],p=i.high,f=i.low,g=s.high,m=s.low,_=n.high,x=n.low,y=l.high,b=l.low,v=h.high,T=h.low,S=u.high,w=u.low,E=c.high,A=c.low,P=d.high,M=p,R=f,C=g,O=m,I=_,B=x,k=y,G=b,D=v,F=T,N=S,U=w,L=E,z=A,X=P,H=r=d.low,j=0;j<80;j++){var V,W,$=a[j];j<16?(W=$.high=0|t[e+2*j],V=$.low=0|t[e+2*j+1]):(tt=(Y=a[j-15]).high,et=Y.low,Q=(Z=a[j-2]).high,K=Z.low,q=(J=a[j-7]).high,Y=J.low,J=(Z=a[j-16]).high,W=(W=((tt>>>1|et<<31)^(tt>>>8|et<<24)^tt>>>7)+q+((V=(q=(et>>>1|tt<<31)^(et>>>8|tt<<24)^(et>>>7|tt<<25))+Y)>>>0<q>>>0?1:0))+((Q>>>19|K<<13)^(Q<<3|K>>>29)^Q>>>6)+((V+=et=(K>>>19|Q<<13)^(K<<3|Q>>>29)^(K>>>6|Q<<26))>>>0<et>>>0?1:0),V+=tt=Z.low,$.high=W=W+J+(V>>>0<tt>>>0?1:0),$.low=V);var Y=D&N^~D&L,q=F&U^~F&z,K=M&C^M&I^C&I,Q=(R>>>28|M<<4)^(R<<30|M>>>2)^(R<<25|M>>>7),Z=(et=o[j]).high,J=et.low,tt=H+((F>>>14|D<<18)^(F>>>18|D<<14)^(F<<23|D>>>9)),et=($=X+((D>>>14|F<<18)^(D>>>18|F<<14)^(D<<23|F>>>9))+(tt>>>0<H>>>0?1:0),Q+(R&O^R&B^O&B));X=L,H=z,L=N,z=U,N=D,U=F,D=k+($=($=($=$+Y+((tt+=q)>>>0<q>>>0?1:0))+Z+((tt+=J)>>>0<J>>>0?1:0))+W+((tt+=V)>>>0<V>>>0?1:0))+((F=G+tt|0)>>>0<G>>>0?1:0)|0,k=I,G=B,I=C,B=O,C=M,O=R,M=$+(((M>>>28|R<<4)^(M<<30|R>>>2)^(M<<25|R>>>7))+K+(et>>>0<Q>>>0?1:0))+((R=tt+et|0)>>>0<tt>>>0?1:0)|0}f=i.low=f+R,i.high=p+M+(f>>>0<R>>>0?1:0),m=s.low=m+O,s.high=g+C+(m>>>0<O>>>0?1:0),x=n.low=x+B,n.high=_+I+(x>>>0<B>>>0?1:0),b=l.low=b+G,l.high=y+k+(b>>>0<G>>>0?1:0),T=h.low=T+F,h.high=v+D+(T>>>0<F>>>0?1:0),w=u.low=w+U,u.high=S+N+(w>>>0<U>>>0?1:0),A=c.low=A+z,c.high=E+L+(A>>>0<z>>>0?1:0),r=d.low=r+H,d.high=P+X+(r>>>0<H>>>0?1:0)},_doFinalize:function(){var t=this._data,e=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return e[i>>>5]|=128<<24-i%32,e[30+(128+i>>>10<<5)]=Math.floor(r/4294967296),e[31+(128+i>>>10<<5)]=r,t.sigBytes=4*e.length,this._process(),this._hash.toX32()},clone:function(){var t=e.clone.call(this);return t._hash=this._hash.clone(),t},blockSize:32}),t.SHA512=e._createHelper(s),t.HmacSHA512=e._createHmacHelper(s)}(),G=(B=U).x64,u=G.Word,c=G.WordArray,G=B.algo,d=G.SHA512,G=G.SHA384=d.extend({_doReset:function(){this._hash=new c.init([new u.init(3418070365,3238371032),new u.init(1654270250,914150663),new u.init(2438529370,812702999),new u.init(355462360,4144912697),new u.init(1731405415,4290775857),new u.init(2394180231,1750603025),new u.init(3675008525,1694076839),new u.init(1203062813,3204075428)])},_doFinalize:function(){var t=d._doFinalize.call(this);return t.sigBytes-=16,t}}),B.SHA384=d._createHelper(G),B.HmacSHA384=d._createHmacHelper(G),function(t){var e=U,r=(n=e.lib).WordArray,i=n.Hasher,s=e.x64.Word,n=e.algo,o=[],a=[],l=[];!function(){for(var t=1,e=0,r=0;r<24;r++){o[t+5*e]=(r+1)*(r+2)/2%64;var i=(2*t+3*e)%5;t=e%5,e=i}for(t=0;t<5;t++)for(e=0;e<5;e++)a[t+5*e]=e+(2*t+3*e)%5*5;for(var n=1,h=0;h<24;h++){for(var u,c=0,d=0,p=0;p<7;p++)1&n&&((u=(1<<p)-1)<32?d^=1<<u:c^=1<<u-32),128&n?n=n<<1^113:n<<=1;l[h]=s.create(c,d)}}();var h=[];!function(){for(var t=0;t<25;t++)h[t]=s.create()}(),n=n.SHA3=i.extend({cfg:i.cfg.extend({outputLength:512}),_doReset:function(){for(var t=this._state=[],e=0;e<25;e++)t[e]=new s.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(t,e){for(var r=this._state,i=this.blockSize/2,s=0;s<i;s++){var n=t[e+2*s],u=t[e+2*s+1];n=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),(A=r[s]).high^=u=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8),A.low^=n}for(var c=0;c<24;c++){for(var d=0;d<5;d++){for(var p=0,f=0,g=0;g<5;g++)p^=(A=r[d+5*g]).high,f^=A.low;var m=h[d];m.high=p,m.low=f}for(d=0;d<5;d++){var _=h[(d+4)%5],x=(y=h[(d+1)%5]).high,y=y.low;for(p=_.high^(x<<1|y>>>31),f=_.low^(y<<1|x>>>31),g=0;g<5;g++)(A=r[d+5*g]).high^=p,A.low^=f}for(var b=1;b<25;b++){var v=(A=r[b]).high,T=A.low,S=o[b];f=S<32?(p=v<<S|T>>>32-S,T<<S|v>>>32-S):(p=T<<S-32|v>>>64-S,v<<S-32|T>>>64-S),(S=h[a[b]]).high=p,S.low=f}var w=h[0],E=r[0];for(w.high=E.high,w.low=E.low,d=0;d<5;d++)for(g=0;g<5;g++){var A=r[b=d+5*g],P=h[b],M=h[(d+1)%5+5*g],R=h[(d+2)%5+5*g];A.high=P.high^~M.high&R.high,A.low=P.low^~M.low&R.low}A=r[0],E=l[c],A.high^=E.high,A.low^=E.low}},_doFinalize:function(){var e=this._data,i=e.words,s=(this._nDataBytes,8*e.sigBytes),n=32*this.blockSize;i[s>>>5]|=1<<24-s%32,i[(t.ceil((1+s)/n)*n>>>5)-1]|=128,e.sigBytes=4*i.length,this._process();for(var o=this._state,a=(i=this.cfg.outputLength/8)/8,l=[],h=0;h<a;h++){var u=(c=o[h]).high,c=c.low;u=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8),l.push(c=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)),l.push(u)}return new r.init(l,i)},clone:function(){for(var t=i.clone.call(this),e=t._state=this._state.slice(0),r=0;r<25;r++)e[r]=e[r].clone();return t}}),e.SHA3=i._createHelper(n),e.HmacSHA3=i._createHmacHelper(n)}(Math),Math,k=(A=U).lib,p=k.WordArray,f=k.Hasher,k=A.algo,g=p.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),m=p.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),_=p.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),x=p.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),y=p.create([0,1518500249,1859775393,2400959708,2840853838]),b=p.create([1352829926,1548603684,1836072691,2053994217,0]),k=k.RIPEMD160=f.extend({_doReset:function(){this._hash=p.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var r=0;r<16;r++){var i=e+r,s=t[i];t[i]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}var n,o,a,l,h,u,c=this._hash.words,d=y.words,p=b.words,f=g.words,v=m.words,T=_.words,S=x.words,w=n=c[0],E=o=c[1],A=a=c[2],P=l=c[3],M=h=c[4];for(r=0;r<80;r+=1)u=n+t[e+f[r]]|0,u+=r<16?(o^a^l)+d[0]:r<32?L(o,a,l)+d[1]:r<48?((o|~a)^l)+d[2]:r<64?z(o,a,l)+d[3]:(o^(a|~l))+d[4],u=(u=X(u|=0,T[r]))+h|0,n=h,h=l,l=X(a,10),a=o,o=u,u=w+t[e+v[r]]|0,u+=r<16?(E^(A|~P))+p[0]:r<32?z(E,A,P)+p[1]:r<48?((E|~A)^P)+p[2]:r<64?L(E,A,P)+p[3]:(E^A^P)+p[4],u=(u=X(u|=0,S[r]))+M|0,w=M,M=P,P=X(A,10),A=E,E=u;u=c[1]+a+P|0,c[1]=c[2]+l+M|0,c[2]=c[3]+h+w|0,c[3]=c[4]+n+E|0,c[4]=c[0]+o+A|0,c[0]=u},_doFinalize:function(){var t=this._data,e=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;e[i>>>5]|=128<<24-i%32,e[14+(64+i>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t.sigBytes=4*(e.length+1),this._process();for(var s=(e=this._hash).words,n=0;n<5;n++){var o=s[n];s[n]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}return e},clone:function(){var t=f.clone.call(this);return t._hash=this._hash.clone(),t}}),A.RIPEMD160=f._createHelper(k),A.HmacRIPEMD160=f._createHmacHelper(k),G=(B=U).lib.Base,v=B.enc.Utf8,B.algo.HMAC=G.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=v.parse(e));var r=t.blockSize,i=4*r;(e=e.sigBytes>i?t.finalize(e):e).clamp(),t=this._oKey=e.clone(),e=this._iKey=e.clone();for(var s=t.words,n=e.words,o=0;o<r;o++)s[o]^=1549556828,n[o]^=909522486;t.sigBytes=e.sigBytes=i,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher;return t=e.finalize(t),e.reset(),e.finalize(this._oKey.clone().concat(t))}}),B=(k=(A=U).lib).Base,T=k.WordArray,k=(G=A.algo).SHA1,S=G.HMAC,w=G.PBKDF2=B.extend({cfg:B.extend({keySize:4,hasher:k,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var r=this.cfg,i=S.create(r.hasher,t),s=T.create(),n=T.create([1]),o=s.words,a=n.words,l=r.keySize,h=r.iterations;o.length<l;){var u=i.update(e).finalize(n);i.reset();for(var c=u.words,d=c.length,p=u,f=1;f<h;f++){p=i.finalize(p),i.reset();for(var g=p.words,m=0;m<d;m++)c[m]^=g[m]}s.concat(u),a[0]++}return s.sigBytes=4*l,s}}),A.PBKDF2=function(t,e,r){return w.create(r).compute(t,e)},k=(B=(G=U).lib).Base,E=B.WordArray,B=(A=G.algo).MD5,P=A.EvpKDF=k.extend({cfg:k.extend({keySize:4,hasher:B,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var r,i=this.cfg,s=i.hasher.create(),n=E.create(),o=n.words,a=i.keySize,l=i.iterations;o.length<a;){r&&s.update(r),r=s.update(t).finalize(e),s.reset();for(var h=1;h<l;h++)r=s.finalize(r),s.reset();n.concat(r)}return n.sigBytes=4*a,n}}),G.EvpKDF=function(t,e,r){return P.create(r).compute(t,e)},U.lib.Cipher||function(){var t=(p=U).lib,e=t.Base,r=t.WordArray,i=t.BufferedBlockAlgorithm,s=((h=p.enc).Utf8,h.Base64),n=p.algo.EvpKDF,o=t.Cipher=i.extend({cfg:e.extend(),createEncryptor:function(t,e){return this.create(this._ENC_XFORM_MODE,t,e)},createDecryptor:function(t,e){return this.create(this._DEC_XFORM_MODE,t,e)},init:function(t,e,r){this.cfg=this.cfg.extend(r),this._xformMode=t,this._key=e,this.reset()},reset:function(){i.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(t){return{encrypt:function(e,r,i){return a(r).encrypt(t,e,r,i)},decrypt:function(e,r,i){return a(r).decrypt(t,e,r,i)}}}});function a(t){return"string"==typeof t?f:d}t.StreamCipher=o.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var l=p.mode={},h=t.BlockCipherMode=e.extend({createEncryptor:function(t,e){return this.Encryptor.create(t,e)},createDecryptor:function(t,e){return this.Decryptor.create(t,e)},init:function(t,e){this._cipher=t,this._iv=e}});function u(t,e,r){var i,s=this._iv;s?(i=s,this._iv=void 0):i=this._prevBlock;for(var n=0;n<r;n++)t[e+n]^=i[n]}h=l.CBC=((l=h.extend()).Encryptor=l.extend({processBlock:function(t,e){var r=this._cipher,i=r.blockSize;u.call(this,t,e,i),r.encryptBlock(t,e),this._prevBlock=t.slice(e,e+i)}}),l.Decryptor=l.extend({processBlock:function(t,e){var r=this._cipher,i=r.blockSize,s=t.slice(e,e+i);r.decryptBlock(t,e),u.call(this,t,e,i),this._prevBlock=s}}),l),l=(p.pad={}).Pkcs7={pad:function(t,e){for(var i=(e*=4)-t.sigBytes%e,s=i<<24|i<<16|i<<8|i,n=[],o=0;o<i;o+=4)n.push(s);e=r.create(n,i),t.concat(e)},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}};var c=(t.BlockCipher=o.extend({cfg:o.cfg.extend({mode:h,padding:l}),reset:function(){var t;o.reset.call(this);var e=(r=this.cfg).iv,r=r.mode;this._xformMode==this._ENC_XFORM_MODE?t=r.createEncryptor:(t=r.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==t?this._mode.init(this,e&&e.words):(this._mode=t.call(r,this,e&&e.words),this._mode.__creator=t)},_doProcessBlock:function(t,e){this._mode.processBlock(t,e)},_doFinalize:function(){var t,e=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(e.pad(this._data,this.blockSize),t=this._process(!0)):(t=this._process(!0),e.unpad(t)),t},blockSize:4}),t.CipherParams=e.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}})),d=(l=(p.format={}).OpenSSL={stringify:function(t){var e=t.ciphertext;return(e=(t=t.salt)?r.create([1398893684,1701076831]).concat(t).concat(e):e).toString(s)},parse:function(t){var e,i=s.parse(t);return 1398893684==(t=i.words)[0]&&1701076831==t[1]&&(e=r.create(t.slice(2,4)),t.splice(0,4),i.sigBytes-=16),c.create({ciphertext:i,salt:e})}},t.SerializableCipher=e.extend({cfg:e.extend({format:l}),encrypt:function(t,e,r,i){i=this.cfg.extend(i),e=(s=t.createEncryptor(r,i)).finalize(e);var s=s.cfg;return c.create({ciphertext:e,key:r,iv:s.iv,algorithm:t,mode:s.mode,padding:s.padding,blockSize:t.blockSize,formatter:i.format})},decrypt:function(t,e,r,i){return i=this.cfg.extend(i),e=this._parse(e,i.format),t.createDecryptor(r,i).finalize(e.ciphertext)},_parse:function(t,e){return"string"==typeof t?e.parse(t,this):t}})),p=(p.kdf={}).OpenSSL={execute:function(t,e,i,s){return s=s||r.random(8),t=n.create({keySize:e+i}).compute(t,s),i=r.create(t.words.slice(e),4*i),t.sigBytes=4*e,c.create({key:t,iv:i,salt:s})}},f=t.PasswordBasedCipher=d.extend({cfg:d.cfg.extend({kdf:p}),encrypt:function(t,e,r,i){return r=(i=this.cfg.extend(i)).kdf.execute(r,t.keySize,t.ivSize),i.iv=r.iv,(i=d.encrypt.call(this,t,e,r.key,i)).mixIn(r),i},decrypt:function(t,e,r,i){return i=this.cfg.extend(i),e=this._parse(e,i.format),r=i.kdf.execute(r,t.keySize,t.ivSize,e.salt),i.iv=r.iv,d.decrypt.call(this,t,e,r.key,i)}})}(),U.mode.CFB=((k=U.lib.BlockCipherMode.extend()).Encryptor=k.extend({processBlock:function(t,e){var r=this._cipher,i=r.blockSize;H.call(this,t,e,i,r),this._prevBlock=t.slice(e,e+i)}}),k.Decryptor=k.extend({processBlock:function(t,e){var r=this._cipher,i=r.blockSize,s=t.slice(e,e+i);H.call(this,t,e,i,r),this._prevBlock=s}}),k),U.mode.CTR=(G=(B=U.lib.BlockCipherMode.extend()).Encryptor=B.extend({processBlock:function(t,e){var r=this._cipher,i=r.blockSize,s=this._iv,n=this._counter;s&&(n=this._counter=s.slice(0),this._iv=void 0);var o=n.slice(0);r.encryptBlock(o,0),n[i-1]=n[i-1]+1|0;for(var a=0;a<i;a++)t[e+a]^=o[a]}}),B.Decryptor=G,B),U.mode.CTRGladman=(G=(k=U.lib.BlockCipherMode.extend()).Encryptor=k.extend({processBlock:function(t,e){var r=this._cipher,i=r.blockSize,s=this._iv,n=this._counter;s&&(n=this._counter=s.slice(0),this._iv=void 0),0===((s=n)[0]=j(s[0]))&&(s[1]=j(s[1]));var o=n.slice(0);r.encryptBlock(o,0);for(var a=0;a<i;a++)t[e+a]^=o[a]}}),k.Decryptor=G,k),U.mode.OFB=(G=(B=U.lib.BlockCipherMode.extend()).Encryptor=B.extend({processBlock:function(t,e){var r=this._cipher,i=r.blockSize,s=this._iv,n=this._keystream;s&&(n=this._keystream=s.slice(0),this._iv=void 0),r.encryptBlock(n,0);for(var o=0;o<i;o++)t[e+o]^=n[o]}}),B.Decryptor=G,B),U.mode.ECB=((k=U.lib.BlockCipherMode.extend()).Encryptor=k.extend({processBlock:function(t,e){this._cipher.encryptBlock(t,e)}}),k.Decryptor=k.extend({processBlock:function(t,e){this._cipher.decryptBlock(t,e)}}),k),U.pad.AnsiX923={pad:function(t,e){var r=(r=t.sigBytes)+(e=(e*=4)-r%e)-1;t.clamp(),t.words[r>>>2]|=e<<24-r%4*8,t.sigBytes+=e},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},U.pad.Iso10126={pad:function(t,e){e*=4,e-=t.sigBytes%e,t.concat(U.lib.WordArray.random(e-1)).concat(U.lib.WordArray.create([e<<24],1))},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},U.pad.Iso97971={pad:function(t,e){t.concat(U.lib.WordArray.create([2147483648],1)),U.pad.ZeroPadding.pad(t,e)},unpad:function(t){U.pad.ZeroPadding.unpad(t),t.sigBytes--}},U.pad.ZeroPadding={pad:function(t,e){e*=4,t.clamp(),t.sigBytes+=e-(t.sigBytes%e||e)},unpad:function(t){var e=t.words,r=t.sigBytes-1;for(r=t.sigBytes-1;0<=r;r--)if(e[r>>>2]>>>24-r%4*8&255){t.sigBytes=r+1;break}}},U.pad.NoPadding={pad:function(){},unpad:function(){}},M=(G=U).lib.CipherParams,R=G.enc.Hex,G.format.Hex={stringify:function(t){return t.ciphertext.toString(R)},parse:function(t){return t=R.parse(t),M.create({ciphertext:t})}},function(){var t=U,e=t.lib.BlockCipher,r=t.algo,i=[],s=[],n=[],o=[],a=[],l=[],h=[],u=[],c=[],d=[];!function(){for(var t=[],e=0;e<256;e++)t[e]=e<128?e<<1:e<<1^283;var r=0,p=0;for(e=0;e<256;e++){var f=p^p<<1^p<<2^p<<3^p<<4;i[r]=f=f>>>8^255&f^99;var g=t[s[f]=r],m=t[g],_=t[m],x=257*t[f]^16843008*f;n[r]=x<<24|x>>>8,o[r]=x<<16|x>>>16,a[r]=x<<8|x>>>24,l[r]=x,h[f]=(x=16843009*_^65537*m^257*g^16843008*r)<<24|x>>>8,u[f]=x<<16|x>>>16,c[f]=x<<8|x>>>24,d[f]=x,r?(r=g^t[t[t[_^g]]],p^=t[t[p]]):r=p=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54];r=r.AES=e.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var t=this._keyPriorReset=this._key,e=t.words,r=t.sigBytes/4,s=4*(1+(this._nRounds=6+r)),n=this._keySchedule=[],o=0;o<s;o++)o<r?n[o]=e[o]:(f=n[o-1],o%r?6<r&&o%r==4&&(f=i[f>>>24]<<24|i[f>>>16&255]<<16|i[f>>>8&255]<<8|i[255&f]):(f=i[(f=f<<8|f>>>24)>>>24]<<24|i[f>>>16&255]<<16|i[f>>>8&255]<<8|i[255&f],f^=p[o/r|0]<<24),n[o]=n[o-r]^f);for(var a=this._invKeySchedule=[],l=0;l<s;l++){var f;o=s-l,f=l%4?n[o]:n[o-4],a[l]=l<4||o<=4?f:h[i[f>>>24]]^u[i[f>>>16&255]]^c[i[f>>>8&255]]^d[i[255&f]]}}},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._keySchedule,n,o,a,l,i)},decryptBlock:function(t,e){var r=t[e+1];t[e+1]=t[e+3],t[e+3]=r,this._doCryptBlock(t,e,this._invKeySchedule,h,u,c,d,s),r=t[e+1],t[e+1]=t[e+3],t[e+3]=r},_doCryptBlock:function(t,e,r,i,s,n,o,a){for(var l=this._nRounds,h=t[e]^r[0],u=t[e+1]^r[1],c=t[e+2]^r[2],d=t[e+3]^r[3],p=4,f=1;f<l;f++){var g=i[h>>>24]^s[u>>>16&255]^n[c>>>8&255]^o[255&d]^r[p++],m=i[u>>>24]^s[c>>>16&255]^n[d>>>8&255]^o[255&h]^r[p++],_=i[c>>>24]^s[d>>>16&255]^n[h>>>8&255]^o[255&u]^r[p++],x=i[d>>>24]^s[h>>>16&255]^n[u>>>8&255]^o[255&c]^r[p++];h=g,u=m,c=_,d=x}g=(a[h>>>24]<<24|a[u>>>16&255]<<16|a[c>>>8&255]<<8|a[255&d])^r[p++],m=(a[u>>>24]<<24|a[c>>>16&255]<<16|a[d>>>8&255]<<8|a[255&h])^r[p++],_=(a[c>>>24]<<24|a[d>>>16&255]<<16|a[h>>>8&255]<<8|a[255&u])^r[p++],x=(a[d>>>24]<<24|a[h>>>16&255]<<16|a[u>>>8&255]<<8|a[255&c])^r[p++],t[e]=g,t[e+1]=m,t[e+2]=_,t[e+3]=x},keySize:8}),t.AES=e._createHelper(r)}(),function(){var t=U,e=(i=t.lib).WordArray,r=i.BlockCipher,i=t.algo,s=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],n=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],o=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],a=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],l=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],h=i.DES=r.extend({_doReset:function(){for(var t=this._key.words,e=[],r=0;r<56;r++){var i=s[r]-1;e[r]=t[i>>>5]>>>31-i%32&1}for(var a=this._subKeys=[],l=0;l<16;l++){var h=a[l]=[],u=o[l];for(r=0;r<24;r++)h[r/6|0]|=e[(n[r]-1+u)%28]<<31-r%6,h[4+(r/6|0)]|=e[28+(n[r+24]-1+u)%28]<<31-r%6;for(h[0]=h[0]<<1|h[0]>>>31,r=1;r<7;r++)h[r]=h[r]>>>4*(r-1)+3;h[7]=h[7]<<5|h[7]>>>27}var c=this._invSubKeys=[];for(r=0;r<16;r++)c[r]=a[15-r]},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._subKeys)},decryptBlock:function(t,e){this._doCryptBlock(t,e,this._invSubKeys)},_doCryptBlock:function(t,e,r){this._lBlock=t[e],this._rBlock=t[e+1],u.call(this,4,252645135),u.call(this,16,65535),c.call(this,2,858993459),c.call(this,8,16711935),u.call(this,1,1431655765);for(var i=0;i<16;i++){for(var s=r[i],n=this._lBlock,o=this._rBlock,h=0,d=0;d<8;d++)h|=a[d][((o^s[d])&l[d])>>>0];this._lBlock=o,this._rBlock=n^h}var p=this._lBlock;this._lBlock=this._rBlock,this._rBlock=p,u.call(this,1,1431655765),c.call(this,8,16711935),c.call(this,2,858993459),u.call(this,16,65535),u.call(this,4,252645135),t[e]=this._lBlock,t[e+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function u(t,e){e=(this._lBlock>>>t^this._rBlock)&e,this._rBlock^=e,this._lBlock^=e<<t}function c(t,e){e=(this._rBlock>>>t^this._lBlock)&e,this._lBlock^=e,this._rBlock^=e<<t}t.DES=r._createHelper(h),i=i.TripleDES=r.extend({_doReset:function(){if(2!==(i=this._key.words).length&&4!==i.length&&i.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var t=i.slice(0,2),r=i.length<4?i.slice(0,2):i.slice(2,4),i=i.length<6?i.slice(0,2):i.slice(4,6);this._des1=h.createEncryptor(e.create(t)),this._des2=h.createEncryptor(e.create(r)),this._des3=h.createEncryptor(e.create(i))},encryptBlock:function(t,e){this._des1.encryptBlock(t,e),this._des2.decryptBlock(t,e),this._des3.encryptBlock(t,e)},decryptBlock:function(t,e){this._des3.decryptBlock(t,e),this._des2.encryptBlock(t,e),this._des1.decryptBlock(t,e)},keySize:6,ivSize:2,blockSize:2}),t.TripleDES=r._createHelper(i)}(),function(){var t=U,e=t.lib.StreamCipher,r=t.algo,i=r.RC4=e.extend({_doReset:function(){for(var t=this._key,e=t.words,r=t.sigBytes,i=this._S=[],s=0;s<256;s++)i[s]=s;s=0;for(var n=0;s<256;s++){var o=e[(o=s%r)>>>2]>>>24-o%4*8&255;n=(n+i[s]+o)%256,o=i[s],i[s]=i[n],i[n]=o}this._i=this._j=0},_doProcessBlock:function(t,e){t[e]^=s.call(this)},keySize:8,ivSize:0});function s(){for(var t=this._S,e=this._i,r=this._j,i=0,s=0;s<4;s++){r=(r+t[e=(e+1)%256])%256;var n=t[e];t[e]=t[r],t[r]=n,i|=t[(t[e]+t[r])%256]<<24-8*s}return this._i=e,this._j=r,i}t.RC4=e._createHelper(i),r=r.RC4Drop=i.extend({cfg:i.cfg.extend({drop:192}),_doReset:function(){i._doReset.call(this);for(var t=this.cfg.drop;0<t;t--)s.call(this)}}),t.RC4Drop=e._createHelper(r)}(),k=(B=U).lib.StreamCipher,G=B.algo,C=[],O=[],I=[],G=G.Rabbit=k.extend({_doReset:function(){for(var t=this._key.words,e=this.cfg.iv,r=0;r<4;r++)t[r]=16711935&(t[r]<<8|t[r]>>>24)|4278255360&(t[r]<<24|t[r]>>>8);var i=this._X=[t[0],t[3]<<16|t[2]>>>16,t[1],t[0]<<16|t[3]>>>16,t[2],t[1]<<16|t[0]>>>16,t[3],t[2]<<16|t[1]>>>16],s=this._C=[t[2]<<16|t[2]>>>16,4294901760&t[0]|65535&t[1],t[3]<<16|t[3]>>>16,4294901760&t[1]|65535&t[2],t[0]<<16|t[0]>>>16,4294901760&t[2]|65535&t[3],t[1]<<16|t[1]>>>16,4294901760&t[3]|65535&t[0]];for(r=this._b=0;r<4;r++)V.call(this);for(r=0;r<8;r++)s[r]^=i[r+4&7];if(e){var n,o=(e=16711935&((o=(n=e.words)[0])<<8|o>>>24)|4278255360&(o<<24|o>>>8))>>>16|4294901760&(n=16711935&((a=n[1])<<8|a>>>24)|4278255360&(a<<24|a>>>8)),a=n<<16|65535&e;for(s[0]^=e,s[1]^=o,s[2]^=n,s[3]^=a,s[4]^=e,s[5]^=o,s[6]^=n,s[7]^=a,r=0;r<4;r++)V.call(this)}},_doProcessBlock:function(t,e){var r=this._X;V.call(this),C[0]=r[0]^r[5]>>>16^r[3]<<16,C[1]=r[2]^r[7]>>>16^r[5]<<16,C[2]=r[4]^r[1]>>>16^r[7]<<16,C[3]=r[6]^r[3]>>>16^r[1]<<16;for(var i=0;i<4;i++)C[i]=16711935&(C[i]<<8|C[i]>>>24)|4278255360&(C[i]<<24|C[i]>>>8),t[e+i]^=C[i]},blockSize:4,ivSize:2}),B.Rabbit=k._createHelper(G),k=(B=U).lib.StreamCipher,G=B.algo,D=[],F=[],N=[],G=G.RabbitLegacy=k.extend({_doReset:function(){for(var t=this._key.words,e=this.cfg.iv,r=this._X=[t[0],t[3]<<16|t[2]>>>16,t[1],t[0]<<16|t[3]>>>16,t[2],t[1]<<16|t[0]>>>16,t[3],t[2]<<16|t[1]>>>16],i=this._C=[t[2]<<16|t[2]>>>16,4294901760&t[0]|65535&t[1],t[3]<<16|t[3]>>>16,4294901760&t[1]|65535&t[2],t[0]<<16|t[0]>>>16,4294901760&t[2]|65535&t[3],t[1]<<16|t[1]>>>16,4294901760&t[3]|65535&t[0]],s=this._b=0;s<4;s++)W.call(this);for(s=0;s<8;s++)i[s]^=r[s+4&7];if(e){var n,o=(e=16711935&((o=(n=e.words)[0])<<8|o>>>24)|4278255360&(o<<24|o>>>8))>>>16|4294901760&(n=16711935&((t=n[1])<<8|t>>>24)|4278255360&(t<<24|t>>>8));for(t=n<<16|65535&e,i[0]^=e,i[1]^=o,i[2]^=n,i[3]^=t,i[4]^=e,i[5]^=o,i[6]^=n,i[7]^=t,s=0;s<4;s++)W.call(this)}},_doProcessBlock:function(t,e){var r=this._X;W.call(this),D[0]=r[0]^r[5]>>>16^r[3]<<16,D[1]=r[2]^r[7]>>>16^r[5]<<16,D[2]=r[4]^r[1]>>>16^r[7]<<16,D[3]=r[6]^r[3]>>>16^r[1]<<16;for(var i=0;i<4;i++)D[i]=16711935&(D[i]<<8|D[i]>>>24)|4278255360&(D[i]<<24|D[i]>>>8),t[e+i]^=D[i]},blockSize:4,ivSize:2}),B.RabbitLegacy=k._createHelper(G),U})),function(t,e){"use strict";function r(t,r){function i(t){return a.num(t)?o.at(t):o}function s(t){return o.push(t)>0}const n=Date.parse("01 Jan 2001 00:00:00 GMT"),o=[],{is:a,u:l}=t;function h(){let t=i(-1);return 0!=t.index&&t.index%10==0?function(t){let e=i(-10),{difficulty:r}=e.POW,s=t.ts-e.ts;return s<5e4?r+1:s>2e5?r-1:r}(t):t.POW.difficulty}function u(t,e,r,i,s){for(let n,o=0;;++o)if(n=g(t,e,r,i,s,o),p(n,s))return m(r,t,i,n,e,{nonce:o,difficulty:s})}function c(t){_.isValidNewBlock(t,i(-1))&&s(t)}function d(t){return t||(t=i()),t.reduce(((t,e)=>t+Math.pow(2,e.POW.difficulty)),0)}function p(t,e){return l.hexToBin(t).startsWith("0".repeat(e))}function f(t){let e=i(0);return e.ts==t.ts&&e.index==t.index&&e.hash==t.hash&&e.prev==t.prev&&e.POW.nonce==t.POW.nonce&&e.POW.difficulty==t.POW.difficulty&&e.data.toString()==t.data.toString()}function g(t,e,i,s,n,o){return r.SHA256(""+t+e+i+s.toString()+n+o).toString()}function m(t,e,r,i,s,n){return{ts:t,index:e,data:r,hash:i,prev:s,POW:l.inject({},n)}}const _={DIFFICULTY_ADJUSTMENT_BLOCKS:10,BLOCK_GEN_INTERVAL_SECS:10,blockChainDB:e,calcTotalDifficulty:d,CHAIN:i,CHAIN_ADD:s,nextIndex:()=>i(-1).index+1,serialize:()=>JSON.stringify(o),getDataOf(t){let r=i(t);return r?r.data:e},headChain:()=>o[0],tailChain:()=>l.last(o),ensureRoot:t=>f(t),genNextBlockAsync(t,r){let i=h(),s=l.last(o),n=function*(t,r,i,s,n){for(let o,a,l=0;!o;++l)a=g(t,r,i,s,n,l),o=p(a,n)?m(i,t,s,a,r,{nonce:l,difficulty:n}):e,yield o}(s.index+1,s.hash,l.now(),t,i);setTimeout((function t(){let e=n.next().value;e?(c(e),_.bcastChanges(),r&&r(e)):setTimeout(t,0)}),0)},genNextBlock(t){let e=h(),r=l.last(o),i=u(r.index+1,r.hash,l.now(),t,e);return c(i),this.bcastChanges(),i},isValidBlockShape:t=>a.num(t.index)&&a.str(t.hash)&&a.str(t.prev)&&a.num(t.ts)&&l.echt(t.data),addBlockToChain(t){if(this.isValidNewBlock(t,l.last(o)))return s(t)},isValidNewBlock(t,e){let r;return this.isValidBlockShape(t)?e.index+1!=t.index?r="invalid index":e.hash!=t.prev?r="invalid previous hash":function(t,e){return e.ts-6e4<t.ts&&t.ts-6e4<l.now()}(t,e)||(r="invalid timestamp"):r="invalid structure",r&&console.log(r),!r&&function(t){let{difficulty:e}=t.POW;return function(t){return function(t){let{nonce:e,difficulty:r}=t.POW;return g(t.index,t.prev,t.ts,t.data,r,e)}(t)==t.hash}(t)?(p(t.hash,e)||console.log(`block difficulty error, expected: ${e} got: ${t.hash}`),!0):(console.log(`invalid hash, got: ${t.hash}`),!1)}(t)},isValidChain(t){for(let e=0;e<t.length;++e)if(0==e){if(!f(t[e]))return!1}else if(!this.isValidNewBlock(t[e],t[e-1]))return!1;return!0},replaceChain(t){this.isValidChain(t)&&d(t)>=d()?(console.log("Replacing blockchain with updated blockchain"),this.resetChain(t)):console.log("Received invalid blockchain")},resetChain(t){l.append(o,t,!0),this.bcastChanges()},bcastChanges(){this.evtMsg.pub(["bc.latest"],i(-1))},genRawNextBlock(t){let e=this.tailChain(),r=getDifficulty(),i=u(e.index+1,e.hash,l.now(),t,r);if(this.addBlockToChain(i))return this.bcastChanges(),i},init(t,e){t&&t.lift(this);let r=this.genRoot();return this.evtMgr=e,o[0]=m(n,0,r,g(0,"",n,r,0,0),"",function(t=0,e=0){return{nonce:t,difficulty:e}}()),this},genRoot:()=>"Beware: Money is the root of all evil!"};return _}"object"==typeof module&&module.exports?module.exports=r(require("../main/core"),require("crypto-js")):t["io/czlab/mcfud/crypto/blockchain"]=r}(this),function(t,e){"use strict";function r(t,r,i){const s=new i.ec("secp256k1"),{u:n,is:o}=t;function a(t,e,r,i){return{txOutId:t,txOutIndex:e,address:r,amount:i}}function l(t,e,r=""){return{txOutId:t,txOutIndex:e,signature:r,toString(){return""+this.txOutId+this.txOutIndex+this.signature}}}function h(t,e){return{address:t,amount:e,toString(){return""+this.address+this.amount}}}function u(t,e,r){return{id:t,txIns:e,txOuts:r,toString(){return""+this.id+this.txIns.toString()+this.txOuts.toString()}}}function c(t,e){function r(r){let i=e.find((t=>t.txOutId==r.txOutId&&t.txOutIndex==r.txOutIndex));return i&&s.keyFromPublic(i.address,"hex").verify(t.id,r.signature)}if(m.getTransactionId(t)!=t.id)return console.error(`invalid tx id: ${t.id}`);for(let e=0;e<t.txIns.length;++e)if(!r(t.txIns[e]))return console.error(`invalid txIns in tx: ${t.id}`);return t.txOuts.reduce(((t,e)=>t+e.amount),0)==t.txIns.reduce(((t,r)=>t+function(t){let r=d(t.txOutId,t.txOutIndex,e);return n.assert(r,"failed to find unspent-rec")&&r.amount}(r)),0)}function d(t,e,r){return r.find((r=>r.txOutId==t&&r.txOutIndex==e))}function p(t){function e(t){let e;return t?o.str(t.address)?function(t){let e;return 130!=t.length?e="invalid public key length":t.match("^[a-fA-F0-9]+$")?t.startsWith("04")||(e="public key must start with 04"):e="public key must contain only hex characters",e&&console.log(e),!e}(t.address)?o.num(t.amount)||(e="invalid amount type in txOut"):e="invalid TxOut address":e="invalid address type in txOut":e="txOut is null",e&&console.log(e),!e}let r;if(o.str(t.id)?t.txIns instanceof Array?t.txIns.map((function(t){let e;return t?o.str(t.signature)?o.str(t.txOutId)?o.num(t.txOutIndex)||(e="invalid txOutIndex type in txIn"):e="invalid txOutId type in txIn":e="invalid signature type in txIn":e="txIn is null",e&&console.log(e),!e})).reduce(((t,e)=>t&&e),!0)?t.txOuts instanceof Array||(r="invalid txIns type in transaction"):r="invalid txIn structure":r="invalid txIns type in transaction":r="transactionId missing",r)return console.error(r);for(let r=0;r<t.txOuts.length;++r)if(!e(t.txOuts[r]))return!1;return!0}const f=[],g=[],m={UnspentRec:a,TxIn:l,TxOut:h,Transaction:u,lift:t=>(t.replaceChain=function(t){let e=this.isValidChain(t);n.echt(e)&&this.calcTotalDifficulty(t)>this.calcTotalDifficulty()?(m.setUnspentRecs(e),m.updateTxPool(e),this.resetChain(t)):console.warn("received blockchain invalid")},t.addBlockToChain=function(t){if(this.isValidNewBlock(t,this.tailChain())){let e=m.processTxs(t.data,t.index,g);if(e)return m.setUnspentRecs(e),m.updateTxPool(e),this.CHAIN_ADD(t)}},t.isValidChain=function(t){if(!this.ensureRoot(t[0]))return e;let r=[];for(let i,s=0;s<t.length;++s){if(i=t[s],0!=s&&!this.isValidNewBlock(t[s],t[s-1]))return e;if(r=m.processTxs(i.data,i.index,r),!r)return console.warn("invalid transactions in blockchain")}return r},t.genRoot=function(){return[m.genRoot()]},t),genRoot:()=>u("5e7a184fe16430f399d37a3e0197614ea3188624aa25b021139bb61a73fd412b",[l("",0,"")],[h("0429a91b39ad936a5e0690ffdb3136a554da25ba577182f6f187ba329e564a93cc5a3ee6f3258fe5139fd75d92851c85a3fb3f3f2b71e98ac254b8b73cc12db613",50)]),setUnspentRecs(t){n.append(g,t,!0)},getUnspentRecs:()=>JSON.parse(JSON.stringify(g)),processTxs(t,e,r){if(t.every(p)&&function(t,e,r){let i;if(function(t,e){let r;return t?m.getTransactionId(t)!=t.id?r=`invalid grant-tx id: ${t.id}`:1!=t.txIns.length?r="one txIn must be specified in the grant-tx":t.txIns[0].txOutIndex!=e?r="invalid txIn index in grant-tx":1!=t.txOuts.length?r="invalid number of txOuts in grant-tx":50!=t.txOuts[0].amount&&(r="invalid amount in grant-tx"):r="the first tx in the block must be a grant-tx",r&&console.error(r),!r}(t[0],e)){if(function(t){for(let e,r,i=new Map,s=0;s<t.length;++s){if(r=t[s],e=""+r.txOutId+r.txOutIndex,i.has(e))return!0;i.set(e,1)}}(t.map((t=>t.txIns)).flat()))i="duplicate txIns";else for(let e=1;e<t.length;++e)if(!c(t[e],r)){i="invalid tx";break}}else i="invalid tx[0]";return i&&console.error(i),!i}(t,e,r))return function(){let e=t.reduce(((t,e)=>t.concat(e.txOuts.map(((t,r)=>a(e.id,r,t.address,t.amount))))),[]),i=t.map((t=>t.txIns)).flat().map((t=>a(t.txOutId,t.txOutIndex,"",0)));return r.filter((t=>!d(t.txOutId,t.txOutIndex,i))).concat(e)}()},getPublicKey:t=>s.keyFromPrivate(t,"hex").getPublic().encode("hex"),genGrantTx(t,e){let r=u("",[l("",e,"")],[h(t,50)]);return r.id=this.getTransactionId(r),r},getTransactionId:t=>r.SHA256(""+t.txIns.reduce(((t,e)=>t+""+e.txOutId+e.txOutIndex),"")+t.txOuts.reduce(((t,e)=>t+""+e.address+e.amount),"")).toString(),signTxIn(t,e,r,i){let o=t.txIns[e],a=d(o.txOutId,o.txOutIndex,i);return n.assert(a,"could not find referenced txOut"),getPublicKey(r)!=a.address&&n.assert(!1,"trying to sign an input with private-key that does not match the address that is referenced in txIn"),l=s.keyFromPrivate(r,"hex").sign(t.id).toDER(),Array.from(l,(t=>("0"+(255&t).toString(16)).slice(-2))).join("");var l},handleReceivedTx(t){this.addToTxPool(t,g)},getTxPool:()=>JSON.parse(JSON.stringify(f)),addToTxPool(t,e){return n.assert(c(t,e),"trying to add invalid tx to pool"),n.assert(this.isValidTxForPool(t),"trying to add invalid tx to pool"),f.push(t)>0},hasTxIn:(t,e)=>e.find((e=>e.txOutId==t.txOutId&&e.txOutIndex==t.txOutIndex)),updateTxPool(t){let e=[];for(let r of f)for(let i of r.txIns)this.hasTxIn(i,t)||e.push(r);e.forEach((t=>n.disj(f,t)))},getTxPoolIns:()=>f.map((t=>t.txIns)).flat(),isValidTxForPool(t){let e=this.getTxPoolIns();return t.txIns.every((t=>!e.find((e=>t.txOutIndex==e.txOutIndex&&t.txOutId==e.txOutId))))},init(t,e){return n.append(g,this.processTxs(t.getDataOf(0),0,g),!0),this.evtMsg=e,this}};return m}"object"==typeof module&&module.exports?module.exports=r(require("../main/core"),require("crypto-js"),require("elliptic")):t["io/czlab/mcfud/crypto/transaction"]=r}(this),function(t,e){"use strict";"object"==typeof module&&module.exports&&(module.exports=function(t,e){const{Server:r}=e,{is:i,u:s}=t,n=[],o={QUERY_LATEST:0,QUERY_ALL:1,QUERY_TXPOOL:2,RESPONSE_TXPOOL:4,RESPONSE_BLOCKCHAIN:8},a={type:o.QUERY_LATEST},l={type:o.QUERY_ALL},h=t=>({type:o.BLOCKCHAIN,data:JSON.stringify([t])}),u=t=>({type:o.RESPONSE_TXPOOL,data:JSON.stringify(t)});function c(t){try{return JSON.parse(t)}catch(t){console.error(t)}}function d(t,e){t&&t.send(JSON.stringify(e))}function p(t){n.forEach((e=>d(e,t)))}const f={initServer(t){new e.Server({port:t}).on("connection",(t=>this.cfgConnection(t))),console.log(`listening websocket p2p port on: ${t}`)},getSockets:()=>n,connect(t){let r=new e(t);r.on("open",(()=>this.cfgConnection(r))),r.on("error",(()=>console.error("connection failed")))},cfgConnection(t){var e;e=t,n.push(e),function(t,e,r){t.on("message",(i=>{const s=c(i);if(s)switch(console.log(`got json-message ${JSON.stringify(s)}`),s.type){case o.QUERY_LATEST:d(t,h(e.tailChain()));break;case o.QUERY_ALL:d(t,(n=e.CHAIN(),{type:o.BLOCKCHAIN,data:JSON.stringify(n)}));break;case o.RESPONSE_BLOCKCHAIN:{let t=c(s.data);t?function(t,e){if(0==t.length)return console.log("received block chain size of 0");let r=t.at(-1);if(!e.isValidBlockShape(r))return console.log("block structuture not valid");let i=e.tailChain();r.index>i.index?(console.log(`last-index: ${i.index}, peer-last-index: ${r.index}`),i.hash==r.prev?e.addBlockToChain(r)&&p(h(e.tailChain())):1==t.length?(console.log("have to query the chain from our peer"),p(l)):(console.log("blockchain is longer than current blockchain"),e.replaceChain(t))):console.log("received blockchain is shorter. Do nothing")}(t,e):console.log("invalid blocks received")}break;case o.QUERY_TXPOOL:d(t,u(r.getTxPool()));break;case o.RESPONSE_TXPOOL:{let t=c(s.data);t||console.log("invalid transaction received"),t&&t.forEach((t=>{try{r.handleReceivedTx(t),f.bcastTxPool()}catch(t){console.error(t.message)}}))}}else console.log(`could not parse JSON message: ${i}`);var n}))}(t,this.bcObj,this.txObj),function(t){let e=t=>{console.log(`connection failed to peer: ${t.url}`),s.disj(n,t)};t.on("close",(()=>e(t))),t.on("error",(()=>e(t)))}(t),d(t,a)},onBCLatest(t){console.log("send changes to peers"),p(h(t))},onTxPool(t){console.log("send tx-pool to peers"),p(u(t))},init(t,e,r){this.evtMsg=r,this.bcObj=t,this.txObj=e,r.sub(["bc.latest"],"onBCLatest",this),r.sub(["tx.pool"],"onTxPool",this)}};return f}(require("../main/core"),require("ws")))}(),function(t,e){"use strict";function r(t,e,r){const i=new r.ec("secp256k1"),{u:s,is:n}=t;return{_KEY:void 0,createTx(t,e,r,n,o){let a=this.TX,l=i.keyFromPrivate(r,"hex").getPublic().encode("hex"),{included:h,leftOver:u}=function(t,e){let r=0,i=[];for(let s of e)if(i.push(s),r+=s.amount,r>=t)return{included:i,leftOver:r-t};s.assert(!1,`Can't create tx from the unspent transaction outputs.\n                       Required amount: ${t},\n                       available unspentTxOuts: ${JSON.stringify(e)}`)}(e,function(t){let e=[],r=o.map((t=>t.txIns)).flat(),i=n.filter((e=>e.address==t));for(let t of i)s.find(r,(e=>e.txOutId==t.txOutId&&e.txOutIndex==t.txOutIndex))||e.push(t);return e}(l)),c=a.Transaction("",h.map((t=>a.TxIn(t.txOutId,t.txOutIndex))),function(r,i){let s=a.TxOut(t,e);return 0==i?[s]:[s,a.TxOut(r,i)]}(l,u));c.id=a.getTransactionId(c);for(let t=0;t<c.txIns.length;++t)c.txIns[t].signature=a.signTxIn(c,t,r,n);return c},genPrivateKey:()=>i.genKeyPair().getPrivate().toString(16),getPublicFromWallet(){return i.keyFromPrivate(this.getPrivateFromWallet(),"hex").getPublic().encode("hex")},getPrivateFromWallet(){return this._KEY},initWallet(){return this._KEY="20db2edd8bd2e09e8cb7def7a26a20547afc0442509b275209cdd609923f7a80",this._KEY||(this._KEY=this.genPrivateKey()),this},deleteWallet(){return this},getBalance(t,e){return this.findUnspentRecs(t,e).reduce(((t,e)=>t+e.amount),0)},findUnspentRecs:(t,e)=>e.filter((e=>e.address==t)),init(e,r,i){return this.evtMgr=t.EventBus(),this.BC=e.init(r,this.evtMgr),this.TX=r.init(e,this.evtMgr),i.init(e,r,this.evtMgr),this},genNextBlock(){let t=this.TX.genGrantTx(this.getPublicFromWallet(),this.BC.nextIndex());return this.BC.genRawNextBlock([t].concat(this.TX.getTxPool()))},genBlockWith(t,e){return s.assert(this.TX.isValidAddress(t),"invalid address"),s.assert(n.num(e),"invalid amount"),this.BC.genRawNextBlock([this.TX.genGrantTx(this.getPublicFromWallet(),this.BC.nextIndex()),this.createTx(t,e,this.getPrivateFromWallet(),this.TX.getUnspentRecs(),this.TX.getTxPool())])},getAccountBalance(){return this.getBalance(this.getPublicFromWallet(),this.TX.getUnspentRecs())},sendTx(t,e){let r=this.createTx(t,e,this.getPrivateFromWallet(),this.TX.getUnspentRecs(),this.TX.getTxPool());return this.TX.addToTxPool(r,this.TX.getUnspentRecs()),this.evtMgr.pub(["tx.pool"],this.TX.getTxPool()),r},listUnspent(){return this.findUnspentRecs(this.getPublicFromWallet(),this.TX.getUnspentRecs())}}.initWallet()}"object"==typeof module&&module.exports?module.exports=r(require("../main/core"),require("crypto-js"),require("elliptic")):t["io/czlab/mcfud/crypto/wallet"]=r}(this),function(t,e){"use strict";function r(e,r){if(e||(e=t["io/czlab/mcfud/core"]()),!r)throw"Fatal: No Colors!";const{is:i,u:s}=e;function n(t,e){let r="";for(;t>0;)r+=e,--t;return r}function o(t,e){let r=u;return e&&(i.str(t)?r="any"==t||t==e?c:u:t instanceof e&&(r=c)),r}function a(t,e,r){return new Promise(((i,s)=>{let n;try{n=r.call(t),n instanceof Promise?n.then((function(t){i(`${t?c:u}: ${e}`)})):(n=n?709394==n?h:c:u,i(`${n}: ${e}`))}catch(t){n=u,i(`${n}: ${e}`)}}))}function l(t,e,r,i){return new Promise(((s,n)=>{let a;try{a=r.call(t),a=709394==a?c:o(i,null)}catch(t){a=o(i,t)}s(`${a}: ${e}`)}))}const[h,u,c]=["Skippd","Failed","Passed"];return{prn(t){const e=t.passed.length,i=t.total,o=e/i*100;console.log(r.white(n(78,"+"))),console.log(r.white.bold(t.title)),console.log(r.white(t.date)),console.log(r.white(n(78,"+"))),t.passed.length>0&&console.log(r.green(t.passed.join("\n"))),t.skippd.length>0&&console.log(r.grey(t.skippd.join("\n"))),t.failed.length>0&&console.log(r.magenta(t.failed.join("\n"))),console.log(r.white(n(78,"="))),console.log(r.yellow(["Passed: ",e,"/",i," [",0|o,"%]"].join(""))),console.log(r.magenta("Failed: "+(i-e))),console.log(r.white(["cpu-time: ",s.prettyMillis(t.duration)].join(""))),console.log(r.white(n(78,"=")))},deftest(t){let[e,r,i,s]=[null,null,null,null];const n={ensure:(t,e)=>(i.push([1,t,e]),n),eerror:(t,e)=>(i.push([911,t,e]),n),begin:t=>(s={},i=[],e=t,n),end(n){r=n;let o=function(){return new Promise(((t,n)=>{e&&e(s);let o,h=[];for(let t,e,r=0;r<i.length;++r){switch(e=i[r],e[0]){case 1:t=a(s,e[1],e[2]);break;case 911:t=l(s,e[1],e[2],"any")}o=o?o.then((function(e){return h.push(e),t})):t}o&&o.then((function(e){h.push(e),i.length=0,r&&r(s),t(h)}))}))};return(o.title=t)&&o}};return n},_run:t=>new Promise(((e,r)=>{t().then((function(t){e(t)}))})),runtest(t,e){const r=Date.now();return this._run(t).then((function(i){const s=Date.now(),n={title:e||t.title,date:(new Date).toString(),total:i.length,duration:s-r,passed:i.filter((t=>"P"==t[0])),skippd:i.filter((t=>"S"==t[0])),failed:i.filter((t=>"F"==t[0]))};return new Promise((t=>{t(n)}))}))}}}"object"==typeof module&&module.exports?module.exports=r(require("./core"),require("colors/safe")):t["io/czlab/mcfud/test"]=r}(this),function(t,e){"use strict";console.log("mufud version: 1.2.0")}(),function(t,e){"use strict";const r=["fnt"],i=["mp3","wav","ogg"],s=["jpg","png","jpeg","gif","webp"],n=["ttf","otf","ttc","woff","woff2"];function o(o,a){const{EventBus:l,dom:h,is:u,u:c}=t["io/czlab/mcfud/core"](),d=t["io/czlab/mcfud/vec2"](),p=t["io/czlab/mcfud/math"](),f=l(),g=Math.floor,m=1/15;let _=!1;class x extends PIXI.Container{constructor(){super(),this.m5={stage:!0}}onResize(t,e){this.children.forEach((r=>{r instanceof t.Scenes.SceneWrapper&&(r=r.children[0]),r.onCanvasResize(e[0],e[1])})),t.Input.resize()}}function y(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}function b(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}function v(t){let e,r=[],s=0,o=t.u.load,a=[],l=[],h=[];t.u.assetFiles.forEach((e=>{u.obj(e)?c.has(n,c.fileExt(e.url))&&l.push(e):u.str(e)&&(e=t.assetPath(e),c.has(i,c.fileExt(e))?a.push(e):h.push(e))})),l.length>0&&async function(t){const e=t.map((t=>({alias:`${t.family}`,src:`${t.url}`})));PIXI.Assets.addBundle("webfonts",e),await PIXI.Assets.loadBundle("webfonts"),e.forEach((t=>c.log(`loaded web font ${t.alias}`)))}(l),o||(o=function(t){return{init(){let e=t.Sprites.sprite("boot/ZotohLab_x1240.png"),r=t.Sprites.sprite("boot/preloader_bar.png"),i=t.Sprites.sprite("boot/preloader_bar.png"),[s,n]=t.scaleXY([e.width,e.height],[t.width,t.height]),o=t.getScaleFactor(),a=s>n?n:s;a*=.2,t.Sprites.scaleXY(i,a,a),t.Sprites.scaleXY(r,a,a),t.Sprites.scaleXY(e,a,a),t.Sprites.pinCenter(this,e),t.Sprites.pinBelow(e,r,4*o),t.Sprites.pinBelow(e,i,4*o),t.Sprites.opacity(i,.3),this.insertEx([e,i,r]),this.g.pbar=r,this.g.pbar_width=r.width},update(t){this.g.pbar.width=this.g.pbar_width*t}}}(t));{const r=new t.Scenes.Scene("loader",{setup(){o.init.call(this)}},{});e=t.stage.addChild(r).runOnce()}return PIXI.Assets.load(h,(t=>{r.unshift(t)})).then((e=>{c.delay(0,(()=>function(e){function i(t){c.log(`loaded ${t}`)}!function(t,e){let r=t.length;function i(){c.delay(0,(()=>e()))}function s(t){--r,0==r&&i()}t.forEach((t=>{(async function(t){const e=await PIXI.DOMAdapter.get().fetch(t),r=await e.arrayBuffer(),i=t.lastIndexOf("/");return{name:i>0?t.substring(i+1):t,url:t,buffer:r}})(t).then((t=>{M.Sound.decodeData(t.name,t.url,t.buffer,s)}))})),0==r&&i()}(a,(()=>{let s=0;for(const[r,n]of Object.entries(e))++s,i(r),t._cache[r]=n;a.forEach(i),c.log(`completed loading of ${s+a.length} files.`),r.unshift("$")}))}(e)))})).catch((t=>{++s,c.error(`Failed to load all assets: ${t}`)})),t.addBgTask({update(){if(0==r.length);else{let i=r.pop();u.num(i)?i&&o.update.call(e,i):"$"==i?c.delay(800,(()=>function(t,e,r,i){e&&t.delBgTask(e),c.delay(50,(()=>{t.Scenes.remove(r),i?c.error("Cannot load game!"):t._runAppStart()}))}(t,this,e,s>0))):c.error("Fatal error while loading assets")}}}),t.start()}c.patch(o,{assetFiles:[],logos:[],aniFps:12,fps:60});const T={width:0,height:0},w={width:1,height:1};function E(t){M._curFPS=M.calcFPS(t),a.forEach((e=>e.update?.(t))),!_&&M.stageCS((e=>e.update?.(t)))}const A=e=>t.requestAnimationFrame(e);class P{constructor(t){this.uid=t}playSound(){}pokeMove(){this.onPoke()}pokeWait(){this.onWait()}uuid(){return this.uid}stateValue(){c.assert(!1,"implement stateValue!")}}const M={_offsetX:0,_offsetY:0,_scaleX:1,_scaleY:1,_selectedCellX:0,_selectedCellY:0,_startPanX:0,_startPanY:0,_curFPS:60,Bot:class extends P{constructor(t="p2"){super(t)}onPoke(){}onWait(){}},Local:class extends P{constructor(t="p1"){super(t)}onPoke(){M.Input.resume()}onWait(){M.Input.pause()}},Mediator:class{constructor(){this.players=[],this._pcnt=0,this.state,this.pcur,this.end,this.pwin}cur(){return this.pcur}add(t){return t.pnum=++this._pcnt,t.owner=this,this.players.push(t),this}winner(){return this.pwin}isGameOver(){return this.end}gameState(t){return t&&(this.state=t),this.state}gameOver(t){return M.Input.resume(),this.pwin=t,this.end=!0}start(t){c.assert(t,"bad player to start with"),this.end=!1,this.pcur=t,this._turn()}other(){return this.pcur===this.players[0]?this.players[1]:this.pcur===this.players[1]?this.players[0]:void 0}_turn(){this.players.forEach((t=>{t!==this.pcur&&t.pokeWait()})),this.pcur.pokeMove()}redoTurn(){this.pcur.pokeMove()}postMove(t,e){c.assert(!1,"implement postMove!")}updateState(t,e){c.assert(!1,"implement updateState!")}updateSound(t){}updateMove(t,e){this.end||(this.updateState(t,e),this.updateSound(t),c.delay(0,(()=>this.postMove(t,e))))}takeTurn(){this.end||(this.pcur===this.players[0]?this.pcur=this.players[1]:this.pcur===this.players[1]&&(this.pcur=this.players[0]),this._turn())}},SSheetFrame:class{#t;#e;constructor(t,e){this.#t=t,this.#e=e}get frame(){return this.#e}get sheet(){return this.#t}toString(){return`${this.#t}::${this.#e}`}},UNSCII:"unscii",DOKI_LOWER:"Doki Lowercase",BIGSHOUTBOB:"Big Shout Bob",COPYRIGHT:"(c) www.zotohlab.com 2025.",_frame:1/o.fps,EVERY:1,SOME:2,CENTER:3,TOP:4,LEFT:5,RIGHT:6,BOTTOM:7,UP:8,DOWN:9,NW:10,NE:11,SW:12,SE:13,NONE:100,PI_45:Math.PI/4,PI_90:Math.PI/2,PI_180:Math.PI,PI_270:1.5*Math.PI,PI_360:2*Math.PI,v2:d,math:p,ute:c,is:u,dom:h,u:o,Game:{mode:1},_cache:{},MODE_ONE:1,MODE_TWO:2,MODE_NET:3,CON:console,noop:()=>{},warn(...t){console.warn(...t)},get mouse(){return M.Input.pointer()},playSfx(t){return this.sound(t).play()},accel:(t,e,r)=>t+e*r,on:(...t)=>f.sub(...t),emit:(...t)=>f.pub(...t),off:(...t)=>f.unsub(...t),ssf(t,e){return new this.SSheetFrame(t,e)},frameRate(){return this._frame},sideRight:t=>t==M.RIGHT||t==M.NE||t==M.SE,sideLeft:t=>t==M.LEFT||t==M.NW||t==M.SW,sideTop:t=>t==M.UP||t==M.TOP||t==M.NW||t==M.NE,sideBottom:t=>t==M.DOWN||t==M.BOTTOM||t==M.SW||t==M.SE,overlap:(t,e)=>!(t.x2<e.x1||e.x2<t.x1||t.y2<e.y1||e.y2<t.y1),overlapX:(t,e)=>t.x2>e.x1&&e.x2>t.x1,overlapY:(t,e)=>t.y2>e.y1&&e.y2>t.y1,hasClass(t,e){if(e)return t.classList.contains(e)},toggleClass:(t,e)=>(e&&t.classList.toggle(e),t),addClass:(t,e)=>(c.hasClass(t,e)||t.classList.add(e),t),removeClass:(t,e)=>(c.hasClass(t,e)&&t.classList.remove(e),t),wrapv:(t,e,r)=>t<e?r:t>r?e:t,get canvas(){return this._canvasObj},get assets(){return PIXI.Assets.cache._cache},get designSize(){return this.u.arena},get width(){return this.canvas.width},get height(){return this.canvas.height},stageCS(t){this.inModal?t(c.last(this.stage.children)):this.stage.children.forEach((e=>{e instanceof M.Scenes.SceneWrapper&&(e=e.children[0]),e&&t(e)}))},moveToTop(t){let e=t.parent;return e&&(e.removeChild(t),e.addChild(t)),t},scroll(e,r){t.scrollTo(e||0,r||1)},portrait:()=>M.height>M.width,screenCenter:()=>c.v2(g(M.width/2),g(M.height/2)),scaleXY:(t,e)=>[e[0]/t[0],e[1]/t[1]],makeAnchor(t,e){return new PIXI.ObservablePoint(this,t,e??t)},mockStage(t=0,e=0,r,i){let s=u.obj(t)?t:{x:t,y:e,width:r??M.width,height:i??M.height};return s.getGlobalPosition=()=>({x:this.x,y:this.y}),s.anchor=M.makeAnchor(0,0),s.m5={stage:!0},s},tcached(t){return c.inst(PIXI.Texture,t)?t:u.str(t)?this._cache[t]||PIXI.Assets.cache._cache.get(t):e},clickPlayMsg(){return(this.touchDevice?"Tap":"Click")+" to Play!"},splitXY:(t,e)=>[t%e,g(t/e)],rect:(t,e,r,i)=>new PIXI.Rectangle(t,e,r,i),scaleSZ:(t,e)=>({width:e.width/t.width,height:e.height/t.height}),sheet(t,e){const r=this.resource(t);return c.assert(r,`unknown sheet: ${t}.`),c.assert(u.obj(r.data)&&u.obj(r.textures),`bad sheet: ${t}`),r.textures[e]},image(t){return this.resource(t)},xml(t){return this.resource(t)},json(t){return this.resource(t)},assetPath(t,e){if(u.str(t))if(t.includes("/"))e=t;else{let o="data",a=c.fileExt(t);c.has(s,a)?o="images":c.has(r,a)||c.has(n,a)?o="fonts":c.has(i,a)&&(o="audio"),e=`${o}/${t}`}return e||""},contentScaleFactor(){return T.height=M.height,T.width=M.width,"max"!==o.scaleToWindow?w:this.scaleSZ(this.designSize,T)},getScaleFactor(t){if(t||"max"==o.scaleToWindow){T.height=M.height,T.width=M.width;let t=this.scaleSZ(this.designSize,T);return"x"==o.scaleFit||"X"==o.scaleFit?t.width:"y"==o.scaleFit||"Y"==o.scaleFit?t.height:Math.min(t.width,t.height)}return 1},resource(t,r){let i,s;return c.inst(this.SSheetFrame,t)?s=this.sheet(t.sheet,t.frame):t&&(i=this.assetPath(t),s=this.tcached(t)||this.tcached(i)||PIXI.Texture.from(i)),s||(r?c.assert(!1,`no such resource ${t}.`):e)},addChild:(t,e,...r)=>(t.addChild(e),r.forEach((e=>t.addChild(e))),e),_fpsList:e,_fpsSum:0,calcFPS(t){let e,r=0;return t>0&&(e=g(1/t),this._fpsList||(this._fpsList=c.fill(60,e),this._fpsSum=60*e),this._fpsSum-=this._fpsList.pop(),this._fpsList.unshift(e),this._fpsSum+=e,r=g(this._fpsSum/60)),r},degToRad:t=>t*(Math.PI/180),radToDeg:t=>t*(180/Math.PI),addBgTask(t){a.push(t)},delBgTask(t){t&&(c.disj(a,t),t.dispose&&t.dispose())},resume(){_=!1},pause(){_=!0},start(){let t=0,e=c.now(),r=function(){let i=c.now(),s=(i-e)/1e3,n=M.frameRate();for(s>m&&(s=m),t+=s;t>=n;t-=n)E(s);M.ctx.render(M.stage),e=i,A(r)};return A(r)},_runAppStart(){return M.Input.keybd(M.Input.Q,(()=>{this.takeScreenShot()})),M.u.start(this)},takeScreenShot(){M.ctx.extract.canvas(M.stage).toBlob((t=>{const e=document.createElement("a");document.body.append(e),e.download="screenshot",e.href=URL.createObjectURL(t),e.click(),e.remove()}),"image/png")},worldToScreen(t,e){return[g((t-this._offsetX)*this._scaleX),g((e-this._offsetY)*this._scaleY)]},screenToWorld(t,e){return[t/this._scaleX+this._offsetX,e/this._scaleY+this._offsetY]}};{let e,r=PIXI.isMobile.tablet,i=PIXI.isMobile.phone;e=PIXI.isMobile.windows.device?r?"tablet":i?"phone":"windows":PIXI.isMobile.apple.device?r?"ipad":i?"iphone":"apple":PIXI.isMobile.android.device?"android":r||i?"mobile":"desktop",c.log(`we are running on a ${e} device`),function(e){let r=!1,i=o.arena;c.assert(i,"design resolution req'd."),"max"!=o.scaleToWindow&&!0!==o.scaleToWindow||(r=!0,i={width:y(),height:b()},1==o.arena.scale&&(r=!1,o.arena=i,o.scaleToWindow="win")),e.maxed=r,o.logos||(o.logos=new Array),(async()=>{e.ctx=await PIXI.autoDetectRenderer(c.inject(i,{webgpu:{antialias:!0},webgl:{antialias:!0}})),function(e,r){e.touchDevice=!!("ontouchstart"in document),e._canvasObj=e.ctx.canvas,e._canvasObj.id="mojoh5",e.scale=1,e.scaledBgColor="#5A0101",e.stage=new x,["Sprites","Input","Scenes","Sound","FX","Ute2D","Tiles","Touch"].forEach((r=>{c.log(`installing module ${r}...`),t[`io/czlab/mojoh5/${r}`](e).assets?.forEach((t=>e.u.assetFiles.unshift(t)))})),a.push(e.FX),function(t){let e=h.newElm("style");h.conj(document.body,M._canvasObj),h.conj(e,h.newTxt("body, * {padding: 0; margin: 0; height:100%; overflow:hidden}")),h.conj(document.head,e),h.css(M._canvasObj,{outline:"none"}),h.attrs(M._canvasObj,"tabindex","0"),h.css(document.body,{background:"black"})}(),c.has(r,"border")&&h.css(e.canvas,"border",r.border),c.has(r,"bgColor")&&(e.ctx.backgroundColor=e.Sprites.color(r.bgColor)),e.prevHeight=0,e.prevWidth=0,!0===r.resize&&(c.addEvent("resize",t,c.debounce((t=>{const[r,i]=[e.prevWidth,e.prevHeight];e.ctx.resize(y(),b()),e.emit(["canvas.resize"],[r,i]),e.prevWidth=y(),e.prevHeight=b()}),r.debounceRate||150)),e.on(["canvas.resize"],(t=>S.onResize(e,t)))),function(t){c.log(`browser window size= w:${y()},h=${b()}`),c.log(`canvas size= w:${t.canvas.width},h=${t.canvas.height}`),t._canvasObj.focus(),t.scroll(),t.prevHeight=b(),t.prevWidth=y(),t.u.load||(t.u.logos=["boot/preloader_bar.png","boot/ZotohLab_x1240.png"]);let e=t.u.logos.map((e=>t.assetPath(e)));PIXI.Assets.init(),(async(r,i)=>{try{r=await PIXI.Assets.load(e),i=Object.keys(r)}catch(t){c.error(t)}i&&e.length==i.length?(i.forEach((t=>c.log(`loaded logo file "${t}"`))),c.delay(50,(()=>v(t)))):c.log("logo files not loaded!")})()}(e)}(e,o)})()}(M)}}if("object"==typeof module&&module.exports)throw"Panic: browser only!";t.MojoH5=function(t){return o(t,[])},t.MojoH5Ldr=function(e){window.addEventListener("load",(()=>t.MojoH5(e)))}}(this),function(t,e){"use strict";const r={blue:"#319bd5",green:"#78c03f",yellow:"#f9ef50",red:"#eb2224",orange:"#f48917",grey:"#848685",cyan:"#1ee5e6",lime:"#e5e61e",magenta:"#e61ee5",purple:"#a6499a"},i={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",brown:"#A52A2A",crimson:"#DC143C",cyan:"#00FFFF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",grey:"#808080",lavender:"#E6E6FA",lime:"#00FF00",magenta:"#FF00FF",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",turquoise:"#40E0D0",wheat:"#F5DEB3",white:"#FFFFFF",yellow:"#FFFF00"};function s(s){const{v2:n,math:o,ute:a,is:l,dom:h}=s,u=t["io/czlab/mcfud/geo2d"](),c=2*Math.PI,d=Math.floor;function p(t,e,r,i){return new PIXI.GenerateTextureSystem(s.ctx).generateTexture(t)}var f,g,m;function _(t,r){let i,n;return a.inst(PIXI.Graphics,t)&&(t=p(t)),a.inst(PIXI.Texture,t)?n=t:l.vec(t)?(l.str(t[0])&&(t=t.map((t=>s.resource(t)))),i=a.inst(PIXI.Texture,t[0])?new PIXI.AnimatedSprite(t,!1):e):l.str(t)&&(n=s.resource(t)),n&&(i=r(n)),a.assert(i,`SpriteError: ${t} not found`)&&i}function x(t,e,r,i,s,n){let o=e,a=t,l=[];for(let e,h,u,c=0;c<r;++c){u=[];for(let t=0;t<i;++t)h=o+n,e=a+s,u.push({x1:a,x2:e,y1:o,y2:h}),a=e;o=h,a=t,l.push(u)}return l}function y(t,e,r){let i,n;return e&&e.m5&&e.m5.stage?n={x1:0,y1:0,x2:s.width,y2:s.height}:(void 0!==e.angle&&a.assert(a.feq0(e.angle),"expected non rotated object!"),i=e.parent,n=t.getAABB(e)),r&&i===r&&(n.x1+=r.x,n.x2+=r.x,n.y1+=r.y,n.y2+=r.y),[n,o.ndiv(n.x2-n.x1,2),o.ndiv(n.y2-n.y1,2),o.ndiv(n.x1+n.x2,2),o.ndiv(n.y1+n.y2,2)]}function b(t,e,r){if(e.m5.static)n.sub$(t.m5.vel,n.mul(r.overlapN,2*n.dot(t.m5.vel,r.overlapN)));else{let i=n.mul$(n.sub(e.m5.vel,t.m5.vel),r.overlapN),s=-2*(i[0]+i[1])/(t.m5.invMass+e.m5.invMass);n.sub$(t.m5.vel,n.mul$(n.div(r.overlapN,t.m5.mass),s)),n.add$(e.m5.vel,n.mul$(n.div(r.overlapN,e.m5.mass),s))}}function v(t,e,r){let i,s=t.toBody(e),n=t.toBody(r);return i=e.m5.circle?r.m5.circle?u.hitCircleCircle(s,n):u.hitCirclePolygon(s,n):r.m5.circle?u.hitPolygonCircle(s,n):u.hitPolygonPolygon(s,n),i&&(i.A=e,i.B=r),i}f=new PIXI.Container,(g=new PIXI.Graphics).circle(0,0,4),g.fill({color:0}),m=new PIXI.Sprite(p(g)),["m5","tiled","remove","collideXY","setup","preTMX","postTMX","dispose","preDispose","onTick","getGuid","getBBox","getSpatial"].forEach((t=>{[[f,"Container"],[g,"Graphics"],[m,"Sprite"]].forEach((e=>{a.assertNot(a.has(e[0],t),`Uh Oh, PIXI ${e[1]} has our ${t} property!`)}))}));const T={SomeColors:{},BtnColors:{},Geo:u,assets:["boot/splash.jpg","boot/star.png","boot/audioOff.png","boot/audioOn.png","boot/unscii.fnt","boot/doki.fnt","boot/BIG_SHOUT_BOB.fnt"],assertCenter:t=>a.assert(t?.anchor&&a.feq(t.anchor.x,.5)&&a.feq(t.anchor.y,.5),"not center'ed"),empty:t=>t&&0==t.children.length,btnPress(t,e,r,i,n,o=343){const l=this;return function(t){t.tint=l.color(e),i&&s.sound(i).play(),a.delay(o,(()=>{t.tint=l.color(r),n(t)}))}},oneOffClick(t,e){const r=function(){s.Input.off(["single.tap"],r),e&&s.sound(e).play(),t()};return s.Input.on(["single.tap"],r),r},cancelOneOffClick:t=>(t&&s.Input.off(["single.tap"],t),e),sizeXY:(t,e,r)=>(l.num(r)&&(t.height=r),l.num(e)&&(t.width=e),t),asCircle:t=>(t.m5.circle=!0)&&t,scaleXY:(t,e,r)=>(l.num(e)&&(t.scale.x=e),l.num(r)&&(t.scale.y=r),t),scaleBy:(t,e,r)=>(l.num(e)&&(t.scale.x*=e),l.num(r)&&(t.scale.y*=r),t),isVX:t=>!a.feq0(t.m5.vel[0]),isVY:t=>!a.feq0(t.m5.vel[1]),halfSize:t=>({width:d(t.width/2),height:d(t.height/2)}),anchorXY:(t,e,r)=>(a.assert(t.anchor,"sprite has no anchor object"),t.anchor.y=r??e,t.anchor.x=e,t),centerAnchor(t){return this.anchorXY(t,.5,.5)},topLeftAnchor(t){return this.anchorXY(t,0,0)},offsetXY:(t,e,r)=>(a.assert(t.anchor&&e>=0&&e<=1&&r>=0&&r<=1,"no anchor or bad target offset points"),[t.width*(e-t.anchor.x),t.height*(r-t.anchor.y)]),topLeftOffsetXY(t){return this.offsetXY(t,0,0)},centerOffsetXY(t){return this.offsetXY(t,.5,.5)},adjOffsetXY:(t,e,r)=>(a.assert(t.anchor&&e>=0&&e<=1&&r>=0&&r<=1,"no anchor or bad target offset points"),[t.width*(t.anchor.x-e),t.height*(t.anchor.y-r)]),makeSteerable(t){t.width!=t.height&&s.warn(`object ${t.m5?.uuid} is not a square, radius will be off....`);let{width:e,height:r}=this.halfSize(t);return t.m5.steer=[0,0],t.m5.steerInfo={wanderAngle:a.rand()*Math.PI*2,arrivalThreshold:400,wanderDistance:10,wanderRadius:5,wanderRange:1,avoidDistance:400,inSightDistance:200,tooCloseDistance:60,maxForce:5,pathIndex:0},t.m5.radius=Math.sqrt(e*e+r*r),t},updateSteer:(t,e=!0)=>(t.m5?.steer&&(n.clamp$(t.m5.steer,0,t.m5.steerInfo.maxForce),n.div$(t.m5.steer,t.m5.mass),n.add$(t.m5.vel,t.m5.steer),e&&n.mul$(t.m5.steer,0)),t),clrSpatial:t=>(t.m5?.sgrid&&(t.m5.sgrid.x1=e,t.m5.sgrid.x2=e,t.m5.sgrid.y1=e,t.m5.sgrid.y2=e),t),lift(t){if(!t.m5){const e=this;t.g={},t.m5={uuid:`s${a.nextId()}`,circle:!1,stage:!1,drag:!1,dead:!1,angVel:0,friction:n.vec(1,1),gravity:n.vec(),vel:n.vec(),acc:n.vec(),static:!1,sensor:!1,sgrid:{},mass:1,type:0,cmask:0,speed:0,heading:s.RIGHT,get invMass(){return a.feq0(t.m5.mass)?0:1/t.m5.mass}},t.m5.resize=function(r,i,s,n){e.resize(t,r,i,s,n)},t.m5.getImageOffsets=function(){return{x1:0,x2:0,y1:0,y2:0}},t.m5.getContactPoints=function(){return function(t,e,r){let i=[n.vec(e,r),n.vec(e,0),n.vec(0,0),n.vec(0,r)];return t&&i.forEach((i=>{i[0]-=d(e*t.x),i[1]-=d(r*t.y)})),i}(t.anchor,t.width,t.height)},t.getGuid=function(){return t.m5.uuid},t.getSpatial=function(){return t.m5.sgrid},t.getBBox=function(){return a.feq0(t.angle)?e.getAABB(t):e.boundingBox(t)}}return t},clamp2Pi(t){for(;t.rotation>c;)t.rotation-=c;for(;t.rotation<0;)t.rotation+=c;return t},getHeading:t=>[Math.cos(t.rotation),Math.sin(t.rotation)],setOrient:(t,e,r=!1)=>(r?t.angle=e:t.rotation=e,t),toPolygon:t=>new u.Polygon(t.m5.getContactPoints()).setOrient(t.rotation),toCircle(t){return this.assertCenter(t)&&new u.Circle(d(t.width/2)).setOrient(t.rotation)},toBody(t){let e=t.x,r=t.y,i=t.m5.circle?this.toCircle(t):this.toPolygon(t);return u.bodyWrap(i,e,r)},gposXY(t){const{x:e,y:r}=t.getGlobalPosition();return n.vec(e,r)},isTopLeft:t=>!t.anchor||a.feq0(t.anchor.x)&&a.feq0(t.anchor.y),isCenter:t=>!!t.anchor&&a.feq(t.anchor.x,.5)&&a.feq(t.anchor.y,.5),centerXY(t){return this.isCenter(t)?n.vec(t.x,t.y):n.add(this.centerOffsetXY(t),t)},setScaleModeNearest:(t,e=!0)=>(t.texture.source.scaleMode=e?"nearest":"linear",t),angle(t,e){return n.angle(this.centerXY(t),this.centerXY(e))},die:t=>(t.m5.dead=!0)&&t,undie:t=>(t.m5.dead=!1)||t,move:(t,e)=>(e?(n.add$(t.m5.vel,n.mul(t.m5.gravity,e)),n.add$(t.m5.vel,n.mul(t.m5.acc,e)),n.mul$(t.m5.vel,t.m5.friction)):e=1,void 0!==t.m5.maxSpeed&&n.clamp$(t.m5.vel,0,t.m5.maxSpeed),n.add$(t,n.mul(t.m5.vel,e))),leftSide(t){let e=t.x,r=t.width,i=t.anchor?t.anchor.x:0;return i>.7?e-=r:i>0&&(e-=d(r/2)),e},rightSide(t){return this.leftSide(t)+t.width},topSide(t){let e=t.y,r=t.height,i=t.anchor?t.anchor.y:0;return i>.7?e-=r:i>0&&(e-=d(r/2)),e},bottomSide(t){return this.topSide(t)+t.height},getAABB(t){if(void 0!==t.x1&&void 0!==t.y2)return t;a.assert(t.m5,"bad sprite for getAABB");let{x1:e,y1:r,x2:i,y2:s}=t.m5.getImageOffsets(),n=this.leftSide(t),o=this.topSide(t);return{x1:n+e,y1:o+r,x2:n+t.width-i,y2:o+t.height-s}},bbox4:(t,e,r,i)=>a.assert(r<=i,"bad bbox")&&{x1:t,x2:e,y1:r,y2:i},bboxCenter(t){if(l.num(t.x1))return n.vec(o.ndiv(t.x1+t.x2,2),o.ndiv(t.y1+t.y2,2))},bboxFrame(t,e=16,r="#dedede"){a.assert(void 0!==t.x1,"bad bounding box");let i,{x1:s,x2:n,y1:o,y2:l}=t,h=n-s,u=l-o,c=this.graphics();return c.roundRect(0,0,h+e,u+e,d(e/4)),c.stroke({width:e,color:this.color(r)}),i=this.sprite(c),i.x=s-e,i.y=o-e,i},bboxSize:t=>void 0!==t.x1?n.vec(t.x2-t.x1,t.y2-t.y1):a.assert(!1,"bad bounding box"),pointInBBox:(t,e,r)=>void 0!==r.x1&&t>r.x1&&t<r.x2&&e>r.y1&&e<r.y2,boundingBox(t){a.feq0(t.rotation)||a.assert(this.isCenter(t),"expected rotated obj with center-anchor");let e,r,i=[],s=[],n=d(t.width/2),o=d(t.height/2),l=Math.tanh(o/n),h=Math.sqrt(n*n+o*o);return r=c-l+t.rotation,s.push(h*Math.sin(r)),i.push(h*Math.cos(r)),r=l+t.rotation,s.push(h*Math.sin(r)),i.push(h*Math.cos(r)),r=Math.PI-l+t.rotation,s.push(h*Math.sin(r)),i.push(h*Math.cos(r)),r=Math.PI+l+t.rotation,s.push(h*Math.sin(r)),i.push(h*Math.cos(r)),e=this.centerXY(t),s.sort(((t,e)=>t-e)),i.sort(((t,e)=>t-e)),{x1:d(i[0]+e[0]),x2:d(i[3]+e[0]),y1:d(s[0]+e[1]),y2:d(s[3]+e[1])}},hitTestPoint(t,e,r){const i=this.toBody(r);return r.m5.circle?u.hitTestPointCircle(t,e,i):u.hitTestPointPolygon(t,e,i)},distance(t,e){return n.dist(this.centerXY(t),this.centerXY(e))},scaleContent(...t){1==t.length&&l.vec(t[0])&&(t=t[0]);const e=s.getScaleFactor();t.forEach((t=>{t.scale.x*=e,t.scale.y*=e}))},scaleToCanvas:t=>(t.height=s.height,t.width=s.width,t),uuid:(t,e)=>(t.m5.uuid=e,t),opacity:(t,e)=>(t.alpha=e,t),tint(t,e){return t.tint=this.color(e),t},hide:t=>(t.visible=!1)||t,show:t=>(t.visible=!0)&&t,pset:(t,e,r)=>(t.g[e]=r,t),pget:(t,e)=>t.g[e],container(t){const e=this.lift(new PIXI.Container);return t&&t(e),e},group(...t){1==t.length&&l.vec(t[0])&&(t=t[0]);const e=this.container();return t.forEach((t=>e.addChild(t))),e},sprite(t,e=!1,r=0,i=0){const n=this.lift(_(t,(t=>new PIXI.Sprite(t))));return n.x=r,n.y=i,e&&this.centerAnchor(n),a.inst(PIXI.AnimatedSprite,n)?function(t){let e=0,r={};function i(){e&&(e=clearInterval(e))}function n(){r.cnt<r.total?(t.gotoAndStop(t.currentFrame+1),r.cnt+=1):t.loop?(t.gotoAndStop(r.start),r.cnt=1):(i(),t.onComplete?.())}return a.inject(t.m5,{stopFrames(){i(),t.gotoAndStop(t.currentFrame)},showFrame(e){i(),t.gotoAndStop(e)},playFrames(o){i(),r.start=0,r.end=t.totalFrames-1,l.vec(o)&&o.length>1&&(r.start=o[0],r.end=o[1]),r.total=r.end-r.start+1,t.gotoAndStop(r.start),r.cnt=1,e=setInterval(n,1e3/s.aniFps)}}),t}(n):n},spriteFrame(t,e,r=!1,i=0,n=0){return this.sprite(s.sheet(t,e),r,i,n)},tilingSprite(t,e,r){return this.lift(_(t,(t=>new PIXI.TilingSprite({texture:t,width:e||t.width,height:r||t.height}))))},repeatSprite(t,e=!0,r=!0,i,o){let a,l=this,h=[],u=0,c=0,d=0,p=0;function f(){const e=l.lift(_(t,(t=>new PIXI.Sprite(t))));let r=s.getScaleFactor();return r=1,e.width*=1,e.height*=1,e}if(e){for(;d<i;)h.push(a=f()),n.set(a,u,c),d+=a.width,u+=a.width,d>=i&&p<o&&r&&(p+=a.height,c+=a.height,u=0,d=0);r=!1}if(r){for(;p<o;)h.push(a=f()),n.set(a,u,c),p+=a.height,c+=a.height,p>=o&&d<i&&e&&(d+=a.width,u+=a.width,c=0,p=0);e=!1}return h},animation(t,e,r,i=0){let o=s.resource(t);if(!o)throw`SpriteError: ${t} not loaded.`;let a=d(o.width/e),l=[],h=a*d(o.height/r);for(let t,s,o=0;o<h;++o)t=o%a*e,s=d(o/a)*r,i>0&&(t+=i+i*o%a,s+=i+i*d(o/a)),l.push(n.vec(t,s));return this.sprite(l.map((t=>new PIXI.Texture({source:o.source,frame:new PIXI.Rectangle(t[0],t[1],e,r)}))))},frame(t,e,r,i,n){return this.sprite(new PIXI.Texture({source:s.resource(t).source,frame:new PIXI.Rectangle(i,n,e,r)}))},frameSelect:(t,e,r,i)=>i.map((i=>new PIXI.Texture({source:s.resource(t).source,frame:new PIXI.Rectangle(i[0],i[1],e,r)}))),frames(t,e,r,i=0,n=0,a=0,l=0){let h=e+i,u=r+n,c=s.resource(t),p=d(c.height/u),f=[],g=o.ndiv(c.width+i,h);for(let t,i=0;i<p;++i){t=l+r*i;for(let i,s=0;s<g;++s)i=a+e*s,f.push(new PIXI.Texture({source:c.source,frame:new PIXI.Rectangle(i,t,e,r)}))}return f},frameImages:(...t)=>(1==t.length&&l.vec(t[0])&&(t=t[0]),t.map((t=>s.resource(t)))),spriteFrom(...t){return this.sprite(this.frameImages(...t))},text(t,e,r=0,i=0){return n.set(this.lift(new PIXI.Text(t||"",e)),r,i)},bitmapText(t,e,r){let i;return l.str(e)?(i={fontFamily:e},l.num(r)&&(i.fontSize=r)):i=e,i.fontFamily||(i.fontFamily=i.fontName?i.fontName:"unscii"),i.align||(i.align="center"),this.lift(new PIXI.BitmapText({text:t||"",style:i}))},triangle(t,e,r,i=16777215,s=16777215,o=0,a=0,h=0){let u=this.graphics(),c=1,p=d(t/2),f=this.color(s),g=r<.5?0:r>.5?t:p;!1!==i&&l.vec(i)&&(c=i[1],i=i[0]),u.poly([0,0,g,-e,t,0]),!1!==i&&u.fill({color:this.color(i),alpha:c}),o>0&&u.stroke({width:o,color:f,alpha:1});let m=this.sprite(u);return m.m5.getContactPoints=e<0?()=>[[g,-e],[t,0],[0,0]]:()=>[[t,e],[g,0],[0,e]],n.set(m,a,h)},rect(t,e,r=16777215,i=16777215,s=0){return this.sprite(this.rectTexture(t,e,r,i,s))},grect:(t,e,r,i,s)=>(t.rect(e,r,i,s),t),gcircle:(t,e,r,i)=>(t.circle(e,r,i),t),gfillEx:(t,e,r)=>(r||(r={}),r.texture=e,t.texture(r),t),gclear:t=>t.clear(),gpath:(t,e)=>(a.assert(l.vec(e),"expected path actions!"),e.forEach((e=>{l.vec(e)?t[e.shift()].apply(t,e):l.str(e)&&t[e]()})),t),gfill:(t,e)=>(a.assert(l.obj(e),"expected fill style object"),t.fill(e),t),gstroke:(t,e)=>(a.assert(l.obj(e),"expected stroke style object"),t.stroke(e),t),rectTexture(t,e,r=16777215,i=16777215,s=0){let n,o=this.graphics();return!1!==r&&(l.vec(r)?(n=r[1],r=r[0]):n=1),o.rect(0,0,t,e),!1!==r&&o.fill({color:this.color(r),alpha:n}),s>0&&o.stroke({width:s,color:this.color(i)}),this.genTexture(o)},drawBody(t,...e){const r=this.graphics();return t.apply(this,[r].concat(e)),this.lift(new PIXI.Sprite(this.genTexture(r)))},circle(t,e=16777215,r=16777215,i=0){return this.circleEx(this.circleTexture(t,e,r,i))},circleTexture(t,e=16777215,r=16777215,i=0){let s,n=this.graphics();return!1!==e&&(l.vec(e)?(s=e[1],e=e[0]):s=1),n.circle(0,0,t),!1!==e&&n.fill({color:this.color(e),alpha:s}),i>0&&n.stroke({width:i,color:this.color(r)}),this.genTexture(n)},circleEx(t){const e=this.lift(new PIXI.Sprite(t));return(e.m5.circle=!0)&&this.centerAnchor(e)},line(t,e,r,i,s=1){let o,a=n.clone(r),l=n.clone(i),h=this.graphics(),u=this.color(t);function c(){h.clear(),h.moveTo(a[0],a[1]),h.lineTo(l[0],l[1]),h.stroke({width:e,color:u,alpha:s})}return c(),o=this.lift(h),o.m5.ptA=function(t,e){return void 0!==t&&(a[0]=t,a[1]=e??t,c()),a},o.m5.ptB=function(t,e){return void 0!==t&&(l[0]=t,l[1]=e??t,c()),l},o},isMoving:t=>!a.feq0(t.m5.vel[0])||!a.feq0(t.m5.vel[1]),makeCells(t,e,r,i,s,n){let a=o.ndiv(r-t,s);return x(t,e,o.ndiv(i-t,n),a,s,n)},gridBox(t=.9,e=.9,r){let i=r??s,n=d(i.height*e),a=d(i.width*t),l=o.ndiv(i.width-a,2),h=o.ndiv(i.height-n,2);return{x1:l,y1:h,x2:l+a,y2:h+n}},gridSQ(t,e=.9,r){let i=e*(s.height<s.width?s.height:s.width),n=d(i/t),l=n;a.isEven(n)||--n,l=n,i=t*n;let h=o.ndiv(s.height-i,2),u=o.ndiv(s.width-i,2),c=u,p=h;return r&&(r.height=i,r.width=i,void 0!==r.x&&(c=r.x),void 0!==r.y&&(p=r.y),r.x=u,r.y=h,r.x1=u,r.y1=h,r.x2=u+i,r.y2=h+i),x(c,p,t,t,n,l)},divXY([t,e],r=.9,i=.9,n){let a,l,h,u,c=d(s.height*i),p=d(s.width*r),f=d(p/t),g=d(c/e);return c=e*g,p=t*f,h=o.ndiv(s.height-c,2),u=o.ndiv(s.width-p,2),a=u,l=h,n&&(n.height=c,n.width=p,void 0!==n.x&&(a=n.x),void 0!==n.y&&(l=n.y),n.x=u,n.y=h,n.x1=u,n.y1=h,n.x2=u+p,n.y2=h+c),x(a,l,e,t,f,g)},gridXY([t,e],r=.9,i=.9,n){let l,h,u,c,p=d(s.height*i),f=d(s.width*r),g=d(f/t),m=d(p/e),_=g>m?m:g;return a.isEven(_)||--_,p=e*_,f=t*_,u=o.ndiv(s.height-p,2),c=o.ndiv(s.width-f,2),l=c,h=u,n&&(n.height=p,n.width=f,void 0!==n.x&&(l=n.x),void 0!==n.y&&(h=n.y),n.x=c,n.y=u,n.x1=c,n.y1=u,n.x2=c+f,n.y2=u+p),x(l,h,e,t,_,_)},gridBBox(t,e,r){let i=r[0].length,s=r[0][0],n=r[r.length-1][i-1];return{x1:t+s.x1,x2:t+n.x2,y1:e+s.y1,y2:e+n.y2}},graphics(t){const e=new PIXI.Graphics;return(e.m5={uuid:`${t||a.nextId()}`})&&e},drawGridBox(t,e=1,r="white",i){return i||(i=this.graphics()),i.rect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1),i.stroke({width:e,color:this.color(r)}),i},drawGridBoxEx(t,e=1,r="white",i=1,s){return s||(s=this.graphics()),s.roundRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1,i),s.stroke({width:e,color:this.color(r)}),s},drawGridLines(t,e,r,i,s,n){let o=r.length,a=r[0].length;n||(n=this.graphics());for(let i,s=1;s<o;++s)i=r[s],n.moveTo(t+i[0].x1,e+i[0].y1),n.lineTo(t+i[a-1].x2,e+i[a-1].y1);for(let i,s=1;s<a;++s)i=r[0],n.moveTo(t+i[s].x1,e+i[s].y1),i=r[o-1],n.lineTo(t+i[s].x1,e+i[s].y2);return l.obj(s)?(s.color=this.color(s.color||"white"),s.width=i,n.stroke(s)):n.stroke({width:i,color:this.color(s)}),n},add:(t,...e)=>(e.forEach((e=>e&&t.addChild(e))),t),remove:(...t)=>(1==t.length&&l.vec(t[0])&&(t=t[0]),a.doseqEx(t,(t=>{t.parent&&(a.inst(s.Scenes.Scene,t.parent)?t.parent.remove(t):t.parent.removeChild(t)),s.emit(["post.remove",t]),s.off(t),t.m5.dispose?.()})),t[0]),centerObj(t){let e=t.anchor,r=s.width/2,i=s.height/2,n=t.width/2,o=t.height/2;return t.x=r,t.y=i,e||(e={x:0,y:0}),e.x<.3&&(t.x=r-n),e.x>.7&&(t.x=r+n),e.y<.3&&(t.y=i-o),e.y>.7&&(t.y=i+o),t},fillMax(t){return(l.str(t)||a.inst(PIXI.Texture,t))&&(t=this.sprite(t)),a.assert(a.inst(PIXI.Container,t),"expected sprite"),t.height=s.height,t.width=s.width,this.centerObj(t)},colorToRgbA(t){a.assert(l.str(t)&&t.length>0,"bad color string value");let e,r=t.toLowerCase(),s=i[r];if("transparent"==r)return[0,0,0,0];if(s&&(t=s),"#"==t[0]){if((e=t.split("")).shift(),3==e.length&&e.push("F"),4==e.length&&(e=e.flatMap((t=>[t,t]))),6==e.length&&e.push("F","F"),8==e.length)return[parseInt(e[0]+e[1],16),parseInt(e[2]+e[3],16),parseInt(e[4]+e[5],16),parseInt(e[6]+e[7],16)/255]}else if(0==r.indexOf("rgb"))return r.indexOf("rgba")<0&&(r+=",1"),r.match(/[\.\d]+/g).map((t=>+t));throw`Error: Bad color string: ${t}`},byteToHex:t=>("0"+t.toString(16)).slice(-2),colorToHex(t){const e=this.colorToRgbA(t);return"0x"+[0,1,2].map((t=>this.byteToHex(e[t]))).join("")},color3(t,e,r){return parseInt(["0x",this.byteToHex(t),this.byteToHex(e),this.byteToHex(r)].join(""))},color(t){return isNaN(t)?parseInt(this.colorToHex(t)):t},rgba(t){return a.assert(l.vec(t),"wanted rgba array"),parseInt("0x"+[0,1,2].map((e=>this.byteToHex(t[e]))).join(""))},hsla(t,e,r,i){function s(t){return Math.min(1,Math.max(0,t))}function n(t){return 6*(t=t<0?t+1:t>1?t-1:t)<1?a+(o-a)*t*6:2*t<1?o:3*t<2?a+(o-a)*(2/3-t)*6:a}t=t%360/360,e=s(e),r=s(r),i=s(i);let o=r<=.5?r*(e+1):r+e-r*e,a=2*r-o;return this.rgba([255*n(t+1/3),255*n(t),255*n(t-1/3),i])},resize(t,e,r,i,s){t&&a.doseqEx(t.children,(e=>e.m5&&e.m5.resize?.(t.x,t.y,t.width,t.height)))},pinAbove(t,e,r=10,i=.5){let[s,o,a,l,h]=y(this,t),[u,c,d,p,f]=y(this,e,t),g=s.y1-r-(u.y2-u.y1),m=i<.3?s.x1:i<.7?l-c:s.x2-(u.x2-u.x1);e.y=!e.anchor||e.anchor.y<.3?g:e.anchor.y<.7?g+d:g+(u.y2-u.y1),e.x=!e.anchor||e.anchor.x<.3?m:e.anchor.x<.7?m+c:m+(u.x2-u.x1),e.parent===t&&n.sub$(e,t)},pinBelow(t,e,r=10,i=.5){let[s,o,a,l,h]=y(this,t),[u,c,d,p,f]=y(this,e,t),g=s.y2+r,m=i<.3?s.x1:i<.7?l-c:s.x2-(u.x2-u.x1);e.y=!e.anchor||e.anchor.y<.3?g:e.anchor.y<.7?g+d:g+(u.y2-u.y1),e.x=!e.anchor||e.anchor.x<.3?m:e.anchor.x<.7?m+c:m+(u.x2-u.x1),e.parent===t&&n.sub$(e,t)},pinCenter(t,e){let[r,i,s,o,a]=y(this,t),[l,h,u,c,d]=y(this,e,t),p=o-h,f=a-u;e.y=!e.anchor||e.anchor.y<.3?f:e.anchor.y<.7?f+u:f+(l.y2-l.y1),e.x=!e.anchor||e.anchor.x<.3?p:e.anchor.x<.7?p+h:p+(l.x2-l.x1),(t.m5.stage||e.parent===t)&&n.sub$(e,t)},pinLeft(t,e,r=10,i=.5){let[s,o,a,l,h]=y(this,t),[u,c,d,p,f]=y(this,e,t),g=s.x1-r-(u.x2-u.x1),m=i<.3?s.y1:i<.7?h-d:s.y2-(u.y2-u.y1);e.y=!e.anchor||e.anchor.y<.3?m:e.anchor.y<.7?m+d:m+(u.y2-u.y1),e.x=!e.anchor||e.anchor.x<.3?g:e.anchor.x<.7?g+c:g+(u.x2-u.x1),e.parent===t&&n.sub$(e,t)},pinRight(t,e,r=10,i=.5){let[s,o,a,l,h]=y(this,t),[u,c,d,p,f]=y(this,e,t),g=s.x2+r,m=i<.3?s.y1:i<.7?h-d:s.y2-(u.y2-u.y1);e.y=!e.anchor||e.anchor.y<.3?m:e.anchor.y<.7?m+d:m+(u.y2-u.y1),e.x=!e.anchor||e.anchor.x<.3?g:e.anchor.x<.7?g+c:g+(u.x2-u.x1),e.parent===t&&n.sub$(e,t)},setMass(t,e){t.m5.mass=e},genTexture:(t,e,r,i)=>p(t),bounceOff:t=>b(t.A,t.B,t),hit(t,e){const r=v(this,t,e);return r&&(s.emit(["hit",t],r),s.emit(["hit",e],r.swap())),r},collide(t,e,r=!0){const i=function(t,e,r,i=!0){let s,o=v(t,e,r);return o&&(r.m5.static?n.sub$(e,o.overlapV):(s=n.div(o.overlapV,2),n.sub$(e,s),n.add$(r,s)),i&&b(e,r,o)),o}(this,t,e,r);return i&&function(t){const e=new Set;return t.overlapN[1]<-.3&&e.add(s.TOP),t.overlapN[1]>.3&&e.add(s.BOTTOM),t.overlapN[0]<-.3&&e.add(s.LEFT),t.overlapN[0]>.3&&e.add(s.RIGHT),e.add(t),e}(i)},hitTest(t,e){return v(this,t,e)},clamp(t,r,i=!1,n){let o,h,u,c,d,p;l.vec(r)&&(u=r[1].left,c=r[1].right,d=r[1].top,p=r[1].bottom,r=r[0]),c=!1!==c,u=!1!==u,d=!1!==d,p=!1!==p,r instanceof s.Scenes.Scene?h=s.mockStage():r.m5&&r.m5.stage?h=r:void 0!==r.x2&&void 0!==r.y2?(h=r,o=!0):(r.isSprite?a.assert(t.parent===r):a.assert(!1,"Error: clamp() using bad container"),a.assert(a.feq0(r.rotation),"Error: clamp() container can't rotate"),a.assert(a.feq0(r.anchor.x),"Error: clamp() container anchor.x !==0"),a.assert(a.feq0(r.anchor.y),"Error: clamp() container anchor.y !==0"),h=r);let f=o?[0,0]:this.topLeftOffsetXY(h),g=new Set,m=!1,_=!1,x=this.getAABB(t),y=o?h.x1:h.x+f[0],b=y+(o?h.x2-h.x1:h.width),v=o?h.y1:h.y+f[1],T=v+(o?h.y2-h.y1:h.height);return u&&x.x1<y&&(t.x+=y-x.x1,m=!0,g.add(s.LEFT)),c&&x.x2>b&&(t.x-=x.x2-b,m=!0,g.add(s.RIGHT)),d&&x.y1<v&&(t.y+=v-x.y1,_=!0,g.add(s.TOP)),p&&x.y2>T&&(t.y-=x.y2-T,_=!0,g.add(s.BOTTOM)),g.size>0?(m&&(t.m5.vel[0]/=t.m5.mass,i&&(t.m5.vel[0]*=-1)),_&&(t.m5.vel[1]/=t.m5.mass,i&&(t.m5.vel[1]*=-1)),n&&n(g)):g=e,g},dbgShowDir(t){let e="?";switch(t){case s.NE:e="top-right";break;case s.NW:e="top-left";break;case s.TOP:case s.UP:e="top";break;case s.LEFT:e="left";break;case s.RIGHT:e="right";break;case s.BOTTOM:case s.DOWN:e="bottom";break;case s.SE:e="bottom-right";break;case s.SW:e="bottom-left"}return e},dbgShowCol(t){const e=[];if(l.set(t))for(let r of t.values())e.push(this.dbgShowDir(r));return e.join(",")}};return T.bmpText=T.bitmapText,a.doseq(i,((t,e)=>{T.SomeColors[e]=T.color(t)})),a.doseq(r,((t,e)=>{T.BtnColors[e]=T.color(t)})),s.Sprites=T}if("object"==typeof module&&module.exports)throw"Panic: browser only";t["io/czlab/mojoh5/Sprites"]=function(t){return t.Sprites?t.Sprites:s(t)}}(this),function(t,e){"use strict";function r(e,r){const i=t["io/czlab/mcfud/spatial"](),{v2:s,math:n,ute:o,is:a}=e,l=Math.floor,h=t=>t.startsWith("scene::")?t:`scene::${t}`;function u(t){t&&(t.dispose?.(),t.parent.removeChild(t))}class c extends PIXI.Container{constructor(t){super(),this.addChild(t),this.label=t.label,this.m5={stage:!0}}dispose(){u(this.children[0])}update(t){this.children[0].update(t)}}class d extends PIXI.Container{constructor(t,e,r){super(),this.label=h(t),this.g={},this.m5={index:{},queue:[],garbo:[],sid:t,options:r,stage:!0,sgrid:i.spatialGrid(r.sgridX||320,r.sgridY||320)},a.fun(e)?this.setup=e:a.obj(e)&&o.inject(this,e)}#r(t,r,i){let s,n,o,a=!1;for(o=0;!a&&o<i.length;++o)n=i[o],r!==n&&!n.m5.dead&&r.m5.cmask&n.m5.type&&(s=e.Sprites.hitTest(r,n))&&(e.emit(["hit",r],s),s.B.m5.static||e.emit(["hit",s.B],s.swap()),t.engrid(r),a=!0);return a}collideXY(t){return this.#r(this.m5.sgrid,t,this.m5.sgrid.search(t))}onCanvasResize(t,r){return e.Sprites.resize({x:0,y:0,width:t,height:r,children:this.children}),this}future(t,r){return this.m5.queue.push([t,n.ndiv(e._curFPS*r,1e3)||1]),this}futureX(t,e){return this.m5.queue.push([t,e||1]),this}getChildById(t){return t&&this.m5.index[t]}remove(t){return a.str(t)&&(t=this.getChildById(t)),t&&(this.removeChild(t),e.off(t),t.m5._engrid&&this.m5.sgrid.degrid(t),e.Input.undoXXX(t),o.dissoc(this.m5.index,t.m5.uuid)),this}degrid(t){return t&&t.m5._engrid&&this.m5.sgrid.degrid(t),t}engrid(t){return t&&t.m5._engrid&&this.m5.sgrid.engrid(t),t}insertEx(t,e=!1){let r;return o.assert(a.vec(t),"wanted array of child sprites to be inserted!"),t.forEach((t=>{this.insertAt(t,null,e),r=t})),r}insert(t,e=!1){return this.insertAt(t,null,e)}insertAt(t,e,r=!1){return t=this.#i(t,e),r&&(t instanceof PIXI.TilingSprite||(t.m5._engrid=!0,this.m5.sgrid.engrid(t))),t}#i(t,e){return a.num(e)&&e>=0&&e<this.children.length?this.addChildAt(t,e):this.addChild(t),this.m5.index[t.m5.uuid]=t}preDispose(){return this}dispose(){return this.preDispose(),this.m5.dead=!0,e.off(this),function t(r){r&&(e.Input.undoXXX(r),r.children.forEach((e=>t(e))))}(this),this.removeChildren(),e.modalScene===this&&(e.modalScene=void 0,e.Input.restore(),o.log("removed the current modal scene")),this}#s(t,r){t.forEach((t=>{t.visible&&t.m5&&t.m5.tick&&(t.m5.tick(r),"x"==t.m5.flip&&(t.scale.x*=-1),"y"==t.m5.flip&&(t.scale.y*=-1),t.m5.flip=!1,e.emit(["post.tick",t],r),t.m5._engrid&&this.m5.sgrid.engrid(t)),t.children.length>0&&this.#s(t.children,r)}))}searchSGrid(t,e=!1){return this.m5.sgrid.search(t,e)}queueForRemoval(t){return this.m5.garbo.push(t)&&t}update(t){return this.m5.dead||(this.m5.queue.filter((t=>(t[1]-=1,t[1]<=0))).reverse().forEach((t=>{o.disj(this.m5.queue,t),t[0]()})),this.preUpdate?.(t),this.#s(this.children,t),this.postUpdate?.(t),this.m5.garbo.forEach((t=>this.remove(t))),this.m5.garbo.length=0),this}runOnce(){return this.setup?.(this.m5.options),this}}function p(t,r,i){let{Sprites:s}=e,h=e.getScaleFactor();if(0==t.length)return;let u,c,d=(r=o.patch(r,{bg:0,padding:10,fit:20,borderWidth:4,border:s.SomeColors.white})).borderWidth*h,p=r.group||s.container(),f=r.padding*h,g=0,m=-1,_=r.fit*h,x=2*_,y=t=>{g+=t.height,t.width>m&&(m=t.width)},b=t=>{g+=t.width,t.height>m&&(m=t.height)};t.forEach((t=>{o.assert(o.feq0(t.anchor.x)&&o.feq0(t.anchor.y),"wanted topleft anchor"),(i==e.DOWN?y:b)(t),r.skipAdd||p.addChild(t)})),m+=x,g+=f*(t.length-1)+x,i==e.DOWN?(u=m,c=g):(c=m,u=g);{let t=s.rect(u,c,r.bg,r.border,d);p.addChildAt(t,0),a.vec(r.bg)||(t.alpha=0==r.opacity?0:r.opacity||.5,"transparent"==r.bg&&(t.alpha=0))}let v,[T,S]=[l(u/2),l(c/2)],w=i==e.DOWN?"pinBelow":"pinRight";return t.forEach(((t,r)=>{i==e.DOWN?0==r&&(t.x=T-t.width/2,t.y=_):0==r&&(t.y=S-t.height/2,t.x=_),v&&e.Sprites[w](v,t,f),v=t})),p.x=r.x??n.ndiv(e.width-u,2),p.y=r.y??n.ndiv(e.height-c,2),p}function f(t,r,i){let s,n,{Sprites:o,Input:a}=e,l=o.color(r.selectedColor??"green"),h=o.color(r.disabledColor??"grey");return t.forEach((t=>{t.m5.uuid==r.defaultChoice?(n=t,t.tint=l):t.tint=h,t.m5.button&&(t.m5.press=t=>{t!==n&&(n.tint=h,t.tint=l,n=t,r.onClick?.(t))})})),n||(n=t[0],n.tint=l),s=p(t,r,i),s.getSelectedChoice=()=>n.m5.uuid,s}const g={Scene:d,SceneWrapper:c,layoutX:(t,r)=>p(t,r,e.RIGHT),layoutY:(t,r)=>p(t,r,e.DOWN),choiceMenuX:(t,r)=>f(t,r,e.RIGHT),choiceMenuY:(t,r)=>f(t,r,e.DOWN),scene(t,e,i){a.fun(e)&&(e={setup:e}),r[t]=[e,i]},replace(t,r,i){const s=h(a.str(t)?t:t.label),n=e.stage.getChildByName(s);if(!n)throw`Fatal: no such scene: ${s}`;return this.run(r,e.stage.getChildIndex(n),i)},remove(...t){1==t.length&&a.vec(t[0])&&(t=t[0]),t.forEach((t=>u(a.str(t)?e.stage.getChildByName(h(t)):t)))},removeAll(){for(;e.stage.children.length>0;)u(e.stage.children[e.stage.children.length-1]);e.mouse.reset(),e.Input.reset()},find:t=>e.stage.getChildByName(h(t)),runEx(t,e,r){return this.removeAll(),this.run(t,e,r)},runSeq(...t){t.forEach((t=>{o.assert(a.vec(t),"Expecting array"),this.run(t[0],t[1],t[2])}))},modal(t,r){return o.assert(!e.modalScene,"Another modal is already running!"),e.Input.save(),e.modalScene=this.run(t,null,r)},run(t,i,s){let n,l,h,p=r[t];if(e.modalScene)throw"Fatal: modal scene is running";if(!p)throw`Fatal: unknown scene: ${t}`;if(a.obj(i)&&(s=i,i=o.dissoc(s,"slot")),s=o.inject({},p[1],s),h=o.inject({},p[0]),o.nichts(i)&&(i=s.slot||-1),s.tiled?(o.assert(s.tiled.name,"no tmx file!"),l=new e.Tiles.TiledScene(t,h,s)):l=new d(t,h,s),n=l,s.centerStage&&(n=new c(l)),i>=0&&i<e.stage.children.length){let t=e.stage.getChildAt(i);e.stage.addChildAt(n,i),u(t)}else e.stage.addChild(n);return l.runOnce(),l},topMost(){let t=o.last(e.stage.children);return t instanceof c&&(t=t.children[0]),o.assert(t instanceof d,"top is not a scene!"),t}};return e.Scenes=g}if("object"==typeof module&&module.exports)throw"Panic: browser only";t["io/czlab/mojoh5/Scenes"]=function(t){return t.Scenes?t.Scenes:r(t,{})}}(this),function(t,e){"use strict";if("object"==typeof module&&module.exports)throw"Panic: browser only";t["io/czlab/mojoh5/FX"]=function(t){return t.FX?t.FX:function(t,r,i){const s=Math.floor,n=5*Math.PI,o=Math.PI/2,a=2*Math.PI,{v2:l,math:h,ute:u,is:c}=t;function d(e,i,s=60,n=!1,o={}){return u.inject({duration:s,sprite:e,easing:i,loop:n,cur:0,on:0,dead:0,onFrame(t,e){},_run(){this.cur=0,this.on=1,this.dead=0,r.push(this)},onTick(){this.on&&(this.cur<this.duration?(this.onFrame(!1,this.easing(this.cur/this.duration)),this.cur+=1):(this.onFrame(!0),this.loop?(c.num(this.loop)&&--this.loop,this.onLoopReset(),this.cur=0):(this.on=0,this.dispose(),this.onComplete&&u.delay(0,(()=>this.onComplete())))))},dispose(){this.dead=1,t.emit(["tween.disposed"],this)}},o)}function p(t,r,i,s){return d(t,r,i,s,{start(t,r,i,s){this._x=c.num(r)?[t,r]:e,this._y=c.num(s)?[i,s]:e,this._run()},onLoopReset(){this._x&&u.swap(this._x,0,1),this._y&&u.swap(this._y,0,1)},onFrame(t,e){this._x&&(this.sprite.x=t?this._x[1]:h.lerp(this._x[0],this._x[1],e)),this._y&&(this.sprite.y=t?this._y[1]:h.lerp(this._y[0],this._y[1],e))}})}function f(...e){const r=e.slice(0),i={onTweenEnd(t){for(let e,i=0;i<r.length;++i)if(e=r[i],e===t){r.splice(i,1);break}0==r.length&&(this.dispose(),this.onComplete&&u.delay(0,(()=>this.onComplete())))},dispose(){t.off(["tween.disposed"],"onTweenEnd",i),r.length=0}};return t.on(["tween.disposed"],"onTweenEnd",i),i}const g={EXPO_IN:t=>0==t?0:Math.pow(1024,t-1),EXPO_OUT:t=>1==t?1:1-Math.pow(2,-10*t),EXPO_INOUT:t=>0==t?0:1==t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1))),LINEAR:t=>t,SMOOTH:t=>3*t*t-2*t*t*t,SMOOTH_QUAD(t){let e=g.SMOOTH(t);return e*e},SMOOTH_CUBIC(t){let e=g.SMOOTH(t);return e*e*e},EASE_IN_CUBIC:t=>t*t*t,EASE_OUT_CUBIC(t){let e=1-t;return 1-e*e*e},EASE_INOUT_CUBIC(t){if(t<.5)return 4*t*t*t;{let e=-2*t+2;return 1-e*e*e/2}},EASE_IN_QUAD:t=>t*t,EASE_OUT_QUAD:t=>1-(1-t)*(1-t),EASE_INOUT_QUAD(t){if(t<.5)return 2*t*t;{let e=-2*t+2;return 1-e*e/2}},EASE_IN_SINE:t=>1-Math.cos(t*o),EASE_OUT_SINE:t=>Math.sin(t*o),EASE_INOUT_SINE:t=>.5-Math.cos(t*Math.PI)/2,SPLINE(t,e,r,i,s){let n=t*t,o=n*t;return.5*(e*(2*n-o-t)+r*(3*o-5*n+2)+i*(-3*o+4*n+t)+s*(o-n))},CUBIC_BEZIER(t,e,r,i,s){let n=t*t,o=1-t,a=o*o;return a*o*e+3*a*t*r+3*o*n*i+n*t*s},ELASTIC_IN:t=>0==t?0:1==t?1:-Math.pow(2,10*(t-1))*Math.sin((t-1.1)*n),ELASTIC_OUT:t=>0==t?0:1==t?1:1+Math.pow(2,-10*t)*Math.sin((t-.1)*n),ELASTIC_INOUT(t){switch(t){case 0:return 0;case 1:return 1;default:return(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin((t-1.1)*n):1+.5*Math.pow(2,-10*(t-1))*Math.sin((t-1.1)*n)}},BOUNCE_IN:t=>1-g.BOUNCE_OUT(1-t),BOUNCE_OUT:t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,BOUNCE_INOUT:t=>t<.5?.5*g.BOUNCE_IN(2*t):.5*g.BOUNCE_OUT(2*t-1)+.5,tweenAlpha(t,e,r,i=60,s=!1){const n=function(t,e,r,i){return d(t,e,r,i,{start(t,e){this._a=[t,e],this._run()},onLoopReset(){u.swap(this._a,0,1)},onFrame(t,e){this.sprite.alpha=t?this._a[1]:h.lerp(this._a[0],this._a[1],e)}})}(t,e,i,s);let o=t.alpha,a=r;return c.vec(r)&&(o=r[0],a=r[1]),n.start(o,a),n},tweenAngle(t,e,r,i=60,s=!1){const n=function(t,e,r,i){return d(t,e,r,i,{start(t,e){this._a=[t,e],this._run()},onLoopReset(){u.swap(this._a,0,1)},onFrame(t,e){this.sprite.rotation=t?this._a[1]:h.lerp(this._a[0],this._a[1],e)}})}(t,e,i,s);let o=t.rotation,a=r;return c.vec(r)&&(o=r[0],a=r[1]),n.start(o,a),n},tweenScale(t,r,i,s,n=60,o=!1){const a=function(t,r,i,s){return d(t,r,i,s,{start(t,r,i,s){this._x=c.num(r)?[t,r]:e,this._y=c.num(s)?[i,s]:e,this._run()},onLoopReset(){this._x&&u.swap(this._x,0,1),this._y&&u.swap(this._y,0,1)},onFrame(t,e){this._x&&(this.sprite.scale.x=t?this._x[1]:h.lerp(this._x[0],this._x[1],e)),this._y&&(this.sprite.scale.y=t?this._y[1]:h.lerp(this._y[0],this._y[1],e))}})}(t,r,n,o);let l=t.scale.x,p=t.scale.y,f=i,g=s;return c.vec(i)&&(l=i[0],f=i[1]),c.vec(s)&&(p=s[0],g=s[1]),c.num(f)||(l=f=e),c.num(g)||(p=g=e),a.start(l,f,p,g),a},tweenXY(t,r,i,s,n=60,o=!1){const a=p(t,r,n,o);let l=t.x,h=t.y,u=i,d=s;return c.vec(i)&&(l=i[0],u=i[1]),c.vec(s)&&(h=s[0],d=s[1]),c.num(u)||(l=u=e),c.num(d)||(h=d=e),a.start(l,u,h,d),a},fadeOut(t,e=60){return this.tweenAlpha(t,this.EASE_OUT_SINE,0,e)},fadeIn(t,e=60){return this.tweenAlpha(t,this.EASE_OUT_SINE,1,e)},pulse(t,e=0,r=60,i=!0){return this.tweenAlpha(t,this.SMOOTH,e,r,i)},slide(t,e,r,i,s=60){return this.tweenXY(t,e,r,i,s)},throb(t,e=.9,r=.9,i=60,s=!0){return this.tweenScale(t,this.SMOOTH_QUAD,e,r,i,s)},scale(t,e=.5,r=.5,i=60){return this.tweenScale(t,this.SMOOTH,e,r,i)},strobe(t,e=1.3,r=10,i=20,s=10,n=!0){return this.tweenScale(t,(t=>this.SPLINE(t,r,0,1,i)),e,e,s,n)},jiggle(t,r,i=1.4,s=1.2,n=10,o=!0){let{x1:a,x2:l,y1:h,y2:c}=r;return f(this.tweenScale(t,(t=>this.SPLINE(t,u.or(a,10),0,1,u.or(l,10))),i,e,n,o),this.tweenScale(t,(t=>this.SPLINE(t,u.or(h,-10),0,1,u.or(c,-10))),e,s,n,o))},bezier(t,e,r,i,s=60){let n=p(t,this.SMOOTH,s);return n.start=function(){this._run()},n.onFrame=function(s,n){s||l.set(t,g.CUBIC_BEZIER(n,t.x,e[0],r[0],i[0]),g.CUBIC_BEZIER(n,t.y,e[1],r[1],i[1]))},n.start(),n},remove(t){t?.dispose()},update(t){u.rseq(r,(e=>e.onTick(t))),u.rseq(i,(e=>e.onTick(t)));for(let t=r.length-1;t>=0;--t)r[t].dead&&r.splice(t,1);for(let t=i.length-1;t>=0;--t)i[t].m5.dead&&_S.remove(i[t])&&i.splice(t,1)},particles(t,e,r,s,n=24,o={},a={},h=[0,.3],c=!0){function d(n){let c,d=s(),p=u.randInt2(o.size,a.size);i.push(d),t.addChild(d),d.totalFrames&&d.gotoAndStop(u.randInt2(0,d.totalFrames-1)),_S.sizeXY(_S.centerAnchor(d),p,p),l.set(d,e,r),d.g.scaleSpeed=u.randFloat2(o.scale,a.scale),d.g.alphaSpeed=u.randFloat2(o.alpha,a.alpha),d.g.angVel=u.randFloat2(o.rotate,a.rotate),c=u.randFloat2(o.speed,a.speed),l.set(d.m5.vel,c*Math.cos(n),c*Math.sin(n)),d.onTick=function(){this.m5.dead||(l.add$(this.m5.vel,h),l.add$(this,this.m5.vel),this.scale.x-this.g.scaleSpeed>0&&(this.scale.x-=this.g.scaleSpeed),this.scale.y-this.g.scaleSpeed>0&&(this.scale.y-=this.g.scaleSpeed),this.rotation+=this.m5.angVel,this.alpha-=this.g.alphaSpeed,this.alpha<=0&&(this.m5.dead=!0))}}o=u.patch(o,{angle:0,size:4,speed:.3,scale:.01,alpha:.02,rotate:.01});for(let t=((a=u.patch(a,{angle:6.28,size:16,speed:3,scale:.05,alpha:.02,rotate:.03})).angle-o.angle)/(n-1),e=o.angle,r=0;r<n;++r)d(c?u.randFloat2(o.angle,a.angle):e),e+=t},shake(t,e=16,r=!1,n=!0){let o={},a=1,l=t.x,h=t.y,c=1,d=t.rotation,p=e,f=s(e/8);return o.onTick=()=>r?void(a<8?(t.rotation=d,e-=f,t.rotation=e*c,++a,c*=-1):n?(e=p,a=1):u.disj(i,o)):void(a<8?(t.x=l,t.y=h,e-=f,t.x+=u.randInt2(-e,e),t.y+=u.randInt2(-e,e),++a):n?(e=p,a=1):u.disj(i,o)),i.push(o)&&t},StarWarp:function(e,r){r=r||{};let{Sprites:i}=t,s=2e3,n=0,l=0,h=0,c=u.now(),d=r.color??"yellow",p=r.items??1e3,f=t.resource("boot/star.png");const g=u.fill(p,(t=>((t=i.sprite(f)).g.d3=[0,0,0],u.rand()<.3&&(t.tint=i.color(d)),i.anchorXY(t,.5,.69),e.addChild(t),m(t,u.rand()*s))));function m(t,e){let r=u.rand()*a,i=50*u.rand()+1;return t.g.d3[0]=Math.cos(r)*i,t.g.d3[1]=Math.sin(r)*i,t.g.d3[2]=isNaN(e)?n+s*(1+.5*u.rand()):e,t}return{dispose(){g.forEach((t=>i.remove(t)))},update(e){let r,a,d=t.width/2,p=t.height/2;l+=(h-l)/20,n+=10*e*(l+.025),g.forEach(((e,r)=>{e.g.d3[2]<n&&m(e),r=20*t.width/a,a=e.g.d3[2]-n,e.x=e.g.d3[0]*r+d,e.y=e.g.d3[1]*r+p;let h=e.x-d,u=e.y-p,c=Math.sqrt(h*h+u*u),f=Math.max(0,1-a/s);e.rotation=Math.atan2(u,h)+o,i.scaleXY(e,.05*f,f*(.05+6*l*c/t.width))})),r=u.now(),r-c>5e3&&(c=r,h=h>0?0:1)}}},SeqTweens:function(...t){let e=[];t.forEach((t=>{e.push(t),u.disj(r,t)}));const i={onDone(){this.dispose(),this.onComplete&&u.delay(0,(()=>this.onComplete()))},dispose(){e.length=0}};return function t(s){s?(r.push(s),s.onComplete=()=>t(e.shift())):i.onDone()}(e.shift()),i},BatchTweens:f};return t.FX=g}(t,[],[])}}(this),function(t,e){"use strict";function r(r){const i=t["io/czlab/mcfud/geo2d"](),{v2:s,math:n,is:o,ute:a}=r,l=Math.abs,h=Math.cos,u=Math.sin,c=Math.floor,d=Math.PI/180;Math.PI,r.Scenes.scene("Splash",{setup(t){let e,i,n,o=r.getScaleFactor(),{title:l,titleFont:h,titleColor:u,titleSize:c}=t,{footerMsgSize:d,action:p,clickSnd:f}=t,{bg:g,playMsg:m,playMsgFont:_,playMsgColor:x,playMsgSize:y,playMsgColor2:b}=t;_=_||r.DOKI_LOWER,h=h||r.BIGSHOUTBOB,d=(d||18)*o,m=m||r.clickPlayMsg(),x=x??r.Sprites.color("white"),b=b??r.Sprites.color("#ffc901"),u=u??r.Sprites.color("#ffc901"),c=(c||96)*o,y=(y||48)*o,this.insert(r.Sprites.fillMax(g||"boot/splash.jpg")),e=this.insert(r.Sprites.container()),n=r.Sprites.bmpText(l,h,c),a.echt(u)&&r.Sprites.tint(n,u),s.set(n,r.width/2,.45*r.height),e.addChild(r.Sprites.centerAnchor(n));{i=r.Sprites.bmpText(m,_,y);let t,s=r.FX.throb(i,.747,.747);const o=()=>{r.Sprites.tint(i,b),r.FX.remove(s),t=r.FX.tweenAlpha(e,r.FX.EASE_OUT_SINE,0,90),t.onComplete=()=>r.Scenes.runEx(p.name,p.cfg)};let a=r.Sprites.oneOffClick(o,f);r.Sprites.centerAnchor(i),r.Sprites.pinBelow(n,i),e.addChild(i),r.touchDevice||(this.g.space=r.Input.keybd(r.Input.SPACE,(()=>{r.Sprites.cancelOneOffClick(a),o(),r.sound(f).play()})))}{const t=r.Sprites.bmpText("Powered by MojoH5 2d game engine.",r.UNSCII,d),e=r.Sprites.bmpText(r.COPYRIGHT,r.UNSCII,d);r.Sprites.pinBelow(this,e,1.5*-e.height,0),r.Sprites.pinBelow(this,t,1.5*-t.height,1),this.insert(e),this.insert(t)}},preDispose(){this.g.space?.dispose()}}),r.Scenes.scene("EndGame",{setup(t){let{winner:e,snd:i}=t,{fontName:s,fontSize:n,msg:o,replay:a,quit:l}=t;i||(i=e?"game_win.mp3":"game_over.mp3"),n=(n||32)*r.getScaleFactor(),s=s||r.DOKI_LOWER;let h={fontName:s,fontSize:n},u=()=>r.Sprites.opacity(r.Sprites.bmpText("#",h),0),c=r.Sprites.bmpText("Game Over",h),d=r.Sprites.bmpText(o,h),p=r.Input.mkBtn(r.Sprites.bmpText("Play Again?",h)),f=r.Sprites.bmpText(" or ",h),g=r.Input.mkBtn(r.Sprites.bmpText("Quit",h));p.m5.press=()=>r.Scenes.runEx(a.name,a.cfg),g.m5.press=()=>r.Scenes.runEx(l.name,l.cfg),r.sound(i).play(),this.insert(r.Scenes.layoutY([c,d,u(),u(),u(),p,f,g],t))}}),r.Scenes.scene("PhotoMat",{setup(t){let i=t.image?r.resource(t.image):e;this.g.gfx=r.Sprites.graphics(),r.Sprites.grect(this.g.gfx,0,0,r.width,t.y1),r.Sprites.grect(this.g.gfx,0,t.y2,r.width,r.height-t.y2),r.Sprites.grect(this.g.gfx,0,0,t.x1,r.height),r.Sprites.grect(this.g.gfx,t.x2,0,r.width-t.x2,r.height),i?r.Sprites.gfillEx(this.g.gfx,i,{}):r.Sprites.gfill(this.g.gfx,{color:r.Sprites.color(t.color)}),this.insert(this.g.gfx)}}),r.Scenes.scene("HotKeys",{setup(t){let i,n,o,a,{Sprites:l,Input:h}=r,u=r.getScaleFactor(),c=1.2,d=r.width,p=r.height,f=t.buttons?"makeButton":"makeHotspot",{fontName:g,fontSize:m,cb:_,radius:x,alpha:y,color:b}=t,{char_fire:v,char_down:T,char_up:S,char_left:w,char_right:E}=t;function A(t,e,r){let i=l.opacity(l.circle(x,b),y);i.addChild(l.centerAnchor(l.tint(l.bmpText(r,g,m),"white"))),t[e]=i}function P(t,e){let r=t.m5.touch;return t.m5.touch=function(i,s){s?h.setKeyOn(e):h.setKeyOff(e),r&&r.call(t.m5,s)},t}g=g||r.DOKI_LOWER,m=(m||48)*u,x=(x||64)*u,y=y??.5,b=b??"grey",t.fontName=g,t.fontSize=m,t.radius=x,t.alpha=y,t.color=b,n=[e,e],o=[e,e],i={},(t.right??1)&&A(i,"right",E||">"),(t.left??1)&&A(i,"left",w||"<"),(t.up??1)&&A(i,"up",S||"+"),(t.down??1)&&A(i,"down",T||"-"),t.fire&&A(i,"fire",v||"^"),t.southpaw?(i.left&&(n[0]=i.left),i.right&&(n[0]?n[1]=i.right:n[0]=i.right),n[0]&&s.set(n[0],c*n[0].width,p-c*n[0].height),n[1]&&l.pinRight(n[0],n[1],n[0].width/3),i.up&&(o[0]=i.up),i.down&&(o[0]?o[1]=i.down:o[0]=i.down),o[0]&&s.set(o[0],d-c*o[0].width,p-c*o[0].height),o[1]&&l.pinLeft(o[0],o[1],o[0].width/3)):(i.right&&(n[0]=i.right),i.left&&(n[0]?n[1]=i.left:n[0]=i.left),n[0]&&s.set(n[0],d-c*n[0].width,p-c*n[0].height),n[1]&&l.pinLeft(n[0],n[1],n[0].width/3),i.up&&(o[0]=i.up),i.down&&(o[0]?o[1]=i.down:o[0]=i.down),o[0]&&s.set(o[0],c*o[0].width,p-c*o[0].height),o[1]&&l.pinRight(o[0],o[1],o[0].width/3)),i.fire&&(o[0]?l.pinAbove(o[0],i.fire,o[0].height/3):s.set(i.fire,c*i.fire.width,p-c*i.fire.height)),a=_?_(i):i,a.right&&(this.insert(h[f](a.right)),a.right.m5.hotspot&&P(a.right,h.RIGHT)),a.left&&(this.insert(h[f](a.left)),a.left.m5.hotspot&&P(a.left,h.LEFT)),a.up&&(this.insert(h[f](a.up)),a.up.m5.hotspot&&P(a.up,h.UP)),a.down&&(this.insert(h[f](a.down)),a.down.m5.hotspot&&P(a.down,h.DOWN)),a.fire&&(this.insert(h[f](a.fire)),a.fire.m5.hotspot&&P(a.fire,h.SPACE)),t.extra?.(this,t)}}),r.Scenes.scene("AudioIcon",{setup(t){let{cb:e,iconOn:i,iconOff:n}=t,{xOffset:o,yOffset:a,xScale:l,yScale:h}=t,{Sound:u}=r,c=r.getScaleFactor(),d=r.Input.mkBtn(r.Sprites.spriteFrom(i||"boot/audioOn.png",n||"boot/audioOff.png"));l=l??c,h=h??c,a=a??0,o=o??-10*c,r.Sprites.scaleXY(r.Sprites.opacity(d,.343),l,h),s.set(d,r.width-d.width+o,0+a),d.m5.showFrame(u.sfx()?0:1),d.m5.press=()=>{u.sfx()?(u.mute(),d.m5.showFrame(1)):(u.unmute(),d.m5.showFrame(0))},this.insert(d)}}),r.Scenes.scene("SpaceWarp",{setup(t){let e=r.Sprites,i=this,s=0,n=0;function o(){this.g.warpSpeed=this.g.warpSpeed>0?0:1,i.future(o,t.interval)}a.patch(t,{count:1e3,interval:5e3}),a.inject(this.g,{stars:[],inWarp:!1,warpSpeed:0,interval:t.interval,init(){for(let r,s=0;s<t.count;++s)r={sprite:e.anchorXY(e.sprite("boot/star.png"),.5,.7),x:0,y:0,z:0},this.rand(r,!0),this.stars.push(r),i.insert(r.sprite)},rand(t,e){t.sprite.tint=a.rand()<.3?r.Sprites.SomeColors.yellow:r.Sprites.SomeColors.white;let i=Math.random()*Math.PI*2,n=50*Math.random()+1;t.x=Math.cos(i)*n,t.y=Math.sin(i)*n,t.z=e?2e3*Math.random():s+1e3*Math.random()+2e3},moveStars(t){const e=r.height/2,i=r.width,o=i/2;let a,l,h,u,c;n+=(this.warpSpeed-n)/20,s+=1e3*t*(n+.025),this.stars.forEach((t=>{t.z<s&&this.rand(t),c=t.z-s,t.sprite.x=t.x*(24/c)*i+o,t.sprite.y=t.y*(24/c)*i+e,h=t.sprite.x-o,u=t.sprite.y-e,a=Math.sqrt(h*h+u*u),l=Math.max(0,(2e3-c)/2e3),t.sprite.scale.x=.05*l,t.sprite.scale.y=.05*l+l*n*5*a/i,t.sprite.rotation=Math.atan2(u,h)+Math.PI/2}))}}),t.static||this.future((()=>{this.g.warpSpeed=1,t.repeat?i.future(o,t.interval):i.future((()=>{this.g.warpSpeed=0}),t.interval)}),t.delayMillis),this.g.init()},postUpdate(t){this.g.moveStars(t)},isBusy(){return this.g.inWarp},warp(){let t=this;this.g.inWarp||(this.g.inWarp=!0,this.g.warpSpeed=1,t.future((()=>{this.g.warpSpeed=0,t.g.inWarp=!1}),this.g.interval))}},{interval:3e3,count:1e3,delayMillis:343,repeat:!1}),r.Scenes.scene("StarfieldBg",{setup(t){const e=[],i=r.Sprites.graphics();a.patch(t,{height:r.height,width:r.width,count:100,minVel:15,maxVel:30}),a.inject(this.g,{gfx:i,stars:e,lag:0,dynamic:!0,fps:1/t.fps,draw(){return r.Sprites.gclear(i),e.forEach((t=>{r.Sprites.grect(i,t.x,t.y,t.size,t.size),r.Sprites.gfill(i,{color:a.rand()<.3?r.Sprites.SomeColors.yellow:r.Sprites.SomeColors.white})})),this},moveStars(r){this.lag+=r,this.lag>=this.fps&&(this.lag=0,e.forEach((e=>{e.y+=r*e.vel,e.y>t.height&&(s.set(e,a.randInt(t.width),0),e.size=a.randInt(4),e.vel=a.rand()*(t.maxVel-t.minVel)+t.minVel)})),this.draw())}}),t.static&&(this.g.dynamic=!1);for(let r=0;r<t.count;++r)e[r]={x:a.rand()*t.width,y:a.rand()*t.height,size:3*a.rand()+1,vel:a.rand()*(t.maxVel-t.minVel)+t.minVel};this.g.draw()&&this.insert(i)},postUpdate(t){this.g.dynamic&&this.g.moveStars(t)}},{fps:90,count:100,minVel:15,maxVel:30});const p={Periodic:class{#n;#o;#l;#a;#h;constructor(t,e,r=16){this.#n=e,this.#o=t,this.#l=0,this.#a=r,this.#h=a.fill(r,t)}lifeCycle(t){this.#l+=t,this.#l>this.#n&&(this.#l=0,this.discharge())}discharge(){throw"Periodic: please implement action()"}reclaim(t){this.#h.length<this.#a&&this.#h.push(t)}take(){return this.#h.length>0?this.#h.pop():this.#o()}},Meander:function(t){function i(t,e,i,s){e.impact=l(i),r.emit([s,t],e)}const n=[],o={dispose(){r.off(o)},boom(o){if(a.assert(o.A===t,"got hit by someone else???"),o.B&&o.B.m5.sensor)r.emit(["bump.sensor",o.B],o.A);else{let[n,a]=t.m5.vel;o.impact=e,s.sub$(t,o.overlapV),o.overlapN[1]<-.3?(a<0&&!t.m5.skipHit&&s.setY(t.m5.vel,0),i(t,o,a,"bump.top")):o.overlapN[1]>.3&&(a>0&&!t.m5.skipHit&&s.setY(t.m5.vel,0),i(t,o,a,"bump.bottom")),o.overlapN[0]<-.3?(n<0&&!t.m5.skipHit&&s.setX(t.m5.vel,0),i(t,o,n,"bump.left")):o.overlapN[0]>.3&&(n>0&&!t.m5.skipHit&&s.setX(t.m5.vel,0),i(t,o,n,"bump.right")),o.impact===e?o.impact=0:r.emit(["bump.*",t],o)}n.push(o)}};return r.on(["hit",t],"boom",o),r.on(["post.remove",t],"dispose",o),function(i){return n.length=0,r.Sprites.move(t,i)&&t.parent.collideXY(t),n.length>0?n[0]:e}},Camera:function(t,e,i,s){const n=s?.height??i,l=s?.width??e,h=c(n/2),u=c(l/2),d=c(n/4),p=c(l/4);let f=0,g=0,m={dispose(){r.off(m)},set x(e){f=e,t.x=-f},set y(e){g=e,t.y=-g},get x(){return f},get y(){return g},worldHeight:i,worldWidth:e,width:l,height:n,follow(t){const s=a.feq0(t.angle)?r.Sprites.getAABB(t):r.Sprites.boundingBox(t);s.x1<this.x+c(u-p)&&(this.x=s.x1-p),s.x2>this.x+c(u+p)&&(this.x=s.x2-3*p),s.y1<this.y+c(h-d)&&(this.y=s.y1-d),s.y2>this.y+c(h+d)&&(this.y=s.y2-3*d),this.x<0&&(this.x=0),this.y<0&&(this.y=0),this.x+l>e&&(this.x=e-l),this.y+n>i&&(this.y=i-n);let{x1:o,x2:f,y1:g,y2:m}=t.m5.getImageOffsets(),_=s.x2-f;return _>e&&(t.x-=_-e),_=s.y2-m,_>i&&(t.y-=_-i),_=s.x1+o,_<0&&(t.x+=-_),_=s.y1+g,_<0&&(t.y+=-_),t},centerOver:function(t,e){if(1!=arguments.length||o.num(t))o.num(t)&&(this.x=t-u),o.num(e)&&(this.y=e-h);else{const e=r.Sprites.centerXY(t);this.x=e[0]-u,this.y=e[1]-h}return t}};return r.on(["post.remove",t],"dispose",m),m},Patrol:function(t,e,i){const n={dispose(){r.off(n)},goLeft(e){t.m5.heading=r.LEFT,t.m5.flip="x",s.setX(t.m5.vel,-e.impact)},goRight(e){t.m5.heading=r.RIGHT,t.m5.flip="x",s.setX(t.m5.vel,e.impact)},goUp(e){s.setY(t.m5.vel,-e.impact),t.m5.heading=r.UP,t.m5.flip="y"},goDown(e){s.setY(t.m5.vel,e.impact),t.m5.heading=r.DOWN,t.m5.flip="y"}};return e&&(r.on(["bump.right",t],"goLeft",n),r.on(["bump.left",t],"goRight",n)),i&&(r.on(["bump.top",t],"goDown",n),r.on(["bump.bottom",t],"goUp",n)),r.on(["post.remove",t],"dispose",n),n},Jitter:function(t,i,n){i=i??-300,n=n??r.Input.UP;let o=0,a=0,l=i/3;const h={onGround(){a=.06666666666666667},dispose(){r.off(h)}};return r.on(["bump.bottom",t],"onGround",h),function(h,u){if(!t.m5.skipHit){let c=t.m5.speed,d=r.Input.keyDown(r.Input.RIGHT),p=r.Input.keyDown(r.Input.LEFT),f=r.Input.keyDown(n);u&&(p||d||a>0)&&(u.overlapN[1]>.85||u.overlapN[1]<-.85)&&(u=e),p&&!d?(t.m5.heading=r.LEFT,u&&a>0?s.set(t.m5.vel,c*u.overlapN[1],-c*u.overlapN[0]):s.setX(t.m5.vel,-c)):d&&!p?(t.m5.heading=r.RIGHT,u&&a>0?s.set(t.m5.vel,-c*u.overlapN[1],c*u.overlapN[0]):s.setX(t.m5.vel,c)):s.setX(t.m5.vel,0),a>0&&0==o&&f?(s.setY(t.m5.vel,i),o+=1,a=-h):f&&o<2&&(o+=1,r.emit(["jump",t])),o&&!f&&(o=0,r.emit(["jumped",t]),t.m5.vel[1]<l&&(t.m5.vel[1]=l)),a>0&&(t.m5.vel[1]=0)}a-=h}},MazeRunner:function(t,e){return function(i,n){let[l,h]=t.m5.vel,u=t.m5.speed,c=!a.feq0(l),d=!a.feq0(h);c&&d||!e||(d&&(o.obj(e)?t.m5.showFrame(e[h>0?r.DOWN:r.UP]):e&&(t.angle=h>0?180:0)),c&&(o.obj(e)?t.m5.showFrame(e[l>0?r.RIGHT:r.LEFT]):e&&(t.angle=l>0?90:-90)));let p=r.u.touchOnly,f=p?t.m5.heading==r.RIGHT:r.Input.keyDown(r.Input.RIGHT)&&r.RIGHT,g=p?t.m5.heading==r.LEFT:r.Input.keyDown(r.Input.LEFT)&&r.LEFT,m=p?t.m5.heading==r.UP:r.Input.keyDown(r.Input.UP)&&r.UP,_=p?t.m5.heading==r.DOWN:r.Input.keyDown(r.Input.DOWN)&&r.DOWN;(g||m)&&(u*=-1),g&&f?s.setX(t.m5.vel,0):(g||f)&&(t.m5.heading=g||f,s.setX(t.m5.vel,u)),m&&_?s.setY(t.m5.vel,0):(m||_)&&(t.m5.heading=m||_,s.setY(t.m5.vel,u))}},seek(t,e){const r=s.unit$(s.sub(e,t));return r&&(s.mul$(r,t.m5.maxSpeed),s.sub$(r,t.m5.vel),s.add$(t.m5.steer,r)),t},flee(t,e,r){let i=s.sub(t,e),n=s.len2(i);return void 0===r&&(r=t.m5.steerInfo.tooCloseDistance),n>r*r||(s.unit$(i)||(i=[.1,.1]),s.mul$(i,t.m5.maxSpeed),s.sub$(i,t.m5.vel),s.add$(t.m5.steer,i)),t},arrive(t,e,r){let i=1,n=s.dist(t,e),o=s.unit$(s.sub(e,t));return void 0===r&&(r=t.m5.steerInfo.arrivalThreshold),n>r||(i=n/r),s.mul$(o,t.m5.maxSpeed*i),s.sub$(o,t.m5.vel),s.add$(t.m5.steer,o),t},pursue(t,e){return this.seek(t,s.add(e,s.mul(e.m5.vel,s.dist(t,e)/t.m5.maxSpeed)))},evade(t,e){return this.flee(t,s.sub(e,s.mul(e.m5.vel,s.dist(t,e)/t.m5.maxSpeed)))},idle:t=>(s.mul$(t.m5.vel,0),s.mul$(t.m5.steer,0),t),wander(t){let e=s.mul$([1,1],t.m5.steerInfo.wanderRadius),r=s.len(e),i=s.mul$(s.unit(t.m5.vel),t.m5.steerInfo.wanderDistance);return e[0]=Math.cos(t.m5.steerInfo.wanderAngle)*r,e[1]=Math.sin(t.m5.steerInfo.wanderAngle)*r,t.m5.steerInfo.wanderAngle+=a.rand()*t.m5.steerInfo.wanderRange-.5*t.m5.steerInfo.wanderRange,s.add$(t.m5.steer,s.add$(i,e)),t},interpose(t,e,r){let i=s.div$(s.add(e,r),2),n=s.dist(t,i)/t.m5.maxSpeed,o=s.add(e,s.mul(e.m5.vel,n)),a=s.add(r,s.mul(r.m5.vel,n));return this.seek(t,s.div$(s.add$(o,a),2))},separation(t,e,r=300,i=100){let n=[0,0],o=0;return e.forEach((e=>{e!==t&&s.dist(e,t)<r&&(s.add$(n,s.sub(e,t)),++o)})),o>0&&s.flip$(s.div$(n,o)),s.add$(t.m5.steer,s.mul$(s.unit$(n),i)),t},followLeader(t,e,r,i=400,n=300,o=100,a=1600,l=200){let h,u=s.mul$(s.unit(e.m5.vel),i),c=s.add(e,u);return s.flip$(u),h=s.add(e,u),function(t,e,r,i){return s.dist(r,t)<i||s.dist(e,t)<i}(t,e,c,a)&&this.evade(t,e),this.arrive(t,h,l),this.separation(t,r,n,o)},queue(t,e,r=500,i=500){let n=function(){let n,o=s.mul$(s.unit(t.m5.vel),r),a=s.add(t,o);for(let r=0;r<e.length;++r)if(e[r]!==t&&s.dist(a,e[r])<i){n=e[r];break}return n}(),o=[0,0],a=s.mul(t.m5.vel,1);return n&&(o=s.mul$(s.flip(t.m5.steer),.8),s.unit$(s.flip$(a)),s.add$(o,a),s.dist(t,n)<i&&s.mul$(t.m5.vel,.3)),s.add$(t.m5.steer,o),t},flock(t,e){let r=0,i=[0,0],n=s.mul(t.m5.vel,1);return e.forEach((e=>{e!==this&&function(e){return!(s.dist(t,e)>t.m5.steerInfo.inSightDistance||s.dot(s.sub(e,t),s.unit(t.m5.vel))<0)}(e)&&(s.add$(n,e.m5.vel),s.add$(i,e),s.dist(t,e)<t.m5.steerInfo.tooCloseDistance&&this.flee(t,e),++r)})),r>0&&(s.div$(n,r),s.div$(i,r),this.seek(t,i),s.add$(t.m5.steer,s.sub$(n,t.m5.vel))),t},followPath(t,e,r,i=1){let n=e[t.m5.pathIndex];if(n)return s.dist(t,n)<i&&(t.m5.pathIndex>=e.length-1?r&&(t.m5.pathIndex=0):t.m5.pathIndex+=1),t.m5.pathIndex>=e.length-1&&!r?this.arrive(t,n):this.seek(t,n),t},avoid(t,e){let r,i=null,n=s.len(t.m5.vel)/t.m5.maxSpeed,o=s.add(t,s.mul$(s.unit(t.m5.vel),n)),a=s.add(t,s.mul$(s.unit(t.m5.vel),.5*t.m5.steerInfo.avoidDistance));for(let r,n=0;n<e.length;++n)e[n]!==this&&(r=s.dist(e[n],o)<=e[n].m5.radius||s.dist(e[n],a)<=e[n].m5.radius,r&&(null===i||s.dist(t,e[n])<s.dist(t,i))&&(i=e[n]));return i&&(r=s.mul$(s.unit$(s.sub(o,i)),100),s.add$(t.m5.steer,r)),t},lineOfSight(t,e,s){let n=r.Sprites.centerXY(t),o=r.Sprites.centerXY(e);for(let t,e,a=0;a<s.length;++a)if(e=s[a],t=e.m5.circle?i.hitTestLineCircle(n,o,e.x,e.y,e.width/2):i.hitTestLinePolygon(n,o,i.bodyWrap(r.Sprites.toPolygon(e),e.x,e.y)),t[0])return!1;return!0},shoot(t,e,i,n,o,a){const l=n(),h=r.Sprites.topLeftOffsetXY(t);return s.add$(h,[o,a]),s.copy(l,s.add(t,h)),s.set(l.m5.vel,Math.cos(e)*i,Math.sin(e)*i),l},healthBar(t){let{scale:e,width:i,height:s,lives:n,borderWidth:o,line:a,fill:l}=t,h=4*e,u=4*e,d=[];o=(o||4)*e,n=n||3,l=r.Sprites.color(l),a=r.Sprites.color(a);for(let t=c(i/n),e=0;e<n;++e)d.push(r.Sprites.rect(t,s-2*o,l));return{dec(){return this.lives>0&&(this.lives-=1,d[this.lives].visible=!1),this.lives>0},lives:d.length,sprite:r.Scenes.layoutX(d,{bg:["#cccccc",0],borderWidth:o,border:a,padding:h,fit:u})}},gaugeUI(t){let{minDeg:e,maxDeg:i,line:s,gfx:o,scale:l,cx:c,cy:p,radius:f,alpha:g,fill:m,needle:_}=a.patch(t,{minDeg:90,maxDeg:360});const x=[0,45*d,90*d,135*d,180*d,225*d,270*d,315*d];function y(t,e,r,i){return[t+r*h(i),e+r*u(i)]}return _=r.Sprites.color(_),s=r.Sprites.color(s),m=r.Sprites.color(m),f*=l,{gfx:o,draw(){r.Sprites.gclear(o),r.Sprites.gcircle(o,c,p,f),r.Sprites.gfill(o,{color:m,alpha:g}),r.Sprites.gstroke(o,{width:f/8,color:s}),x.forEach((t=>function(t,e,i,n){let[a,h]=y(t,e,f-4*l,i),[u,c]=y(t,e,f-12*l,i);r.Sprites.gpath(o,[["moveTo",a,h],["lineTo",u,c],["closePath"]]),r.Sprites.gstroke(o,{color:s,width:n,cap:"round"})}(c,p,t,7*l))),function(t,e,i){let[n,a]=y(c,p,t-20*l,i),[h,u]=y(c,p,2*l,i+90*d),[f,g]=y(c,p,2*l,i-90*d);r.Sprites.gpath(o,[["moveTo",h,u],["lineTo",n,a],["lineTo",f,g],["closePath"]]),r.Sprites.gstroke(o,{cap:"round",width:4*l,color:_}),r.Sprites.gcircle(o,c,p,9*l),r.Sprites.gfill(o,{color:s}),r.Sprites.gstroke(o,{color:s})}(f*l,0,d*n.lerp(e,i,t.update()))}}}};return r.Ute2D=p}if("object"==typeof module&&module.exports)throw"Panic: browser only";t["io/czlab/mojoh5/Ute2D"]=t=>t.Ute2D?t.Ute2D:r(t)}(this),function(t,e){"use strict";if(!t.AudioContext)throw"Fatal: no audio.";function r(r,i){const{ute:s,is:n}=r,o=(Math.floor,new Map);let a=1;function l(t,n,l){let h=0,u=1;const c={sids:s.jsMap(),buffer:e,loop:!1,src:l,name:n,get pan(){return h},set pan(t){h=t},get vol(){return u},set vol(t){u=t},play(){const e=s.now(),i=this.name;if(r.Sound.sfx()&&!function(t,e,r){let i;return o.has(t)&&o.get(t)>e?i=!0:o.delete(t),i}(i,e)){let e=a++,r=1e3*this.buffer.duration,i=t.ctx.createGain(),n=t.ctx.createStereoPanner(),o=t.ctx.createBufferSource();o.buffer=this.buffer,o.connect(i),i.connect(n),n.connect(t.ctx.destination),this.loop?o.loop=!0:s.delay(r,(()=>this.sids.delete(e))),n.pan.value=h,i.gain.value=u,o.start(0),this.sids.set(e,o)}return this},stop(){return this.sids.forEach((t=>t.stop(0))),this.sids.length=0,this}};return i[n]=c}const h={ctx:new t.AudioContext,_mute:0,init(){s.delay(0,(()=>{"suspended"==this.ctx.state&&this.ctx.resume()}))},sfx(){return 0==this._mute},mute(){return(this._mute=1)&&this},unmute(){return(this._mute=0)||this},decodeData(t,e,r,i,s){let n=l(this,t,e);return this.ctx.decodeAudioData(r,(t=>{i(n.buffer=t)}),(t=>{s&&s(e,t)})),n},decodeUrl(t,e,r,i){let s=new XMLHttpRequest,n=l(this,t,e);return s.open("GET",e,!0),s.responseType="arraybuffer",s.addEventListener("load",(()=>{this.decodeData(e,s.response,r,i)})),s.send(),n}};return r.sound=function(t,n=!0){return i[t||r.assetPath(t)]||(n?s.assert(!1,`Sound: ${t} not loaded.`):e)},r.Sound=h}if("object"==typeof module&&module.exports)throw"Panic: browser only";t["io/czlab/mojoh5/Sound"]=function(t){return t.Sound?t.Sound:r(t,{})}}(this),function(t,e){"use strict";function r(r){const i=t["io/czlab/mcfud/geo2d"](),{math:s,v2:n,ute:o,is:a}=r,l=["ctrlKey","altKey","shiftKey"],h=[],u=()=>h[0];function c(t){function s(e,r,i){t===u()&&((r=t.keyInputs.get(e.keyCode))||t.keyInputs.set(e.keyCode,r={}),r.state=i,o.copyKeys(r,e,l),e.preventDefault())}const h=["keyup",globalThis,function(t,e){s(t,e,!1)},!1],c=["keydown",globalThis,function(t,e){s(t,e,!0)},!1];return r.touchDevice||o.addEvent([h,c]),o.inject(t,{yid:`yid#${o.nextId()}`,keyInputs:o.jsMap(),pauseInput:!1,ptr:e,dispose(){this.ptr.dispose(),r.touchDevice||o.delEvent([h,c])},pointer(){return this.ptr||(this.ptr=function(t){let s={Actives:{DragsID:o.jsMap(),Touches:o.jsMap(),reset(){this.DragsID.clear(),this.Touches.clear()}},Hotspots:[],Buttons:[],DragDrops:[],state:[!1,!0],touchZeroID:e,_visible:!0,_x:0,_y:0,width:1,height:1,downTime:0,downAt:[0,0],elapsedTime:0,dragged:e,dragOffsetX:0,dragOffsetY:0,anchor:r.makeAnchor(.5,.5),get cursor(){return r.canvas.style.cursor},set cursor(t){r.canvas.style.cursor=t},get x(){return this._x/r.scale},get y(){return this._y/r.scale},get visible(){return this._visible},get isUp(){return this.state[1]},get isDown(){return this.state[0]},set visible(t){this.cursor=t?"auto":"none",this._visible=t},_testTouchDragStart(t,e){for(let i,s,n=0;n<t.length;++n)if(s=t[n],e.get(s.id)||this.Actives.DragsID.get(s.id))e.set(s.id,1);else for(let t,n=this.DragDrops.length-1;n>=0;--n)if((t=this.DragDrops[n])&&t.m5.drag&&this._test(t,s.x,s.y)){i={dragged:t,id:s.id,dragPtrX:s.x,dragPtrY:s.y,dragStartX:t.x,dragStartY:t.y},this.Actives.DragsID.set(s.id,i),this.touchZeroID==s.id&&this._resetClickTap(),r.moveToTop(t),e.set(s.id,1);break}},_testMouseDragStart(){for(let t,e=this.DragDrops.length-1;e>=0;--e)if((t=this.DragDrops[e])&&t.m5.drag&&this.hitTest(t)){this.dragStartX=t.x,this.dragStartY=t.y,this.dragPtrX=this.x,this.dragPtrY=this.y,this.dragged=t,r.moveToTop(t);break}return this.dragged},_maybeUpdateMouseDrag(){this.state[0]&&this.dragged&&n.set(this.dragged,this.dragStartX+(this.x-this.dragPtrX),this.dragStartY+(this.y-this.dragPtrY))},_maybeEndMouseDrag(t=0){return this.state[1]&&this.dragged&&(this.dragged.m5.onDragDropped?.(),this.dragged=e,t=!0),t},getGlobalPosition(){return{x:this.x,y:this.y}},_press(){if(t!==u())return;let e,r,i,s=this.Buttons.length;for(e=0;e<s;++e)if(r=this.Buttons[e],r.m5.gui&&r.m5.press&&this.hitTest(r)){r.m5.press(r),i=!0;break}if(!i)for(e=0;e<s;++e)if(r=this.Buttons[e],r.m5.press&&this.hitTest(r)){r.m5.press(r);break}},_doMDown(e){if(t!==u())return;let r,i=s;for(let t,s=0;s<i.Hotspots.length;++s)if((t=i.Hotspots[s])&&t.m5.touch&&i.hitTest(t)){t.m5.touch(t,e),r=!0;break}return r},mouseDown(e){if(t!==u())return;let i=s,n=o.now();0==e.button&&(e.preventDefault(),i._x=e.pageX-e.target.offsetLeft,i._y=e.pageY-e.target.offsetTop,o.setVec(i.state,!0,!1),i.downTime=n,i.downAt[0]=i._x,i.downAt[1]=i._y,r.Sound.init(),t.pauseInput||(!i._testMouseDragStart()&&i._doMDown(!0),r.emit([`${t.yid}/mousedown`])))},mouseMove(e){if(t!==u())return;let i=s;i._x=e.pageX-e.target.offsetLeft,i._y=e.pageY-e.target.offsetTop,t.pauseInput||(i._maybeUpdateMouseDrag(),r.emit([`${t.yid}/mousemove`]))},mouseUp(e){if(t!==u())return;let i=s,a=o.now();if(0==e.button&&(e.preventDefault(),i.elapsedTime=Math.max(0,a-i.downTime),i._x=e.pageX-e.target.offsetLeft,i._y=e.pageY-e.target.offsetTop,o.setVec(i.state,!1,!0),!t.pauseInput)){if(i._maybeEndMouseDrag());else if(!i._doMDown(!1)){let e=n.vecAB(i.downAt,i),s=n.len2(e);s<400&&i.elapsedTime<200?(i._press(),r.emit([`${t.yid}/single.tap`])):i._swipeMotion(e,s,i.elapsedTime)}r.emit([`${t.yid}/mouseup`])}},_swipeMotion(e,i,s,o){if(t!==u())return;let a,l=n.unit$(n.normal(e));i>400&&s<1e3&&(Math.abs(l[0])>.8||Math.abs(l[1])>.8)&&(l[0]>.8&&(a="swipe.down"),l[0]<-.8&&(a="swipe.up"),l[1]>.8&&(a="swipe.left"),l[1]<-.8&&(a="swipe.right")),a&&r.emit([`${t.yid}/${a}`],o)},_doMTouch(e,r,i){if(t===u())for(let t,s=0;s<e.length;++s)if(t=e[s],!r.get(t.id))for(let e,s=0;s<this.Hotspots.length;++s)if((e=this.Hotspots[s])&&e.m5.touch&&this._test(e,t.x,t.y)){e.m5.touch(e,i),r.set(t.id,1);break}},touchCancel(e){if(o.log("received touchCancel event!"),t!==u())return;let r,i,n=s,a=e.changedTouches;for(i=0;i<a.length;++i)r=a[i],n.Actives.Touches.delete(r.id),n.Actives.DragsID.delete(r.id);0==n.Actives.Touches.size&&(n.Actives.DragsID.clear(),n._freeTouches())},touchStart(i){if(t!==u())return;let n=i.target,a=[],l=s,h=o.now(),c=o.jsMap(),d=i.targetTouches;i.preventDefault();for(let t,i,s,u,c,p,f=0;f<d.length;++f)p=d[f],c=p.identifier,s=p.pageX-n.offsetLeft,u=p.pageY-n.offsetTop,t={id:c,_x:s,_y:u,downTime:h,downAt:[s,u],x:s/r.scale,y:u/r.scale},i={id:c,_x:s,_y:u,downTime:h,downAt:[s,u],x:t.x,y:t.y},l.Actives.Touches.set(c,i),a.push(t),l.touchZeroID===e&&0==f&&(l.touchZeroID=c,l._x=s,l._y=u,l.downTime=h,l.downAt=[s,u],o.setVec(l.state,!0,!1));r.Sound.init(),t.pauseInput||(l._testTouchDragStart(a,c),l._doMTouch(a,c,!0),r.emit([`${t.yid}/touchstart`],a))},touchMove(e){if(t!==u())return;let i=s,o=[],a=e.target,l=e.changedTouches;e.preventDefault();for(let t,e,s,h,u,c,d,p,f=0;f<l.length;++f)d=l[f],p=d.identifier,(t=i.Actives.Touches.get(p))?(u=d.pageX-a.offsetLeft,c=d.pageY-a.offsetTop,s=u/r.scale,h=c/r.scale,p==i.touchZeroID&&(i._x=u,i._y=c),t.x=s,t.y=h,t._x=u,t._y=c,(t=i.Actives.DragsID.get(p))&&(t.x=s,t.y=h,t._x=u,t._y=c,e=t.dragged,n.set(e,t.dragStartX+(s-t.dragPtrX),t.dragStartY+(h-t.dragPtrY))),o.push({id:p,x:s,y:h,_x:u,_y:c})):r.warn(`move-no activetouch with id=${p}`);!t.pauseInput&&r.emit([`${t.yid}/touchmove`],o)},touchEnd(e){if(t!==u())return;let i,n,a,l,h,c,d=s,p=[],f=o.jsMap(),g=e.changedTouches,m=e.target,_=o.now();for(e.preventDefault(),a=0;a<g.length;++a)h=g[a],c=h.identifier,i=h.pageX-m.offsetLeft,n=h.pageY-m.offsetTop,c==d.touchZeroID&&(d.elapsedTime=Math.max(0,_-d.downTime),o.setVec(d.state,!1,!0),d._x=i,d._y=n),(l=d.Actives.Touches.get(c))?(l.elapsedTime=Math.max(0,_-l.downTime),l.x=i/r.scale,l.y=n/r.scale,l._x=i,l._y=n,p.push(o.clone(l))):r.warn(`end-no activetouch with id=${c}`);for(t.pauseInput||(d._maybeEndTouchDrag(p,f),d._doMTouch(p,f,!1),d._onEndMultiTouches(p,f),r.emit([`${t.yid}/touchend`],p)),a=0;a<g.length;++a)d.Actives.Touches.delete(g[a].identifier);0==d.Actives.Touches.size&&d._freeTouches()},_maybeEndTouchDrag(t,e){let r=this._x,i=this._y;for(let r,i,s,o=0;o<t.length;++o)s=t[o],(i=this.Actives.DragsID.get(s.id))&&(this.Actives.DragsID.delete(s.id),r=i.dragged,e.set(s.id,1),this._x=s._x,this._y=s._y,n.set(r,i.dragStartX+(s.x-i.dragPtrX),i.dragStartY+(s.y-i.dragPtrY)),r.m5.onDragDropped?.());this._x=r,this._y=i},_onEndMultiTouches(e,i){if(t===u())for(let s,o,a,l=0;l<e.length;++l)if(s=e[l],!i.get(s.id))if(o=n.vecAB(s.downAt,s),a=n.len2(o),a<400&&s.elapsedTime<200){for(let t,e=0,r=this.Buttons.length;e<r;++e)if((t=this.Buttons[e])&&t.m5.press&&this._test(t,s.x,s.y)){t.m5.press(t);break}this._x=s.downAt[0],this._y=s.downAt[1],r.emit([`${t.yid}/single.tap`],s)}else this._swipeMotion(o,a,s.elapsedTime,s)},_resetClickTap(){o.setVec(this.state,!1,!0),this.touchZeroID=e},_freeTouches(){this._resetClickTap(),this.Actives.reset()},reset(){this._freeTouches(),this.DragDrops.length=0,this.Buttons.length=0,this.Hotspots.length=0},_test(t,e,s){let o=r.Sprites,a=o.gposXY(t),l=o.toPolygon(t),h=n.translate(a,l.calcPoints);return i.hitTestPointInPolygon(e,s,h)},hitTest(t){return this._test(t,this.x,this.y)},update(t){}};const a=[["mousemove",r.canvas,s.mouseMove],["mousedown",r.canvas,s.mouseDown],["mouseup",globalThis,s.mouseUp]],l=[["touchmove",r.canvas,s.touchMove],["touchstart",r.canvas,s.touchStart],["touchend",globalThis,s.touchEnd],["touchcancel",globalThis,s.touchCancel]];return r.touchDevice?o.addEvent(l):o.addEvent(a),s.dispose=function(){this.reset(),r.touchDevice?o.delEvent(l):o.delEvent(a)},s}(this))},update(t){!this.pauseInput&&this.ptr.update(t)},keybd(e,i,s){const n={press:i,release:s};let l=!0,h=!1,c=this,d=a.vec(e)?e:[e];const p=["keyup",globalThis,function(e){t===u()&&(d.includes(e.keyCode)&&(!c.pauseInput&&h&&n.release?.(e.altKey,e.ctrlKey,e.shiftKey),l=!0,h=!1),e.preventDefault())},!1],f=["keydown",globalThis,function(e){t===u()&&(d.includes(e.keyCode)&&(!c.pauseInput&&l&&n.press?.(e.altKey,e.ctrlKey,e.shiftKey),l=!1,h=!0),e.preventDefault())},!1];return r.touchDevice||o.addEvent([p,f]),n.dispose=()=>{r.touchDevice||o.delEvent([p,f])},n},reset(){this.pauseInput=!1,this.ptr.reset(),this.keyInputs.clear()},resize(){(r.mouse=this.ptr).reset()},dbg(){o.log(`N# of hotspots= ${this.ptr.Hotspots.length}`),o.log(`N# of buttons= ${this.ptr.Buttons.length}`),o.log(`N# of drags= ${this.ptr.DragDrops.length}`),o.log(`Mouse pointer = ${this.ptr}`)}}),t.pointer()&&t}let d=!0;const p={LEFT:37,RIGHT:39,UP:38,DOWN:40,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,ENTER:13,ESC:27,BACKSPACE:8,TAB:9,SHIFT:16,CTRL:17,ALT:18,SPACE:32,HOME:36,END:35,PGGUP:33,PGDOWN:34,isPaused:()=>u().pauseInput,resume(){u().pauseInput=!1},pause(){u().pauseInput=!0},dbg(){u().dbg()},_cur:()=>u(),setMultiTouch(t){d=t},resize(){u().resize()},reset(){u().reset()},setKeyOn(t){let e=u().keyInputs.get(t);e||u().keyInputs.set(t,e={}),e.state=!0},setKeyOff(t){let e=u().keyInputs.get(t);e||u().keyInputs.set(t,e={}),e.state=!1},keybd:(t,e,r)=>u().keybd(t,e,r),undoButton:t=>(o.disj(u().ptr.Buttons,t),t.m5.button=!1,t),makeButton:(t,e=!1)=>(o.conj(u().ptr.Buttons,t),t.m5.button=!0,t.m5.gui=e,t),undoHotspot:t=>(o.disj(u().ptr.Hotspots,t),t.m5.hotspot=!1,t),makeHotspot:t=>(o.conj(u().ptr.Hotspots,t),t.m5.hotspot=!0,t),undoXXX(t){t&&t.m5&&(t.m5.drag&&this.undoDrag(t),t.m5.button&&this.undoButton(t),t.m5.hotspot&&this.undoHotspot(t))},update(t){u().update(t)},makeDrag:t=>(o.conj(u().ptr.DragDrops,t),t.m5.drag=!0,t),undoDrag:t=>(o.disj(u().ptr.DragDrops,t),t.m5.drag=!1,t),keyUp(t){return!this.keyDown(t)},keyDown(t){let r=u().keyInputs.get(t);return r&&r.state?r:e},pointer:()=>u().pointer(),dispose(){h.forEach((t=>t.dispose())),h.length=0},restore(){h.length>1&&(h.shift().dispose(),u().pauseInput=!1)},save(){h.unshift(c({}))},on:(...t)=>(o.assert(a.vec(t[0])&&a.str(t[0][0]),"bad arg for Input.on()"),t[0][0]=`${u().yid}/${t[0][0]}`,r.on(...t)),off:(...t)=>(o.assert(a.vec(t[0])&&a.str(t[0][0]),"bad arg for Input.off()"),t[0][0]=`${u().yid}/${t[0][0]}`,r.off(...t))};return r.canvas.style.touchAction="none",p.undoBtn=p.undoButton,p.mkBtn=p.makeButton,p.mkDrag=p.makeDrag,h.push(c({})),r.Input=p}if("object"==typeof module&&module.exports)throw"Panic: browser only";t["io/czlab/mojoh5/Input"]=function(t){return t.Input?t.Input:r(t)}}(this),function(t,e){"use strict";if("object"==typeof module&&module.exports)throw"Panic: browser only";t["io/czlab/mojoh5/Touch"]=function(t){return t.Touch?t.Touch:function(t){const e=Math.PI/8,r=3*e,i=5*e,s=7*e,{is:n,ute:o}=t,a=Math.sin,l=Math.cos,h=Math.abs,u=180/Math.PI;function c(n){let{Input:c}=t;function d(t){let e=t.target,r=t.changedTouches;r?(t=r[0],n.m5.touchId=r[0].identifier):n.m5.touchId=0,n.m5.startX=t.pageX-e.offsetLeft,n.m5.startY=t.pageY-e.offsetTop,n.m5.drag=!0,n.m5.static||(n.visible=!0,n.x=n.m5.startX,n.y=n.m5.startY),c.isPaused()||n.m5.onStart()}function p(t){n.m5.drag&&(n.m5.hdle.position.set(0,0),n.m5.drag=!1,n.m5.static||(n.visible=!1),c.isPaused()||n.m5.onEnd())}function f(d){if(c.isPaused()||!n.visible||!n.m5.drag)return;let p,f=d.target;if(d.changedTouches){for(let t=0,e=d.changedTouches;t<e.length;++t)if(n.m5.touchId==e[t].identifier){p=[e[t].pageX-f.offsetLeft,e[t].pageY-f.offsetTop];break}}else p=[d.pageX-f.offsetLeft,d.pageY-f.offsetTop];let g,m,_,x=0,y=p?p[0]-n.m5.startX:0,b=p?p[1]-n.m5.startY:0,v=n.m5.range;if(p[0]=0,p[1]=0,!o.feq0(y)||!o.feq0(b)){if(m=h(y),_=h(b),o.feq0(y))p[0]=0,b>0?(p[1]=b>v?v:b,x=270,g=t.DOWN):(p[1]=-(_>v?v:_),x=90,g=t.UP);else if(o.feq0(b))p[1]=0,y>0?(p[0]=m>v?v:m,x=0,g=t.RIGHT):(p[0]=-(m>v?v:m),x=180,g=t.LEFT);else{let n=Math.atan(h(b/y));x=n*u,p[0]=p[1]=0,y*y+b*b>=v*v?(p[0]=v*l(n),p[1]=v*a(n)):(p[0]=m>v?v:m,p[1]=_>v?v:_),b<0&&(p[1]=-h(p[1])),y<0&&(p[0]=-h(p[0])),y>0&&b<0||(y<0&&b<0?x=180-x:y<0&&b>0?x+=180:y>0&&b>0&&(x=360-x)),g=function(n,a){const l=Math.atan2(+a,+n);return l>-i&&l<-r?t.UP:l>r&&l<i?t.DOWN:l>-e&&l<0||l>0&&l<e?t.RIGHT:l>s&&l<Math.PI||l>-Math.PI&&l<-s?t.LEFT:l>e&&l<r?t.SE:l>i&&l<s?t.SW:l>-r&&l<-e?t.NE:l>-s&&l<-i?t.NW:void o.assert(!1,"Failed Joystick calcDir")}(p[0],p[1])}n.m5.hdle.position.set(p[0],p[1]),n.m5.onChange(g,x)}}const g=[["mousemove",t.canvas,f],["mousedown",t.canvas,d],["mouseup",globalThis,p],["touchend",globalThis,p],["touchcancel",globalThis,p],["touchmove",t.canvas,f],["touchstart",t.canvas,d]];return o.addEvent(g),n.m5.dispose=()=>{o.delEvent(g)},n}const d={assets:["boot/joystick.png","boot/joystick-handle.png"],joystick(e){let{Sprites:r}=t,i=r.sprite("boot/joystick-handle.png"),s=r.sprite("boot/joystick.png"),n=r.container(),a=t.getScaleFactor(),l=o.inject({oscale:.7*a,iscale:1*a,hdle:i,schtick:s,onEnd(){},onStart(){},prevDir:0,static:!1,onChange(t,e){}},e);return n.addChild(r.centerAnchor(r.scaleXY(s,l.oscale,l.oscale))),n.addChild(r.centerAnchor(r.scaleXY(i,l.iscale,l.iscale))),l.range=n.width/2.5,l.static||(n.visible=!1),o.inject(n.m5,l),c(n)}};return t.Touch=d}(t)}}(this),function(t,e){"use strict";if("object"==typeof module&&module.exports)throw"Panic: browser only";t["io/czlab/mojoh5/Tiles"]=function(t){return t.Tiles?t.Tiles:function(t){const e=[t.UP,t.LEFT,t.RIGHT,t.DOWN],{ute:r,is:i,v2:s,math:n}=t,o=Math.abs,a=Math.ceil,l=Math.floor;function h(t,e,i){return s=t,n=e,o=i.tiled.tileW,a=i.tiled.tileH,h=i.tiled.tilesInX,s>=0&&n>=0?l(s/o)+l(n/a)*h:r.assert(!1,`IndexError: ${s},${n}, wanted +ve values`);var s,n,o,a,h}function u(e,r){return s.vecAB(t.Sprites.centerXY(e),t.Sprites.centerXY(r))}function c(t){const e=t.image?.split("/");t.image=e&&e.length&&e[e.length-1]}function d(t,e,i){const s=[];return t.forEach((t=>{s.push([t.firstgid,t]),t.spacing||(t.spacing=0),c(t);const n={};(t.tiles||[]).forEach((e=>{let s=r.selectNotKeys(e,"properties");s=r.inject(s,p(e)),s.gid=t.firstgid+e.id,n[e.id]=s,i[s.gid]=s})),e[t.name]=n})),s.sort(((t,e)=>t[0]>e[0]?1:t[0]<e[0]?-1:0))}function p(t){return(t.properties||[]).reduce(((t,e)=>(t[e.name]=e.value,t)),{})}function f(e,s,o){let a={},h={},u=i.str(s)?function(e){let i=t.resource(e,!0),s=i&&(i.tiledversion||i.version);return s&&r.cmpVerStrs(s,"1.4.2")>=0?i:r.assert(!1,`${e} needs update`)}(s):s;r.assert(i.obj(u),"bad tiled map"),u=JSON.parse(JSON.stringify(u)),r.inject(e.tiled,{tileW:u.tilewidth,tileH:u.tileheight,tilesInX:u.width,tilesInY:u.height,tiledMap:u,saved_tileW:u.tilewidth,saved_tileH:u.tileheight,tiledWidth:u.tilewidth*u.width,tiledHeight:u.tileheight*u.height},p(u));let f=e.getScaleFactor(),m=r.evenN(f*u.tileheight),_=r.evenN(f*u.tilewidth);e.tiled.new_tileW=_,e.tiled.new_tileH=m;const x={imagelayer(t){c(t)},tilelayer(t){i.vec(t.data[0])&&(t.width=t.data[0].length,t.height=t.data.length,t.data=t.data.flat()),t.width||(t.width=e.tiled.tilesInX),t.height||(t.height=e.tiled.tilesInY);let r,s=p(t);if(!1!==t.visible)for(let r,i=0;i<t.data.length;++i){if(0==(r=t.data[i]))continue;!1===t.collision||!1===s.collision||!0!==t.collision&&!0!==s.collision||(r>0&&(e.tiled.collision[i]=r),t.collision=!0);let n=i%t.width,a=l(i/t.width),u=h[r],c=u&&u.Class,d=c&&o[c],p=e.getTSInfo(r),f=g(e,r,n,a,s.width,s.height);f&&(f.tiled.layer=t,f.tiled.index=i,f.m5.static=!0),d&&(f=d.c(e,f,p,u)),f&&(e.insert(f,!!d),u&&u.sensor&&(f.m5.sensor=!0))}else(r=s.Class)&&o[r](e,t)},objectgroup(t){t.sprites=[],t.objects.forEach((s=>{r.assert(i.num(s.x),"wanted xy position");let a,l,u=p(s),c=s.gid??-1;r.inject(s,u),c>0&&(l=h[c]);let d=r.nor(l&&l.Class,s.Class),f=d&&o[d],x=e.tiled.saved_tileW,y=e.tiled.saved_tileH,b=n.ndiv(s.x+x/2,x),v=n.ndiv(s.y-y/2,y),T=e.getTSInfo(c);s.column=b,s.row=v,a=c<=0?{width:_,height:m}:g(e,c,b,v,s.width,s.height,d),f&&(a=f.c(e,a,T,l,s)),a&&(!1===s.visible&&(a.visible=!1),s.uuid=a.m5.uuid,t.sprites.push(a),e.insert(a,!0),l&&l.sensor&&(a.m5.sensor=!0))}))}};o=o??{},r.inject(e.tiled,{objFactory:o,tileSets:a,tileProps:h,collision:r.fill(u.width*u.height,0),imagelayer:[],objectgroup:[],tilelayer:[],tileGidList:d(u.tilesets,a,h)}),["imagelayer","tilelayer","objectgroup"].forEach((t=>{u.layers.filter((e=>e.type==t)).forEach((r=>{x[t](r),e.tiled[t].push(r)}))})),e.tiled.tileW=_,e.tiled.tileH=m,e.tiled.tiledWidth=_*u.width,e.tiled.tiledHeight=m*u.height,e.parent instanceof t.Scenes.SceneWrapper&&(e.tiled.tiledHeight<t.height&&(e.parent.y=n.ndiv(t.height-e.tiled.tiledHeight,2)),e.tiled.tiledWidth<t.width&&(e.parent.x=n.ndiv(t.width-e.tiled.tiledWidth,2)))}function g(e,s,o,a,h,u,c){let d,p=e.getTSInfo(s,!0),f=p.columns,g=s-p.firstgid,m=e.tiled.tileProps[s],_=e.getScaleFactor();d=(c=c??(m&&m.Class))&&e.tiled.objFactory[c],r.assertNot(g<0,`Bad tile id: ${g}`),i.num(f)||(f=n.ndiv(p.imagewidth,p.tilewidth+p.spacing));let x=g%f,y=l(g/f),b=x*p.tilewidth,v=y*p.tileheight;p.spacing>0&&(b+=p.spacing*x,v+=p.spacing*y);let T=d&&d.s(e)||t.Sprites.frame(p.image,h||p.tilewidth,u||p.tileheight,b,v);return T&&(T.tiled={id:g,gid:s},h==e.tiled.saved_tileW?T.width=e.tiled.new_tileW:(T.scale.x=_,T.width=r.evenN(T.width)),u==e.tiled.saved_tileH?T.height=e.tiled.new_tileH:(T.scale.y=_,T.height=r.evenN(T.height)),T.x=o*e.tiled.new_tileW,T.y=a*e.tiled.new_tileH),T}const m=t.Sprites.lift({width:0,height:0,parent:null,x:0,y:0,rotation:0,tiled:{},anchor:{x:0,y:0},getGlobalPosition(){return{x:this.x+this.parent.x,y:this.y+this.parent.y}}});class _ extends t.Scenes.Scene{constructor(t,e,r){super(t,e,r),this.tiled={}}reloadMap(t){this.tiled={},this.m5.options.tiled=t,f(this,t.name,t.factory)}runOnce(){const t=this.m5.options.tiled;this.preTMX?.(t),f(this,t.name,t.factory),this.postTMX?.(t),super.runOnce()}removeTile(e,r){let{x:i,y:s}=r;r.anchor.x<.3&&(s=r.y+l(r.height/2),i=r.x+l(r.width/2));let n=l(i/this.tiled.tileW),o=l(s/this.tiled.tileH),a=this.getTileLayer(e),h=n+o*this.tiled.tilesInX;a.data[h]=0,a.collision&&(this.tiled.collision[h]=0),t.Sprites.remove(r)}getTileLayer(t,e){const i=r.some(this.tiled.tilelayer,(e=>{if(e.name==t)return e}));if(!i&&e)throw`There is no layer with name: ${t}`;return i}getObjectGroup(t,e){const i=r.some(this.tiled.objectgroup,(e=>{if(e.name==t)return e}));if(!i&&e)throw`There is no group with name: ${t}`;return i}setTile(t,e,r,i){let s,n=this.getTSInfo(i,!0),o=(n.firstgid,this.getTileLayer(t)),a=r+this.tiled.tilesInX*e;return o.collision&&(this.tiled.collision[a]=i),s=g(this,i,r,e,n.tilewidth,n.tileheight),s&&(s.tiled.index=a,s.tiled.layer=o),s}getTile(t){let{x:e,y:r}=t;return t.anchor.x<.3&&(r+=l(t.height/2),e+=l(t.width/2)),this.getTileXY(e,r)}getTileXY(t,e){let i=l(t/this.tiled.tileW),s=l(e/this.tiled.tileH);return r.assert(i>=0&&i<this.tiled.tilesInX,`bad tile col:${i}`),r.assert(s>=0&&s<this.tiled.tilesInY,`bad tile row:${s}`),[i,s]}getNamedItem(t){const e=[];return this.tiled.objectgroup.forEach((i=>{i.objects.forEach((i=>{t==r.get(i,"name")&&e.push(i)}))})),e}getScaleFactor(){let e=t.height/(this.tiled.saved_tileH*this.tiled.tilesInY),r=t.width/(this.tiled.saved_tileW*this.tiled.tilesInX),i=1;return"max"==t.u.scaleToWindow&&(i=r<e?r:e),i}getTileIndex(e){let[r,i]=t.Sprites.centerXY(e);return h(r,i,this)}getTSInfo(t,e){const i=function(t,e){let r=-1;if(t>0)for(r=0;e[r+1]&&t>=e[r+1][0];)++r;return r>=0?e[r]:[]}(t,this.tiled.tileGidList)[1];return!i&&e?r.assert(!1,`Bad GID ${t}, no tileset`):i}getTileProps(t){return this.tiled.tileProps[t]}_getContactObj(t,e,r){let i=m;return i.height=this.tiled.tileH,i.width=this.tiled.tileW,i.x=e*i.width,i.y=r*i.height,i.tiled.gid=t,i.tiled.row=r,i.tiled.col=e,i.m5.sensor=!1,i}collideXY(e){let s=t.Sprites,n=this.tiled.tileW,o=this.tiled.tileH,h=this.tiled.collision,u=r.feq0(e.angle)?s.getAABB(e):s.boundingBox(e),c=Math.max(0,l(u.x1/n)),d=Math.max(0,l(u.y1/o)),p=Math.min(this.tiled.tilesInX-1,a(u.x2/n)),f=Math.min(this.tiled.tilesInY-1,a(u.y2/o));for(let n,o,a,l,u=d;u<=f;++u)for(let d=c;d<=p;++d)a=u*this.tiled.tilesInX+d,o=h[a],r.assert(i.num(o),"bad gid"),0!=o&&(l=this._getContactObj(o,d,u),n=this.getTileProps(o),n&&(l.m5.sensor=!!n.sensor),l.parent=this,s.hit(e,l)&&l.m5.sensor&&t.emit(["bump.sensor",e],l));return super.collideXY(e)}}class x{constructor(t,e){this.straightCost=t,this.diagonalCost=e}manhattan(t,e){return o(t.row-e.row)*this.straightCost+o(t.col-e.col)*this.straightCost}euclidean(t,e){let i=e.col-t.col,s=e.row-t.row;return l(r.sqrt(i*i+s*s)*this.straightCost)}diagonal(t,e){let r=o(e.col-t.col),i=o(e.row-t.row);return l(r>i?this.diagonalCost*i+this.straightCost*(r-i):this.diagonalCost*r+this.straightCost*(i-r))}}const y={TiledScene:_,neighborCells(t,e,r){let i=e.tiled.tilesInX,s=[t-i-1,t-i,t-i+1,t-1],n=[t+1,t+i-1,t+i,t+i+1];return r||s.push(t),s.concat(n)},updateMap(t,e,s){let n=r.fill(t.length,0),o=t=>{let e=this.getTileIndex(t,s);r.assert(e>=0&&e<n.length,"tiled index outofbound"),t.tiled.index=e,n[e]=t.tiled.gid};return i.vec(e)?e.forEach(o):o(e),n},shortestPath(t,e,r,i,s=[],n="manhattan",o=!0){let a=i.tiled.tilesInX,h=r.map(((t,e)=>({f:0,g:0,h:0,parent:null,index:e,col:e%a,row:l(e/a)}))),u=h[e],c=h[t],d=c,p=[d],f=[],g=[],m=t=>(o?this.neighborCells(t,i,!0):this.crossCells(t,i)).map((t=>h[t])).filter((e=>{if(e){let i=t%a==0,n=(t+1)%a==0,o=e.col%(a-1)==0&&0!=e.col,l=e.col%a==0,h=s.some((t=>r[e.index]==t));return i?!o:n?!l:!h}}));for(;d!==u;){let t=m(d.index);for(let e,r,i,s,o,a=0;a<t.length;++a){o=t[a],s=14,d.row!=o.row&&d.col!=o.col||(s=10),r=d.g+s,e=r+new x(10,14)[n](o,u);let l=p.some((t=>o===t)),h=f.some((t=>o===t));l||h?o.f>e&&(o.f=e,o.g=r,o.h=i,o.parent=d):(o.f=e,o.g=r,o.h=i,o.parent=d,p.push(o))}if(f.push(d),0==p.length)return g;p=p.sort(((t,e)=>t.f-e.f)),d=p.shift()}if(0!=p.length){let t=u;for(g.push(t);t!==c;)t=t.parent,g.unshift(t)}return g},lineOfSight(e,r,i,n,o=0,a=32,c=[]){let d,p,f,g,m,_,x=u(e,r),y=s.len(x),b=l(y/a),v=[];for(let r,i=1;i<=b;++i)r=t.Sprites.centerXY(e),p=a*i,m=x[0]/y,_=x[1]/y,f=l(r[0]+m*p),g=l(r[1]+_*p),v.push({x:f,y:g,index:h(f,g,n)});return d=180*Math.atan2(x[1],x[0])/Math.PI,v.every((t=>i[t.index]==o))&&(0==c.length||c.some((t=>t==d)))},crossCells(t,e){const r=e.tiled.tilesInX;return[t-r,t-1,t+1,t+r]},getCrossTiles(t,e,r){return this.crossCells(t,r).map((t=>e[t]))},getDiagonalCells(t,e){const r=i.num(e)?e:e.tiled.tilesInX;return[t-r-1,t-r+1,t+r-1,t+r+1]},getDiagonalTiles(t,e,r){return this.getDiagonalCells(t,r).map((t=>e[t]))},validDirections(r,i,s,n){const o=this.getTileIndex(r,n);return this.getCrossTiles(o,i,n).map(((r,i)=>r==s?e[i]:t.NONE)).filter((e=>e!==t.NONE))},canChangeDirection(e=[]){let r=e.find((e=>e===t.UP)),i=e.find((e=>e===t.DOWN)),s=e.find((e=>e===t.LEFT)),n=e.find((e=>e===t.RIGHT));return 0==e.length||1==e.length||(r||i)&&(s||n)},randomDirection:(e=[])=>0==e.length?t.NONE:1==e.length?e[0]:e[r.randInt2(0,e.length-1)],closestDirection(e,r){const i=u(e,r);return o(i[0])<o(i[1])?i[1]<=0?t.UP:t.DOWN:i[0]<=0?t.LEFT:t.RIGHT}};return t.Tiles=y}(t)}}(this),function(t,e){"use strict";console.log("mojoh5 version: 1.2.0")}(),function(t,e){"use strict";const r=Math.floor;Math.sin,Math.cos,Math.PI;function i(e){const{Sprites:i,Scenes:s,FX:n,Input:o,Game:a,Ute2D:l,math:h,v2:u,ute:c,is:d}=e,p={Buckland:{eng:t["io/czlab/mcfud/algo/NEAT_Buckland"](t["io/czlab/mcfud/core"](),t["io/czlab/mcfud/math"]()),id:"MB"},CBullet:{eng:t["io/czlab/mcfud/algo/NEAT_CBullet"](t["io/czlab/mcfud/core"](),t["io/czlab/mcfud/math"]()),id:"CB"}},f=e.DOKI_LOWER,g={title:"NEAT/Flappy Bird",clickSnd:"click.mp3",action:{name:"PlayGame"}};function m(t,r,s){let n=i.sprite("bird.png");return i.centerAnchor(n),i.scaleXY(n,r,r),n.x=e.width/3,n.y=e.height/2,n.m5.gravity=0,n.m5.speed=.5,n.m5.jump=-6,n.g.brain=s,n.g.score=0,n.g.flap=()=>{n.m5.gravity=n.m5.jump},n.g.update=()=>{n.m5.gravity+=n.m5.speed,n.y+=n.m5.gravity},n.g.isDead=(t,e)=>{if(n.y>=t||n.y+n.height<=0)return!0;for(let t=0;t<e.length;++t)if(!(n.x>e[t].x+e[t].width||n.x+n.width<e[t].x||n.y>e[t].y+e[t].height||n.y+n.height<e[t].y))return!0},n.g.think=t=>(t&&n.g.brain.compute(t)[0]>.65&&n.g.flap(),n.g),n.g.look=t=>{for(let r,i,s=0;s<t.length;s+=2){if(r=t[s],i=t[s+1],r.x+r.width>n.x)return[h.remap(i.y-(i.y-(r.y+r.height))/2-n.y,0,e.height,0,1),h.remap(r.x-n.x,0,e.width,0,1),h.remap(Math.max(0,i.y-n.y),0,e.height,0,1),h.remap(Math.max(0,n.y-r.y+r.height),0,e.height,0,1)];n.x>=r.x+r.width&&(r.g.passed=!0,i.g.passed=!0,n.g.score+=30)}},t.insert(n)}s.scene("PlayGame",{setup(){let t=this,r=e.getScaleFactor();c.inject(this.g,{initLevel(){this.bgs=c.fill(2,(()=>i.sprite("background.png"))),this.spawnInterval=90,this.NeatModule="CBullet",this.bgs.forEach((e=>{i.scaleToCanvas(t.insert(e))})),this.pipes=[],this.birds=[],this.interval=0,this.waitNextWave=0,this.pipesPassed=0,this.bestCurScore=0,this.bgSpeed=.5,this.bgX=0,this.swapEngine(this.NeatModule)},swapEngine(e){this.NeatModule=e,this.Neat=p[this.NeatModule],this.neatObj=new this.Neat.eng.NeatGA(50,4,1),this.birds.forEach((t=>i.remove(t))),this.birds=this.neatObj.createPhenotypes().map((e=>new m(t,r,e))),this.resetNext(!0)},tick(t){this.bgX+=this.bgSpeed,this.waitNextWave>0?--this.waitNextWave:this.doMoreTick(t)},doMoreTick(t){this.bestCurScore=0,this.birds.forEach(((t,r)=>{t.m5.dead?t.visible=!1:(t.g.think(t.g.look(this.pipes)).update(),t.g.isDead(e.height,this.pipes)?t.m5.dead=!0:(t.rotation=Math.PI/2*t.m5.gravity/20,t.g.score+=1),t.g.score>this.bestCurScore&&(this.bestCurScore=t.g.score))})),this.isItEnd()?this.resetNext():this.checkPipes().morePipes()},resetNext(e){this.pipes.forEach((t=>i.remove(t))),this.waitNextWave=30,this.pipesPassed=0,this.bestCurScore=0,this.interval=0,c.trunc(this.pipes),e||(this.birds=this.neatObj.epoch(this.birds.reduce(((t,e)=>t.push(e.g.score)&&i.remove(e)&&t),[])).map((e=>new m(t,r,e))))},checkPipes(){let t=[];for(let e,r,s=0;s<this.pipes.length;s+=2)r=this.pipes[s+1],e=this.pipes[s],e.x-=e.m5.speed,r.x=e.x,e.g.passed&&(e.g.dead||(this.pipesPassed+=1,e.g.dead=!0,r.g.dead=!0)),e.x+e.width<0?i.remove(e,r):t.push(e,r);return t.length<this.pipes.length&&c.append(this.pipes,t,!0),this},isItEnd(){return this.birds.every((t=>t.m5.dead))},morePipes(){if(0==this.interval){let s=50*r,n=120*r,o=Math.round(c.rand()*(e.height-2*s-n))+s;(function(t,[e,r,s],[n,o,a]){let l=i.sprite("pipetop.png"),h=i.sprite("pipebottom.png");i.scaleXY(l,t,2),i.scaleXY(h,t,2),l.x=e,l.y=s-l.height,h.x=n,h.y=o,l.g.passed=!1,h.g.passed=!1,l.m5.speed=3*t,h.m5.speed=l.m5.speed;let u=c.randItem(["red","green","blue","orange","purple"]);return u="magenta",i.tint(l,u),i.tint(h,u),[l,h]})(r,[e.width,0,o],[e.width,o+n,e.height]).forEach((e=>this.pipes.push(t.insert(e))))}return++this.interval>=this.spawnInterval&&(this.interval=0),this}}),this.g.initLevel(),this.g.genText=i.bmpText("",f,12*r),this.insert(this.g.genText),this.g.menu=i.sprite("menu.png"),i.scaleBy(this.g.menu,.6*r,.6*r),this.g.menu.anchor.x=1,this.g.menu.m5.press=()=>{c.delay(0,(()=>s.runEx("Splash",g)))},u.set(this.g.menu,e.width,0),this.insert(o.mkBtn(this.g.menu))},postUpdate(t){o.keyDown(o.TAB)?"CBullet"==this.g.NeatModule?this.g.swapEngine("Buckland"):"Buckland"==this.g.NeatModule&&this.g.swapEngine("CBullet"):(this.g.bgs.forEach(((t,e)=>{t.x=e*t.width-r(this.g.bgX%t.width),t.y=0})),this.g.tick(),this.g.genText.text=`Generation(${this.g.Neat.id}): ${this.g.neatObj.curGen()} - Pipes: ${this.g.pipesPassed} Score: ${this.g.bestCurScore}`)}}),s.run("Splash",g)}MojoH5Ldr({assetFiles:["bird.png","pipetop.png","pipebottom.png","menu.png","background.png","click.mp3"],arena:{width:1024,height:720},scaleToWindow:"max",start(...t){i(...t)}})}(this);